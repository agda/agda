<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Def</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM_</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntSet</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntSet</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">sconcat</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html"><span class="hs-identifier">Agda.Syntax.Concrete</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.Pretty.html"><span class="hs-identifier">Agda.Syntax.Concrete.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html"><span class="hs-identifier">Agda.Syntax.Position</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Pattern.html"><span class="hs-identifier">Agda.Syntax.Abstract.Pattern</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html"><span class="hs-identifier">Agda.Syntax.Abstract.Views</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Pattern.html"><span class="hs-identifier">Agda.Syntax.Internal.Pattern</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html"><span class="hs-identifier">Agda.Syntax.Internal.MetaVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html#allMetasList"><span class="hs-identifier">allMetasList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html"><span class="hs-identifier">Agda.Syntax.Info</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Info</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html"><span class="hs-identifier">Agda.Syntax.Info</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Info.html#defAbstract"><span class="hs-identifier">defAbstract</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html"><span class="hs-identifier">Agda.TypeChecking.Warnings</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier">warning</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html"><span class="hs-identifier">Agda.TypeChecking.Constraints</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html"><span class="hs-identifier">Agda.TypeChecking.Conversion</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html"><span class="hs-identifier">Agda.TypeChecking.Coverage.SplitTree</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Inlining.html"><span class="hs-identifier">Agda.TypeChecking.Inlining</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Patterns.Abstract.html"><span class="hs-identifier">Agda.TypeChecking.Patterns.Abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Patterns.Abstract.html#expandPatternSynonyms"><span class="hs-identifier">expandPatternSynonyms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CheckInternal.html"><span class="hs-identifier">Agda.TypeChecking.CheckInternal</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.With.html"><span class="hs-identifier">Agda.TypeChecking.With</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html"><span class="hs-identifier">Agda.TypeChecking.Telescope</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.Path.html"><span class="hs-identifier">Agda.TypeChecking.Telescope.Path</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Injectivity.html"><span class="hs-identifier">Agda.TypeChecking.Injectivity</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html"><span class="hs-identifier">Agda.TypeChecking.InstanceArguments</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html"><span class="hs-identifier">Agda.TypeChecking.SizedTypes.Solve</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rewriting.Confluence.html"><span class="hs-identifier">Agda.TypeChecking.Rewriting.Confluence</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html"><span class="hs-identifier">Agda.TypeChecking.CompiledClause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#CompiledClauses%27"><span class="hs-identifier">CompiledClauses'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Done"><span class="hs-identifier">Done</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#hasProjectionPatterns"><span class="hs-identifier">hasProjectionPatterns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html"><span class="hs-identifier">Agda.TypeChecking.CompiledClause.Compile</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.html"><span class="hs-identifier">Agda.TypeChecking.Primitive</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Primitive.html#Nat"><span class="hs-identifier">Nat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.RecordPatterns.html"><span class="hs-identifier">Agda.TypeChecking.RecordPatterns</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.RecordPatterns.html#recordRHSToCopatterns"><span class="hs-identifier">recordRHSToCopatterns</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Sort.html"><span class="hs-identifier">Agda.TypeChecking.Sort</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Term</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html"><span class="hs-identifier">Agda.TypeChecking.Rules.LHS</span></a></span><span>                 </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkLeftHandSide"><span class="hs-identifier">checkLeftHandSide</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier">LHSResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#bindAsPatterns"><span class="hs-identifier">bindAsPatterns</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Decl.html"><span class="hs-identifier">Agda.TypeChecking.Rules.Decl</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Decl.html#checkDecls"><span class="hs-identifier">checkDecls</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier">applyWhen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html#applyWhenM"><span class="hs-identifier">applyWhenM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html"><span class="hs-identifier">Agda.Utils.Functor</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier">List1</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><span class="hs-operator">(:|)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;|)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html"><span class="hs-identifier">Agda.Utils.List1</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List1</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html"><span class="hs-identifier">Agda.Utils.Permutation</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html"><span class="hs-identifier">Agda.Utils.Singleton</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.SmallSet.html"><span class="hs-identifier">Agda.Utils.SmallSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SmallSet</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Update.html"><span class="hs-identifier">Agda.Utils.Update</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-85"></span><span class="annot"><span class="hs-comment">-- * Definitions by pattern matching</span></span><span>
</span><span id="line-86"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkFunDef"><span class="hs-identifier hs-type">checkFunDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefInfo"><span class="hs-identifier hs-type">A.DefInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span id="checkFunDef"><span class="annot"><span class="annottext">checkFunDef :: DefInfo -&gt; QName -&gt; [Clause' LHS] -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkFunDef"><span class="hs-identifier hs-var hs-var">checkFunDef</span></a></span></span><span> </span><span id="local-6989586621682155532"><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682155533"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682155534"><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155534"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-comment">-- Reset blocking tag (in case a previous attempt was blocked)</span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><span class="annottext">(Signature -&gt; Signature) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-identifier hs-var">modifySignature</span></a></span><span> </span><span class="annot"><span class="annottext">((Signature -&gt; Signature) -&gt; TCM ())
-&gt; (Signature -&gt; Signature) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinition"><span class="hs-identifier hs-var">updateDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; Definition) -&gt; Signature -&gt; Signature)
-&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Blocked_ -&gt; Blocked_) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefBlocked"><span class="hs-identifier hs-var">updateDefBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">((Blocked_ -&gt; Blocked_) -&gt; Definition -&gt; Definition)
-&gt; (Blocked_ -&gt; Blocked_) -&gt; Definition -&gt; Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Blocked_ -&gt; Blocked_
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Blocked_ -&gt; Blocked_ -&gt; Blocked_)
-&gt; Blocked_ -&gt; Blocked_ -&gt; Blocked_
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-92"></span><span>          </span><span class="annot"><span class="annottext">NotBlocked' Term -&gt; () -&gt; Blocked_
forall t a. NotBlocked' t -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-var">NotBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; NotBlocked' Term
forall t. QName -&gt; NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#MissingClauses"><span class="hs-identifier hs-var">MissingClauses</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-comment">-- Get the type and relevance of the function</span><span>
</span><span id="line-94"></span><span>        </span><span id="local-6989586621682155541"><span class="annot"><a href="#local-6989586621682155541"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; TCMT IO Definition
forall (m :: * -&gt; *).
(Functor m, HasConstInfo m, HasOptions m, ReadTCState m,
 MonadTCEnv m, MonadDebug m) =&gt;
Definition -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#instantiateDef"><span class="hs-identifier hs-var">instantiateDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO Definition)
-&gt; TCMT IO Definition -&gt; TCMT IO Definition
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-95"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155545"><span class="annot"><a href="#local-6989586621682155545"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682155541"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-96"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155547"><span class="annot"><a href="#local-6989586621682155547"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682155541"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-comment">-- If the function is erased, then hard compile-time mode is</span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-comment">-- entered.</span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#setHardCompileTimeModeIfErased%27"><span class="hs-identifier hs-type">setHardCompileTimeModeIfErased'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155547"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#isAlias"><span class="hs-identifier hs-type">isAlias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155534"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155545"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- #418: Don't use checkAlias for abstract definitions, since the type</span><span>
</span><span id="line-103"></span><span>                              </span><span class="hs-comment">-- of an abstract function must not be informed by its definition.</span><span>
</span><span id="line-104"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155551"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155551"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682155552"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682155552"><span class="hs-identifier hs-var">mc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682155553"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682155553"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DefInfo -&gt; IsAbstract
forall t. DefInfo' t -&gt; IsAbstract
</span><a href="Agda.Syntax.Info.html#defAbstract"><span class="hs-identifier hs-var">Info.defAbstract</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">IsAbstract -&gt; IsAbstract -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsAbstract
</span><a href="Agda.Syntax.Common.html#ConcreteDef"><span class="hs-identifier hs-var">ConcreteDef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefInfo -&gt; IsOpaque
forall t. DefInfo' t -&gt; IsOpaque
</span><a href="Agda.Syntax.Info.html#defOpaque"><span class="hs-identifier hs-var">Info.defOpaque</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">IsOpaque -&gt; IsOpaque -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsOpaque
</span><a href="Agda.Syntax.Common.html#TransparentDef"><span class="hs-identifier hs-var">TransparentDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>              </span><span class="annot"><span class="annottext">Call -&gt; TCM () -&gt; TCM ()
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; QName -&gt; Bool -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckFunDefCall"><span class="hs-identifier hs-var">CheckFunDefCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefInfo -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>                </span><span class="hs-comment">-- Andreas, 2012-11-22: if the alias is in an abstract block</span><span>
</span><span id="line-108"></span><span>                </span><span class="hs-comment">-- it has been frozen.  We unfreeze it to enable type inference.</span><span>
</span><span id="line-109"></span><span>                </span><span class="hs-comment">-- See issue 729.</span><span>
</span><span id="line-110"></span><span>                </span><span class="hs-comment">-- Ulf, 2021-02-09: also unfreeze metas in the sort of this type</span><span>
</span><span id="line-111"></span><span>                </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Bool
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m Bool
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#isFrozen"><span class="hs-identifier hs-var">isFrozen</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682155553"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>                  </span><span id="local-6989586621682155562"><span class="annot"><a href="#local-6989586621682155562"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [MetaId]
forall a. AllMetas a =&gt; a -&gt; [MetaId]
</span><a href="Agda.Syntax.Internal.MetaVars.html#allMetasList"><span class="hs-identifier hs-var">allMetasList</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; [MetaId])
-&gt; (MetaVariable -&gt; Type) -&gt; MetaVariable -&gt; [MetaId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Judgement MetaId -&gt; Type
forall a. Judgement a -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#jMetaType"><span class="hs-identifier hs-var">jMetaType</span></a></span><span> </span><span class="annot"><span class="annottext">(Judgement MetaId -&gt; Type)
-&gt; (MetaVariable -&gt; Judgement MetaId) -&gt; MetaVariable -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaVariable -&gt; [MetaId])
-&gt; TCMT IO MetaVariable -&gt; TCMT IO [MetaId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaVariable
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta"><span class="hs-identifier hs-var">lookupLocalMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682155553"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-113"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#unfreezeMeta"><span class="hs-identifier hs-type">unfreezeMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682155553"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621682155562"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>                </span><span class="annot"><span class="annottext">Type -&gt; ArgInfo -&gt; DefInfo -&gt; QName -&gt; Expr -&gt; Maybe Expr -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkAlias"><span class="hs-identifier hs-var">checkAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155545"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155547"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155551"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682155552"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-115"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Warn about abstract alias (will never work!)</span><span>
</span><span id="line-116"></span><span>              </span><span class="hs-comment">-- Ulf, 2021-11-18, #5620: Don't warn if the meta is solved. A more intuitive solution</span><span>
</span><span id="line-117"></span><span>              </span><span class="hs-comment">-- would be to not treat definitions with solved meta types as aliases, but in mutual</span><span>
</span><span id="line-118"></span><span>              </span><span class="hs-comment">-- blocks you might actually have solved the type of an alias by the time you get to</span><span>
</span><span id="line-119"></span><span>              </span><span class="hs-comment">-- the definition. See test/Succeed/SizeInfinity.agda for an example where this</span><span>
</span><span id="line-120"></span><span>              </span><span class="hs-comment">-- happens.</span><span>
</span><span id="line-121"></span><span>              </span><span class="annot"><span class="annottext">TCMT IO Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInstantiation -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#isOpenMeta"><span class="hs-identifier hs-var">isOpenMeta</span></a></span><span> </span><span class="annot"><span class="annottext">(MetaInstantiation -&gt; Bool)
-&gt; TCMT IO MetaInstantiation -&gt; TCMT IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaInstantiation
forall (m :: * -&gt; *).
ReadTCState m =&gt;
MetaId -&gt; m MetaInstantiation
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupMetaInstantiation"><span class="hs-identifier hs-var">lookupMetaInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682155553"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-122"></span><span>                </span><span class="annot"><span class="annottext">DefInfo -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; Warning -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; IsOpaque -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#MissingTypeSignatureForOpaque"><span class="hs-identifier hs-var">MissingTypeSignatureForOpaque</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefInfo -&gt; IsOpaque
forall t. DefInfo' t -&gt; IsOpaque
</span><a href="Agda.Syntax.Info.html#defOpaque"><span class="hs-identifier hs-var">Info.defOpaque</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>              </span><span class="annot"><span class="annottext">Type
-&gt; ArgInfo
-&gt; Maybe ExtLamInfo
-&gt; Maybe QName
-&gt; DefInfo
-&gt; QName
-&gt; [Clause' LHS]
-&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkFunDef%27"><span class="hs-identifier hs-var">checkFunDef'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155545"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155547"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ExtLamInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe QName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155534"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-124"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Expr, Maybe Expr, MetaId)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; ArgInfo
-&gt; Maybe ExtLamInfo
-&gt; Maybe QName
-&gt; DefInfo
-&gt; QName
-&gt; [Clause' LHS]
-&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkFunDef%27"><span class="hs-identifier hs-var">checkFunDef'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155545"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155547"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ExtLamInfo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe QName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155534"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-comment">-- If it's a macro check that it ends in Term &#8594; TC &#8868;</span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155576"><span class="annot"><a href="#local-6989586621682155576"><span class="hs-identifier hs-var hs-var">ismacro</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#isMacro"><span class="hs-identifier hs-var">isMacro</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; Bool) -&gt; (Definition -&gt; Defn) -&gt; Definition -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Bool) -&gt; Definition -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682155541"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682155576"><span class="hs-identifier hs-type">ismacro</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#defMacro"><span class="hs-identifier hs-var">Info.defMacro</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155532"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MacroDef"><span class="hs-identifier hs-type">MacroDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkMacroType"><span class="hs-identifier hs-type">checkMacroType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155545"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">TCM () -&gt; ((TCErr, Blocker) -&gt; TCM ()) -&gt; TCM ()
forall a. TCM a -&gt; ((TCErr, Blocker) -&gt; TCM a) -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#catchIlltypedPatternBlockedOnMeta"><span class="hs-operator hs-var">`catchIlltypedPatternBlockedOnMeta`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155585"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682155585"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682155586"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682155586"><span class="hs-identifier hs-var">blocker</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.def&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-131"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking function definition got stuck on: &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682155586"><span class="hs-identifier hs-var">blocker</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="annottext">(Signature -&gt; Signature) -&gt; TCM ()
forall (m :: * -&gt; *).
MonadTCState m =&gt;
(Signature -&gt; Signature) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.State.html#modifySignature"><span class="hs-identifier hs-var">modifySignature</span></a></span><span> </span><span class="annot"><span class="annottext">((Signature -&gt; Signature) -&gt; TCM ())
-&gt; (Signature -&gt; Signature) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefinition"><span class="hs-identifier hs-var">updateDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">((Definition -&gt; Definition) -&gt; Signature -&gt; Signature)
-&gt; (Definition -&gt; Definition) -&gt; Signature -&gt; Signature
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Blocked_ -&gt; Blocked_) -&gt; Definition -&gt; Definition
</span><a href="Agda.TypeChecking.Monad.State.html#updateDefBlocked"><span class="hs-identifier hs-var">updateDefBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">((Blocked_ -&gt; Blocked_) -&gt; Definition -&gt; Definition)
-&gt; (Blocked_ -&gt; Blocked_) -&gt; Definition -&gt; Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocked_ -&gt; Blocked_ -&gt; Blocked_
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Blocked_ -&gt; Blocked_ -&gt; Blocked_)
-&gt; Blocked_ -&gt; Blocked_ -&gt; Blocked_
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; () -&gt; Blocked_
forall t a. Blocker -&gt; a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-var">Blocked</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682155586"><span class="hs-identifier hs-var">blocker</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">Blocker -&gt; Constraint -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConstraint m =&gt;
Blocker -&gt; Constraint -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Constraints.html#addConstraint"><span class="hs-identifier hs-var">addConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682155586"><span class="hs-identifier hs-var">blocker</span></a></span><span> </span><span class="annot"><span class="annottext">(Constraint -&gt; TCM ()) -&gt; Constraint -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DefInfo -&gt; QName -&gt; [Clause' LHS] -&gt; TCErr -&gt; Constraint
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckFunDef"><span class="hs-identifier hs-var">CheckFunDef</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155532"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155533"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155534"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682155585"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkMacroType"><span class="hs-identifier hs-type">checkMacroType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span id="checkMacroType"><span class="annot"><span class="annottext">checkMacroType :: Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkMacroType"><span class="hs-identifier hs-var hs-var">checkMacroType</span></a></span></span><span> </span><span id="local-6989586621682155594"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155594"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682155596"><span class="annot"><a href="#local-6989586621682155596"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682155597"><span class="annot"><a href="#local-6989586621682155597"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telView"><span class="hs-identifier hs-var">telView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155594"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155599"><span class="annot"><a href="#local-6989586621682155599"><span class="hs-identifier hs-var hs-var">telList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Dom ([Char], Type)]
forall t. Tele (Dom t) -&gt; [Dom ([Char], t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682155596"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span id="local-6989586621682155601"><span class="annot"><a href="#local-6989586621682155601"><span class="hs-identifier hs-var hs-var">resType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Type -&gt; Type
forall t. Abstract t =&gt; Tele (Dom Type) -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom ([Char], Type)] -&gt; Tele (Dom Type)
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Dom ([Char], Type)] -&gt; [Dom ([Char], Type)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dom ([Char], Type)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Dom ([Char], Type)]
</span><a href="#local-6989586621682155599"><span class="hs-identifier hs-var">telList</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dom ([Char], Type)]
</span><a href="#local-6989586621682155599"><span class="hs-identifier hs-var">telList</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155597"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span id="local-6989586621682155606"><span class="annot"><a href="#local-6989586621682155606"><span class="hs-identifier hs-var">expectedType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.Base.html#el"><span class="hs-identifier hs-type">el</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primAgdaTerm"><span class="hs-identifier hs-type">primAgdaTerm</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.Base.html#--%3E"><span class="hs-operator hs-type">--&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.Base.html#el"><span class="hs-identifier hs-type">el</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primAgdaTCM"><span class="hs-identifier hs-type">primAgdaTCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.Base.html#%3C%23%3E"><span class="hs-operator hs-type">&lt;#&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primLevelZero"><span class="hs-identifier hs-type">primLevelZero</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.Base.html#%3C%40%3E"><span class="hs-operator hs-type">&lt;@&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primUnit"><span class="hs-identifier hs-type">primUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalType"><span class="hs-identifier hs-type">equalType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155601"><span class="hs-identifier hs-type">resType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155606"><span class="hs-identifier hs-type">expectedType</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#MacroResultTypeMismatch"><span class="hs-identifier hs-var">MacroResultTypeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155606"><span class="hs-identifier hs-var">expectedType</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><span class="hs-comment">-- | A single clause without arguments and without type signature is an alias.</span></span><span>
</span><span id="line-146"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#isAlias"><span class="hs-identifier hs-type">isAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Expr"><span class="hs-identifier hs-type">C.Expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span id="isAlias"><span class="annot"><span class="annottext">isAlias :: [Clause' LHS] -&gt; Type -&gt; Maybe (Expr, Maybe Expr, MetaId)
</span><a href="Agda.TypeChecking.Rules.Def.html#isAlias"><span class="hs-identifier hs-var hs-var">isAlias</span></a></span></span><span> </span><span id="local-6989586621682155619"><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155619"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682155620"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155620"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Clause' LHS] -&gt; Maybe (Expr, Maybe Expr)
</span><a href="#local-6989586621682155621"><span class="hs-identifier hs-var">trivialClause</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155619"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-149"></span><span>          </span><span class="hs-comment">-- if we have just one clause without pattern matching and</span><span>
</span><span id="line-150"></span><span>          </span><span class="hs-comment">-- without a type signature, then infer, to allow</span><span>
</span><span id="line-151"></span><span>          </span><span class="hs-comment">-- &quot;aliases&quot; for things starting with hidden abstractions</span><span>
</span><span id="line-152"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155622"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155622"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682155623"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682155623"><span class="hs-identifier hs-var">mc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682155624"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682155624"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Maybe MetaId
</span><a href="#local-6989586621682155625"><span class="hs-identifier hs-var">isMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Term
forall t a. Type'' t a -&gt; a
</span><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155620"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Expr, Maybe Expr, MetaId) -&gt; Maybe (Expr, Maybe Expr, MetaId)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155622"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682155623"><span class="hs-identifier hs-var">mc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682155624"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Expr, Maybe Expr)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Expr, Maybe Expr, MetaId)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621682155625"><span class="annot"><span class="annottext">isMeta :: Term -&gt; Maybe MetaId
</span><a href="#local-6989586621682155625"><span class="hs-identifier hs-var hs-var">isMeta</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span id="local-6989586621682155628"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682155628"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Maybe MetaId
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682155628"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><a href="#local-6989586621682155625"><span class="hs-identifier hs-var">isMeta</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe MetaId
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621682155621"><span class="annot"><span class="annottext">trivialClause :: [Clause' LHS] -&gt; Maybe (Expr, Maybe Expr)
</span><a href="#local-6989586621682155621"><span class="hs-identifier hs-var hs-var">trivialClause</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHS"><span class="hs-identifier hs-type">A.LHS</span></a></span><span> </span><span id="local-6989586621682155633"><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682155633"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSHead"><span class="hs-identifier hs-type">A.LHSHead</span></a></span><span> </span><span id="local-6989586621682155635"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155635"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span> </span><span id="local-6989586621682155637"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155637"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682155638"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682155638"><span class="hs-identifier hs-var">mc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682155639"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682155639"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Catchall
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WhereDeclarations -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682155639"><span class="hs-identifier hs-var">wh</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Expr, Maybe Expr) -&gt; Maybe (Expr, Maybe Expr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155637"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682155638"><span class="hs-identifier hs-var">mc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><a href="#local-6989586621682155621"><span class="hs-identifier hs-var">trivialClause</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause' LHS]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Expr, Maybe Expr)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><span class="hs-comment">-- | Check a trivial definition of the form @f = e@</span></span><span>
</span><span id="line-162"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkAlias"><span class="hs-identifier hs-type">checkAlias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefInfo"><span class="hs-identifier hs-type">A.DefInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#Expr"><span class="hs-identifier hs-type">C.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span id="checkAlias"><span class="annot"><span class="annottext">checkAlias :: Type -&gt; ArgInfo -&gt; DefInfo -&gt; QName -&gt; Expr -&gt; Maybe Expr -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkAlias"><span class="hs-identifier hs-var hs-var">checkAlias</span></a></span></span><span> </span><span id="local-6989586621682155641"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155641"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682155642"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155642"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682155643"><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155643"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682155644"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155644"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682155645"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155645"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682155646"><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682155646"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155647"><span class="annot"><span class="annottext">clause :: SpineClause
</span><a href="#local-6989586621682155647"><span class="hs-identifier hs-var hs-var">clause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">clauseLHS :: SpineLHS
</span><a href="Agda.Syntax.Abstract.html#clauseLHS"><span class="hs-identifier hs-var">clauseLHS</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHSInfo -&gt; QName -&gt; [NamedArg (Pattern' Expr)] -&gt; SpineLHS
</span><a href="Agda.Syntax.Abstract.html#SpineLHS"><span class="hs-identifier hs-var">A.SpineLHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; ExpandedEllipsis -&gt; LHSInfo
</span><a href="Agda.Syntax.Info.html#LHSInfo"><span class="hs-identifier hs-var">LHSInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefInfo -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155643"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpandedEllipsis
</span><a href="Agda.Syntax.Common.html#NoEllipsis"><span class="hs-identifier hs-var">NoEllipsis</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155644"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-165"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseStrippedPats :: [ProblemEq]
</span><a href="Agda.Syntax.Abstract.html#clauseStrippedPats"><span class="hs-identifier hs-var">clauseStrippedPats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseRHS :: RHS
</span><a href="Agda.Syntax.Abstract.html#clauseRHS"><span class="hs-identifier hs-var">clauseRHS</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Maybe Expr -&gt; RHS
</span><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-var">A.RHS</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155645"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><a href="#local-6989586621682155646"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-167"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseWhereDecls :: WhereDeclarations
</span><a href="Agda.Syntax.Abstract.html#clauseWhereDecls"><span class="hs-identifier hs-var">clauseWhereDecls</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="Agda.Syntax.Abstract.html#noWhereDecls"><span class="hs-identifier hs-var">A.noWhereDecls</span></a></span><span>
</span><span id="line-168"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseCatchall :: Catchall
</span><a href="Agda.Syntax.Abstract.html#clauseCatchall"><span class="hs-identifier hs-var">clauseCatchall</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Catchall
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="annottext">QName
-&gt; Int
-&gt; Type
-&gt; Maybe Substitution
-&gt; SpineClause
-&gt; TCM ()
-&gt; TCM ()
forall a.
QName
-&gt; Int
-&gt; Type
-&gt; Maybe Substitution
-&gt; SpineClause
-&gt; TCM a
-&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Def.html#atClause"><span class="hs-identifier hs-var">atClause</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155644"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155641"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Substitution
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">SpineClause
</span><a href="#local-6989586621682155647"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.def.alias&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checkAlias&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155644"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155641"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; [Char]
forall a. Pretty a =&gt; a -&gt; [Char]
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155644"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#equals"><span class="hs-identifier hs-var">equals</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Expr -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155645"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-comment">-- Infer the type of the rhs.</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-comment">-- Andreas, 2018-06-09, issue #2170.</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-comment">-- The context will only be resurrected if we have --irrelevant-projections.</span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621682155663"><span class="annot"><a href="#local-6989586621682155663"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; TCMT IO Term -&gt; TCMT IO Term
forall (tcm :: * -&gt; *) r a.
(MonadTCM tcm, LensModality r) =&gt;
r -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyModalityToContextFunBody"><span class="hs-identifier hs-var">applyModalityToContextFunBody</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155642"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Term -&gt; TCMT IO Term) -&gt; TCMT IO Term -&gt; TCMT IO Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Comparison -&gt; Expr -&gt; Type -&gt; TCMT IO Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkDontExpandLast"><span class="hs-identifier hs-var">checkDontExpandLast</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682155645"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155641"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.def.alias&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;checkAlias: finished checking&quot;</span></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#solveSizeConstraints"><span class="hs-identifier hs-type">solveSizeConstraints</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#DontDefaultToInfty"><span class="hs-identifier hs-type">DontDefaultToInfty</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>  </span><span id="local-6989586621682155669"><span class="annot"><a href="#local-6989586621682155669"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155663"><span class="hs-identifier hs-type">v</span></a></span><span>  </span><span class="hs-comment">-- if we omit this, we loop (stdlib: Relation.Binary.Sum)</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">-- or the termination checker might stumble over levels in sorts</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">-- that cannot be converted to expressions without the level built-ins</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- (test/succeed/Issue655.agda)</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-comment">-- compute body modification for irrelevant definitions, see issue 610</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155671"><span class="annot"><a href="#local-6989586621682155671"><span class="hs-identifier hs-var hs-var">bodyMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (Term -&gt; Term) -&gt; Term -&gt; Term
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier hs-var">applyWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-var">isIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155642"><span class="hs-identifier hs-var">ai</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#dontCare"><span class="hs-identifier hs-var">dontCare</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-comment">-- Add the definition</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621682155674"><span class="annot"><a href="#local-6989586621682155674"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#emptyFunctionData"><span class="hs-identifier hs-type">emptyFunctionData</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#addConstant%27"><span class="hs-identifier hs-type">addConstant'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155644"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155642"><span class="hs-identifier hs-type">ai</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155641"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#FunctionDefn"><span class="hs-identifier hs-type">FunctionDefn</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funMacro_"><span class="hs-identifier hs-type">funMacro_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Info.html#defMacro"><span class="hs-identifier hs-var">Info.defMacro</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155643"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MacroDef"><span class="hs-identifier hs-type">MacroDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funAbstr_"><span class="hs-identifier hs-type">funAbstr_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Info.html#defAbstract"><span class="hs-identifier hs-var">Info.defAbstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155643"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-197"></span><span>      </span><span class="annot"><a href="#local-6989586621682155674"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funClauses"><span class="hs-identifier hs-var">_funClauses</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span>  </span><span class="hs-comment">-- trivial clause @name = v@</span><span>
</span><span id="line-198"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseLHSRange"><span class="hs-identifier hs-var">clauseLHSRange</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-type">getRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155643"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-199"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseFullRange"><span class="hs-identifier hs-var">clauseFullRange</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-type">getRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155643"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-200"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseTel"><span class="hs-identifier hs-var">clauseTel</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EmptyTel"><span class="hs-identifier hs-type">EmptyTel</span></a></span><span>
</span><span id="line-201"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-202"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682155671"><span class="hs-identifier hs-type">bodyMod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155669"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-203"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseType"><span class="hs-identifier hs-var">clauseType</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155642"><span class="hs-identifier hs-type">ai</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155641"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-204"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseCatchall"><span class="hs-identifier hs-var">clauseCatchall</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span>
</span><span id="line-205"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseRecursive"><span class="hs-identifier hs-var">clauseRecursive</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#MaybeRecursive"><span class="hs-identifier hs-type">MaybeRecursive</span></a></span><span>   </span><span class="hs-comment">-- we don't know yet</span><span>
</span><span id="line-206"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseUnreachable"><span class="hs-identifier hs-var">clauseUnreachable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-207"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseEllipsis"><span class="hs-identifier hs-var">clauseEllipsis</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#NoEllipsis"><span class="hs-identifier hs-type">NoEllipsis</span></a></span><span>
</span><span id="line-208"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseWhereModule"><span class="hs-identifier hs-var">clauseWhereModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-209"></span><span>              </span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funCompiled"><span class="hs-identifier hs-var">_funCompiled</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#MaybeRecursive"><span class="hs-identifier hs-type">MaybeRecursive</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682155671"><span class="hs-identifier hs-type">bodyMod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155669"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-211"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funSplitTree"><span class="hs-identifier hs-var">_funSplitTree</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Coverage.SplitTree.html#SplittingDone"><span class="hs-identifier hs-type">SplittingDone</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funOpaque"><span class="hs-identifier hs-var">_funOpaque</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#defOpaque"><span class="hs-identifier hs-var">Info.defOpaque</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155643"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-comment">-- Andreas, 2017-01-01, issue #2372:</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-comment">-- Add the definition to the instance table, if needed, to update its type.</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#defInstance"><span class="hs-identifier hs-var">Info.defInstance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155643"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#InstanceDef"><span class="hs-identifier hs-type">InstanceDef</span></a></span><span> </span><span id="local-6989586621682155707"><span class="annot"><span class="annottext">KwRange
</span><a href="#local-6989586621682155707"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155644"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.InstanceArguments.html#readdTypedInstance"><span class="hs-identifier hs-var">readdTypedInstance</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155644"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155641"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-219"></span><span>      </span><span class="hs-comment">-- Put highlighting on the name only;</span><span>
</span><span id="line-220"></span><span>      </span><span class="hs-comment">-- @(getRange (r, name))@ does not give good results.</span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="annottext">IsInstance
</span><a href="Agda.Syntax.Common.html#NotInstanceDef"><span class="hs-identifier hs-var">NotInstanceDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.def.alias&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;checkAlias: leaving&quot;</span></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="annot"><span class="hs-comment">-- | Type check a definition by pattern matching.</span></span><span>
</span><span id="line-227"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkFunDef%27"><span class="hs-identifier hs-type">checkFunDef'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ the type we expect the function to have</span></span><span>
</span><span id="line-228"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ is it irrelevant (for instance)</span></span><span>
</span><span id="line-229"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExtLamInfo"><span class="hs-identifier hs-type">ExtLamInfo</span></a></span><span> </span><span class="hs-comment">-- ^ does the definition come from an extended lambda</span><span>
</span><span id="line-230"></span><span>                                 </span><span class="hs-comment">--   (if so, we need to know some stuff about lambda-lifted args)</span><span>
</span><span id="line-231"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ is it a with function (if so, what's the name of the parent function)</span></span><span>
</span><span id="line-232"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefInfo"><span class="hs-identifier hs-type">A.DefInfo</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ range info</span></span><span>
</span><span id="line-233"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ the name of the function</span></span><span>
</span><span id="line-234"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span class="hs-special">]</span><span>       </span><span class="annot"><span class="hs-comment">-- ^ the clauses to check</span></span><span>
</span><span id="line-235"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span id="checkFunDef%27"><span class="annot"><span class="annottext">checkFunDef' :: Type
-&gt; ArgInfo
-&gt; Maybe ExtLamInfo
-&gt; Maybe QName
-&gt; DefInfo
-&gt; QName
-&gt; [Clause' LHS]
-&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkFunDef%27"><span class="hs-identifier hs-var hs-var">checkFunDef'</span></a></span></span><span> </span><span id="local-6989586621682155710"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155710"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682155711"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155711"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682155712"><span class="annot"><span class="annottext">Maybe ExtLamInfo
</span><a href="#local-6989586621682155712"><span class="hs-identifier hs-var">extlam</span></a></span></span><span> </span><span id="local-6989586621682155713"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682155713"><span class="hs-identifier hs-var">with</span></a></span></span><span> </span><span id="local-6989586621682155714"><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155714"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682155715"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155715"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682155716"><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155716"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><span class="annottext">Type
-&gt; ArgInfo
-&gt; Maybe ExtLamInfo
-&gt; Maybe QName
-&gt; DefInfo
-&gt; QName
-&gt; Maybe (Substitution, Map Name LetBinding)
-&gt; [Clause' LHS]
-&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkFunDefS"><span class="hs-identifier hs-var">checkFunDefS</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155710"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155711"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ExtLamInfo
</span><a href="#local-6989586621682155712"><span class="hs-identifier hs-var">extlam</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682155713"><span class="hs-identifier hs-var">with</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155714"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155715"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Substitution, Map Name LetBinding)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155716"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><span class="hs-comment">-- | Type check a definition by pattern matching.</span></span><span>
</span><span id="line-240"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkFunDefS"><span class="hs-identifier hs-type">checkFunDefS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ the type we expect the function to have</span></span><span>
</span><span id="line-241"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#ArgInfo"><span class="hs-identifier hs-type">ArgInfo</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ is it irrelevant (for instance)</span></span><span>
</span><span id="line-242"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#ExtLamInfo"><span class="hs-identifier hs-type">ExtLamInfo</span></a></span><span> </span><span class="hs-comment">-- ^ does the definition come from an extended lambda</span><span>
</span><span id="line-243"></span><span>                                 </span><span class="hs-comment">--   (if so, we need to know some stuff about lambda-lifted args)</span><span>
</span><span id="line-244"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ is it a with function (if so, what's the name of the parent function)</span></span><span>
</span><span id="line-245"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#DefInfo"><span class="hs-identifier hs-type">A.DefInfo</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ range info</span></span><span>
</span><span id="line-246"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ the name of the function</span></span><span>
</span><span id="line-247"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#LetBinding"><span class="hs-identifier hs-type">LetBinding</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>                                 </span><span class="hs-comment">-- ^ substitution (from with abstraction) that needs to be applied</span><span>
</span><span id="line-249"></span><span>                                 </span><span class="hs-comment">--   to module parameters, and let-bindings inherited from parent</span><span>
</span><span id="line-250"></span><span>                                 </span><span class="hs-comment">--   clause</span><span>
</span><span id="line-251"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span class="hs-special">]</span><span>       </span><span class="annot"><span class="hs-comment">-- ^ the clauses to check</span></span><span>
</span><span id="line-252"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span id="checkFunDefS"><span class="annot"><span class="annottext">checkFunDefS :: Type
-&gt; ArgInfo
-&gt; Maybe ExtLamInfo
-&gt; Maybe QName
-&gt; DefInfo
-&gt; QName
-&gt; Maybe (Substitution, Map Name LetBinding)
-&gt; [Clause' LHS]
-&gt; TCM ()
</span><a href="Agda.TypeChecking.Rules.Def.html#checkFunDefS"><span class="hs-identifier hs-var hs-var">checkFunDefS</span></a></span></span><span> </span><span id="local-6989586621682155718"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155718"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682155719"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155719"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span id="local-6989586621682155720"><span class="annot"><span class="annottext">Maybe ExtLamInfo
</span><a href="#local-6989586621682155720"><span class="hs-identifier hs-var">extlam</span></a></span></span><span> </span><span id="local-6989586621682155721"><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682155721"><span class="hs-identifier hs-var">with</span></a></span></span><span> </span><span id="local-6989586621682155722"><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155722"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682155723"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155723"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682155724"><span class="annot"><span class="annottext">Maybe (Substitution, Map Name LetBinding)
</span><a href="#local-6989586621682155724"><span class="hs-identifier hs-var">withSubAndLets</span></a></span></span><span> </span><span id="local-6989586621682155725"><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155725"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">Call -&gt; TCM () -&gt; TCM ()
forall a. Call -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; QName -&gt; Bool -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckFunDefCall"><span class="hs-identifier hs-var">CheckFunDefCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefInfo -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">DefInfo
</span><a href="#local-6989586621682155722"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155723"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.def.fun&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking body of&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155723"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-258"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155718"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-259"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;full type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TCMT IO Doc)
-&gt; (Definition -&gt; Type) -&gt; Definition -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO Doc) -&gt; TCMT IO Definition -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155723"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.def.fun&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;clauses:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; [TCMT IO Doc] -&gt; [TCMT IO Doc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Clause' LHS -&gt; TCMT IO Doc) -&gt; [Clause' LHS] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc)
-&gt; (Clause' LHS -&gt; TCMT IO Doc) -&gt; Clause' LHS -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO Doc)
-&gt; (Clause' LHS -&gt; [Char]) -&gt; Clause' LHS -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Clause' LHS -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Clause' LHS -&gt; [Char])
-&gt; (Clause' LHS -&gt; Clause' LHS) -&gt; Clause' LHS -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Clause' LHS -&gt; Clause' LHS
forall a. ExprLike a =&gt; a -&gt; a
</span><a href="Agda.Syntax.Abstract.Views.html#deepUnscope"><span class="hs-identifier hs-var">A.deepUnscope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155725"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>        </span><span id="local-6989586621682155730"><span class="annot"><a href="#local-6989586621682155730"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SpineClause] -&gt; TCMT IO [SpineClause]
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([SpineClause] -&gt; TCMT IO [SpineClause])
-&gt; [SpineClause] -&gt; TCMT IO [SpineClause]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Clause' LHS -&gt; SpineClause) -&gt; [Clause' LHS] -&gt; [SpineClause]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Clause' LHS -&gt; SpineClause
forall a b. LHSToSpine a b =&gt; a -&gt; b
</span><a href="Agda.Syntax.Abstract.Pattern.html#lhsToSpine"><span class="hs-identifier hs-var">A.lhsToSpine</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause' LHS]
</span><a href="#local-6989586621682155725"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.def.fun&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-268"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;spine clauses:&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Views.html#deepUnscope"><span class="hs-identifier hs-type">A.deepUnscope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155730"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-comment">-- Ensure that all clauses have the same number of trailing hidden patterns</span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-comment">-- This is necessary since trailing implicits are no longer eagerly inserted.</span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-comment">-- Andreas, 2013-10-13</span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-comment">-- Since we have flexible function arity, it is no longer necessary</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-comment">-- to patch clauses to same arity</span><span>
</span><span id="line-275"></span><span>        </span><span class="hs-comment">-- cs &lt;- trailingImplicits t cs</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-comment">-- Check the clauses</span><span>
</span><span id="line-278"></span><span>        </span><span id="local-6989586621682155732"><span class="annot"><a href="#local-6989586621682155732"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-type">traceCall</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NoHighlighting"><span class="hs-identifier hs-type">NoHighlighting</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- To avoid flicker.</span><span>
</span><span id="line-279"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="annot"><a href="#local-6989586621682155730"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155734"><span class="annot"><span class="annottext">SpineClause
</span><a href="#local-6989586621682155734"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682155735"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155735"><span class="hs-identifier hs-var">clauseNo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-280"></span><span>            </span><span class="annot"><span class="annottext">QName
-&gt; Int
-&gt; Type
-&gt; Maybe Substitution
-&gt; SpineClause
-&gt; TCMT IO (Clause, ClausesPostChecks)
-&gt; TCMT IO (Clause, ClausesPostChecks)
forall a.
QName
-&gt; Int
-&gt; Type
-&gt; Maybe Substitution
-&gt; SpineClause
-&gt; TCM a
-&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Def.html#atClause"><span class="hs-identifier hs-var">atClause</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155723"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155735"><span class="hs-identifier hs-var">clauseNo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155718"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Substitution, Map Name LetBinding) -&gt; Substitution
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Substitution, Map Name LetBinding) -&gt; Substitution)
-&gt; Maybe (Substitution, Map Name LetBinding) -&gt; Maybe Substitution
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Substitution, Map Name LetBinding)
</span><a href="#local-6989586621682155724"><span class="hs-identifier hs-var">withSubAndLets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpineClause
</span><a href="#local-6989586621682155734"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Clause, ClausesPostChecks)
 -&gt; TCMT IO (Clause, ClausesPostChecks))
-&gt; TCMT IO (Clause, ClausesPostChecks)
-&gt; TCMT IO (Clause, ClausesPostChecks)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682155737"><span class="annot"><a href="#local-6989586621682155737"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682155738"><span class="annot"><a href="#local-6989586621682155738"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ArgInfo
-&gt; TCMT IO (Clause, ClausesPostChecks)
-&gt; TCMT IO (Clause, ClausesPostChecks)
forall (tcm :: * -&gt; *) r a.
(MonadTCM tcm, LensModality r) =&gt;
r -&gt; tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Modality.html#applyModalityToContextFunBody"><span class="hs-identifier hs-var">applyModalityToContextFunBody</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155719"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Clause, ClausesPostChecks)
 -&gt; TCMT IO (Clause, ClausesPostChecks))
-&gt; TCMT IO (Clause, ClausesPostChecks)
-&gt; TCMT IO (Clause, ClausesPostChecks)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>                </span><span class="annot"><span class="annottext">Type
-&gt; Maybe (Substitution, Map Name LetBinding)
-&gt; SpineClause
-&gt; TCMT IO (Clause, ClausesPostChecks)
</span><a href="Agda.TypeChecking.Rules.Def.html#checkClause"><span class="hs-identifier hs-var">checkClause</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155718"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Substitution, Map Name LetBinding)
</span><a href="#local-6989586621682155724"><span class="hs-identifier hs-var">withSubAndLets</span></a></span><span> </span><span class="annot"><span class="annottext">SpineClause
</span><a href="#local-6989586621682155734"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-283"></span><span>              </span><span class="hs-comment">-- Andreas, 2013-11-23 do not solve size constraints here yet</span><span>
</span><span id="line-284"></span><span>              </span><span class="hs-comment">-- in case we are checking the body of an extended lambda.</span><span>
</span><span id="line-285"></span><span>              </span><span class="hs-comment">-- 2014-04-24: The size solver requires each clause to be</span><span>
</span><span id="line-286"></span><span>              </span><span class="hs-comment">-- checked individually, since otherwise we get constraints</span><span>
</span><span id="line-287"></span><span>              </span><span class="hs-comment">-- in typing contexts which are not prefixes of each other.</span><span>
</span><span id="line-288"></span><span>              </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenNothing"><span class="hs-identifier hs-type">whenNothing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155720"><span class="hs-identifier hs-type">extlam</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#solveSizeConstraints"><span class="hs-identifier hs-type">solveSizeConstraints</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#DontDefaultToInfty"><span class="hs-identifier hs-type">DontDefaultToInfty</span></a></span><span>
</span><span id="line-289"></span><span>              </span><span class="hs-comment">-- Andreas, 2013-10-27 add clause as soon it is type-checked</span><span>
</span><span id="line-290"></span><span>              </span><span class="hs-comment">-- TODO: instantiateFull?</span><span>
</span><span id="line-291"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#addClauses"><span class="hs-identifier hs-type">addClauses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682155737"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-292"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682155737"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682155738"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682155743"><span class="annot"><a href="#local-6989586621682155743"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#CPC"><span class="hs-identifier hs-type">CPC</span></a></span><span> </span><span id="local-6989586621682155745"><span class="annot"><a href="#local-6989586621682155745"><span class="hs-identifier hs-var">isOneIxs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">second</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mconcat</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">unzip</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155732"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-comment">-- If there is a partial match (&quot;system&quot;), no proper (co)pattern matching is allowed.</span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155748"><span class="annot"><a href="#local-6989586621682155748"><span class="hs-identifier hs-var hs-var">isSystem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (IntSet -&gt; Bool) -&gt; IntSet -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">(IntSet -&gt; Bool) -&gt; IntSet -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621682155745"><span class="hs-identifier hs-var">isOneIxs</span></a></span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155748"><span class="hs-identifier hs-type">isSystem</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>          </span><span class="hs-comment">-- allow VarP and ConP i0/i1 fallThrough = yes, DotP</span><span>
</span><span id="line-300"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155750"><span class="annot"><a href="#local-6989586621682155750"><span class="hs-identifier hs-var hs-var">pss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; [NamedArg DeBruijnPattern])
-&gt; [Clause] -&gt; [[NamedArg DeBruijnPattern]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; [NamedArg DeBruijnPattern]
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682155743"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-301"></span><span>              </span><span id="local-6989586621682155751"><span class="annot"><a href="#local-6989586621682155751"><span class="hs-identifier hs-var hs-var">allowed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-302"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#VarP"><span class="hs-identifier hs-type">VarP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-303"></span><span>                </span><span class="hs-comment">-- pattern inserted by splitPartial</span><span>
</span><span id="line-304"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682155754"><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682155754"><span class="hs-identifier hs-var">cpi</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ConPatternInfo -&gt; Bool
</span><a href="Agda.Syntax.Internal.html#conPFallThrough"><span class="hs-identifier hs-var">conPFallThrough</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><a href="#local-6989586621682155754"><span class="hs-identifier hs-var">cpi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-305"></span><span>                </span><span class="annot"><a href="Agda.Syntax.Internal.html#DotP"><span class="hs-identifier hs-type">DotP</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-306"></span><span>                </span><span class="annot"><span class="annottext">Pattern' x
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-307"></span><span>          </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">all</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682155751"><span class="hs-identifier hs-type">allowed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-type">namedArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155750"><span class="hs-identifier hs-type">pss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-308"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PatternInSystem"><span class="hs-identifier hs-type">PatternInSystem</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.def.fun&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-311"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;checked clauses:&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155743"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc&quot;</span></span><span> </span><span class="annot"><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-314"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;clauses before injectivity test&quot;</span></span><span>
</span><span id="line-315"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QNamed"><span class="hs-identifier hs-type">QNamed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155743"><span class="hs-identifier hs-type">cs</span></a></span><span>  </span><span class="hs-comment">-- broken, reify (QNamed n cl) expect cl to live at top level</span><span>
</span><span id="line-316"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc&quot;</span></span><span> </span><span class="annot"><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;raw clauses: &quot;</span></span><span>
</span><span id="line-319"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QNamed"><span class="hs-identifier hs-type">QNamed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155743"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-320"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-comment">-- Needed to calculate the proper fullType below.</span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><a href="Agda.Utils.Function.html#applyWhenM"><span class="hs-identifier hs-type">applyWhenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optPolarity"><span class="hs-identifier hs-type">optPolarity</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Modality.html#applyPolarityToContext"><span class="hs-identifier hs-type">applyPolarityToContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155719"><span class="hs-identifier hs-type">ai</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-324"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Modality.html#applyCohesionToContext"><span class="hs-identifier hs-type">applyCohesionToContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155719"><span class="hs-identifier hs-type">ai</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-comment">-- Systems have their own coverage and &quot;coherence&quot; check, we</span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-comment">-- also add an absurd clause for the cases not needed.</span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682155766"><span class="annot"><a href="#local-6989586621682155766"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682155767"><span class="annot"><a href="#local-6989586621682155767"><span class="hs-identifier hs-var">sys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682155748"><span class="hs-identifier hs-type">isSystem</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682155743"><span class="hs-identifier hs-type">cs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>                 </span><span id="local-6989586621682155768"><span class="annot"><a href="#local-6989586621682155768"><span class="hs-identifier hs-var">fullType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-type">abstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155718"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span>
</span><span id="line-330"></span><span>                 </span><span id="local-6989586621682155771"><span class="annot"><a href="#local-6989586621682155771"><span class="hs-identifier hs-var">sys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkSystemCoverage"><span class="hs-identifier hs-type">checkSystemCoverage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntSet.toList</span></span><span> </span><span class="annot"><a href="#local-6989586621682155745"><span class="hs-identifier hs-type">isOneIxs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155768"><span class="hs-identifier hs-type">fullType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155743"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-331"></span><span>                 </span><span id="local-6989586621682155774"><span class="annot"><a href="#local-6989586621682155774"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span>
</span><span id="line-332"></span><span>                 </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155775"><span class="annot"><a href="#local-6989586621682155775"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span>
</span><span id="line-333"></span><span>                       </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">clauseFullRange :: Range
</span><a href="Agda.Syntax.Internal.html#clauseFullRange"><span class="hs-identifier hs-var">clauseFullRange</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span>
</span><span id="line-334"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseLHSRange :: Range
</span><a href="Agda.Syntax.Internal.html#clauseLHSRange"><span class="hs-identifier hs-var">clauseLHSRange</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Range
forall a. Range' a
</span><a href="Agda.Syntax.Position.html#noRange"><span class="hs-identifier hs-var">noRange</span></a></span><span>
</span><span id="line-335"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseTel :: Tele (Dom Type)
</span><a href="Agda.Syntax.Internal.html#clauseTel"><span class="hs-identifier hs-var">clauseTel</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682155774"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-336"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">namedClausePats :: [NamedArg DeBruijnPattern]
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [NamedArg DeBruijnPattern]
forall a t. DeBruijn a =&gt; Tele (Dom t) -&gt; [NamedArg a]
</span><a href="Agda.TypeChecking.Telescope.html#teleNamedArgs"><span class="hs-identifier hs-var">teleNamedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682155774"><span class="hs-identifier hs-var">tel</span></a></span><span>
</span><span id="line-337"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseBody :: Maybe Term
</span><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Term
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-338"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseType :: Maybe (Arg Type)
</span><a href="Agda.Syntax.Internal.html#clauseType"><span class="hs-identifier hs-var">clauseType</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arg Type -&gt; Maybe (Arg Type)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Arg Type
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155718"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseCatchall :: Catchall
</span><a href="Agda.Syntax.Internal.html#clauseCatchall"><span class="hs-identifier hs-var">clauseCatchall</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Catchall
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-340"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseRecursive :: ClauseRecursive
</span><a href="Agda.Syntax.Internal.html#clauseRecursive"><span class="hs-identifier hs-var">clauseRecursive</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClauseRecursive
</span><a href="Agda.Syntax.Internal.html#NotRecursive"><span class="hs-identifier hs-var">NotRecursive</span></a></span><span>
</span><span id="line-341"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseUnreachable :: Maybe Bool
</span><a href="Agda.Syntax.Internal.html#clauseUnreachable"><span class="hs-identifier hs-var">clauseUnreachable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-342"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseEllipsis :: ExpandedEllipsis
</span><a href="Agda.Syntax.Internal.html#clauseEllipsis"><span class="hs-identifier hs-var">clauseEllipsis</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExpandedEllipsis
</span><a href="Agda.Syntax.Common.html#NoEllipsis"><span class="hs-identifier hs-var">NoEllipsis</span></a></span><span>
</span><span id="line-343"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">clauseWhereModule :: Maybe ModuleName
</span><a href="Agda.Syntax.Internal.html#clauseWhereModule"><span class="hs-identifier hs-var">clauseWhereModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-344"></span><span>                       </span><span class="hs-special">}</span><span>
</span><span id="line-345"></span><span>                 </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682155743"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682155775"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682155771"><span class="hs-identifier hs-type">sys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>        </span><span class="hs-comment">-- The macro or inline tags might be on the type signature</span><span>
</span><span id="line-348"></span><span>        </span><span id="local-6989586621682155780"><span class="annot"><a href="#local-6989586621682155780"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-349"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-350"></span><span>          </span><span id="local-6989586621682155781"><span class="annot"><a href="#local-6989586621682155781"><span class="hs-identifier hs-var hs-var">ismacro</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Base.html#isMacro"><span class="hs-identifier hs-var">isMacro</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682155780"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>          </span><span id="local-6989586621682155782"><span class="annot"><a href="#local-6989586621682155782"><span class="hs-identifier hs-var hs-var">isinline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Defn -&gt; Bool
</span><a href="Agda.TypeChecking.Monad.Signature.html#isInlineFun"><span class="hs-identifier hs-var">isInlineFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682155780"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-comment">-- Annotate the clauses with which arguments are actually used.</span><span>
</span><span id="line-354"></span><span>        </span><span id="local-6989586621682155784"><span class="annot"><a href="#local-6989586621682155784"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="hs-comment">{- =&lt;&lt; mapM rebindClause -}</span><span> </span><span class="annot"><a href="#local-6989586621682155766"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-comment">-- Andreas, 2010-11-12</span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-comment">-- rebindClause is the identity, and instantiateFull eta-contracts</span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-comment">-- removing this eta-contraction fixes issue 361</span><span>
</span><span id="line-359"></span><span>        </span><span class="hs-comment">-- however, Data.Star.Decoration.gmapAll no longer type-checks</span><span>
</span><span id="line-360"></span><span>        </span><span class="hs-comment">-- possibly due to missing eta-contraction!?</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-comment">-- Inline copattern record constructors on demand, unless the</span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-comment">-- function is marked inline.</span><span>
</span><span id="line-364"></span><span>        </span><span id="local-6989586621682155785"><span class="annot"><a href="#local-6989586621682155785"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682155782"><span class="hs-identifier hs-type">isinline</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621682155784"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-365"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621682155784"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682155787"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682155787"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682155788"><span class="annot"><a href="#local-6989586621682155788"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682155789"><span class="annot"><a href="#local-6989586621682155789"><span class="hs-identifier hs-var">nonExactSplit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ChangeT (TCMT IO) [Clause] -&gt; TCMT IO ([Clause], Bool)
forall (m :: * -&gt; *) a. Functor m =&gt; ChangeT m a -&gt; m (a, Bool)
</span><a href="Agda.Utils.Update.html#runChangeT"><span class="hs-identifier hs-var">runChangeT</span></a></span><span> </span><span class="annot"><span class="annottext">(ChangeT (TCMT IO) [Clause] -&gt; TCMT IO ([Clause], Bool))
-&gt; ChangeT (TCMT IO) [Clause] -&gt; TCMT IO ([Clause], Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; ChangeT (TCMT IO) [Clause]
forall (m :: * -&gt; *).
(MonadChange m, PureTCM m) =&gt;
Clause -&gt; m [Clause]
</span><a href="Agda.TypeChecking.RecordPatterns.html#recordRHSToCopatterns"><span class="hs-identifier hs-var">recordRHSToCopatterns</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682155787"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-367"></span><span>            </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155789"><span class="hs-identifier hs-type">nonExactSplit</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-368"></span><span>              </span><span class="hs-comment">-- If we inlined a non-eta constructor, issue a warning</span><span>
</span><span id="line-369"></span><span>              </span><span class="hs-comment">-- (pointing at the clause lhs) that the clause does not</span><span>
</span><span id="line-370"></span><span>              </span><span class="hs-comment">-- hold as definitional equality.</span><span>
</span><span id="line-371"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-type">setCurrentRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseLHSRange"><span class="hs-identifier hs-var">clauseLHSRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155787"><span class="hs-identifier hs-type">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-type">warning</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#InlineNoExactSplit"><span class="hs-identifier hs-type">InlineNoExactSplit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155787"><span class="hs-identifier hs-type">cl</span></a></span><span>
</span><span id="line-372"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682155788"><span class="hs-identifier hs-type">cls</span></a></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-comment">-- After checking, remove the clauses again.</span><span>
</span><span id="line-375"></span><span>        </span><span class="hs-comment">-- (Otherwise, @checkInjectivity@ loops for issue 801).</span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-377"></span><span>        </span><span class="hs-comment">-- Amy, 2025-04-03: We can't remove the clauses before doing</span><span>
</span><span id="line-378"></span><span>        </span><span class="hs-comment">-- record&#8594;copattern translation, since we might need the</span><span>
</span><span id="line-379"></span><span>        </span><span class="hs-comment">-- previous clauses to come up with the types of the projected</span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-comment">-- fields; see 'test/Succeed/IApplyRecConstrInline'.</span><span>
</span><span id="line-381"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#modifyFunClauses"><span class="hs-identifier hs-type">modifyFunClauses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-comment">-- Check if the function is injective.</span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-comment">-- Andreas, 2015-07-01 we do it here in order to resolve metas</span><span>
</span><span id="line-385"></span><span>        </span><span class="hs-comment">-- in mutual definitions, e.g. the U/El definition in succeed/Issue439.agda</span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-comment">-- We do it again for the mutual block after termination checking, see Rules.Decl.</span><span>
</span><span id="line-387"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.inj.def&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;checkFunDef': checking injectivity...&quot;</span></span><span>
</span><span id="line-388"></span><span>        </span><span id="local-6989586621682155794"><span class="annot"><a href="#local-6989586621682155794"><span class="hs-identifier hs-var">inv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Injectivity"><span class="hs-identifier hs-type">Bench.Injectivity</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-389"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Injectivity.html#checkInjectivity"><span class="hs-identifier hs-type">checkInjectivity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155785"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-392"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;clauses before compilation&quot;</span></span><span>
</span><span id="line-393"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QNamed"><span class="hs-identifier hs-type">QNamed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155785"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-394"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc.raw&quot;</span></span><span> </span><span class="annot"><span class="hs-number">65</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-397"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;clauses before compilation&quot;</span></span><span>
</span><span id="line-398"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155785"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-399"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-comment">-- add clauses for the coverage (&amp; confluence) checker (needs to reduce)</span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#addClauses"><span class="hs-identifier hs-type">addClauses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155785"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc.type&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  type   : &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155718"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-405"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc.type&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;  context: &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>        </span><span id="local-6989586621682155798"><span class="annot"><a href="#local-6989586621682155798"><span class="hs-identifier hs-var">fullType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#telePi"><span class="hs-identifier hs-type">telePi</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155718"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span>  </span><span class="annot"><span class="hs-string">&quot;tc.cc.type&quot;</span></span><span> </span><span class="annot"><span class="hs-number">80</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682155798"><span class="hs-identifier hs-type">fullType</span></a></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span>        </span><span class="hs-comment">-- Coverage check and compile the clauses</span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682155800"><span class="annot"><a href="#local-6989586621682155800"><span class="hs-identifier hs-var">mst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682155801"><span class="annot"><a href="#local-6989586621682155801"><span class="hs-identifier hs-var">_recordExpressionBecameCopatternLHS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682155802"><span class="annot"><a href="#local-6989586621682155802"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Coverage"><span class="hs-identifier hs-type">Bench.Coverage</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-413"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#unsafeInTopContext"><span class="hs-identifier hs-type">unsafeInTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.Compile.html#compileClauses"><span class="hs-identifier hs-type">compileClauses</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682155748"><span class="hs-identifier hs-type">isSystem</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682155798"><span class="hs-identifier hs-type">fullType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>                                        </span><span class="annot"><a href="#local-6989586621682155785"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-415"></span><span>        </span><span class="hs-comment">-- Andreas, 2019-10-21 (see also issue #4142):</span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-comment">-- We ignore whether the clause compilation turned some</span><span>
</span><span id="line-417"></span><span>        </span><span class="hs-comment">-- record expressions into copatterns</span><span>
</span><span id="line-418"></span><span>        </span><span class="hs-comment">-- (_recordExpressionsBecameCopatternLHS),</span><span>
</span><span id="line-419"></span><span>        </span><span class="hs-comment">-- since the defCopatternLHS flag is anyway set by traversing</span><span>
</span><span id="line-420"></span><span>        </span><span class="hs-comment">-- the compiled clauses looking for a copattern match</span><span>
</span><span id="line-421"></span><span>        </span><span class="hs-comment">-- (hasProjectionPatterns).</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-comment">-- Clause compilation runs the coverage checker, which might add</span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-comment">-- some extra clauses.</span><span>
</span><span id="line-425"></span><span>        </span><span id="local-6989586621682155806"><span class="annot"><a href="#local-6989586621682155806"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defClauses"><span class="hs-identifier hs-type">defClauses</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.cc&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-428"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;compiled clauses of&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-429"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155802"><span class="hs-identifier hs-type">cc</span></a></span><span>
</span><span id="line-430"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span>        </span><span id="local-6989586621682155808"><span class="annot"><a href="#local-6989586621682155808"><span class="hs-identifier hs-var">covering</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funCovering"><span class="hs-identifier hs-var">funCovering</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span>        </span><span class="hs-comment">-- Add the definition</span><span>
</span><span id="line-435"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#addConstant"><span class="hs-identifier hs-type">addConstant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.def.fun.clauses&quot;</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-438"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;final clauses for&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span>  </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-439"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QNamed"><span class="hs-identifier hs-type">QNamed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155806"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-440"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>          </span><span class="hs-comment">-- If there was a pragma for this definition, we can set the</span><span>
</span><span id="line-443"></span><span>          </span><span class="hs-comment">-- funTerminates field directly.</span><span>
</span><span id="line-444"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-445"></span><span>          </span><span class="hs-comment">-- Amy, 2025-04-03: If the function was marked INLINE before</span><span>
</span><span id="line-446"></span><span>          </span><span class="hs-comment">-- the clauses were checked the result should also be INLINE.</span><span>
</span><span id="line-447"></span><span>          </span><span id="local-6989586621682155811"><span class="annot"><a href="#local-6989586621682155811"><span class="hs-identifier hs-var">fun</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#emptyFunctionData"><span class="hs-identifier hs-type">emptyFunctionData</span></a></span><span>
</span><span id="line-448"></span><span>          </span><span id="local-6989586621682155812"><span class="annot"><a href="#local-6989586621682155812"><span class="hs-identifier hs-var">defn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Inlining.html#autoInline"><span class="hs-identifier hs-type">autoInline</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funInline"><span class="hs-identifier hs-type">funInline</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155782"><span class="hs-identifier hs-type">isinline</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#FunctionDefn"><span class="hs-identifier hs-type">FunctionDefn</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-449"></span><span>           </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funMacro_"><span class="hs-identifier hs-type">funMacro_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682155781"><span class="hs-identifier hs-type">ismacro</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#defMacro"><span class="hs-identifier hs-var">Info.defMacro</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155722"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MacroDef"><span class="hs-identifier hs-type">MacroDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-450"></span><span>           </span><span class="annot"><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funAbstr_"><span class="hs-identifier hs-type">funAbstr_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Info.html#defAbstract"><span class="hs-identifier hs-var">Info.defAbstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155722"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-451"></span><span>           </span><span class="annot"><a href="#local-6989586621682155811"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-452"></span><span>             </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funClauses"><span class="hs-identifier hs-var">_funClauses</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682155806"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-453"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funCompiled"><span class="hs-identifier hs-var">_funCompiled</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682155802"><span class="hs-identifier hs-type">cc</span></a></span><span>
</span><span id="line-454"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funSplitTree"><span class="hs-identifier hs-var">_funSplitTree</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682155800"><span class="hs-identifier hs-type">mst</span></a></span><span>
</span><span id="line-455"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funInv"><span class="hs-identifier hs-var">_funInv</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682155794"><span class="hs-identifier hs-type">inv</span></a></span><span>
</span><span id="line-456"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funOpaque"><span class="hs-identifier hs-var">_funOpaque</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#defOpaque"><span class="hs-identifier hs-var">Info.defOpaque</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155722"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-457"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funExtLam"><span class="hs-identifier hs-var">_funExtLam</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682155823"><span class="annot"><span class="annottext">ExtLamInfo
</span><a href="#local-6989586621682155823"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtLamInfo
</span><a href="#local-6989586621682155823"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#extLamSys"><span class="hs-identifier hs-var">extLamSys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682155767"><span class="hs-identifier hs-type">sys</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682155720"><span class="hs-identifier hs-type">extlam</span></a></span><span>
</span><span id="line-458"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funWith"><span class="hs-identifier hs-var">_funWith</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682155721"><span class="hs-identifier hs-type">with</span></a></span><span>
</span><span id="line-459"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#_funCovering"><span class="hs-identifier hs-var">_funCovering</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682155808"><span class="hs-identifier hs-type">covering</span></a></span><span>
</span><span id="line-460"></span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-461"></span><span>          </span><span id="local-6989586621682155827"><span class="annot"><a href="#local-6989586621682155827"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#getLanguage"><span class="hs-identifier hs-type">getLanguage</span></a></span><span>
</span><span id="line-462"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#useTerPragma"><span class="hs-identifier hs-type">useTerPragma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-463"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.State.html#updateDefCopatternLHS"><span class="hs-identifier hs-type">updateDefCopatternLHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">const</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CompiledClause.html#hasProjectionPatterns"><span class="hs-identifier hs-type">hasProjectionPatterns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155802"><span class="hs-identifier hs-type">cc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-464"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defaultDefn"><span class="hs-identifier hs-type">defaultDefn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155719"><span class="hs-identifier hs-type">ai</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155798"><span class="hs-identifier hs-type">fullType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155827"><span class="hs-identifier hs-type">lang</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155812"><span class="hs-identifier hs-type">defn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.def.fun&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-467"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;added &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-468"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defType"><span class="hs-identifier hs-var">defType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155723"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-469"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>        </span><span class="hs-comment">-- Jesper, 2019-05-30: if the constructors used in the</span><span>
</span><span id="line-472"></span><span>        </span><span class="hs-comment">-- lhs of a clause have rewrite rules, we need to check</span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-comment">-- confluence here</span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><a href="Agda.Utils.Maybe.html#whenJustM"><span class="hs-identifier hs-type">whenJustM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optConfluenceCheck"><span class="hs-identifier hs-type">optConfluenceCheck</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682155834"><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621682155834"><span class="hs-identifier hs-var">confChk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-475"></span><span>          </span><span class="annot"><span class="annottext">ConfluenceCheck -&gt; QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Rewriting.Confluence.html#checkConfluenceOfClauses"><span class="hs-identifier hs-var">checkConfluenceOfClauses</span></a></span><span> </span><span class="annot"><span class="annottext">ConfluenceCheck
</span><a href="#local-6989586621682155834"><span class="hs-identifier hs-var">confChk</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155723"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span class="hs-comment">-- | Set 'funTerminates' according to termination info in 'TCEnv',</span><span>
</span><span id="line-478"></span><span class="hs-comment">--   which comes from a possible termination pragma.</span><span>
</span><span id="line-479"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#useTerPragma"><span class="hs-identifier hs-type">useTerPragma</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definition"><span class="hs-identifier hs-type">Definition</span></a></span><span>
</span><span id="line-480"></span><span id="useTerPragma"><span class="annot"><span class="annottext">useTerPragma :: Definition -&gt; TCMT IO Definition
</span><a href="Agda.TypeChecking.Rules.Def.html#useTerPragma"><span class="hs-identifier hs-var hs-var">useTerPragma</span></a></span></span><span> </span><span id="local-6989586621682155838"><span class="annot"><span class="annottext">def :: Definition
</span><a href="#local-6989586621682155838"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">defName :: Definition -&gt; QName
</span><a href="Agda.TypeChecking.Monad.Base.html#defName"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682155841"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155841"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">theDef :: Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682155842"><span class="annot"><span class="annottext">fun :: Defn
</span><a href="#local-6989586621682155842"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-481"></span><span>  </span><span id="local-6989586621682155844"><span class="annot"><a href="#local-6989586621682155844"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' TCEnv (TerminationCheck ()) -&gt; TCMT IO (TerminationCheck ())
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; Lens' TCEnv a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-var">viewTC</span></a></span><span> </span><span class="annot"><span class="annottext">(TerminationCheck () -&gt; f (TerminationCheck ()))
-&gt; TCEnv -&gt; f TCEnv
Lens' TCEnv (TerminationCheck ())
</span><a href="Agda.TypeChecking.Monad.Base.html#eTerminationCheck"><span class="hs-identifier hs-var">eTerminationCheck</span></a></span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155849"><span class="annot"><a href="#local-6989586621682155849"><span class="hs-identifier hs-var hs-var">terminates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TerminationCheck ()
</span><a href="#local-6989586621682155844"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-483"></span><span>        </span><span class="annot"><span class="annottext">TerminationCheck ()
</span><a href="Agda.Syntax.Common.html#NonTerminating"><span class="hs-identifier hs-var">NonTerminating</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-484"></span><span>        </span><span class="annot"><span class="annottext">TerminationCheck ()
</span><a href="Agda.Syntax.Common.html#Terminating"><span class="hs-identifier hs-var">Terminating</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-485"></span><span>        </span><span class="annot"><span class="annottext">TerminationCheck ()
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-486"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportS"><span class="hs-identifier hs-type">reportS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.fundef&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;funTerminates of &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155841"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot; set to &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682155849"><span class="hs-identifier hs-type">terminates</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  tc = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682155844"><span class="hs-identifier hs-type">tc</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-490"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682155838"><span class="hs-identifier hs-type">def</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682155842"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#funTerminates"><span class="hs-identifier hs-var">funTerminates</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682155849"><span class="hs-identifier hs-type">terminates</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-491"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#useTerPragma"><span class="hs-identifier hs-var">useTerPragma</span></a></span><span> </span><span id="local-6989586621682155853"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682155853"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; TCMT IO Definition
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682155853"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="hs-comment">-- | Modify all the LHSCore of the given RHS.</span><span>
</span><span id="line-494"></span><span class="hs-comment">-- (Used to insert patterns for @rewrite@ or the inspect idiom)</span><span>
</span><span id="line-495"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#mapLHSCores"><span class="hs-identifier hs-type">mapLHSCores</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSCore"><span class="hs-identifier hs-type">A.LHSCore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSCore"><span class="hs-identifier hs-type">A.LHSCore</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span id="mapLHSCores"><span class="annot"><span class="annottext">mapLHSCores :: (LHSCore' Expr -&gt; LHSCore' Expr) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#mapLHSCores"><span class="hs-identifier hs-var hs-var">mapLHSCores</span></a></span></span><span> </span><span id="local-6989586621682155856"><span class="annot"><span class="annottext">LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="#local-6989586621682155856"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-497"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithRHS"><span class="hs-identifier hs-type">A.WithRHS</span></a></span><span> </span><span id="local-6989586621682155858"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155858"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621682155859"><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682155859"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621682155860"><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682155860"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; List1 WithExpr -&gt; List1 (Clause' LHS) -&gt; RHS
</span><a href="Agda.Syntax.Abstract.html#WithRHS"><span class="hs-identifier hs-var">A.WithRHS</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155858"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682155859"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 (Clause' LHS) -&gt; RHS) -&gt; List1 (Clause' LHS) -&gt; RHS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 (Clause' LHS)
-&gt; (Clause' LHS -&gt; Clause' LHS) -&gt; List1 (Clause' LHS)
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682155860"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">((Clause' LHS -&gt; Clause' LHS) -&gt; List1 (Clause' LHS))
-&gt; (Clause' LHS -&gt; Clause' LHS) -&gt; List1 (Clause' LHS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHS"><span class="hs-identifier hs-type">A.LHS</span></a></span><span> </span><span id="local-6989586621682155862"><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682155862"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682155863"><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155863"><span class="hs-identifier hs-var">core</span></a></span></span><span class="hs-special">)</span><span>     </span><span id="local-6989586621682155864"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682155864"><span class="hs-identifier hs-var">spats</span></a></span></span><span> </span><span id="local-6989586621682155865"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682155865"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>                 </span><span id="local-6989586621682155866"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682155866"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621682155867"><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682155867"><span class="hs-identifier hs-var">catchall</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-499"></span><span>       </span><span class="annot"><span class="annottext">LHS
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' LHS
forall lhs.
lhs
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' lhs
</span><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-var">A.Clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHSInfo -&gt; LHSCore' Expr -&gt; LHS
</span><a href="Agda.Syntax.Abstract.html#LHS"><span class="hs-identifier hs-var">A.LHS</span></a></span><span> </span><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682155862"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="#local-6989586621682155856"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155863"><span class="hs-identifier hs-var">core</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682155864"><span class="hs-identifier hs-var">spats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LHSCore' Expr -&gt; LHSCore' Expr) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#mapLHSCores"><span class="hs-identifier hs-var">mapLHSCores</span></a></span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="#local-6989586621682155856"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682155865"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682155866"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682155867"><span class="hs-identifier hs-var">catchall</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-type">A.RewriteRHS</span></a></span><span> </span><span id="local-6989586621682155869"><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682155869"><span class="hs-identifier hs-var">qes</span></a></span></span><span> </span><span id="local-6989586621682155870"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682155870"><span class="hs-identifier hs-var">spats</span></a></span></span><span> </span><span id="local-6989586621682155871"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682155871"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682155872"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682155872"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[RewriteEqn] -&gt; [ProblemEq] -&gt; RHS -&gt; WhereDeclarations -&gt; RHS
</span><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-var">A.RewriteRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682155869"><span class="hs-identifier hs-var">qes</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682155870"><span class="hs-identifier hs-var">spats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LHSCore' Expr -&gt; LHSCore' Expr) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#mapLHSCores"><span class="hs-identifier hs-var">mapLHSCores</span></a></span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="#local-6989586621682155856"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682155871"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682155872"><span class="hs-identifier hs-var">wh</span></a></span><span>
</span><span id="line-501"></span><span>  </span><span id="local-6989586621682155873"><span class="annot"><span class="annottext">rhs :: RHS
</span><a href="#local-6989586621682155873"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">RHS
</span><a href="Agda.Syntax.Abstract.html#AbsurdRHS"><span class="hs-identifier hs-var">A.AbsurdRHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682155873"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-502"></span><span>  </span><span id="local-6989586621682155875"><span class="annot"><span class="annottext">rhs :: RHS
</span><a href="#local-6989586621682155875"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682155875"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="hs-comment">-- | Insert some names into the with-clauses LHS of the given RHS.</span><span>
</span><span id="line-505"></span><span class="hs-comment">-- (Used for the inspect idiom)</span><span>
</span><span id="line-506"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#insertNames"><span class="hs-identifier hs-type">insertNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#BindName"><span class="hs-identifier hs-type">A.BindName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span>
</span><span id="line-507"></span><span id="insertNames"><span class="annot"><span class="annottext">insertNames :: List1 (Arg (Maybe BindName)) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#insertNames"><span class="hs-identifier hs-var hs-var">insertNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHSCore' Expr -&gt; LHSCore' Expr) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#mapLHSCores"><span class="hs-identifier hs-var">mapLHSCores</span></a></span><span> </span><span class="annot"><span class="annottext">((LHSCore' Expr -&gt; LHSCore' Expr) -&gt; RHS -&gt; RHS)
-&gt; (List1 (Arg (Maybe BindName)) -&gt; LHSCore' Expr -&gt; LHSCore' Expr)
-&gt; List1 (Arg (Maybe BindName))
-&gt; RHS
-&gt; RHS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Maybe BindName)) -&gt; LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="Agda.TypeChecking.Rules.Def.html#insertInspects"><span class="hs-identifier hs-var">insertInspects</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#insertInspects"><span class="hs-identifier hs-type">insertInspects</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#BindName"><span class="hs-identifier hs-type">A.BindName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSCore"><span class="hs-identifier hs-type">A.LHSCore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSCore"><span class="hs-identifier hs-type">A.LHSCore</span></a></span><span>
</span><span id="line-510"></span><span id="insertInspects"><span class="annot"><span class="annottext">insertInspects :: List1 (Arg (Maybe BindName)) -&gt; LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="Agda.TypeChecking.Rules.Def.html#insertInspects"><span class="hs-identifier hs-var hs-var">insertInspects</span></a></span></span><span> </span><span id="local-6989586621682155878"><span class="annot"><span class="annottext">List1 (Arg (Maybe BindName))
</span><a href="#local-6989586621682155878"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-511"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSWith"><span class="hs-identifier hs-type">A.LHSWith</span></a></span><span> </span><span id="local-6989586621682155880"><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155880"><span class="hs-identifier hs-var">core</span></a></span></span><span> </span><span id="local-6989586621682155881"><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682155881"><span class="hs-identifier hs-var">wps</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682155882"><span class="annot"><span class="annottext">ps' :: NonEmpty (Arg (Maybe (Arg (Pattern' Expr))))
</span><a href="#local-6989586621682155882"><span class="hs-identifier hs-var hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg (Maybe BindName) -&gt; Arg (Maybe (Arg (Pattern' Expr))))
-&gt; List1 (Arg (Maybe BindName))
-&gt; NonEmpty (Arg (Maybe (Arg (Pattern' Expr))))
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe BindName -&gt; Maybe (Arg (Pattern' Expr)))
-&gt; Arg (Maybe BindName) -&gt; Arg (Maybe (Arg (Pattern' Expr)))
forall a b. (a -&gt; b) -&gt; Arg a -&gt; Arg b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Maybe BindName -&gt; Maybe (Arg (Pattern' Expr)))
 -&gt; Arg (Maybe BindName) -&gt; Arg (Maybe (Arg (Pattern' Expr))))
-&gt; (Maybe BindName -&gt; Maybe (Arg (Pattern' Expr)))
-&gt; Arg (Maybe BindName)
-&gt; Arg (Maybe (Arg (Pattern' Expr)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BindName -&gt; Arg (Pattern' Expr))
-&gt; Maybe BindName -&gt; Maybe (Arg (Pattern' Expr))
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">BindName -&gt; Arg (Pattern' Expr)
</span><a href="#local-6989586621682155883"><span class="hs-identifier hs-var">patOfName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Maybe BindName))
</span><a href="#local-6989586621682155878"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-513"></span><span>    </span><span class="annot"><span class="annottext">LHSCore' Expr
-&gt; List1 (Arg (Pattern' Expr))
-&gt; [NamedArg (Pattern' Expr)]
-&gt; LHSCore' Expr
forall e.
LHSCore' e
-&gt; List1 (Arg (Pattern' e))
-&gt; [NamedArg (Pattern' e)]
-&gt; LHSCore' e
</span><a href="Agda.Syntax.Abstract.html#LHSWith"><span class="hs-identifier hs-var">A.LHSWith</span></a></span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155880"><span class="hs-identifier hs-var">core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
-&gt; [Arg (Pattern' Expr)] -&gt; List1 (Arg (Pattern' Expr))
forall a. List1 a -&gt; [a] -&gt; List1 a
</span><a href="Agda.Utils.List1.html#fromListSafe"><span class="hs-identifier hs-var">List1.fromListSafe</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg (Pattern' Expr)] -&gt; List1 (Arg (Pattern' Expr)))
-&gt; [Arg (Pattern' Expr)] -&gt; List1 (Arg (Pattern' Expr))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Maybe (Arg (Pattern' Expr)))]
-&gt; [Arg (Pattern' Expr)] -&gt; [Arg (Pattern' Expr)]
forall a. [Arg (Maybe (Arg a))] -&gt; [Arg a] -&gt; [Arg a]
</span><a href="#local-6989586621682155886"><span class="hs-identifier hs-var">insertIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (Arg (Maybe (Arg (Pattern' Expr))))
-&gt; [Item (NonEmpty (Arg (Maybe (Arg (Pattern' Expr)))))]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><span class="hs-identifier hs-var">List1.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Arg (Maybe (Arg (Pattern' Expr))))
</span><a href="#local-6989586621682155882"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr)) -&gt; [Item (List1 (Arg (Pattern' Expr)))]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><span class="hs-identifier hs-var">List1.toList</span></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682155881"><span class="hs-identifier hs-var">wps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-comment">-- Andreas, AIM XXXV, 2022-05-09, issue #5728:</span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-comment">-- Cases other than LHSWith actually do not make sense, but let them</span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-comment">-- through to get a proper error later.</span><span>
</span><span id="line-517"></span><span>  </span><span id="local-6989586621682155887"><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155887"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155887"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>    </span><span class="annot"><a href="#local-6989586621682155883"><span class="hs-identifier hs-type">patOfName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#BindName"><span class="hs-identifier hs-type">A.BindName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span>
</span><span id="line-522"></span><span>    </span><span id="local-6989586621682155883"><span class="annot"><span class="annottext">patOfName :: BindName -&gt; Arg (Pattern' Expr)
</span><a href="#local-6989586621682155883"><span class="hs-identifier hs-var hs-var">patOfName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern' Expr -&gt; Arg (Pattern' Expr)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern' Expr -&gt; Arg (Pattern' Expr))
-&gt; (BindName -&gt; Pattern' Expr) -&gt; BindName -&gt; Arg (Pattern' Expr)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BindName -&gt; Pattern' Expr
forall e. BindName -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-var">A.VarP</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span>    </span><span id="local-6989586621682153633"><span class="annot"><a href="#local-6989586621682155886"><span class="hs-identifier hs-type">insertIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153633"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-525"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153633"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153633"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-526"></span><span>    </span><span id="local-6989586621682155886"><span class="annot"><span class="annottext">insertIn :: forall a. [Arg (Maybe (Arg a))] -&gt; [Arg a] -&gt; [Arg a]
</span><a href="#local-6989586621682155886"><span class="hs-identifier hs-var hs-var">insertIn</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                 </span><span id="local-6989586621682155895"><span class="annot"><span class="annottext">[Arg a]
</span><a href="#local-6989586621682155895"><span class="hs-identifier hs-var">wps</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg a]
</span><a href="#local-6989586621682155895"><span class="hs-identifier hs-var">wps</span></a></span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><a href="#local-6989586621682155886"><span class="hs-identifier hs-var">insertIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682155896"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155896"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682155897"><span class="annot"><span class="annottext">Maybe (Arg a)
</span><a href="#local-6989586621682155897"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682155898"><span class="annot"><span class="annottext">[Arg (Maybe (Arg a))]
</span><a href="#local-6989586621682155898"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155899"><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682155899"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682155900"><span class="annot"><span class="annottext">[Arg a]
</span><a href="#local-6989586621682155900"><span class="hs-identifier hs-var">wps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#visible"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155896"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-528"></span><span>      </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682155899"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; [Arg a] -&gt; [Arg a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Arg a) -&gt; [Arg a]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Arg a)
</span><a href="#local-6989586621682155897"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg a] -&gt; [Arg a] -&gt; [Arg a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Maybe (Arg a))] -&gt; [Arg a] -&gt; [Arg a]
forall a. [Arg (Maybe (Arg a))] -&gt; [Arg a] -&gt; [Arg a]
</span><a href="#local-6989586621682155886"><span class="hs-identifier hs-var">insertIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Maybe (Arg a))]
</span><a href="#local-6989586621682155898"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg a]
</span><a href="#local-6989586621682155900"><span class="hs-identifier hs-var">wps</span></a></span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><a href="#local-6989586621682155886"><span class="hs-identifier hs-var">insertIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682155903"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155903"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682155904"><span class="annot"><span class="annottext">Maybe (Arg a)
</span><a href="#local-6989586621682155904"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682155905"><span class="annot"><span class="annottext">[Arg (Maybe (Arg a))]
</span><a href="#local-6989586621682155905"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682155906"><span class="annot"><span class="annottext">[Arg a]
</span><a href="#local-6989586621682155906"><span class="hs-identifier hs-var">wps</span></a></span></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensHiding a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#notVisible"><span class="hs-identifier hs-var">notVisible</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682155903"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-530"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Arg a) -&gt; [Arg a]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Arg a)
</span><a href="#local-6989586621682155904"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg a] -&gt; [Arg a] -&gt; [Arg a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Arg (Maybe (Arg a))] -&gt; [Arg a] -&gt; [Arg a]
forall a. [Arg (Maybe (Arg a))] -&gt; [Arg a] -&gt; [Arg a]
</span><a href="#local-6989586621682155886"><span class="hs-identifier hs-var">insertIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Maybe (Arg a))]
</span><a href="#local-6989586621682155905"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg a]
</span><a href="#local-6989586621682155906"><span class="hs-identifier hs-var">wps</span></a></span><span>
</span><span id="line-531"></span><span>    </span><span class="annot"><a href="#local-6989586621682155886"><span class="hs-identifier hs-var">insertIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg (Maybe (Arg a))]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Arg a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg a]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="hs-comment">-- | Insert some with-patterns into the with-clauses LHS of the given RHS.</span><span>
</span><span id="line-535"></span><span class="hs-comment">-- (Used for @rewrite@)</span><span>
</span><span id="line-536"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#insertPatterns"><span class="hs-identifier hs-type">insertPatterns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span>
</span><span id="line-537"></span><span id="insertPatterns"><span class="annot"><span class="annottext">insertPatterns :: List1 (Arg (Pattern' Expr)) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#insertPatterns"><span class="hs-identifier hs-var hs-var">insertPatterns</span></a></span></span><span> </span><span id="local-6989586621682155909"><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682155909"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHSCore' Expr -&gt; LHSCore' Expr) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#mapLHSCores"><span class="hs-identifier hs-var">mapLHSCores</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr)) -&gt; LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="Agda.TypeChecking.Rules.Def.html#insertPatternsLHSCore"><span class="hs-identifier hs-var">insertPatternsLHSCore</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682155909"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="hs-comment">-- | Insert with-patterns before the trailing with patterns.</span><span>
</span><span id="line-540"></span><span class="hs-comment">-- If there are none, append the with-patterns.</span><span>
</span><span id="line-541"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#insertPatternsLHSCore"><span class="hs-identifier hs-type">insertPatternsLHSCore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSCore"><span class="hs-identifier hs-type">A.LHSCore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSCore"><span class="hs-identifier hs-type">A.LHSCore</span></a></span><span>
</span><span id="line-542"></span><span id="insertPatternsLHSCore"><span class="annot"><span class="annottext">insertPatternsLHSCore :: List1 (Arg (Pattern' Expr)) -&gt; LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="Agda.TypeChecking.Rules.Def.html#insertPatternsLHSCore"><span class="hs-identifier hs-var hs-var">insertPatternsLHSCore</span></a></span></span><span> </span><span id="local-6989586621682155911"><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682155911"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHSWith"><span class="hs-identifier hs-type">A.LHSWith</span></a></span><span> </span><span id="local-6989586621682155912"><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155912"><span class="hs-identifier hs-var">core</span></a></span></span><span> </span><span id="local-6989586621682155913"><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682155913"><span class="hs-identifier hs-var">wps</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr
-&gt; List1 (Arg (Pattern' Expr))
-&gt; [NamedArg (Pattern' Expr)]
-&gt; LHSCore' Expr
forall e.
LHSCore' e
-&gt; List1 (Arg (Pattern' e))
-&gt; [NamedArg (Pattern' e)]
-&gt; LHSCore' e
</span><a href="Agda.Syntax.Abstract.html#LHSWith"><span class="hs-identifier hs-var">A.LHSWith</span></a></span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155912"><span class="hs-identifier hs-var">core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682155911"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
-&gt; List1 (Arg (Pattern' Expr)) -&gt; List1 (Arg (Pattern' Expr))
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682155913"><span class="hs-identifier hs-var">wps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-544"></span><span>  </span><span id="local-6989586621682155914"><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155914"><span class="hs-identifier hs-var">core</span></a></span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr
-&gt; List1 (Arg (Pattern' Expr))
-&gt; [NamedArg (Pattern' Expr)]
-&gt; LHSCore' Expr
forall e.
LHSCore' e
-&gt; List1 (Arg (Pattern' e))
-&gt; [NamedArg (Pattern' e)]
-&gt; LHSCore' e
</span><a href="Agda.Syntax.Abstract.html#LHSWith"><span class="hs-identifier hs-var">A.LHSWith</span></a></span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682155914"><span class="hs-identifier hs-var">core</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682155911"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span class="annot"><span class="hs-comment">-- | Parameters for creating a @with@-function.</span></span><span>
</span><span id="line-547"></span><span class="hs-keyword">data</span><span> </span><span id="WithFunctionProblem"><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-var">WithFunctionProblem</span></a></span></span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoWithFunction"><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#NoWithFunction"><span class="hs-identifier hs-var">NoWithFunction</span></a></span></span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="WithFunction"><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunction"><span class="hs-identifier hs-var">WithFunction</span></a></span></span><span>
</span><span id="line-550"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="wfParentName"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; QName
</span><a href="Agda.TypeChecking.Rules.Def.html#wfParentName"><span class="hs-identifier hs-var hs-var">wfParentName</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                            </span><span class="annot"><span class="hs-comment">-- ^ Parent function name.</span></span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfName"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; QName
</span><a href="Agda.TypeChecking.Rules.Def.html#wfName"><span class="hs-identifier hs-var hs-var">wfName</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                            </span><span class="annot"><span class="hs-comment">-- ^ With function name.</span></span><span>
</span><span id="line-552"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfParentType"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Type
</span><a href="Agda.TypeChecking.Rules.Def.html#wfParentType"><span class="hs-identifier hs-var hs-var">wfParentType</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                             </span><span class="annot"><span class="hs-comment">-- ^ Type of the parent function.</span></span><span>
</span><span id="line-553"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfParentTel"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Tele (Dom Type)
</span><a href="Agda.TypeChecking.Rules.Def.html#wfParentTel"><span class="hs-identifier hs-var hs-var">wfParentTel</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>                        </span><span class="annot"><span class="hs-comment">-- ^ Context of the parent patterns.</span></span><span>
</span><span id="line-554"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfBeforeTel"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Tele (Dom Type)
</span><a href="Agda.TypeChecking.Rules.Def.html#wfBeforeTel"><span class="hs-identifier hs-var hs-var">wfBeforeTel</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>                        </span><span class="annot"><span class="hs-comment">-- ^ Types of arguments to the with function before the with expressions (needed vars).</span></span><span>
</span><span id="line-555"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfAfterTel"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Tele (Dom Type)
</span><a href="Agda.TypeChecking.Rules.Def.html#wfAfterTel"><span class="hs-identifier hs-var hs-var">wfAfterTel</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span>                        </span><span class="annot"><span class="hs-comment">-- ^ Types of arguments to the with function after the with expressions (unneeded vars).</span></span><span>
</span><span id="line-556"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfExprs"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; List1 (Arg (Term, EqualityView))
</span><a href="Agda.TypeChecking.Rules.Def.html#wfExprs"><span class="hs-identifier hs-var hs-var">wfExprs</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityView"><span class="hs-identifier hs-type">EqualityView</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-comment">-- ^ With and rewrite expressions and their types.</span></span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfRHSType"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Type
</span><a href="Agda.TypeChecking.Rules.Def.html#wfRHSType"><span class="hs-identifier hs-var hs-var">wfRHSType</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                             </span><span class="annot"><span class="hs-comment">-- ^ Type of the right hand side.</span></span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfParentPats"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; [NamedArg DeBruijnPattern]
</span><a href="Agda.TypeChecking.Rules.Def.html#wfParentPats"><span class="hs-identifier hs-var hs-var">wfParentPats</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Parent patterns.</span></span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfParentParams"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Int
</span><a href="Agda.TypeChecking.Rules.Def.html#wfParentParams"><span class="hs-identifier hs-var hs-var">wfParentParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>                              </span><span class="annot"><span class="hs-comment">-- ^ Number of module parameters in parent patterns</span></span><span>
</span><span id="line-560"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfPermSplit"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Permutation
</span><a href="Agda.TypeChecking.Rules.Def.html#wfPermSplit"><span class="hs-identifier hs-var hs-var">wfPermSplit</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Permutation"><span class="hs-identifier hs-type">Permutation</span></a></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ Permutation resulting from splitting the telescope into needed and unneeded vars.</span></span><span>
</span><span id="line-561"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfPermParent"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Permutation
</span><a href="Agda.TypeChecking.Rules.Def.html#wfPermParent"><span class="hs-identifier hs-var hs-var">wfPermParent</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Permutation"><span class="hs-identifier hs-type">Permutation</span></a></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ Permutation reordering the variables in the parent pattern.</span></span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfPermFinal"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Permutation
</span><a href="Agda.TypeChecking.Rules.Def.html#wfPermFinal"><span class="hs-identifier hs-var hs-var">wfPermFinal</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#Permutation"><span class="hs-identifier hs-type">Permutation</span></a></span><span>                      </span><span class="annot"><span class="hs-comment">-- ^ Final permutation (including permutation for the parent clause).</span></span><span>
</span><span id="line-563"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfClauses"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; List1 (Clause' LHS)
</span><a href="Agda.TypeChecking.Rules.Def.html#wfClauses"><span class="hs-identifier hs-var hs-var">wfClauses</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ The given clauses for the with function</span></span><span>
</span><span id="line-564"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfCallSubst"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Substitution
</span><a href="Agda.TypeChecking.Rules.Def.html#wfCallSubst"><span class="hs-identifier hs-var hs-var">wfCallSubst</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span>                     </span><span class="annot"><span class="hs-comment">-- ^ Substitution to generate call for the parent.</span></span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wfLetBindings"><span class="annot"><span class="annottext">WithFunctionProblem -&gt; Map Name LetBinding
</span><a href="Agda.TypeChecking.Rules.Def.html#wfLetBindings"><span class="hs-identifier hs-var hs-var">wfLetBindings</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#LetBinding"><span class="hs-identifier hs-type">LetBinding</span></a></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ The let-bindings in scope of the parent (in the parent context).</span></span><span>
</span><span id="line-566"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkSystemCoverage"><span class="hs-identifier hs-type">checkSystemCoverage</span></a></span><span>
</span><span id="line-569"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-571"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-573"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#System"><span class="hs-identifier hs-type">System</span></a></span><span>
</span><span id="line-574"></span><span id="checkSystemCoverage"><span class="annot"><span class="annottext">checkSystemCoverage :: QName -&gt; [Int] -&gt; Type -&gt; [Clause] -&gt; TCMT IO System
</span><a href="Agda.TypeChecking.Rules.Def.html#checkSystemCoverage"><span class="hs-identifier hs-var hs-var">checkSystemCoverage</span></a></span></span><span> </span><span id="local-6989586621682155935"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155935"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682155936"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155936"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621682155937"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155937"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682155938"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682155938"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-575"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.sys.cover&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155936"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Clause] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682155938"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155937"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-576"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682155939"><span class="annot"><a href="#local-6989586621682155939"><span class="hs-identifier hs-var">gamma</span></a></span></span><span> </span><span id="local-6989586621682155940"><span class="annot"><a href="#local-6989586621682155940"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Int -&gt; Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telViewUpTo"><span class="hs-identifier hs-var">telViewUpTo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155936"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155937"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-577"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155939"><span class="hs-identifier hs-type">gamma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-578"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ExtendTel"><span class="hs-identifier hs-type">ExtendTel</span></a></span><span> </span><span id="local-6989586621682155944"><span class="annot"><a href="#local-6989586621682155944"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#telViewUpTo"><span class="hs-identifier hs-type">telViewUpTo</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="#local-6989586621682155940"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-579"></span><span>  </span><span id="local-6989586621682155945"><span class="annot"><a href="#local-6989586621682155945"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unEl"><span class="hs-identifier hs-var">unEl</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155944"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682155945"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-582"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682155949"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682155949"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682155951"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682155951"><span class="hs-identifier hs-var">phi</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-583"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621682155952"><span class="annot"><a href="#local-6989586621682155952"><span class="hs-identifier hs-var">iz</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682155953"><span class="annot"><a href="#local-6989586621682155953"><span class="hs-identifier hs-var">io</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BuiltinId -&gt; TCMT IO (Maybe QName))
-&gt; [BuiltinId] -&gt; TCMT IO [Maybe QName]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">BuiltinId -&gt; TCMT IO (Maybe QName)
forall (m :: * -&gt; *). HasBuiltins m =&gt; BuiltinId -&gt; m (Maybe QName)
</span><a href="Agda.TypeChecking.Monad.Builtin.html#getBuiltinName%27"><span class="hs-identifier hs-var">getBuiltinName'</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BuiltinId
</span><a href="Agda.Syntax.Builtin.html#builtinIZero"><span class="hs-identifier hs-var">builtinIZero</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuiltinId
</span><a href="Agda.Syntax.Builtin.html#builtinIOne"><span class="hs-identifier hs-var">builtinIOne</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-584"></span><span>      </span><span id="local-6989586621682155958"><span class="annot"><a href="#local-6989586621682155958"><span class="hs-identifier hs-var">ineg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primINeg"><span class="hs-identifier hs-type">primINeg</span></a></span><span>
</span><span id="line-585"></span><span>      </span><span id="local-6989586621682155960"><span class="annot"><a href="#local-6989586621682155960"><span class="hs-identifier hs-var">imin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primIMin"><span class="hs-identifier hs-type">primIMin</span></a></span><span>
</span><span id="line-586"></span><span>      </span><span id="local-6989586621682155962"><span class="annot"><a href="#local-6989586621682155962"><span class="hs-identifier hs-var">imax</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primIMax"><span class="hs-identifier hs-type">primIMax</span></a></span><span>
</span><span id="line-587"></span><span>      </span><span id="local-6989586621682155964"><span class="annot"><a href="#local-6989586621682155964"><span class="hs-identifier hs-var">i0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primIZero"><span class="hs-identifier hs-type">primIZero</span></a></span><span>
</span><span id="line-588"></span><span>      </span><span id="local-6989586621682155966"><span class="annot"><a href="#local-6989586621682155966"><span class="hs-identifier hs-var">i1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primIOne"><span class="hs-identifier hs-type">primIOne</span></a></span><span>
</span><span id="line-589"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-590"></span><span>        </span><span id="local-6989586621682155968"><span class="annot"><a href="#local-6989586621682155968"><span class="hs-identifier hs-var hs-var">isDir</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682155969"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682155969"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682155969"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682155952"><span class="hs-identifier hs-var">iz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-591"></span><span>        </span><span class="annot"><a href="#local-6989586621682155968"><span class="hs-identifier hs-var">isDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#ConP"><span class="hs-identifier hs-type">ConP</span></a></span><span> </span><span id="local-6989586621682155971"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682155971"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConPatternInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Maybe QName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682155971"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe QName -&gt; Maybe QName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Maybe QName
</span><a href="#local-6989586621682155953"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-592"></span><span>        </span><span class="annot"><a href="#local-6989586621682155968"><span class="hs-identifier hs-var">isDir</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>        </span><span class="annot"><a href="#local-6989586621682155972"><span class="hs-identifier hs-type">collectDirs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#DeBruijnPattern"><span class="hs-identifier hs-type">DeBruijnPattern</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-595"></span><span>        </span><span id="local-6989586621682155972"><span class="annot"><a href="#local-6989586621682155972"><span class="hs-identifier hs-var hs-var">collectDirs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-596"></span><span>        </span><span class="annot"><a href="#local-6989586621682155972"><span class="hs-identifier hs-var">collectDirs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155973"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155973"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682155974"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682155974"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155975"><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682155975"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682155976"><span class="annot"><span class="annottext">[DeBruijnPattern]
</span><a href="#local-6989586621682155976"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682155977"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682155977"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern -&gt; Maybe Bool
</span><a href="#local-6989586621682155968"><span class="hs-identifier hs-var">isDir</span></a></span><span> </span><span class="annot"><span class="annottext">DeBruijnPattern
</span><a href="#local-6989586621682155975"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155973"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682155977"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int, Bool) -&gt; [(Int, Bool)] -&gt; [(Int, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [DeBruijnPattern] -&gt; [(Int, Bool)]
</span><a href="#local-6989586621682155972"><span class="hs-identifier hs-var">collectDirs</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682155974"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">[DeBruijnPattern]
</span><a href="#local-6989586621682155976"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-597"></span><span>                                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [DeBruijnPattern] -&gt; [(Int, Bool)]
</span><a href="#local-6989586621682155972"><span class="hs-identifier hs-var">collectDirs</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682155974"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">[DeBruijnPattern]
</span><a href="#local-6989586621682155976"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-598"></span><span>        </span><span class="annot"><a href="#local-6989586621682155972"><span class="hs-identifier hs-var">collectDirs</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[DeBruijnPattern]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, Bool)]
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>        </span><span class="annot"><a href="#local-6989586621682155978"><span class="hs-identifier hs-type">dir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-601"></span><span>        </span><span id="local-6989586621682155978"><span class="annot"><a href="#local-6989586621682155978"><span class="hs-identifier hs-var hs-var">dir</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155979"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155979"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155958"><span class="hs-identifier hs-var">ineg</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Arg Term] -&gt; Term
forall t. Apply t =&gt; t -&gt; [Arg Term] -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.TypeChecking.Primitive.Base.html#argN"><span class="hs-identifier hs-var">argN</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Arg Term) -&gt; Term -&gt; Arg Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155979"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-602"></span><span>        </span><span class="annot"><a href="#local-6989586621682155978"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155983"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155983"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155983"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>        </span><span class="hs-comment">-- andI and orI have cases for singletons to improve error messages.</span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><a href="#local-6989586621682155984"><span class="hs-identifier hs-type">andI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682155985"><span class="hs-identifier hs-type">orI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-606"></span><span>        </span><span id="local-6989586621682155984"><span class="annot"><a href="#local-6989586621682155984"><span class="hs-identifier hs-var hs-var">andI</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155966"><span class="hs-identifier hs-var">i1</span></a></span><span>
</span><span id="line-607"></span><span>        </span><span class="annot"><a href="#local-6989586621682155984"><span class="hs-identifier hs-var">andI</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682155986"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155986"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155986"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-608"></span><span>        </span><span class="annot"><a href="#local-6989586621682155984"><span class="hs-identifier hs-var">andI</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155987"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155987"><span class="hs-identifier hs-var">t</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682155988"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682155988"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682155989"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155989"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155960"><span class="hs-identifier hs-var">imin</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Arg Term] -&gt; Term
forall t. Apply t =&gt; t -&gt; [Arg Term] -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.TypeChecking.Primitive.Base.html#argN"><span class="hs-identifier hs-var">argN</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155987"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.TypeChecking.Primitive.Base.html#argN"><span class="hs-identifier hs-var">argN</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155989"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Term -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Term
</span><a href="#local-6989586621682155984"><span class="hs-identifier hs-var">andI</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682155988"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-609"></span><span>
</span><span id="line-610"></span><span>        </span><span id="local-6989586621682155985"><span class="annot"><a href="#local-6989586621682155985"><span class="hs-identifier hs-var hs-var">orI</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155964"><span class="hs-identifier hs-var">i0</span></a></span><span>
</span><span id="line-611"></span><span>        </span><span class="annot"><a href="#local-6989586621682155985"><span class="hs-identifier hs-var">orI</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682155990"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155990"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155990"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-612"></span><span>        </span><span class="annot"><a href="#local-6989586621682155985"><span class="hs-identifier hs-var">orI</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682155991"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155991"><span class="hs-identifier hs-var">t</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682155992"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682155992"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155962"><span class="hs-identifier hs-var">imax</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Arg Term] -&gt; Term
forall t. Apply t =&gt; t -&gt; [Arg Term] -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.TypeChecking.Primitive.Base.html#argN"><span class="hs-identifier hs-var">argN</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155991"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.TypeChecking.Primitive.Base.html#argN"><span class="hs-identifier hs-var">argN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Term] -&gt; Term
</span><a href="#local-6989586621682155985"><span class="hs-identifier hs-var">orI</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682155992"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-615"></span><span>        </span><span id="local-6989586621682155993"><span class="annot"><a href="#local-6989586621682155993"><span class="hs-identifier hs-var hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; [DeBruijnPattern]) -&gt; [Clause] -&gt; [[DeBruijnPattern]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [DeBruijnPattern] -&gt; [DeBruijnPattern]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155936"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">([DeBruijnPattern] -&gt; [DeBruijnPattern])
-&gt; (Clause -&gt; [DeBruijnPattern]) -&gt; Clause -&gt; [DeBruijnPattern]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg DeBruijnPattern -&gt; DeBruijnPattern)
-&gt; [NamedArg DeBruijnPattern] -&gt; [DeBruijnPattern]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Named NamedName DeBruijnPattern -&gt; DeBruijnPattern
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span> </span><span class="annot"><span class="annottext">(Named NamedName DeBruijnPattern -&gt; DeBruijnPattern)
-&gt; (NamedArg DeBruijnPattern -&gt; Named NamedName DeBruijnPattern)
-&gt; NamedArg DeBruijnPattern
-&gt; DeBruijnPattern
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NamedArg DeBruijnPattern -&gt; Named NamedName DeBruijnPattern
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; [DeBruijnPattern])
-&gt; (Clause -&gt; [NamedArg DeBruijnPattern])
-&gt; Clause
-&gt; [DeBruijnPattern]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; [NamedArg DeBruijnPattern]
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682155938"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-616"></span><span>        </span><span class="annot"><a href="#local-6989586621682155997"><span class="hs-identifier hs-type">alphas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- the face maps corresponding to each clause</span><span>
</span><span id="line-617"></span><span>        </span><span id="local-6989586621682155997"><span class="annot"><a href="#local-6989586621682155997"><span class="hs-identifier hs-var hs-var">alphas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([DeBruijnPattern] -&gt; [(Int, Bool)])
-&gt; [[DeBruijnPattern]] -&gt; [[(Int, Bool)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; [DeBruijnPattern] -&gt; [(Int, Bool)]
</span><a href="#local-6989586621682155972"><span class="hs-identifier hs-var">collectDirs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155936"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[DeBruijnPattern]]
</span><a href="#local-6989586621682155993"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-618"></span><span>        </span><span class="annot"><a href="#local-6989586621682155999"><span class="hs-identifier hs-type">phis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- the &#966; terms for each clause (i.e. the alphas as terms)</span><span>
</span><span id="line-619"></span><span>        </span><span id="local-6989586621682155999"><span class="annot"><a href="#local-6989586621682155999"><span class="hs-identifier hs-var hs-var">phis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Int, Bool)] -&gt; Term) -&gt; [[(Int, Bool)]] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Term] -&gt; Term
</span><a href="#local-6989586621682155984"><span class="hs-identifier hs-var">andI</span></a></span><span> </span><span class="annot"><span class="annottext">([Term] -&gt; Term)
-&gt; ([(Int, Bool)] -&gt; [Term]) -&gt; [(Int, Bool)] -&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, Bool) -&gt; Term) -&gt; [(Int, Bool)] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, Bool) -&gt; Term
</span><a href="#local-6989586621682155978"><span class="hs-identifier hs-var">dir</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(Int, Bool)]]
</span><a href="#local-6989586621682155997"><span class="hs-identifier hs-var">alphas</span></a></span><span>
</span><span id="line-620"></span><span>        </span><span id="local-6989586621682156000"><span class="annot"><a href="#local-6989586621682156000"><span class="hs-identifier hs-var hs-var">psi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Term
</span><a href="#local-6989586621682155985"><span class="hs-identifier hs-var">orI</span></a></span><span> </span><span class="annot"><span class="annottext">([Term] -&gt; Term) -&gt; [Term] -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682155999"><span class="hs-identifier hs-var">phis</span></a></span><span>
</span><span id="line-621"></span><span>        </span><span id="local-6989586621682156001"><span class="annot"><a href="#local-6989586621682156001"><span class="hs-identifier hs-var hs-var">pcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Clause] -&gt; [(Term, Clause)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682155999"><span class="hs-identifier hs-var">phis</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682155938"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.sys.cover&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155993"><span class="hs-identifier hs-type">pats</span></a></span><span>
</span><span id="line-624"></span><span>      </span><span id="local-6989586621682156003"><span class="annot"><a href="#local-6989586621682156003"><span class="hs-identifier hs-var">interval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.Cubical.Base.html#primIntervalType"><span class="hs-identifier hs-type">primIntervalType</span></a></span><span>
</span><span id="line-625"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.sys.cover&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;equalTerm &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155951"><span class="hs-identifier hs-type">phi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156000"><span class="hs-identifier hs-type">psi</span></a></span><span>
</span><span id="line-626"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-type">equalTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156003"><span class="hs-identifier hs-type">interval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155951"><span class="hs-identifier hs-type">phi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156000"><span class="hs-identifier hs-type">psi</span></a></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List.html#initWithDefault"><span class="hs-identifier hs-type">initWithDefault</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-629"></span><span>             </span><span class="annot"><a href="Agda.Utils.List.html#initWithDefault"><span class="hs-identifier hs-type">initWithDefault</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List.tails</span></span><span> </span><span class="annot"><a href="#local-6989586621682156001"><span class="hs-identifier hs-type">pcs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682156008"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156008"><span class="hs-identifier hs-var">phi1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682156009"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682156009"><span class="hs-identifier hs-var">cl1</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682156010"><span class="annot"><span class="annottext">[(Term, Clause)]
</span><a href="#local-6989586621682156010"><span class="hs-identifier hs-var">pcs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-630"></span><span>        </span><span class="annot"><span class="annottext">[(Term, Clause)] -&gt; ((Term, Clause) -&gt; TCMT IO [()]) -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[(Term, Clause)]
</span><a href="#local-6989586621682156010"><span class="hs-identifier hs-var">pcs'</span></a></span><span> </span><span class="annot"><span class="annottext">(((Term, Clause) -&gt; TCMT IO [()]) -&gt; TCM ())
-&gt; ((Term, Clause) -&gt; TCMT IO [()]) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156011"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156011"><span class="hs-identifier hs-var">phi2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682156012"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682156012"><span class="hs-identifier hs-var">cl2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-631"></span><span>          </span><span id="local-6989586621682156013"><span class="annot"><a href="#local-6989586621682156013"><span class="hs-identifier hs-var">phi12</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Term
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682155960"><span class="hs-identifier hs-var">imin</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; [Arg Term] -&gt; Term
forall t. Apply t =&gt; t -&gt; [Arg Term] -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#apply"><span class="hs-operator hs-var">`apply`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.TypeChecking.Primitive.Base.html#argN"><span class="hs-identifier hs-var">argN</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156008"><span class="hs-identifier hs-var">phi1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Arg Term
forall a. a -&gt; Arg a
</span><a href="Agda.TypeChecking.Primitive.Base.html#argN"><span class="hs-identifier hs-var">argN</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156011"><span class="hs-identifier hs-var">phi2</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#forallFaceMaps"><span class="hs-identifier hs-type">forallFaceMaps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156013"><span class="hs-identifier hs-type">phi12</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">IntMap Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">IntMap Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156015"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682156015"><span class="hs-identifier hs-var">sigma</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156016"><span class="annot"><span class="annottext">args :: [Arg Term]
</span><a href="#local-6989586621682156016"><span class="hs-identifier hs-var hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg [Arg Term])
</span><a href="#local-6989586621682156015"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg [Arg Term]) -&gt; [Arg Term] -&gt; [Arg Term]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-operator hs-var">`applySubst`</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Arg Term]
forall a t. DeBruijn a =&gt; Tele (Dom t) -&gt; [Arg a]
</span><a href="Agda.TypeChecking.Telescope.html#teleArgs"><span class="hs-identifier hs-var">teleArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682155939"><span class="hs-identifier hs-var">gamma</span></a></span><span>
</span><span id="line-634"></span><span>                </span><span id="local-6989586621682156019"><span class="annot"><span class="annottext">t' :: Type
</span><a href="#local-6989586621682156019"><span class="hs-identifier hs-var hs-var hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg Type)
</span><a href="#local-6989586621682156015"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Type) -&gt; Type -&gt; Type
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-operator hs-var">`applySubst`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682155940"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-635"></span><span>                </span><span id="local-6989586621682156020"><span class="annot"><span class="annottext">fromReduced :: Reduced (Blocked' t yes) yes -&gt; yes
</span><a href="#local-6989586621682156020"><span class="hs-identifier hs-var hs-var hs-var">fromReduced</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#YesReduction"><span class="hs-identifier hs-type">YesReduction</span></a></span><span> </span><span class="annot"><span class="annottext">Simplification
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156022"><span class="annot"><span class="annottext">yes
</span><a href="#local-6989586621682156022"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">yes
</span><a href="#local-6989586621682156022"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-636"></span><span>                </span><span class="annot"><a href="#local-6989586621682156020"><span class="hs-identifier hs-var">fromReduced</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NoReduction"><span class="hs-identifier hs-type">NoReduction</span></a></span><span> </span><span id="local-6989586621682156024"><span class="annot"><span class="annottext">Blocked' t yes
</span><a href="#local-6989586621682156024"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked' t yes -&gt; yes
forall t a. Blocked' t a -&gt; a
</span><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked' t yes
</span><a href="#local-6989586621682156024"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-637"></span><span>                </span><span id="local-6989586621682156026"><span class="annot"><span class="annottext">body :: Clause -&gt; TCMT IO Term
</span><a href="#local-6989586621682156026"><span class="hs-identifier hs-var hs-var hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682156027"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682156027"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-638"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156028"><span class="annot"><span class="annottext">extra :: Int
</span><a href="#local-6989586621682156028"><span class="hs-identifier hs-var hs-var hs-var">extra</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682155936"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern])
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; [NamedArg DeBruijnPattern]
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682156027"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>                  </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682156029"><span class="annot"><a href="#local-6989586621682156029"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; TCMT IO (TelV Type)
forall (m :: * -&gt; *).
(MonadReduce m, MonadAddContext m) =&gt;
Int -&gt; Type -&gt; m (TelV Type)
</span><a href="Agda.TypeChecking.Telescope.html#telViewUpTo"><span class="hs-identifier hs-var">telViewUpTo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156028"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156019"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-640"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-type">abstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156029"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156029"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-641"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="#local-6989586621682156020"><span class="hs-identifier hs-type">fromReduced</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#runReduceM"><span class="hs-identifier hs-type">runReduceM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-642"></span><span>                      </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#appDef%27"><span class="hs-identifier hs-type">appDef'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155935"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155935"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682156027"><span class="hs-identifier hs-type">cl</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#notReduced"><span class="hs-identifier hs-type">notReduced</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#raise"><span class="hs-identifier hs-type">raise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156029"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156016"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#teleArgs"><span class="hs-identifier hs-type">teleArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156029"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>            </span><span id="local-6989586621682156035"><span class="annot"><a href="#local-6989586621682156035"><span class="hs-identifier hs-var">v1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; TCMT IO Term
</span><a href="#local-6989586621682156026"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682156009"><span class="hs-identifier hs-var">cl1</span></a></span><span>
</span><span id="line-644"></span><span>            </span><span id="local-6989586621682156036"><span class="annot"><a href="#local-6989586621682156036"><span class="hs-identifier hs-var">v2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682156026"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156012"><span class="hs-identifier hs-type">cl2</span></a></span><span>
</span><span id="line-645"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-type">equalTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156019"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156035"><span class="hs-identifier hs-type">v1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156036"><span class="hs-identifier hs-type">v2</span></a></span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span>      </span><span id="local-6989586621682156037"><span class="annot"><a href="#local-6989586621682156037"><span class="hs-identifier hs-var">sys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="annot"><a href="#local-6989586621682155997"><span class="hs-identifier hs-type">alphas</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155938"><span class="hs-identifier hs-type">cs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156038"><span class="annot"><span class="annottext">[(Int, Bool)]
</span><a href="#local-6989586621682156038"><span class="hs-identifier hs-var">alpha</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682156039"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682156039"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>            </span><span class="hs-keyword">let</span><span>
</span><span id="line-650"></span><span>                </span><span class="hs-comment">-- &#916; = &#915;_&#945; , &#916;'&#945;</span><span>
</span><span id="line-651"></span><span>                </span><span id="local-6989586621682156040"><span class="annot"><span class="annottext">delta :: Tele (Dom Type)
</span><a href="#local-6989586621682156040"><span class="hs-identifier hs-var hs-var">delta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Tele (Dom Type)
</span><a href="Agda.Syntax.Internal.html#clauseTel"><span class="hs-identifier hs-var">clauseTel</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682156039"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-652"></span><span>                </span><span class="hs-comment">-- &#916; &#8866; b</span><span>
</span><span id="line-653"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682156041"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156041"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Maybe Term
</span><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682156039"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-654"></span><span>                </span><span class="hs-comment">-- &#916; &#8866; ps : &#915; , o : [&#966;] , &#916;'</span><span>
</span><span id="line-655"></span><span>                </span><span class="hs-comment">-- we assume that there's no pattern matching other</span><span>
</span><span id="line-656"></span><span>                </span><span class="hs-comment">-- than from the system</span><span>
</span><span id="line-657"></span><span>                </span><span id="local-6989586621682156042"><span class="annot"><span class="annottext">ps :: [NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156042"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; [NamedArg DeBruijnPattern]
</span><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682156039"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-658"></span><span>                </span><span id="local-6989586621682156043"><span class="annot"><span class="annottext">extra :: Int
</span><a href="#local-6989586621682156043"><span class="hs-identifier hs-var hs-var">extra</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682155939"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156042"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>                </span><span class="hs-comment">-- size &#916;'&#945; = size &#916;' = extra</span><span>
</span><span id="line-660"></span><span>                </span><span class="hs-comment">-- &#915; , &#945; &#8866; u</span><span>
</span><span id="line-661"></span><span>                </span><span id="local-6989586621682156047"><span class="annot"><span class="annottext">takeLast :: Int -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621682156047"><span class="hs-identifier hs-var hs-var">takeLast</span></a></span></span><span> </span><span id="local-6989586621682156048"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156048"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682156049"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682156049"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [a] -&gt; [a]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682156049"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156048"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682156049"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-662"></span><span>                </span><span id="local-6989586621682156059"><span class="annot"><span class="annottext">weak :: [Int] -&gt; Substitution' a
</span><a href="#local-6989586621682156059"><span class="hs-identifier hs-var hs-var">weak</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution' a
forall a. Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-var">idS</span></a></span><span>
</span><span id="line-663"></span><span>                </span><span class="annot"><a href="#local-6989586621682156059"><span class="hs-identifier hs-var">weak</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156061"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156061"><span class="hs-identifier hs-var">i</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682156062"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682156062"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Substitution' a
</span><a href="#local-6989586621682156059"><span class="hs-identifier hs-var">weak</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621682156062"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution' a -&gt; Substitution' a -&gt; Substitution' a
forall a.
EndoSubst a =&gt;
Substitution' a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#composeS"><span class="hs-operator hs-var">`composeS`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Substitution' a -&gt; Substitution' a
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156061"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Substitution' a
forall a. Int -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#raiseS"><span class="hs-identifier hs-var">raiseS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>                </span><span id="local-6989586621682156066"><span class="annot"><span class="annottext">tel :: Tele (Dom Type)
</span><a href="#local-6989586621682156066"><span class="hs-identifier hs-var hs-var">tel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom ([Char], Type)] -&gt; Tele (Dom Type)
</span><a href="Agda.Syntax.Internal.html#telFromList"><span class="hs-identifier hs-var">telFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Dom ([Char], Type)] -&gt; [Dom ([Char], Type)]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621682156047"><span class="hs-identifier hs-var">takeLast</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156043"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Dom ([Char], Type)]
forall t. Tele (Dom t) -&gt; [Dom ([Char], t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156040"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-665"></span><span>                </span><span id="local-6989586621682156067"><span class="annot"><span class="annottext">u :: Term
</span><a href="#local-6989586621682156067"><span class="hs-identifier hs-var hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Term -&gt; Term
forall t. Abstract t =&gt; Tele (Dom Type) -&gt; t -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-var">abstract</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156066"><span class="hs-identifier hs-var">tel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156043"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Substitution
forall {a}.
(SubstArg a ~ a, Subst a, DeBruijn a) =&gt;
[Int] -&gt; Substitution' a
</span><a href="#local-6989586621682156059"><span class="hs-identifier hs-var">weak</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Substitution) -&gt; [Int] -&gt; Substitution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sort</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Bool) -&gt; Int) -&gt; [(Int, Bool)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, Bool) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Bool)]
</span><a href="#local-6989586621682156038"><span class="hs-identifier hs-var">alpha</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg Term) -&gt; Term -&gt; Term
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-operator hs-var">`applySubst`</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156041"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>            </span><span class="annot"><span class="annottext">([(Term, Bool)], Term) -&gt; TCMT IO ([(Term, Bool)], Term)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, Bool) -&gt; (Term, Bool)) -&gt; [(Int, Bool)] -&gt; [(Term, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Term) -&gt; (Int, Bool) -&gt; (Term, Bool)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, Bool)]
</span><a href="#local-6989586621682156038"><span class="hs-identifier hs-var">alpha</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156067"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.sys.cover.sys&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155939"><span class="hs-identifier hs-type">gamma</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156037"><span class="hs-identifier hs-type">sys</span></a></span><span>
</span><span id="line-669"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.sys.cover.sys&quot;</span></span><span> </span><span class="annot"><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-type">fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682155939"><span class="hs-identifier hs-type">gamma</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156037"><span class="hs-identifier hs-type">sys</span></a></span><span>
</span><span id="line-670"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#System"><span class="hs-identifier hs-type">System</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682155939"><span class="hs-identifier hs-type">gamma</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156037"><span class="hs-identifier hs-type">sys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- gamma uses names from the type, not the patterns, could we do better?</span><span>
</span><span id="line-671"></span><span>    </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO System
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-672"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkSystemCoverage"><span class="hs-identifier hs-var">checkSystemCoverage</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156071"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156071"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682156072"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682156072"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO System
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span class="annot"><span class="hs-comment">-- * Info that is needed after all clauses have been processed.</span></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span class="hs-keyword">data</span><span> </span><span id="ClausesPostChecks"><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#ClausesPostChecks"><span class="hs-identifier hs-var">ClausesPostChecks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CPC"><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#CPC"><span class="hs-identifier hs-var">CPC</span></a></span></span><span>
</span><span id="line-678"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="cpcPartialSplits"><span class="annot"><span class="annottext">ClausesPostChecks -&gt; IntSet
</span><a href="Agda.TypeChecking.Rules.Def.html#cpcPartialSplits"><span class="hs-identifier hs-var hs-var">cpcPartialSplits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntSet</span></span><span>
</span><span id="line-679"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Which argument indexes have a partial split.</span></span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682156076"><span id="local-6989586621682156080"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#ClausesPostChecks"><span class="hs-identifier hs-type">ClausesPostChecks</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-683"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#CPC"><span class="hs-identifier hs-type">CPC</span></a></span><span> </span><span id="local-6989586621682156085"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621682156085"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682156086"><span class="annot"><span class="annottext">&lt;&gt; :: ClausesPostChecks -&gt; ClausesPostChecks -&gt; ClausesPostChecks
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#CPC"><span class="hs-identifier hs-type">CPC</span></a></span><span> </span><span id="local-6989586621682156087"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621682156087"><span class="hs-identifier hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; ClausesPostChecks
</span><a href="Agda.TypeChecking.Rules.Def.html#CPC"><span class="hs-identifier hs-var">CPC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet -&gt; IntSet -&gt; IntSet
</span><span class="hs-identifier hs-var">IntSet.union</span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621682156085"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621682156087"><span class="hs-identifier hs-var">xs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682156094"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#ClausesPostChecks"><span class="hs-identifier hs-type">ClausesPostChecks</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-686"></span><span>  </span><span id="local-6989586621682156098"><span class="annot"><span class="annottext">mempty :: ClausesPostChecks
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; ClausesPostChecks
</span><a href="Agda.TypeChecking.Rules.Def.html#CPC"><span class="hs-identifier hs-var">CPC</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-687"></span><span>  </span><span id="local-6989586621682156100"><span class="annot"><span class="annottext">mappend :: ClausesPostChecks -&gt; ClausesPostChecks -&gt; ClausesPostChecks
</span><span class="hs-identifier hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClausesPostChecks -&gt; ClausesPostChecks -&gt; ClausesPostChecks
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="annot"><span class="hs-comment">-- | The LHS part of checkClause.</span></span><span>
</span><span id="line-690"></span><span id="local-6989586621682153704"><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkClauseLHS"><span class="hs-identifier hs-type">checkClauseLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineClause"><span class="hs-identifier hs-type">A.SpineClause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153704"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153704"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-691"></span><span id="checkClauseLHS"><span class="annot"><span class="annottext">checkClauseLHS :: forall a.
Type
-&gt; Maybe Substitution
-&gt; SpineClause
-&gt; (LHSResult -&gt; TCM a)
-&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Def.html#checkClauseLHS"><span class="hs-identifier hs-var hs-var">checkClauseLHS</span></a></span></span><span> </span><span id="local-6989586621682156164"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156164"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682156165"><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621682156165"><span class="hs-identifier hs-var">withSub</span></a></span></span><span> </span><span id="local-6989586621682156166"><span class="annot"><span class="annottext">c :: SpineClause
</span><a href="#local-6989586621682156166"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span id="local-6989586621682156167"><span class="annot"><span class="annottext">lhs :: SpineLHS
</span><a href="#local-6989586621682156167"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineLHS"><span class="hs-identifier hs-type">A.SpineLHS</span></a></span><span> </span><span id="local-6989586621682156168"><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682156168"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682156169"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156169"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682156170"><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)]
</span><a href="#local-6989586621682156170"><span class="hs-identifier hs-var">aps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156171"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156171"><span class="hs-identifier hs-var">strippedPats</span></a></span></span><span> </span><span id="local-6989586621682156172"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156172"><span class="hs-identifier hs-var">_rhs0</span></a></span></span><span> </span><span id="local-6989586621682156173"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156173"><span class="hs-identifier hs-var">_wh</span></a></span></span><span> </span><span id="local-6989586621682156174"><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682156174"><span class="hs-identifier hs-var">_catchall</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156175"><span class="annot"><span class="annottext">LHSResult -&gt; TCM a
</span><a href="#local-6989586621682156175"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-692"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Checking clause&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SpineClause -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">SpineClause
</span><a href="#local-6989586621682156166"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-693"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)]
-&gt; (List1 (NamedArg (Pattern' Expr)) -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
[a] -&gt; (List1 a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.List1.html#unlessNull"><span class="hs-identifier hs-var">List1.unlessNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)] -&gt; [NamedArg (Pattern' Expr)]
</span><a href="Agda.Syntax.Abstract.Pattern.html#trailingWithPatterns"><span class="hs-identifier hs-var">trailingWithPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)]
</span><a href="#local-6989586621682156170"><span class="hs-identifier hs-var">aps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((List1 (NamedArg (Pattern' Expr)) -&gt; TCM ()) -&gt; TCM ())
-&gt; (List1 (NamedArg (Pattern' Expr)) -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682156180"><span class="annot"><span class="annottext">List1 (NamedArg (Pattern' Expr))
</span><a href="#local-6989586621682156180"><span class="hs-identifier hs-var">withPats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>      </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCM ()) -&gt; TypeError -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Pattern' Expr) -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#UnexpectedWithPatterns"><span class="hs-identifier hs-var">UnexpectedWithPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Pattern' Expr) -&gt; TypeError)
-&gt; NonEmpty (Pattern' Expr) -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NamedArg (Pattern' Expr) -&gt; Pattern' Expr)
-&gt; List1 (NamedArg (Pattern' Expr)) -&gt; NonEmpty (Pattern' Expr)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">NamedArg (Pattern' Expr) -&gt; Pattern' Expr
forall a. NamedArg a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedArg"><span class="hs-identifier hs-var">namedArg</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (NamedArg (Pattern' Expr))
</span><a href="#local-6989586621682156180"><span class="hs-identifier hs-var">withPats</span></a></span><span>
</span><span id="line-695"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-type">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckClause"><span class="hs-identifier hs-type">CheckClause</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156164"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156166"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-696"></span><span>      </span><span id="local-6989586621682156183"><span class="annot"><a href="#local-6989586621682156183"><span class="hs-identifier hs-var">aps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Patterns.Abstract.html#expandPatternSynonyms"><span class="hs-identifier hs-type">expandPatternSynonyms</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156170"><span class="hs-identifier hs-type">aps</span></a></span><span>
</span><span id="line-697"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156171"><span class="hs-identifier hs-type">strippedPats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-698"></span><span>        </span><span class="annot"><span class="hs-string">&quot;strippedPats:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-type">prettyA</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156184"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156185"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156186"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">A.ProblemEq</span></a></span><span> </span><span id="local-6989586621682156184"><span class="annot"><a href="#local-6989586621682156184"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621682156185"><span class="annot"><a href="#local-6989586621682156185"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682156186"><span class="annot"><a href="#local-6989586621682156186"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682156171"><span class="hs-identifier hs-type">strippedPats</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-699"></span><span>      </span><span id="local-6989586621682156188"><span class="annot"><a href="#local-6989586621682156188"><span class="hs-identifier hs-var">closed_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-type">abstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156164"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span>
</span><span id="line-700"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#checkLeftHandSide"><span class="hs-identifier hs-type">checkLeftHandSide</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckLHS"><span class="hs-identifier hs-type">CheckLHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156167"><span class="hs-identifier hs-type">lhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-type">getRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156167"><span class="hs-identifier hs-type">lhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682156169"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156183"><span class="hs-identifier hs-type">aps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156164"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156165"><span class="hs-identifier hs-type">withSub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156171"><span class="hs-identifier hs-type">strippedPats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156175"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span class="annot"><span class="hs-comment">-- | Type check a function clause.</span></span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkClause"><span class="hs-identifier hs-type">checkClause</span></a></span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Type of function defined by this clause.</span></span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#LetBinding"><span class="hs-identifier hs-type">LetBinding</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Module parameter substitution arising from with-abstraction, and inherited let-bindings.</span></span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineClause"><span class="hs-identifier hs-type">A.SpineClause</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Clause.</span></span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#ClausesPostChecks"><span class="hs-identifier hs-type">ClausesPostChecks</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Type-checked clause</span></span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span id="checkClause"><span class="annot"><span class="annottext">checkClause :: Type
-&gt; Maybe (Substitution, Map Name LetBinding)
-&gt; SpineClause
-&gt; TCMT IO (Clause, ClausesPostChecks)
</span><a href="Agda.TypeChecking.Rules.Def.html#checkClause"><span class="hs-identifier hs-var hs-var">checkClause</span></a></span></span><span> </span><span id="local-6989586621682156190"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156190"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682156191"><span class="annot"><span class="annottext">Maybe (Substitution, Map Name LetBinding)
</span><a href="#local-6989586621682156191"><span class="hs-identifier hs-var">withSubAndLets</span></a></span></span><span> </span><span id="local-6989586621682156192"><span class="annot"><span class="annottext">c :: SpineClause
</span><a href="#local-6989586621682156192"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span id="local-6989586621682156193"><span class="annot"><span class="annottext">lhs :: SpineLHS
</span><a href="#local-6989586621682156193"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineLHS"><span class="hs-identifier hs-type">A.SpineLHS</span></a></span><span> </span><span id="local-6989586621682156194"><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682156194"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682156195"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156195"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682156196"><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)]
</span><a href="#local-6989586621682156196"><span class="hs-identifier hs-var">aps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156197"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156197"><span class="hs-identifier hs-var">strippedPats</span></a></span></span><span> </span><span id="local-6989586621682156198"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156198"><span class="hs-identifier hs-var">rhs0</span></a></span></span><span> </span><span id="local-6989586621682156199"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156199"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span id="local-6989586621682156200"><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682156200"><span class="hs-identifier hs-var">catchall</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156201"><span class="annot"><span class="annottext">withSub :: Maybe Substitution
</span><a href="#local-6989586621682156201"><span class="hs-identifier hs-var hs-var hs-var">withSub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Substitution, Map Name LetBinding) -&gt; Substitution
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Substitution, Map Name LetBinding) -&gt; Substitution)
-&gt; Maybe (Substitution, Map Name LetBinding) -&gt; Maybe Substitution
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Substitution, Map Name LetBinding)
</span><a href="#local-6989586621682156191"><span class="hs-identifier hs-var">withSubAndLets</span></a></span><span>
</span><span id="line-712"></span><span>  </span><span id="local-6989586621682156202"><span class="annot"><a href="#local-6989586621682156202"><span class="hs-identifier hs-var">cxtNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO [Name]
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m [Name]
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextNames"><span class="hs-identifier hs-var">getContextNames</span></a></span><span>
</span><span id="line-713"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkClauseLHS"><span class="hs-identifier hs-type">checkClauseLHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156190"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156201"><span class="hs-identifier hs-type">withSub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156192"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682156204"><span class="annot"><span class="annottext">lhsResult :: LHSResult
</span><a href="#local-6989586621682156204"><span class="hs-identifier hs-var">lhsResult</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span> </span><span id="local-6989586621682156206"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156206"><span class="hs-identifier hs-var">npars</span></a></span></span><span> </span><span id="local-6989586621682156207"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156207"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682156208"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156208"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682156209"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682156209"><span class="hs-identifier hs-var">absurdPat</span></a></span></span><span> </span><span id="local-6989586621682156210"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682156210"><span class="hs-identifier hs-var">trhs</span></a></span></span><span> </span><span id="local-6989586621682156211"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682156211"><span class="hs-identifier hs-var">patSubst</span></a></span></span><span> </span><span id="local-6989586621682156212"><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682156212"><span class="hs-identifier hs-var">asb</span></a></span></span><span> </span><span id="local-6989586621682156213"><span class="annot"><span class="annottext">IntSet
</span><a href="#local-6989586621682156213"><span class="hs-identifier hs-var">psplit</span></a></span></span><span> </span><span id="local-6989586621682156214"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682156214"><span class="hs-identifier hs-var">ixsplit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156215"><span class="annot"><span class="annottext">installInheritedLets :: TCMT IO (Clause, ClausesPostChecks)
-&gt; TCMT IO (Clause, ClausesPostChecks)
</span><a href="#local-6989586621682156215"><span class="hs-identifier hs-var hs-var">installInheritedLets</span></a></span></span><span> </span><span id="local-6989586621682156216"><span class="annot"><span class="annottext">TCMT IO (Clause, ClausesPostChecks)
</span><a href="#local-6989586621682156216"><span class="hs-identifier hs-var">k</span></a></span></span><span>
</span><span id="line-716"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156217"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682156217"><span class="hs-identifier hs-var">withSub</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156218"><span class="annot"><span class="annottext">Map Name LetBinding
</span><a href="#local-6989586621682156218"><span class="hs-identifier hs-var">lets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Substitution, Map Name LetBinding)
</span><a href="#local-6989586621682156191"><span class="hs-identifier hs-var">withSubAndLets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-717"></span><span>            </span><span id="local-6989586621682156219"><span class="annot"><a href="#local-6989586621682156219"><span class="hs-identifier hs-var">lets'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LetBinding -&gt; TCMT IO (Open LetBinding))
-&gt; Map Name LetBinding -&gt; TCMT IO (Map Name (Open LetBinding))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Map Name a -&gt; f (Map Name b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">LetBinding -&gt; TCMT IO (Open LetBinding)
forall (m :: * -&gt; *) a.
(ReadTCState m, MonadTCEnv m) =&gt;
a -&gt; m (Open a)
</span><a href="Agda.TypeChecking.Monad.Open.html#makeOpen"><span class="hs-identifier hs-var">makeOpen</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Name LetBinding -&gt; TCMT IO (Map Name (Open LetBinding)))
-&gt; Map Name LetBinding -&gt; TCMT IO (Map Name (Open LetBinding))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg (Map Name LetBinding))
-&gt; Map Name LetBinding -&gt; Map Name LetBinding
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682156211"><span class="hs-identifier hs-var">patSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution -&gt; Substitution -&gt; Substitution
forall a.
EndoSubst a =&gt;
Substitution' a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#composeS"><span class="hs-operator hs-var">`composeS`</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682156217"><span class="hs-identifier hs-var">withSub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Name LetBinding
</span><a href="#local-6989586621682156218"><span class="hs-identifier hs-var">lets</span></a></span><span>
</span><span id="line-718"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#locallyTC"><span class="hs-identifier hs-type">locallyTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eLetBindings"><span class="hs-identifier hs-type">eLetBindings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lets'</span></span><span> </span><span class="annot"><span class="hs-operator">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156216"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-719"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCMT IO (Clause, ClausesPostChecks)
</span><a href="#local-6989586621682156216"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO (Clause, ClausesPostChecks)
-&gt; TCMT IO (Clause, ClausesPostChecks)
</span><a href="#local-6989586621682156215"><span class="hs-identifier hs-var">installInheritedLets</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Clause, ClausesPostChecks)
 -&gt; TCMT IO (Clause, ClausesPostChecks))
-&gt; TCMT IO (Clause, ClausesPostChecks)
-&gt; TCMT IO (Clause, ClausesPostChecks)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-722"></span><span>        </span><span class="hs-comment">-- Note that we might now be in irrelevant context,</span><span>
</span><span id="line-723"></span><span>        </span><span class="hs-comment">-- in case checkLeftHandSide walked over an irrelevant projection pattern.</span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span>        </span><span class="hs-comment">-- Subtle: checkRHS expects the function type to be the lambda lifted</span><span>
</span><span id="line-726"></span><span>        </span><span class="hs-comment">-- type. If we're checking a with-function that's already the case,</span><span>
</span><span id="line-727"></span><span>        </span><span class="hs-comment">-- otherwise we need to abstract over the module telescope.</span><span>
</span><span id="line-728"></span><span>        </span><span id="local-6989586621682156226"><span class="annot"><a href="#local-6989586621682156226"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621682156201"><span class="hs-identifier hs-var">withSub</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-729"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Type
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156190"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-730"></span><span>                </span><span class="annot"><span class="annottext">Maybe Substitution
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-731"></span><span>                  </span><span id="local-6989586621682156227"><span class="annot"><a href="#local-6989586621682156227"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; TCMT IO (Tele (Dom Type))
forall (m :: * -&gt; *).
(Functor m, ReadTCState m) =&gt;
ModuleName -&gt; m (Tele (Dom Type))
</span><a href="Agda.TypeChecking.Monad.Signature.html#lookupSection"><span class="hs-identifier hs-var">lookupSection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; ModuleName
</span><a href="Agda.Syntax.Abstract.Name.html#qnameModule"><span class="hs-identifier hs-var">qnameModule</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156195"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#abstract"><span class="hs-identifier hs-type">abstract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156227"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156190"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>        </span><span class="hs-comment">-- At this point we should update the named dots potential with-clauses</span><span>
</span><span id="line-735"></span><span>        </span><span class="hs-comment">-- in the right-hand side. When checking a clause we expect the named</span><span>
</span><span id="line-736"></span><span>        </span><span class="hs-comment">-- dots to live in the context of the closest parent lhs, but the named</span><span>
</span><span id="line-737"></span><span>        </span><span class="hs-comment">-- dots added by buildWithFunction live in the context of the</span><span>
</span><span id="line-738"></span><span>        </span><span class="hs-comment">-- with-function arguments before pattern matching. That's what we need</span><span>
</span><span id="line-739"></span><span>        </span><span class="hs-comment">-- patSubst for.</span><span>
</span><span id="line-740"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156230"><span class="annot"><a href="#local-6989586621682156230"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RHS -&gt; RHS
</span><a href="#local-6989586621682156231"><span class="hs-identifier hs-var">updateRHS</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156198"><span class="hs-identifier hs-var">rhs0</span></a></span><span>
</span><span id="line-741"></span><span>            </span><span id="local-6989586621682156231"><span class="annot"><a href="#local-6989586621682156231"><span class="hs-identifier hs-var hs-var">updateRHS</span></a></span></span><span> </span><span id="local-6989586621682156232"><span class="annot"><span class="annottext">rhs :: RHS
</span><a href="#local-6989586621682156232"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156232"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-742"></span><span>            </span><span class="annot"><a href="#local-6989586621682156231"><span class="hs-identifier hs-var">updateRHS</span></a></span><span> </span><span id="local-6989586621682156233"><span class="annot"><span class="annottext">rhs :: RHS
</span><a href="#local-6989586621682156233"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Abstract.html#AbsurdRHS"><span class="hs-identifier hs-type">A.AbsurdRHS</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156233"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-743"></span><span>            </span><span class="annot"><a href="#local-6989586621682156231"><span class="hs-identifier hs-var">updateRHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithRHS"><span class="hs-identifier hs-type">A.WithRHS</span></a></span><span> </span><span id="local-6989586621682156234"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156234"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621682156235"><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682156235"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621682156236"><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682156236"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; List1 WithExpr -&gt; List1 (Clause' LHS) -&gt; RHS
</span><a href="Agda.Syntax.Abstract.html#WithRHS"><span class="hs-identifier hs-var">A.WithRHS</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156234"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682156235"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">(List1 (Clause' LHS) -&gt; RHS) -&gt; List1 (Clause' LHS) -&gt; RHS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Clause' LHS -&gt; Clause' LHS)
-&gt; List1 (Clause' LHS) -&gt; List1 (Clause' LHS)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Clause' LHS -&gt; Clause' LHS
</span><a href="#local-6989586621682156237"><span class="hs-identifier hs-var">updateClause</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682156236"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-744"></span><span>            </span><span class="annot"><a href="#local-6989586621682156231"><span class="hs-identifier hs-var">updateRHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-type">A.RewriteRHS</span></a></span><span> </span><span id="local-6989586621682156238"><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156238"><span class="hs-identifier hs-var">qes</span></a></span></span><span> </span><span id="local-6989586621682156239"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156239"><span class="hs-identifier hs-var">spats</span></a></span></span><span> </span><span id="local-6989586621682156240"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156240"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682156241"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156241"><span class="hs-identifier hs-var">wh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-745"></span><span>              </span><span class="annot"><span class="annottext">[RewriteEqn] -&gt; [ProblemEq] -&gt; RHS -&gt; WhereDeclarations -&gt; RHS
</span><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-var">A.RewriteRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156238"><span class="hs-identifier hs-var">qes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution' (SubstArg [ProblemEq]) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg [ProblemEq])
</span><a href="#local-6989586621682156211"><span class="hs-identifier hs-var">patSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156239"><span class="hs-identifier hs-var">spats</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RHS -&gt; RHS
</span><a href="#local-6989586621682156231"><span class="hs-identifier hs-var">updateRHS</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156240"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156241"><span class="hs-identifier hs-var">wh</span></a></span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span>            </span><span id="local-6989586621682156237"><span class="annot"><a href="#local-6989586621682156237"><span class="hs-identifier hs-var hs-var">updateClause</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span id="local-6989586621682156242"><span class="annot"><span class="annottext">LHS
</span><a href="#local-6989586621682156242"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682156243"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156243"><span class="hs-identifier hs-var">spats</span></a></span></span><span> </span><span id="local-6989586621682156244"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156244"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682156245"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156245"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span id="local-6989586621682156246"><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682156246"><span class="hs-identifier hs-var">ca</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-748"></span><span>              </span><span class="annot"><span class="annottext">LHS
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' LHS
forall lhs.
lhs
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' lhs
</span><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-var">A.Clause</span></a></span><span> </span><span class="annot"><span class="annottext">LHS
</span><a href="#local-6989586621682156242"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution' (SubstArg [ProblemEq]) -&gt; [ProblemEq] -&gt; [ProblemEq]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-identifier hs-var">applySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
Substitution' (SubstArg [ProblemEq])
</span><a href="#local-6989586621682156211"><span class="hs-identifier hs-var">patSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156243"><span class="hs-identifier hs-var">spats</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RHS -&gt; RHS
</span><a href="#local-6989586621682156231"><span class="hs-identifier hs-var">updateRHS</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156244"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156245"><span class="hs-identifier hs-var">wh</span></a></span><span> </span><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682156246"><span class="hs-identifier hs-var">ca</span></a></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682156247"><span class="annot"><a href="#local-6989586621682156247"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156248"><span class="annot"><a href="#local-6989586621682156248"><span class="hs-identifier hs-var">with</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#bindAsPatterns"><span class="hs-identifier hs-type">bindAsPatterns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156212"><span class="hs-identifier hs-type">asb</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkWhere"><span class="hs-identifier hs-type">checkWhere</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156199"><span class="hs-identifier hs-type">wh</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkRHS"><span class="hs-identifier hs-type">checkRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156194"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156195"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156196"><span class="hs-identifier hs-type">aps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156226"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156204"><span class="hs-identifier hs-type">lhsResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156230"><span class="hs-identifier hs-type">rhs</span></a></span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>        </span><span class="hs-comment">-- Note that the with function doesn't necessarily share any part of</span><span>
</span><span id="line-753"></span><span>        </span><span class="hs-comment">-- the context with the parent (but withSub will take you from parent</span><span>
</span><span id="line-754"></span><span>        </span><span class="hs-comment">-- to child).</span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>        </span><span id="local-6989586621682156251"><span class="annot"><a href="#local-6989586621682156251"><span class="hs-identifier hs-var">wbody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#unsafeInTopContext"><span class="hs-identifier hs-type">unsafeInTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-type">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier hs-type">Bench.Typing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html#With"><span class="hs-identifier hs-type">Bench.With</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkWithFunction"><span class="hs-identifier hs-type">checkWithFunction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156202"><span class="hs-identifier hs-type">cxtNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156248"><span class="hs-identifier hs-type">with</span></a></span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span>        </span><span id="local-6989586621682156255"><span class="annot"><a href="#local-6989586621682156255"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682156247"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">`mplus`</span></span><span> </span><span class="annot"><a href="#local-6989586621682156251"><span class="hs-identifier hs-type">wbody</span></a></span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-type">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optDoubleCheck"><span class="hs-identifier hs-type">optDoubleCheck</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682156255"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-761"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682156258"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156258"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-762"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-763"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;double checking rhs&quot;</span></span><span>
</span><span id="line-764"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156258"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot; : &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Type -&gt; Type
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682156210"><span class="hs-identifier hs-var">trhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-766"></span><span>            </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a.
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-var">noConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a.
(MonadMetaSolver m, MonadTCState m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#withFrozenMetas"><span class="hs-identifier hs-var">withFrozenMetas</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Comparison -&gt; TypeOf Term -&gt; TCM ()
forall a (m :: * -&gt; *).
(CheckInternal a, MonadCheckInternal m) =&gt;
a -&gt; Comparison -&gt; TypeOf a -&gt; m ()
forall (m :: * -&gt; *).
MonadCheckInternal m =&gt;
Term -&gt; Comparison -&gt; TypeOf Term -&gt; m ()
</span><a href="Agda.TypeChecking.CheckInternal.html#checkInternal"><span class="hs-identifier hs-var">checkInternal</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156258"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="Agda.TypeChecking.Monad.Base.Types.html#CmpLeq"><span class="hs-identifier hs-var">CmpLeq</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeOf Term -&gt; TCM ()) -&gt; TypeOf Term -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg (TypeOf Term) -&gt; TypeOf Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (TypeOf Term)
Arg Type
</span><a href="#local-6989586621682156210"><span class="hs-identifier hs-var">trhs</span></a></span><span>
</span><span id="line-767"></span><span>          </span><span class="annot"><span class="annottext">Maybe Term
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-770"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;Clause before translation:&quot;</span></span><span>
</span><span id="line-771"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-772"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;delta =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#escapeContext"><span class="hs-identifier hs-type">escapeContext</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-type">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156207"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156207"><span class="hs-identifier hs-type">delta</span></a></span><span>
</span><span id="line-773"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;ps    =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#fsep"><span class="hs-identifier hs-type">P.fsep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCMPatterns"><span class="hs-identifier hs-type">prettyTCMPatterns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156208"><span class="hs-identifier hs-type">ps</span></a></span><span>
</span><span id="line-774"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;body  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;_|_&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156255"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-775"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;type  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156190"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-776"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-777"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-778"></span><span>
</span><span id="line-779"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.lhs.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">90</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#escapeContext"><span class="hs-identifier hs-type">escapeContext</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-type">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156207"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-780"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;Clause before translation (raw):&quot;</span></span><span>
</span><span id="line-781"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-782"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;ps    =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682156208"><span class="hs-identifier hs-type">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;body  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682156255"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;type  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682156190"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-786"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span>        </span><span class="hs-comment">-- compute body modification for irrelevant definitions, see issue 610</span><span>
</span><span id="line-789"></span><span>        </span><span id="local-6989586621682156267"><span class="annot"><a href="#local-6989586621682156267"><span class="hs-identifier hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-type">viewTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eRelevance"><span class="hs-identifier hs-type">eRelevance</span></a></span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156271"><span class="annot"><a href="#local-6989586621682156271"><span class="hs-identifier hs-var hs-var">bodyMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (Maybe Term -&gt; Maybe Term) -&gt; Maybe Term -&gt; Maybe Term
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier hs-var">applyWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relevance -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-var">isIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="#local-6989586621682156267"><span class="hs-identifier hs-var">rel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; Maybe Term -&gt; Maybe Term
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#dontCare"><span class="hs-identifier hs-var">dontCare</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span>        </span><span class="hs-comment">-- absurd clauses don't define computational behaviour, so it's fine to</span><span>
</span><span id="line-793"></span><span>        </span><span class="hs-comment">-- treat them as catchalls.</span><span>
</span><span id="line-794"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156272"><span class="annot"><a href="#local-6989586621682156272"><span class="hs-identifier hs-var hs-var">catchall'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682156255"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Range -&gt; Catchall
</span><a href="Agda.Syntax.Common.html#YesCatchall"><span class="hs-identifier hs-var">YesCatchall</span></a></span><span> </span><span class="annot"><span class="annottext">Range
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682156200"><span class="hs-identifier hs-var">catchall</span></a></span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#CPC"><span class="hs-identifier hs-type">CPC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156213"><span class="hs-identifier hs-type">psplit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-797"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseLHSRange"><span class="hs-identifier hs-var">clauseLHSRange</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-type">getRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156194"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-798"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseFullRange"><span class="hs-identifier hs-var">clauseFullRange</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-type">getRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156192"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-799"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseTel"><span class="hs-identifier hs-var">clauseTel</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-type">killRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156207"><span class="hs-identifier hs-type">delta</span></a></span><span>
</span><span id="line-800"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#namedClausePats"><span class="hs-identifier hs-var">namedClausePats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682156208"><span class="hs-identifier hs-type">ps</span></a></span><span>
</span><span id="line-801"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682156271"><span class="hs-identifier hs-type">bodyMod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156255"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-802"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseType"><span class="hs-identifier hs-var">clauseType</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682156210"><span class="hs-identifier hs-type">trhs</span></a></span><span>
</span><span id="line-803"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseCatchall"><span class="hs-identifier hs-var">clauseCatchall</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682156272"><span class="hs-identifier hs-type">catchall'</span></a></span><span>
</span><span id="line-804"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseRecursive"><span class="hs-identifier hs-var">clauseRecursive</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#MaybeRecursive"><span class="hs-identifier hs-type">MaybeRecursive</span></a></span><span> </span><span class="hs-comment">-- we don't know yet</span><span>
</span><span id="line-805"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseUnreachable"><span class="hs-identifier hs-var">clauseUnreachable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-comment">-- we don't know yet</span><span>
</span><span id="line-806"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseEllipsis"><span class="hs-identifier hs-var">clauseEllipsis</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#lhsEllipsis"><span class="hs-identifier hs-var">lhsEllipsis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156194"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-807"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#clauseWhereModule"><span class="hs-identifier hs-var">clauseWhereModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#whereModule"><span class="hs-identifier hs-var">A.whereModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156199"><span class="hs-identifier hs-type">wh</span></a></span><span>
</span><span id="line-808"></span><span>                 </span><span class="hs-special">}</span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span>
</span><span id="line-812"></span><span class="annot"><span class="hs-comment">-- | Generate the abstract pattern corresponding to Refl</span></span><span>
</span><span id="line-813"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#getReflPattern"><span class="hs-identifier hs-type">getReflPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span>
</span><span id="line-814"></span><span id="getReflPattern"><span class="annot"><span class="annottext">getReflPattern :: TCM (Pattern' Expr)
</span><a href="Agda.TypeChecking.Rules.Def.html#getReflPattern"><span class="hs-identifier hs-var hs-var">getReflPattern</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-comment">-- Get the name of builtin REFL.</span><span>
</span><span id="line-816"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682156280"><span class="annot"><a href="#local-6989586621682156280"><span class="hs-identifier hs-var">reflCon</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO Term
forall (m :: * -&gt; *).
(HasBuiltins m, MonadError TCErr m, MonadTCEnv m, ReadTCState m) =&gt;
m Term
</span><a href="Agda.TypeChecking.Monad.Builtin.html#primRefl"><span class="hs-identifier hs-var">primRefl</span></a></span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span>  </span><span id="local-6989586621682156282"><span class="annot"><a href="#local-6989586621682156282"><span class="hs-identifier hs-var">reflInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#setOrigin"><span class="hs-identifier hs-type">setOrigin</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Inserted"><span class="hs-identifier hs-type">Inserted</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Primitive.html#getReflArgInfo"><span class="hs-identifier hs-type">getReflArgInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156280"><span class="hs-identifier hs-type">reflCon</span></a></span><span>
</span><span id="line-819"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156286"><span class="annot"><a href="#local-6989586621682156286"><span class="hs-identifier hs-var hs-var">patInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConInfo -&gt; PatInfo -&gt; ConPatLazy -&gt; ConPatInfo
</span><a href="Agda.Syntax.Info.html#ConPatInfo"><span class="hs-identifier hs-var">ConPatInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="Agda.Syntax.Common.html#ConOCon"><span class="hs-identifier hs-var">ConOCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><a href="Agda.Syntax.Info.html#patNoRange"><span class="hs-identifier hs-var">patNoRange</span></a></span><span> </span><span class="annot"><span class="annottext">ConPatLazy
</span><a href="Agda.Syntax.Info.html#ConPatEager"><span class="hs-identifier hs-var">ConPatEager</span></a></span><span>
</span><span id="line-820"></span><span>  </span><span class="hs-comment">-- The REFL constructor might have an argument</span><span>
</span><span id="line-821"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156291"><span class="annot"><a href="#local-6989586621682156291"><span class="hs-identifier hs-var hs-var">reflArg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (NamedArg (Pattern' Expr)) -&gt; [NamedArg (Pattern' Expr)]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (NamedArg (Pattern' Expr)) -&gt; [NamedArg (Pattern' Expr)])
-&gt; Maybe (NamedArg (Pattern' Expr)) -&gt; [NamedArg (Pattern' Expr)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ArgInfo -&gt; NamedArg (Pattern' Expr))
-&gt; Maybe ArgInfo -&gt; Maybe (NamedArg (Pattern' Expr))
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682156292"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682156292"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ArgInfo
-&gt; Named NamedName (Pattern' Expr) -&gt; NamedArg (Pattern' Expr)
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682156292"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(Named NamedName (Pattern' Expr) -&gt; NamedArg (Pattern' Expr))
-&gt; Named NamedName (Pattern' Expr) -&gt; NamedArg (Pattern' Expr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pattern' Expr -&gt; Named NamedName (Pattern' Expr)
forall a name. a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#unnamed"><span class="hs-identifier hs-var">unnamed</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern' Expr -&gt; Named NamedName (Pattern' Expr))
-&gt; Pattern' Expr -&gt; Named NamedName (Pattern' Expr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatInfo -&gt; Pattern' Expr
forall e. PatInfo -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-var">A.WildP</span></a></span><span> </span><span class="annot"><span class="annottext">PatInfo
</span><a href="Agda.Syntax.Info.html#patNoRange"><span class="hs-identifier hs-var">patNoRange</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ArgInfo
</span><a href="#local-6989586621682156282"><span class="hs-identifier hs-var">reflInfo</span></a></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#ConP"><span class="hs-identifier hs-type">A.ConP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156286"><span class="hs-identifier hs-type">patInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#unambiguous"><span class="hs-identifier hs-type">unambiguous</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156280"><span class="hs-identifier hs-type">reflCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156291"><span class="hs-identifier hs-type">reflArg</span></a></span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span class="annot"><span class="hs-comment">-- | Type check the @with@ and @rewrite@ lhss and/or the rhs.</span></span><span>
</span><span id="line-826"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkRHS"><span class="hs-identifier hs-type">checkRHS</span></a></span><span>
</span><span id="line-827"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#LHSInfo"><span class="hs-identifier hs-type">LHSInfo</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Range of lhs.</span></span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ Name of function.</span></span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#NamedArg"><span class="hs-identifier hs-type">NamedArg</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">]</span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Patterns in lhs.</span></span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ Top-level type of function.</span></span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Result of type-checking patterns</span></span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span>                   </span><span class="annot"><span class="hs-comment">-- ^ Rhs to check.</span></span><span>
</span><span id="line-833"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>                                              </span><span class="hs-comment">-- Note: the as-bindings are already bound (in checkClause)</span><span>
</span><span id="line-835"></span><span id="checkRHS"><span class="annot"><span class="annottext">checkRHS :: LHSInfo
-&gt; QName
-&gt; [NamedArg (Pattern' Expr)]
-&gt; Type
-&gt; LHSResult
-&gt; RHS
-&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="Agda.TypeChecking.Rules.Def.html#checkRHS"><span class="hs-identifier hs-var hs-var">checkRHS</span></a></span></span><span> </span><span id="local-6989586621682156297"><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682156297"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682156298"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156298"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682156299"><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)]
</span><a href="#local-6989586621682156299"><span class="hs-identifier hs-var">aps</span></a></span></span><span> </span><span id="local-6989586621682156300"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156300"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682156301"><span class="annot"><span class="annottext">lhsResult :: LHSResult
</span><a href="#local-6989586621682156301"><span class="hs-identifier hs-var">lhsResult</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156302"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156302"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682156303"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156303"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682156304"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682156304"><span class="hs-identifier hs-var">absurdPat</span></a></span></span><span> </span><span id="local-6989586621682156305"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682156305"><span class="hs-identifier hs-var">trhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156306"><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682156306"><span class="hs-identifier hs-var">_asb</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156307"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156307"><span class="hs-identifier hs-var">rhs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-836"></span><span>  </span><span class="annot"><span class="annottext">RHS -&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156308"><span class="hs-identifier hs-var">handleRHS</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156307"><span class="hs-identifier hs-var">rhs0</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>  </span><span class="annot"><a href="#local-6989586621682156308"><span class="hs-identifier hs-type">handleRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-839"></span><span>  </span><span id="local-6989586621682156308"><span class="annot"><span class="annottext">handleRHS :: RHS -&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156308"><span class="hs-identifier hs-var hs-var">handleRHS</span></a></span></span><span> </span><span id="local-6989586621682156309"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156309"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156309"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-840"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span> </span><span id="local-6989586621682156310"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156310"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156311"><span class="hs-identifier hs-var">ordinaryRHS</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156310"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-841"></span><span>    </span><span class="annot"><span class="annottext">RHS
</span><a href="Agda.Syntax.Abstract.html#AbsurdRHS"><span class="hs-identifier hs-var">A.AbsurdRHS</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156312"><span class="hs-identifier hs-var">noRHS</span></a></span><span>
</span><span id="line-842"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-type">A.RewriteRHS</span></a></span><span> </span><span id="local-6989586621682156313"><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156313"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621682156314"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156314"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682156315"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156315"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682156316"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156316"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156317"><span class="hs-identifier hs-var">rewriteEqnsRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156313"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156314"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156315"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156316"><span class="hs-identifier hs-var">wh</span></a></span><span>
</span><span id="line-843"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithRHS"><span class="hs-identifier hs-type">A.WithRHS</span></a></span><span> </span><span id="local-6989586621682156318"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156318"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621682156319"><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682156319"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621682156320"><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682156320"><span class="hs-identifier hs-var">cs</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; List1 WithExpr
-&gt; List1 (Clause' LHS)
-&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156321"><span class="hs-identifier hs-var">withRHS</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156318"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682156319"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682156320"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span>  </span><span class="hs-comment">-- Ordinary case: f xs = e</span><span>
</span><span id="line-846"></span><span>  </span><span class="annot"><a href="#local-6989586621682156311"><span class="hs-identifier hs-type">ordinaryRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>  </span><span id="local-6989586621682156311"><span class="annot"><span class="annottext">ordinaryRHS :: Expr -&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156311"><span class="hs-identifier hs-var hs-var">ordinaryRHS</span></a></span></span><span> </span><span id="local-6989586621682156322"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156322"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier hs-var">Bench.Typing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#CheckRHS"><span class="hs-identifier hs-var">Bench.CheckRHS</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM (Maybe Term, WithFunctionProblem)
 -&gt; TCM (Maybe Term, WithFunctionProblem))
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-848"></span><span>    </span><span class="hs-comment">-- If there is an absurd pattern, we do not need a RHS. If we have</span><span>
</span><span id="line-849"></span><span>    </span><span class="hs-comment">-- one we complain, ignore it and return the same @(Nothing, NoWithFunction)@</span><span>
</span><span id="line-850"></span><span>    </span><span class="hs-comment">-- as the case dealing with @A.AbsurdRHS@.</span><span>
</span><span id="line-851"></span><span>    </span><span id="local-6989586621682156324"><span class="annot"><a href="#local-6989586621682156324"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682156304"><span class="hs-identifier hs-var">absurdPat</span></a></span><span>
</span><span id="line-852"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Term
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; TCM () -&gt; TCMT IO (Maybe Term)
forall a b. a -&gt; TCMT IO b -&gt; TCMT IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156322"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#AbsurdPatternRequiresAbsentRHS"><span class="hs-identifier hs-var">AbsurdPatternRequiresAbsentRHS</span></a></span><span>
</span><span id="line-853"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Maybe Term
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Maybe Term) -&gt; TCMT IO Term -&gt; TCMT IO (Maybe Term)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Type -&gt; TCMT IO Term
</span><a href="Agda.TypeChecking.Rules.Term.html#checkExpr"><span class="hs-identifier hs-var">checkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156322"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arg Type -&gt; Type
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682156305"><span class="hs-identifier hs-var">trhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156324"><span class="hs-identifier hs-type">mv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#NoWithFunction"><span class="hs-identifier hs-type">NoWithFunction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span>  </span><span class="hs-comment">-- Absurd case: no right hand side</span><span>
</span><span id="line-857"></span><span>  </span><span class="annot"><a href="#local-6989586621682156312"><span class="hs-identifier hs-type">noRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>  </span><span id="local-6989586621682156312"><span class="annot"><span class="annottext">noRHS :: TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156312"><span class="hs-identifier hs-var hs-var">noRHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-859"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682156304"><span class="hs-identifier hs-var">absurdPat</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#AbsentRHSRequiresAbsurdPattern"><span class="hs-identifier hs-var">AbsentRHSRequiresAbsurdPattern</span></a></span><span>
</span><span id="line-860"></span><span>    </span><span class="annot"><span class="annottext">(Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Term
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WithFunctionProblem
</span><a href="Agda.TypeChecking.Rules.Def.html#NoWithFunction"><span class="hs-identifier hs-var">NoWithFunction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>
</span><span id="line-862"></span><span>  </span><span class="hs-comment">-- With case: @f xs with {a} in eqa | b in eqb | {{c}} | ...; ... | ps1 = rhs1; ... | ps2 = rhs2; ...@</span><span>
</span><span id="line-863"></span><span>  </span><span class="hs-comment">-- We need to modify the patterns `ps1, ps2, ...` in the user-provided clauses</span><span>
</span><span id="line-864"></span><span>  </span><span class="hs-comment">-- to insert the {eqb} names so that the equality proofs are available on the various RHS.</span><span>
</span><span id="line-865"></span><span>  </span><span class="annot"><a href="#local-6989586621682156321"><span class="hs-identifier hs-type">withRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-866"></span><span>       </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>             </span><span class="hs-comment">-- name of the with-function</span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WithExpr"><span class="hs-identifier hs-type">A.WithExpr</span></a></span><span>  </span><span class="hs-comment">-- @[{a} in eqa, b in eqb, {{c}}, ...]@</span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span>    </span><span class="hs-comment">-- @[(ps1 = rhs1), (ps2 = rhs), ...]@</span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>  </span><span id="local-6989586621682156321"><span class="annot"><span class="annottext">withRHS :: QName
-&gt; List1 WithExpr
-&gt; List1 (Clause' LHS)
-&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156321"><span class="hs-identifier hs-var hs-var">withRHS</span></a></span></span><span> </span><span id="local-6989586621682156329"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156329"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621682156330"><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682156330"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621682156331"><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682156331"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-873"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;TC.Rules.Def.checkclause reached A.WithRHS&quot;</span></span><span>
</span><span id="line-874"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NonEmpty (TCMT IO Doc) -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (TCMT IO Doc) -&gt; TCMT IO Doc)
-&gt; NonEmpty (TCMT IO Doc) -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156329"><span class="hs-identifier hs-var">aux</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; NonEmpty (TCMT IO Doc) -&gt; NonEmpty (TCMT IO Doc)
forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><span class="hs-operator hs-var">&lt;|</span></span><span> </span><span class="annot"><span class="annottext">(WithExpr -&gt; TCMT IO Doc)
-&gt; List1 WithExpr -&gt; NonEmpty (TCMT IO Doc)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc)
-&gt; (WithExpr -&gt; TCMT IO Doc) -&gt; WithExpr -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg Expr -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">(Arg Expr -&gt; TCMT IO Doc)
-&gt; (WithExpr -&gt; Arg Expr) -&gt; WithExpr -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WithExpr -&gt; Arg Expr
forall name a. Named name a -&gt; a
</span><a href="Agda.Syntax.Common.html#namedThing"><span class="hs-identifier hs-var">namedThing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682156330"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-875"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-876"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-877"></span><span>      </span><span id="local-6989586621682156333"><span class="annot"><a href="#local-6989586621682156333"><span class="hs-identifier hs-var">nfv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM Int
</span><a href="Agda.TypeChecking.Monad.Signature.html#getCurrentModuleFreeVars"><span class="hs-identifier hs-var">getCurrentModuleFreeVars</span></a></span><span>
</span><span id="line-878"></span><span>      </span><span id="local-6989586621682156335"><span class="annot"><a href="#local-6989586621682156335"><span class="hs-identifier hs-var">m</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-type">currentModule</span></a></span><span>
</span><span id="line-879"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;with function module:&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span>
</span><span id="line-880"></span><span>             </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#mnameToList"><span class="hs-identifier hs-var">mnameToList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156335"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span>          </span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;free variables: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682156333"><span class="hs-identifier hs-type">nfv</span></a></span><span>
</span><span id="line-882"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span>    </span><span class="hs-comment">-- Infer the types of the with expressions</span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span>    </span><span id="local-6989586621682156339"><span class="annot"><a href="#local-6989586621682156339"><span class="hs-identifier hs-var">vtys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">List1 WithExpr
-&gt; (WithExpr -&gt; TCMT IO (Arg (Term, EqualityView)))
-&gt; TCMT IO (List1 (Arg (Term, EqualityView)))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682156330"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">((WithExpr -&gt; TCMT IO (Arg (Term, EqualityView)))
 -&gt; TCMT IO (List1 (Arg (Term, EqualityView))))
-&gt; (WithExpr -&gt; TCMT IO (Arg (Term, EqualityView)))
-&gt; TCMT IO (List1 (Arg (Term, EqualityView)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621682156341"><span class="annot"><span class="annottext">Maybe BindName
</span><a href="#local-6989586621682156341"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621682156342"><span class="annot"><span class="annottext">Arg Expr
</span><a href="#local-6989586621682156342"><span class="hs-identifier hs-var">we</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-887"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682156343"><span class="annot"><a href="#local-6989586621682156343"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156344"><span class="annot"><a href="#local-6989586621682156344"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Arg Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExprForWith"><span class="hs-identifier hs-var">inferExprForWith</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Expr
</span><a href="#local-6989586621682156342"><span class="hs-identifier hs-var">we</span></a></span><span>
</span><span id="line-888"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">&lt;$</span></span><span> </span><span class="annot"><span class="hs-identifier">we</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156343"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682156341"><span class="hs-identifier hs-type">nm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-889"></span><span>                </span><span class="annot"><span class="annottext">Maybe BindName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; EqualityView
</span><a href="Agda.Syntax.Internal.html#OtherType"><span class="hs-identifier hs-var">OtherType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156344"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-890"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; EqualityView
</span><a href="Agda.Syntax.Internal.html#IdiomType"><span class="hs-identifier hs-var">IdiomType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156344"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156348"><span class="annot"><a href="#local-6989586621682156348"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WithExpr -&gt; Arg (Maybe BindName))
-&gt; List1 WithExpr -&gt; List1 (Arg (Maybe BindName))
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621682156349"><span class="annot"><span class="annottext">Maybe BindName
</span><a href="#local-6989586621682156349"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621682156350"><span class="annot"><span class="annottext">Arg Expr
</span><a href="#local-6989586621682156350"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe BindName
</span><a href="#local-6989586621682156349"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BindName -&gt; Arg Expr -&gt; Arg (Maybe BindName)
forall a b. a -&gt; Arg b -&gt; Arg a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Arg Expr
</span><a href="#local-6989586621682156350"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 WithExpr
</span><a href="#local-6989586621682156330"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-893"></span><span>    </span><span id="local-6989586621682156351"><span class="annot"><a href="#local-6989586621682156351"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621682156331"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682156352"><span class="annot"><span class="annottext">c :: Clause' LHS
</span><a href="#local-6989586621682156352"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#LHS"><span class="hs-identifier hs-type">A.LHS</span></a></span><span> </span><span id="local-6989586621682156353"><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682156353"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682156354"><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682156354"><span class="hs-identifier hs-var">core</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156355"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156355"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621682156356"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156356"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682156357"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156357"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span id="local-6989586621682156358"><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682156358"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-894"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156359"><span class="annot"><span class="annottext">rhs' :: RHS
</span><a href="#local-6989586621682156359"><span class="hs-identifier hs-var hs-var hs-var">rhs'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Maybe BindName)) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#insertNames"><span class="hs-identifier hs-var">insertNames</span></a></span><span>    </span><span class="annot"><span class="annottext">List1 (Arg (Maybe BindName))
</span><a href="#local-6989586621682156348"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156356"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-895"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156360"><span class="annot"><span class="annottext">core' :: LHSCore' Expr
</span><a href="#local-6989586621682156360"><span class="hs-identifier hs-var hs-var">core'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Maybe BindName)) -&gt; LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="Agda.TypeChecking.Rules.Def.html#insertInspects"><span class="hs-identifier hs-var">insertInspects</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Maybe BindName))
</span><a href="#local-6989586621682156348"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682156354"><span class="hs-identifier hs-var">core</span></a></span><span>
</span><span id="line-896"></span><span>      </span><span class="annot"><span class="annottext">Clause' LHS -&gt; TCMT IO (Clause' LHS)
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Clause' LHS -&gt; TCMT IO (Clause' LHS))
-&gt; Clause' LHS -&gt; TCMT IO (Clause' LHS)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LHS
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' LHS
forall lhs.
lhs
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' lhs
</span><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-var">A.Clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHSInfo -&gt; LHSCore' Expr -&gt; LHS
</span><a href="Agda.Syntax.Abstract.html#LHS"><span class="hs-identifier hs-var">A.LHS</span></a></span><span> </span><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682156353"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">LHSCore' Expr
</span><a href="#local-6989586621682156360"><span class="hs-identifier hs-var">core'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156355"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156359"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156357"><span class="hs-identifier hs-var">wh</span></a></span><span> </span><span class="annot"><span class="annottext">Catchall
</span><a href="#local-6989586621682156358"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span>    </span><span class="hs-comment">-- Andreas, 2016-01-23, Issue #1796</span><span>
</span><span id="line-899"></span><span>    </span><span class="hs-comment">-- Run the size constraint solver to improve with-abstraction</span><span>
</span><span id="line-900"></span><span>    </span><span class="hs-comment">-- in case the with-expression contains size metas.</span><span>
</span><span id="line-901"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#solveSizeConstraints"><span class="hs-identifier hs-type">solveSizeConstraints</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#DefaultToInfty"><span class="hs-identifier hs-type">DefaultToInfty</span></a></span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkWithRHS"><span class="hs-identifier hs-type">checkWithRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156298"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156329"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156300"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156301"><span class="hs-identifier hs-type">lhsResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156339"><span class="hs-identifier hs-type">vtys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156351"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span>  </span><span class="hs-comment">-- Rewrite case: f xs (rewrite / invert) a | b | c | ...</span><span>
</span><span id="line-906"></span><span>  </span><span class="annot"><a href="#local-6989586621682156317"><span class="hs-identifier hs-type">rewriteEqnsRHS</span></a></span><span>
</span><span id="line-907"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteEqn"><span class="hs-identifier hs-type">A.RewriteEqn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#ProblemEq"><span class="hs-identifier hs-type">A.ProblemEq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-909"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RHS"><span class="hs-identifier hs-type">A.RHS</span></a></span><span>
</span><span id="line-910"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WhereDeclarations"><span class="hs-identifier hs-type">A.WhereDeclarations</span></a></span><span>
</span><span id="line-911"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span>  </span><span id="local-6989586621682156317"><span class="annot"><span class="annottext">rewriteEqnsRHS :: [RewriteEqn]
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156317"><span class="hs-identifier hs-var hs-var">rewriteEqnsRHS</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682156363"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156363"><span class="hs-identifier hs-var">strippedPats</span></a></span></span><span> </span><span id="local-6989586621682156364"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156364"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682156365"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156365"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall a. WhereDeclarations -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Def.html#checkWhere"><span class="hs-identifier hs-var">checkWhere</span></a></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156365"><span class="hs-identifier hs-var">wh</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (Maybe Term, WithFunctionProblem)
 -&gt; TCM (Maybe Term, WithFunctionProblem))
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RHS -&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156308"><span class="hs-identifier hs-var">handleRHS</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156364"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-914"></span><span>      </span><span class="hs-comment">-- Case: @rewrite@</span><span>
</span><span id="line-915"></span><span>      </span><span class="hs-comment">-- Andreas, 2014-01-17, Issue 1402:</span><span>
</span><span id="line-916"></span><span>      </span><span class="hs-comment">-- If the rewrites are discarded since lhs=rhs, then</span><span>
</span><span id="line-917"></span><span>      </span><span class="hs-comment">-- we can actually have where clauses.</span><span>
</span><span id="line-918"></span><span>  </span><span class="annot"><a href="#local-6989586621682156317"><span class="hs-identifier hs-var">rewriteEqnsRHS</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156366"><span class="annot"><span class="annottext">RewriteEqn
</span><a href="#local-6989586621682156366"><span class="hs-identifier hs-var">r</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682156367"><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156367"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156368"><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156368"><span class="hs-identifier hs-var">strippedPats</span></a></span></span><span> </span><span id="local-6989586621682156369"><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156369"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682156370"><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156370"><span class="hs-identifier hs-var">wh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RewriteEqn
</span><a href="#local-6989586621682156366"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-919"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#Rewrite"><span class="hs-identifier hs-type">Rewrite</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682156372"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156372"><span class="hs-identifier hs-var">qname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156373"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156373"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621682156374"><span class="annot"><span class="annottext">[(QName, Expr)]
</span><a href="#local-6989586621682156374"><span class="hs-identifier hs-var">qes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-920"></span><span>      </span><span class="annot"><span class="annottext">QName
-&gt; Expr -&gt; [RewriteEqn] -&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156375"><span class="hs-identifier hs-var">rewriteEqnRHS</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156372"><span class="hs-identifier hs-var">qname</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156373"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="annot"><span class="annottext">([RewriteEqn] -&gt; TCM (Maybe Term, WithFunctionProblem))
-&gt; [RewriteEqn] -&gt; TCM (Maybe Term, WithFunctionProblem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-921"></span><span>        </span><span class="annot"><span class="annottext">[(QName, Expr)]
-&gt; [RewriteEqn]
-&gt; (NonEmpty (QName, Expr) -&gt; [RewriteEqn])
-&gt; [RewriteEqn]
forall a b. [a] -&gt; b -&gt; (List1 a -&gt; b) -&gt; b
</span><a href="Agda.Utils.List1.html#ifNull"><span class="hs-identifier hs-var">List1.ifNull</span></a></span><span> </span><span class="annot"><span class="annottext">[(QName, Expr)]
</span><a href="#local-6989586621682156374"><span class="hs-identifier hs-var">qes</span></a></span><span> </span><span class="hs-comment">{-then-}</span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156367"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="hs-comment">{-else-}</span><span> </span><span class="annot"><span class="annottext">((NonEmpty (QName, Expr) -&gt; [RewriteEqn]) -&gt; [RewriteEqn])
-&gt; (NonEmpty (QName, Expr) -&gt; [RewriteEqn]) -&gt; [RewriteEqn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682156377"><span class="annot"><span class="annottext">NonEmpty (QName, Expr)
</span><a href="#local-6989586621682156377"><span class="hs-identifier hs-var">qes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (QName, Expr) -&gt; RewriteEqn
forall qn nm p e. List1 (qn, e) -&gt; RewriteEqn' qn nm p e
</span><a href="Agda.Syntax.Common.html#Rewrite"><span class="hs-identifier hs-var">Rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (QName, Expr)
</span><a href="#local-6989586621682156377"><span class="hs-identifier hs-var">qes</span></a></span><span> </span><span class="annot"><span class="annottext">RewriteEqn -&gt; [RewriteEqn] -&gt; [RewriteEqn]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156367"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-922"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#Invert"><span class="hs-identifier hs-type">Invert</span></a></span><span> </span><span id="local-6989586621682156379"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156379"><span class="hs-identifier hs-var">qname</span></a></span></span><span> </span><span id="local-6989586621682156380"><span class="annot"><span class="annottext">List1 (Named BindName (Pattern' Expr, Expr))
</span><a href="#local-6989586621682156380"><span class="hs-identifier hs-var">pes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName
-&gt; List1 (Named BindName (Pattern' Expr, Expr))
-&gt; [RewriteEqn]
-&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156381"><span class="hs-identifier hs-var">invertEqnRHS</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156379"><span class="hs-identifier hs-var">qname</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Named BindName (Pattern' Expr, Expr))
</span><a href="#local-6989586621682156380"><span class="hs-identifier hs-var">pes</span></a></span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156367"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-923"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Common.html#LeftLet"><span class="hs-identifier hs-type">LeftLet</span></a></span><span> </span><span id="local-6989586621682156383"><span class="annot"><span class="annottext">List1 (Pattern' Expr, Expr)
</span><a href="#local-6989586621682156383"><span class="hs-identifier hs-var">pes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">List1 (Pattern' Expr, Expr)
-&gt; [RewriteEqn] -&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156384"><span class="hs-identifier hs-var">usingEqnRHS</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Pattern' Expr, Expr)
</span><a href="#local-6989586621682156383"><span class="hs-identifier hs-var">pes</span></a></span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156367"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-926"></span><span>
</span><span id="line-927"></span><span>    </span><span class="hs-comment">-- @using@ clauses</span><span>
</span><span id="line-928"></span><span>    </span><span class="annot"><a href="#local-6989586621682156384"><span class="hs-identifier hs-type">usingEqnRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteEqn"><span class="hs-identifier hs-type">A.RewriteEqn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-929"></span><span>    </span><span id="local-6989586621682156384"><span class="annot"><span class="annottext">usingEqnRHS :: List1 (Pattern' Expr, Expr)
-&gt; [RewriteEqn] -&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156384"><span class="hs-identifier hs-var hs-var">usingEqnRHS</span></a></span></span><span> </span><span id="local-6989586621682156385"><span class="annot"><span class="annottext">List1 (Pattern' Expr, Expr)
</span><a href="#local-6989586621682156385"><span class="hs-identifier hs-var">pes</span></a></span></span><span> </span><span id="local-6989586621682156386"><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156386"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-930"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156387"><span class="annot"><span class="annottext">letBindings :: [LetBinding]
</span><a href="#local-6989586621682156387"><span class="hs-identifier hs-var hs-var">letBindings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Pattern' Expr, Expr)]
-&gt; ((Pattern' Expr, Expr) -&gt; LetBinding) -&gt; [LetBinding]
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (Pattern' Expr, Expr) -&gt; [Item (List1 (Pattern' Expr, Expr))]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><span class="hs-identifier hs-var">List1.toList</span></span><span> </span><span class="annot"><span class="annottext">List1 (Pattern' Expr, Expr)
</span><a href="#local-6989586621682156385"><span class="hs-identifier hs-var">pes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Pattern' Expr, Expr) -&gt; LetBinding) -&gt; [LetBinding])
-&gt; ((Pattern' Expr, Expr) -&gt; LetBinding) -&gt; [LetBinding]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682156388"><span class="annot"><span class="annottext">Pattern' Expr
</span><a href="#local-6989586621682156388"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156389"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156389"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LetInfo -&gt; ArgInfo -&gt; Pattern' Expr -&gt; Expr -&gt; LetBinding
</span><a href="Agda.Syntax.Abstract.html#LetPatBind"><span class="hs-identifier hs-var">A.LetPatBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Range -&gt; LetInfo
</span><a href="Agda.Syntax.Info.html#LetRange"><span class="hs-identifier hs-var">LetRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156389"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-var">defaultArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' Expr
</span><a href="#local-6989586621682156388"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156389"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-931"></span><span>      </span><span class="annot"><span class="annottext">[LetBinding]
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall (t :: * -&gt; *) a.
Foldable t =&gt;
t LetBinding -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkLetBindings%27"><span class="hs-identifier hs-var">checkLetBindings'</span></a></span><span> </span><span class="annot"><span class="annottext">[LetBinding]
</span><a href="#local-6989586621682156387"><span class="hs-identifier hs-var">letBindings</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM (Maybe Term, WithFunctionProblem)
 -&gt; TCM (Maybe Term, WithFunctionProblem))
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156317"><span class="hs-identifier hs-var">rewriteEqnsRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156386"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156368"><span class="hs-identifier hs-var">strippedPats</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156369"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156370"><span class="hs-identifier hs-var">wh</span></a></span><span>
</span><span id="line-932"></span><span>
</span><span id="line-933"></span><span>    </span><span class="hs-comment">-- @invert@ clauses</span><span>
</span><span id="line-934"></span><span>    </span><span class="annot"><a href="#local-6989586621682156381"><span class="hs-identifier hs-type">invertEqnRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#BindName"><span class="hs-identifier hs-type">A.BindName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Pattern"><span class="hs-identifier hs-type">A.Pattern</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteEqn"><span class="hs-identifier hs-type">A.RewriteEqn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-935"></span><span>    </span><span id="local-6989586621682156381"><span class="annot"><span class="annottext">invertEqnRHS :: QName
-&gt; List1 (Named BindName (Pattern' Expr, Expr))
-&gt; [RewriteEqn]
-&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156381"><span class="hs-identifier hs-var hs-var">invertEqnRHS</span></a></span></span><span> </span><span id="local-6989586621682156394"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156394"><span class="hs-identifier hs-var">qname</span></a></span></span><span> </span><span id="local-6989586621682156395"><span class="annot"><span class="annottext">List1 (Named BindName (Pattern' Expr, Expr))
</span><a href="#local-6989586621682156395"><span class="hs-identifier hs-var">pes</span></a></span></span><span> </span><span id="local-6989586621682156396"><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156396"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-936"></span><span>
</span><span id="line-937"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156397"><span class="annot"><span class="annottext">List1 (Named BindName (Pattern' Expr))
</span><a href="#local-6989586621682156397"><span class="hs-identifier hs-var hs-var">npats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156398"><span class="annot"><span class="annottext">List1 (Named BindName Expr)
</span><a href="#local-6989586621682156398"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Named BindName (Pattern' Expr, Expr)
 -&gt; (Named BindName (Pattern' Expr), Named BindName Expr))
-&gt; List1 (Named BindName (Pattern' Expr, Expr))
-&gt; (List1 (Named BindName (Pattern' Expr)),
    List1 (Named BindName Expr))
forall a b c. (a -&gt; (b, c)) -&gt; List1 a -&gt; (List1 b, List1 c)
</span><a href="Agda.Utils.List1.html#unzipWith"><span class="hs-identifier hs-var">List1.unzipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621682156400"><span class="annot"><span class="annottext">Maybe BindName
</span><a href="#local-6989586621682156400"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156401"><span class="annot"><span class="annottext">Pattern' Expr
</span><a href="#local-6989586621682156401"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156402"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156402"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe BindName -&gt; Pattern' Expr -&gt; Named BindName (Pattern' Expr)
forall name a. Maybe name -&gt; a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-var">Named</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BindName
</span><a href="#local-6989586621682156400"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' Expr
</span><a href="#local-6989586621682156401"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe BindName -&gt; Expr -&gt; Named BindName Expr
forall name a. Maybe name -&gt; a -&gt; Named name a
</span><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-var">Named</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe BindName
</span><a href="#local-6989586621682156400"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156402"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 (Named BindName (Pattern' Expr, Expr))
</span><a href="#local-6989586621682156395"><span class="hs-identifier hs-var">pes</span></a></span><span>
</span><span id="line-938"></span><span>      </span><span class="hs-comment">-- Infer the types of the with expressions</span><span>
</span><span id="line-939"></span><span>      </span><span id="local-6989586621682156403"><span class="annot"><a href="#local-6989586621682156403"><span class="hs-identifier hs-var">vtys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">List1 (Named BindName Expr)
-&gt; (Named BindName Expr -&gt; TCMT IO (Arg (Term, EqualityView)))
-&gt; TCMT IO (List1 (Arg (Term, EqualityView)))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">List1 (Named BindName Expr)
</span><a href="#local-6989586621682156398"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">((Named BindName Expr -&gt; TCMT IO (Arg (Term, EqualityView)))
 -&gt; TCMT IO (List1 (Arg (Term, EqualityView))))
-&gt; (Named BindName Expr -&gt; TCMT IO (Arg (Term, EqualityView)))
-&gt; TCMT IO (List1 (Arg (Term, EqualityView)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621682156404"><span class="annot"><span class="annottext">Maybe BindName
</span><a href="#local-6989586621682156404"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621682156405"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156405"><span class="hs-identifier hs-var">we</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-940"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682156406"><span class="annot"><a href="#local-6989586621682156406"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156407"><span class="annot"><a href="#local-6989586621682156407"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Arg Expr -&gt; TCM (Term, Type)
</span><a href="Agda.TypeChecking.Rules.Term.html#inferExprForWith"><span class="hs-identifier hs-var">inferExprForWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Arg Expr
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156405"><span class="hs-identifier hs-var">we</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-type">defaultArg</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156406"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682156404"><span class="hs-identifier hs-type">nm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-942"></span><span>          </span><span class="annot"><span class="annottext">Maybe BindName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; EqualityView
</span><a href="Agda.Syntax.Internal.html#OtherType"><span class="hs-identifier hs-var">OtherType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156407"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-943"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; EqualityView
</span><a href="Agda.Syntax.Internal.html#IdiomType"><span class="hs-identifier hs-var">IdiomType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156407"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-944"></span><span>
</span><span id="line-945"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156408"><span class="annot"><a href="#local-6989586621682156408"><span class="hs-identifier hs-var hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Pattern' Expr -&gt; Arg (Pattern' Expr))
-&gt; NonEmpty (Pattern' Expr) -&gt; List1 (Arg (Pattern' Expr))
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Pattern' Expr -&gt; Arg (Pattern' Expr)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (Pattern' Expr) -&gt; List1 (Arg (Pattern' Expr)))
-&gt; NonEmpty (Pattern' Expr) -&gt; List1 (Arg (Pattern' Expr))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (NonEmpty (Pattern' Expr)) -&gt; NonEmpty (Pattern' Expr)
forall a. Semigroup a =&gt; NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">sconcat</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (NonEmpty (Pattern' Expr)) -&gt; NonEmpty (Pattern' Expr))
-&gt; NonEmpty (NonEmpty (Pattern' Expr)) -&gt; NonEmpty (Pattern' Expr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-946"></span><span>            </span><span class="annot"><span class="annottext">List1 (Named BindName (Pattern' Expr))
-&gt; (Named BindName (Pattern' Expr) -&gt; NonEmpty (Pattern' Expr))
-&gt; NonEmpty (NonEmpty (Pattern' Expr))
forall (m :: * -&gt; *) a b. Functor m =&gt; m a -&gt; (a -&gt; b) -&gt; m b
</span><a href="Agda.Utils.Functor.html#for"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Named BindName (Pattern' Expr))
</span><a href="#local-6989586621682156397"><span class="hs-identifier hs-var">npats</span></a></span><span> </span><span class="annot"><span class="annottext">((Named BindName (Pattern' Expr) -&gt; NonEmpty (Pattern' Expr))
 -&gt; NonEmpty (NonEmpty (Pattern' Expr)))
-&gt; (Named BindName (Pattern' Expr) -&gt; NonEmpty (Pattern' Expr))
-&gt; NonEmpty (NonEmpty (Pattern' Expr))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Named"><span class="hs-identifier hs-type">Named</span></a></span><span> </span><span id="local-6989586621682156409"><span class="annot"><span class="annottext">Maybe BindName
</span><a href="#local-6989586621682156409"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span id="local-6989586621682156410"><span class="annot"><span class="annottext">Pattern' Expr
</span><a href="#local-6989586621682156410"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pattern' Expr
</span><a href="#local-6989586621682156410"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' Expr -&gt; [Pattern' Expr] -&gt; NonEmpty (Pattern' Expr)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="annot"><span class="annottext">[Pattern' Expr]
-&gt; (BindName -&gt; [Pattern' Expr])
-&gt; Maybe BindName
-&gt; [Pattern' Expr]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682156411"><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682156411"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BindName -&gt; Pattern' Expr
forall e. BindName -&gt; Pattern' e
</span><a href="Agda.Syntax.Abstract.html#VarP"><span class="hs-identifier hs-var">A.VarP</span></a></span><span> </span><span class="annot"><span class="annottext">BindName
</span><a href="#local-6989586621682156411"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe BindName
</span><a href="#local-6989586621682156409"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span>      </span><span class="hs-comment">-- Andreas, 2016-04-14, see also Issue #1796</span><span>
</span><span id="line-949"></span><span>      </span><span class="hs-comment">-- Run the size constraint solver to improve with-abstraction</span><span>
</span><span id="line-950"></span><span>      </span><span class="hs-comment">-- in case the with-expression contains size metas.</span><span>
</span><span id="line-951"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#solveSizeConstraints"><span class="hs-identifier hs-type">solveSizeConstraints</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#DefaultToInfty"><span class="hs-identifier hs-type">DefaultToInfty</span></a></span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156412"><span class="annot"><a href="#local-6989586621682156412"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr)) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#insertPatterns"><span class="hs-identifier hs-var">insertPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682156408"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156369"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-954"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682156413"><span class="annot"><a href="#local-6989586621682156413"><span class="hs-identifier hs-var">rhs''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156414"><span class="annot"><a href="#local-6989586621682156414"><span class="hs-identifier hs-var">outerWhere</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- the where clauses should go on the inner-most with</span><span>
</span><span id="line-955"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156396"><span class="hs-identifier hs-type">rs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156412"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682156370"><span class="hs-identifier hs-type">wh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-type">A.RewriteRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156396"><span class="hs-identifier hs-type">rs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156368"><span class="hs-identifier hs-type">strippedPats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156412"><span class="hs-identifier hs-type">rhs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156370"><span class="hs-identifier hs-type">wh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#noWhereDecls"><span class="hs-identifier hs-type">A.noWhereDecls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>          </span><span class="hs-comment">-- Andreas, 2014-03-05 kill range of copied patterns</span><span>
</span><span id="line-958"></span><span>          </span><span class="hs-comment">-- since they really do not have a source location.</span><span>
</span><span id="line-959"></span><span>          </span><span id="local-6989586621682156415"><span class="annot"><a href="#local-6989586621682156415"><span class="hs-identifier hs-var hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHS
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' LHS
forall lhs.
lhs
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' lhs
</span><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-var">A.Clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHSInfo -&gt; LHSCore' Expr -&gt; LHS
</span><a href="Agda.Syntax.Abstract.html#LHS"><span class="hs-identifier hs-var">A.LHS</span></a></span><span> </span><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682156297"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(LHSCore' Expr -&gt; LHS) -&gt; LHSCore' Expr -&gt; LHS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr)) -&gt; LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="Agda.TypeChecking.Rules.Def.html#insertPatternsLHSCore"><span class="hs-identifier hs-var">insertPatternsLHSCore</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682156408"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">(LHSCore' Expr -&gt; LHSCore' Expr) -&gt; LHSCore' Expr -&gt; LHSCore' Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [NamedArg (Pattern' Expr)] -&gt; LHSCore' Expr
forall e. QName -&gt; [NamedArg (Pattern' e)] -&gt; LHSCore' e
</span><a href="Agda.Syntax.Abstract.html#LHSHead"><span class="hs-identifier hs-var">A.LHSHead</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156298"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg (Pattern' Expr)] -&gt; LHSCore' Expr)
-&gt; [NamedArg (Pattern' Expr)] -&gt; LHSCore' Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)] -&gt; [NamedArg (Pattern' Expr)]
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)]
</span><a href="#local-6989586621682156299"><span class="hs-identifier hs-var">aps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>                 </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156368"><span class="hs-identifier hs-var">strippedPats</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156413"><span class="hs-identifier hs-var">rhs''</span></a></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156414"><span class="hs-identifier hs-var">outerWhere</span></a></span><span> </span><span class="annot"><span class="annottext">Catchall
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.invert&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-963"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;invert&quot;</span></span><span>
</span><span id="line-964"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  rhs' = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156412"><span class="hs-identifier hs-type">rhs'</span></a></span><span>
</span><span id="line-965"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-966"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkWithRHS"><span class="hs-identifier hs-type">checkWithRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156298"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156394"><span class="hs-identifier hs-type">qname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156300"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156301"><span class="hs-identifier hs-type">lhsResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156403"><span class="hs-identifier hs-type">vtys</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-type">singleton</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156415"><span class="hs-identifier hs-type">cl</span></a></span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span>    </span><span class="hs-comment">-- @rewrite@ clauses</span><span>
</span><span id="line-969"></span><span>    </span><span class="annot"><a href="#local-6989586621682156375"><span class="hs-identifier hs-type">rewriteEqnRHS</span></a></span><span>
</span><span id="line-970"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-971"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Expr"><span class="hs-identifier hs-type">A.Expr</span></a></span><span>
</span><span id="line-972"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteEqn"><span class="hs-identifier hs-type">A.RewriteEqn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-973"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>    </span><span id="local-6989586621682156375"><span class="annot"><span class="annottext">rewriteEqnRHS :: QName
-&gt; Expr -&gt; [RewriteEqn] -&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="#local-6989586621682156375"><span class="hs-identifier hs-var hs-var">rewriteEqnRHS</span></a></span></span><span> </span><span id="local-6989586621682156417"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156417"><span class="hs-identifier hs-var">qname</span></a></span></span><span> </span><span id="local-6989586621682156418"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621682156418"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621682156419"><span class="annot"><span class="annottext">[RewriteEqn]
</span><a href="#local-6989586621682156419"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span>      </span><span class="hs-comment">-- Action for skipping this rewrite.</span><span>
</span><span id="line-977"></span><span>      </span><span class="hs-comment">-- We do not want to create unsolved metas in case of</span><span>
</span><span id="line-978"></span><span>      </span><span class="hs-comment">-- a futile rewrite with a reflexive equation.</span><span>
</span><span id="line-979"></span><span>      </span><span class="hs-comment">-- Thus, we restore the state in this case,</span><span>
</span><span id="line-980"></span><span>      </span><span class="hs-comment">-- unless the rewrite expression contains questionmarks.</span><span>
</span><span id="line-981"></span><span>      </span><span id="local-6989586621682156420"><span class="annot"><a href="#local-6989586621682156420"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-982"></span><span>      </span><span class="hs-comment">-- TODO:: recurse defined but not used</span><span>
</span><span id="line-983"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156422"><span class="annot"><a href="#local-6989586621682156422"><span class="hs-identifier hs-var hs-var">recurse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-984"></span><span>           </span><span id="local-6989586621682156423"><span class="annot"><a href="#local-6989586621682156423"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO TCState
forall (m :: * -&gt; *). MonadTCState m =&gt; m TCState
</span><a href="Agda.TypeChecking.Monad.Base.html#getTC"><span class="hs-identifier hs-var">getTC</span></a></span><span>
</span><span id="line-985"></span><span>           </span><span class="hs-comment">-- Comparing the whole stInteractionPoints maps is a bit</span><span>
</span><span id="line-986"></span><span>           </span><span class="hs-comment">-- wasteful, but we assume</span><span>
</span><span id="line-987"></span><span>           </span><span class="hs-comment">-- 1. rewriting with a reflexive equality to happen rarely,</span><span>
</span><span id="line-988"></span><span>           </span><span class="hs-comment">-- 2. especially with ?-holes in the rewrite expression</span><span>
</span><span id="line-989"></span><span>           </span><span class="hs-comment">-- 3. and a large overall number of ?s.</span><span>
</span><span id="line-990"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156430"><span class="annot"><a href="#local-6989586621682156430"><span class="hs-identifier hs-var hs-var">sameIP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractionPoints -&gt; InteractionPoints -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(InteractionPoints -&gt; InteractionPoints -&gt; Bool)
-&gt; (TCState -&gt; InteractionPoints) -&gt; TCState -&gt; TCState -&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCState -&gt; Lens' TCState InteractionPoints -&gt; InteractionPoints
forall o i. o -&gt; Lens' o i -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(InteractionPoints -&gt; f InteractionPoints) -&gt; TCState -&gt; f TCState
Lens' TCState InteractionPoints
</span><a href="Agda.TypeChecking.Monad.Base.html#stInteractionPoints"><span class="hs-identifier hs-var">stInteractionPoints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span>           </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156430"><span class="hs-identifier hs-type">sameIP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156420"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156423"><span class="hs-identifier hs-type">st'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#putTC"><span class="hs-identifier hs-type">putTC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156420"><span class="hs-identifier hs-type">st</span></a></span><span>
</span><span id="line-992"></span><span>           </span><span class="annot"><a href="#local-6989586621682156308"><span class="hs-identifier hs-type">handleRHS</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-type">A.RewriteRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156419"><span class="hs-identifier hs-type">rs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156368"><span class="hs-identifier hs-type">strippedPats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156369"><span class="hs-identifier hs-type">rhs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156370"><span class="hs-identifier hs-type">wh</span></a></span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span>      </span><span class="hs-comment">-- Get value and type of rewrite-expression.</span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682156438"><span class="annot"><a href="#local-6989586621682156438"><span class="hs-identifier hs-var">proof</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156439"><span class="annot"><a href="#local-6989586621682156439"><span class="hs-identifier hs-var">eqt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Term.html#inferExpr"><span class="hs-identifier hs-type">inferExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156418"><span class="hs-identifier hs-type">eq</span></a></span><span>
</span><span id="line-997"></span><span>
</span><span id="line-998"></span><span>      </span><span class="hs-comment">-- Andreas, 2024-02-27, issue #7150</span><span>
</span><span id="line-999"></span><span>      </span><span class="hs-comment">-- trigger instance search to resolve instances in rewrite-expression</span><span>
</span><span id="line-1000"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#solveAwakeConstraints"><span class="hs-identifier hs-type">solveAwakeConstraints</span></a></span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span>      </span><span class="hs-comment">-- Andreas, 2016-04-14, see also Issue #1796</span><span>
</span><span id="line-1003"></span><span>      </span><span class="hs-comment">-- Run the size constraint solver to improve with-abstraction</span><span>
</span><span id="line-1004"></span><span>      </span><span class="hs-comment">-- in case the with-expression contains size metas.</span><span>
</span><span id="line-1005"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#solveSizeConstraints"><span class="hs-identifier hs-type">solveSizeConstraints</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.SizedTypes.Solve.html#DefaultToInfty"><span class="hs-identifier hs-type">DefaultToInfty</span></a></span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span>      </span><span class="hs-comment">-- Check that the type is actually an equality (lhs &#8801; rhs)</span><span>
</span><span id="line-1008"></span><span>      </span><span class="hs-comment">-- and extract lhs, rhs, and their type.</span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span>      </span><span id="local-6989586621682156442"><span class="annot"><a href="#local-6989586621682156442"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-type">reduce</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156439"><span class="hs-identifier hs-type">eqt</span></a></span><span>
</span><span id="line-1011"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682156443"><span class="annot"><a href="#local-6989586621682156443"><span class="hs-identifier hs-var">eqt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156444"><span class="annot"><a href="#local-6989586621682156444"><span class="hs-identifier hs-var">rewriteType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156445"><span class="annot"><a href="#local-6989586621682156445"><span class="hs-identifier hs-var">rewriteFrom</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156446"><span class="annot"><a href="#local-6989586621682156446"><span class="hs-identifier hs-var">rewriteTo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#equalityView"><span class="hs-identifier hs-type">equalityView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-type">getRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156418"><span class="hs-identifier hs-type">eq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156442"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1012"></span><span>        </span><span id="local-6989586621682156448"><span class="annot"><span class="annottext">eqt :: EqualityView
</span><a href="#local-6989586621682156448"><span class="hs-identifier hs-var">eqt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityType"><span class="hs-identifier hs-type">EqualityType</span></a></span><span> </span><span id="local-6989586621682156450"><span class="annot"><span class="annottext">Range
</span><a href="#local-6989586621682156450"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span id="local-6989586621682156451"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682156451"><span class="hs-identifier hs-var">_s</span></a></span></span><span> </span><span id="local-6989586621682156452"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156452"><span class="hs-identifier hs-var">_eq</span></a></span></span><span> </span><span id="local-6989586621682156453"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682156453"><span class="hs-identifier hs-var">_params</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156454"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156454"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156455"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682156455"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682156456"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682156456"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1013"></span><span>          </span><span id="local-6989586621682156457"><span class="annot"><a href="#local-6989586621682156457"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Sort
forall (m :: * -&gt; *).
(PureTCM m, MonadBlock m, MonadConstraint m) =&gt;
Term -&gt; m Sort
</span><a href="Agda.TypeChecking.Sort.html#sortOf"><span class="hs-identifier hs-var">sortOf</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156454"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-1014"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156448"><span class="hs-identifier hs-type">eqt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156457"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156454"><span class="hs-identifier hs-type">dom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156455"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156456"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1015"></span><span>          </span><span class="hs-comment">-- Note: the sort _s of the equality need not be the sort of the type @dom@!</span><span>
</span><span id="line-1016"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#OtherType"><span class="hs-identifier hs-type">OtherType</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO (EqualityView, Type, Term, Term)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO (EqualityView, Type, Term, Term))
-&gt; TypeError -&gt; TCMT IO (EqualityView, Type, Term, Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotRewriteByNonEquation"><span class="hs-identifier hs-var">CannotRewriteByNonEquation</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156442"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1017"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#IdiomType"><span class="hs-identifier hs-type">IdiomType</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCMT IO (EqualityView, Type, Term, Term)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; TCMT IO (EqualityView, Type, Term, Term))
-&gt; TypeError -&gt; TCMT IO (EqualityView, Type, Term, Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#CannotRewriteByNonEquation"><span class="hs-identifier hs-var">CannotRewriteByNonEquation</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156442"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span>      </span><span id="local-6989586621682156461"><span class="annot"><a href="#local-6989586621682156461"><span class="hs-identifier hs-var">reflPat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#getReflPattern"><span class="hs-identifier hs-type">getReflPattern</span></a></span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span>      </span><span class="hs-comment">-- Andreas, 2015-12-25  Issue #1740:</span><span>
</span><span id="line-1022"></span><span>      </span><span class="hs-comment">-- After the fix of #520, rewriting with a reflexive equation</span><span>
</span><span id="line-1023"></span><span>      </span><span class="hs-comment">-- has to be desugared as matching against refl.</span><span>
</span><span id="line-1024"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156462"><span class="annot"><a href="#local-6989586621682156462"><span class="hs-identifier hs-var hs-var">isReflexive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCMT IO Bool
forall (m :: * -&gt; *).
(MonadConstraint m, MonadWarning m, MonadError TCErr m,
 MonadFresh ProblemId m) =&gt;
m () -&gt; m Bool
</span><a href="Agda.TypeChecking.Conversion.html#tryConversion"><span class="hs-identifier hs-var">tryConversion</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCMT IO Bool) -&gt; TCM () -&gt; TCMT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a.
(MonadTCEnv m, HasOptions m, MonadDebug m) =&gt;
m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#dontAssignMetas"><span class="hs-identifier hs-var">dontAssignMetas</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1025"></span><span>           </span><span class="annot"><span class="annottext">Type -&gt; Term -&gt; Term -&gt; TCM ()
forall (m :: * -&gt; *).
MonadConversion m =&gt;
Type -&gt; Term -&gt; Term -&gt; m ()
</span><a href="Agda.TypeChecking.Conversion.html#equalTerm"><span class="hs-identifier hs-var">equalTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156444"><span class="hs-identifier hs-var">rewriteType</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156445"><span class="hs-identifier hs-var">rewriteFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682156446"><span class="hs-identifier hs-var">rewriteTo</span></a></span><span>
</span><span id="line-1026"></span><span>
</span><span id="line-1027"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682156465"><span class="annot"><a href="#local-6989586621682156465"><span class="hs-identifier hs-var">pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156466"><span class="annot"><a href="#local-6989586621682156466"><span class="hs-identifier hs-var">withExpr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156467"><span class="annot"><a href="#local-6989586621682156467"><span class="hs-identifier hs-var">withType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1028"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-type">ifM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156462"><span class="hs-identifier hs-type">isReflexive</span></a></span><span>
</span><span id="line-1029"></span><span>          </span><span class="hs-comment">{-then-}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span>                      </span><span class="annot"><a href="#local-6989586621682156461"><span class="hs-identifier hs-type">reflPat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682156438"><span class="hs-identifier hs-type">proof</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#OtherType"><span class="hs-identifier hs-type">OtherType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156442"><span class="hs-identifier hs-type">t'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1030"></span><span>          </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#WildP"><span class="hs-identifier hs-type">A.WildP</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Info.html#patNoRange"><span class="hs-identifier hs-type">patNoRange</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;|</span></span><span> </span><span class="annot"><a href="#local-6989586621682156461"><span class="hs-identifier hs-type">reflPat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682156438"><span class="hs-identifier hs-type">proof</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682156443"><span class="hs-identifier hs-type">eqt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1031"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156469"><span class="annot"><a href="#local-6989586621682156469"><span class="hs-identifier hs-var hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pattern' Expr -&gt; Arg (Pattern' Expr)
forall a. a -&gt; Arg a
</span><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-var">defaultArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Pattern' Expr -&gt; Arg (Pattern' Expr))
-&gt; NonEmpty (Pattern' Expr) -&gt; List1 (Arg (Pattern' Expr))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Pattern' Expr)
</span><a href="#local-6989586621682156465"><span class="hs-identifier hs-var">pats'</span></a></span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156470"><span class="annot"><a href="#local-6989586621682156470"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr)) -&gt; RHS -&gt; RHS
</span><a href="Agda.TypeChecking.Rules.Def.html#insertPatterns"><span class="hs-identifier hs-var">insertPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682156469"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156369"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1034"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682156471"><span class="annot"><a href="#local-6989586621682156471"><span class="hs-identifier hs-var">rhs''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156472"><span class="annot"><a href="#local-6989586621682156472"><span class="hs-identifier hs-var">outerWhere</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- the where clauses should go on the inner-most with</span><span>
</span><span id="line-1035"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156419"><span class="hs-identifier hs-type">rs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156470"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682156370"><span class="hs-identifier hs-type">wh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1036"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#RewriteRHS"><span class="hs-identifier hs-type">A.RewriteRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156419"><span class="hs-identifier hs-type">rs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156368"><span class="hs-identifier hs-type">strippedPats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156470"><span class="hs-identifier hs-type">rhs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156370"><span class="hs-identifier hs-type">wh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#noWhereDecls"><span class="hs-identifier hs-type">A.noWhereDecls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span>          </span><span class="hs-comment">-- Andreas, 2014-03-05 kill range of copied patterns</span><span>
</span><span id="line-1038"></span><span>          </span><span class="hs-comment">-- since they really do not have a source location.</span><span>
</span><span id="line-1039"></span><span>          </span><span id="local-6989586621682156473"><span class="annot"><a href="#local-6989586621682156473"><span class="hs-identifier hs-var hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHS
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' LHS
forall lhs.
lhs
-&gt; [ProblemEq]
-&gt; RHS
-&gt; WhereDeclarations
-&gt; Catchall
-&gt; Clause' lhs
</span><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-var">A.Clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHSInfo -&gt; LHSCore' Expr -&gt; LHS
</span><a href="Agda.Syntax.Abstract.html#LHS"><span class="hs-identifier hs-var">A.LHS</span></a></span><span> </span><span class="annot"><span class="annottext">LHSInfo
</span><a href="#local-6989586621682156297"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(LHSCore' Expr -&gt; LHS) -&gt; LHSCore' Expr -&gt; LHS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr)) -&gt; LHSCore' Expr -&gt; LHSCore' Expr
</span><a href="Agda.TypeChecking.Rules.Def.html#insertPatternsLHSCore"><span class="hs-identifier hs-var">insertPatternsLHSCore</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Pattern' Expr))
</span><a href="#local-6989586621682156469"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">(LHSCore' Expr -&gt; LHSCore' Expr) -&gt; LHSCore' Expr -&gt; LHSCore' Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; [NamedArg (Pattern' Expr)] -&gt; LHSCore' Expr
forall e. QName -&gt; [NamedArg (Pattern' e)] -&gt; LHSCore' e
</span><a href="Agda.Syntax.Abstract.html#LHSHead"><span class="hs-identifier hs-var">A.LHSHead</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156298"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">([NamedArg (Pattern' Expr)] -&gt; LHSCore' Expr)
-&gt; [NamedArg (Pattern' Expr)] -&gt; LHSCore' Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)] -&gt; [NamedArg (Pattern' Expr)]
forall a. KillRange a =&gt; KillRangeT a
</span><a href="Agda.Syntax.Position.html#killRange"><span class="hs-identifier hs-var">killRange</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg (Pattern' Expr)]
</span><a href="#local-6989586621682156299"><span class="hs-identifier hs-var">aps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span>                 </span><span class="annot"><span class="annottext">[ProblemEq]
</span><a href="#local-6989586621682156368"><span class="hs-identifier hs-var">strippedPats</span></a></span><span> </span><span class="annot"><span class="annottext">RHS
</span><a href="#local-6989586621682156471"><span class="hs-identifier hs-var">rhs''</span></a></span><span> </span><span class="annot"><span class="annottext">WhereDeclarations
</span><a href="#local-6989586621682156472"><span class="hs-identifier hs-var">outerWhere</span></a></span><span> </span><span class="annot"><span class="annottext">Catchall
forall a. Null a =&gt; a
</span><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1041"></span><span>
</span><span id="line-1042"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.rewrite&quot;</span></span><span> </span><span class="annot"><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1043"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;rewrite&quot;</span></span><span>
</span><span id="line-1044"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;  rhs' = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156470"><span class="hs-identifier hs-type">rhs'</span></a></span><span>
</span><span id="line-1045"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1046"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkWithRHS"><span class="hs-identifier hs-type">checkWithRHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156298"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156417"><span class="hs-identifier hs-type">qname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156300"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156301"><span class="hs-identifier hs-type">lhsResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-type">singleton</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#defaultArg"><span class="hs-identifier hs-type">defaultArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156466"><span class="hs-identifier hs-type">withExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682156467"><span class="hs-identifier hs-type">withType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Singleton.html#singleton"><span class="hs-identifier hs-type">singleton</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156473"><span class="hs-identifier hs-type">cl</span></a></span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkWithRHS"><span class="hs-identifier hs-type">checkWithRHS</span></a></span><span>
</span><span id="line-1049"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                             </span><span class="annot"><span class="hs-comment">-- ^ Name of function.</span></span><span>
</span><span id="line-1050"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>                             </span><span class="annot"><span class="hs-comment">-- ^ Name of the with-function.</span></span><span>
</span><span id="line-1051"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                              </span><span class="annot"><span class="hs-comment">-- ^ Type of function.</span></span><span>
</span><span id="line-1052"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span>                         </span><span class="annot"><span class="hs-comment">-- ^ Result of type-checking patterns</span></span><span>
</span><span id="line-1053"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#EqualityView"><span class="hs-identifier hs-type">EqualityView</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Expressions and types of with-expressions.</span></span><span>
</span><span id="line-1054"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#List1"><span class="hs-identifier hs-type">List1</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#Clause"><span class="hs-identifier hs-type">A.Clause</span></a></span><span>                    </span><span class="annot"><span class="hs-comment">-- ^ With-clauses to check.</span></span><span>
</span><span id="line-1055"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1056"></span><span>                                </span><span class="hs-comment">-- Note: as-bindings already bound (in checkClause)</span><span>
</span><span id="line-1057"></span><span id="checkWithRHS"><span class="annot"><span class="annottext">checkWithRHS :: QName
-&gt; QName
-&gt; Type
-&gt; LHSResult
-&gt; List1 (Arg (Term, EqualityView))
-&gt; List1 (Clause' LHS)
-&gt; TCM (Maybe Term, WithFunctionProblem)
</span><a href="Agda.TypeChecking.Rules.Def.html#checkWithRHS"><span class="hs-identifier hs-var hs-var">checkWithRHS</span></a></span></span><span> </span><span id="local-6989586621682156474"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156474"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682156475"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156475"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621682156476"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156476"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.LHS.html#LHSResult"><span class="hs-identifier hs-type">LHSResult</span></a></span><span> </span><span id="local-6989586621682156477"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156477"><span class="hs-identifier hs-var">npars</span></a></span></span><span> </span><span id="local-6989586621682156478"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156478"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682156479"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156479"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621682156480"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682156480"><span class="hs-identifier hs-var">_absurdPat</span></a></span></span><span> </span><span id="local-6989586621682156481"><span class="annot"><span class="annottext">Arg Type
</span><a href="#local-6989586621682156481"><span class="hs-identifier hs-var">trhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156482"><span class="annot"><span class="annottext">[AsBinding]
</span><a href="#local-6989586621682156482"><span class="hs-identifier hs-var">_asb</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156483"><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682156483"><span class="hs-identifier hs-var">vtys0</span></a></span></span><span> </span><span id="local-6989586621682156484"><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682156484"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1058"></span><span>  </span><span class="annot"><span class="annottext">[Char]
-&gt; Int
-&gt; [Char]
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall a. [Char] -&gt; Int -&gt; [Char] -&gt; TCMT IO a -&gt; TCMT IO a
forall (m :: * -&gt; *) a.
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Debug.html#verboseBracket"><span class="hs-identifier hs-var">verboseBracket</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;checkWithRHS&quot;</span></span><span> </span><span class="annot"><span class="annottext">(TCM (Maybe Term, WithFunctionProblem)
 -&gt; TCM (Maybe Term, WithFunctionProblem))
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1059"></span><span>    </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier hs-var">Bench.Typing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#With"><span class="hs-identifier hs-var">Bench.With</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM (Maybe Term, WithFunctionProblem)
 -&gt; TCM (Maybe Term, WithFunctionProblem))
-&gt; TCM (Maybe Term, WithFunctionProblem)
-&gt; TCM (Maybe Term, WithFunctionProblem)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1060"></span><span>        </span><span id="local-6989586621682156486"><span class="annot"><a href="#local-6989586621682156486"><span class="hs-identifier hs-var">withArgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView)) -&gt; TCM (List1 (Arg Term))
</span><a href="Agda.TypeChecking.With.html#withArguments"><span class="hs-identifier hs-var">withArguments</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682156483"><span class="hs-identifier hs-var">vtys0</span></a></span><span>
</span><span id="line-1061"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156488"><span class="annot"><a href="#local-6989586621682156488"><span class="hs-identifier hs-var hs-var">perm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Permutation -&gt; Maybe Permutation -&gt; Permutation
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Permutation
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Permutation -&gt; Permutation)
-&gt; Maybe Permutation -&gt; Permutation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; Maybe Permutation
</span><a href="Agda.Syntax.Internal.Pattern.html#dbPatPerm"><span class="hs-identifier hs-var">dbPatPerm</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156479"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1064"></span><span>          </span><span class="hs-comment">-- declared locally because we do not want to use the unzip'd thing!</span><span>
</span><span id="line-1065"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156491"><span class="annot"><a href="#local-6989586621682156491"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156492"><span class="annot"><a href="#local-6989586621682156492"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#unzipWith"><span class="hs-identifier hs-type">List1.unzipWith</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156483"><span class="hs-identifier hs-type">vtys0</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1066"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;vs (before normalization) =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156491"><span class="hs-identifier hs-type">vs</span></a></span><span>
</span><span id="line-1067"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;as (before normalization) =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156492"><span class="hs-keyword hs-type">as</span></a></span><span>
</span><span id="line-1068"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1069"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">45</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1070"></span><span>          </span><span class="hs-comment">-- declared locally because we do not want to use the unzip'd thing!</span><span>
</span><span id="line-1071"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156493"><span class="annot"><a href="#local-6989586621682156493"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156494"><span class="annot"><a href="#local-6989586621682156494"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#unzipWith"><span class="hs-identifier hs-type">List1.unzipWith</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156483"><span class="hs-identifier hs-type">vtys0</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1072"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;vs (before norm., raw) =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156493"><span class="hs-identifier hs-type">vs</span></a></span><span>
</span><span id="line-1073"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1074"></span><span>        </span><span id="local-6989586621682156495"><span class="annot"><a href="#local-6989586621682156495"><span class="hs-identifier hs-var">vtys0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#normalise"><span class="hs-identifier hs-type">normalise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156483"><span class="hs-identifier hs-type">vtys0</span></a></span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span>        </span><span class="hs-comment">-- Andreas, 2012-09-17: for printing delta,</span><span>
</span><span id="line-1077"></span><span>        </span><span class="hs-comment">-- we should remove it from the context first</span><span>
</span><span id="line-1078"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#escapeContext"><span class="hs-identifier hs-type">escapeContext</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-type">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1079"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;delta  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span>
</span><span id="line-1080"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1081"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1082"></span><span>          </span><span class="hs-comment">-- declared locally because we do not want to use the unzip'd thing!</span><span>
</span><span id="line-1083"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156497"><span class="annot"><a href="#local-6989586621682156497"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156498"><span class="annot"><a href="#local-6989586621682156498"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#unzipWith"><span class="hs-identifier hs-type">List1.unzipWith</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156495"><span class="hs-identifier hs-type">vtys0</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1084"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;vs     =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156497"><span class="hs-identifier hs-type">vs</span></a></span><span>
</span><span id="line-1085"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;as     =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156498"><span class="hs-keyword hs-type">as</span></a></span><span>
</span><span id="line-1086"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;perm   =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682156488"><span class="hs-identifier hs-type">perm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1087"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span>        </span><span class="hs-comment">-- Split the telescope into the part needed to type the with arguments</span><span>
</span><span id="line-1090"></span><span>        </span><span class="hs-comment">-- and all the other stuff</span><span>
</span><span id="line-1091"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156499"><span class="annot"><a href="#local-6989586621682156499"><span class="hs-identifier hs-var">delta1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156500"><span class="annot"><a href="#local-6989586621682156500"><span class="hs-identifier hs-var">delta2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156501"><span class="annot"><a href="#local-6989586621682156501"><span class="hs-identifier hs-var">perm'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156502"><span class="annot"><a href="#local-6989586621682156502"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156503"><span class="annot"><a href="#local-6989586621682156503"><span class="hs-identifier hs-var">vtys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.With.html#splitTelForWith"><span class="hs-identifier hs-type">splitTelForWith</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156481"><span class="hs-identifier hs-type">trhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156495"><span class="hs-identifier hs-type">vtys0</span></a></span><span>
</span><span id="line-1092"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156505"><span class="annot"><a href="#local-6989586621682156505"><span class="hs-identifier hs-var hs-var">finalPerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Permutation -&gt; Permutation -&gt; Permutation
</span><a href="Agda.Utils.Permutation.html#composeP"><span class="hs-identifier hs-var">composeP</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156501"><span class="hs-identifier hs-var">perm'</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156488"><span class="hs-identifier hs-var">perm</span></a></span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">75</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;delta  = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>        </span><span class="hs-comment">-- Andreas, 2012-09-17: for printing delta,</span><span>
</span><span id="line-1097"></span><span>        </span><span class="hs-comment">-- we should remove it from the context first</span><span>
</span><span id="line-1098"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#escapeContext"><span class="hs-identifier hs-type">escapeContext</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-type">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1099"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;delta1 =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156499"><span class="hs-identifier hs-type">delta1</span></a></span><span>
</span><span id="line-1100"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;delta2 =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156499"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156500"><span class="hs-identifier hs-type">delta2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1101"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1102"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1103"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;perm'  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682156501"><span class="hs-identifier hs-type">perm'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1104"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;fPerm  =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682156505"><span class="hs-identifier hs-type">finalPerm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1106"></span><span>
</span><span id="line-1107"></span><span>        </span><span class="hs-comment">-- Create the body of the original function</span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>        </span><span class="hs-comment">-- All the context variables</span><span>
</span><span id="line-1110"></span><span>        </span><span id="local-6989586621682156507"><span class="annot"><a href="#local-6989586621682156507"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTerms"><span class="hs-identifier hs-type">getContextTerms</span></a></span><span>
</span><span id="line-1111"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156509"><span class="annot"><a href="#local-6989586621682156509"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682156507"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-1112"></span><span>            </span><span id="local-6989586621682156510"><span class="annot"><a href="#local-6989586621682156510"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156478"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-1113"></span><span>            </span><span class="hs-comment">-- First the variables bound outside this definition</span><span>
</span><span id="line-1114"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682156511"><span class="annot"><a href="#local-6989586621682156511"><span class="hs-identifier hs-var">us0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156512"><span class="annot"><a href="#local-6989586621682156512"><span class="hs-identifier hs-var">us1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156509"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><a href="#local-6989586621682156510"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156507"><span class="hs-identifier hs-type">us</span></a></span><span>
</span><span id="line-1115"></span><span>            </span><span class="hs-comment">-- Then permute the rest and grab those needed to for the with arguments</span><span>
</span><span id="line-1116"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682156514"><span class="annot"><a href="#local-6989586621682156514"><span class="hs-identifier hs-var">us1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156515"><span class="annot"><a href="#local-6989586621682156515"><span class="hs-identifier hs-var">us2</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156499"><span class="hs-identifier hs-type">delta1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html#permute"><span class="hs-identifier hs-type">permute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156501"><span class="hs-identifier hs-type">perm'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156512"><span class="hs-identifier hs-type">us1'</span></a></span><span>
</span><span id="line-1117"></span><span>            </span><span class="hs-comment">-- Now stuff the with arguments in between and finish with the remaining variables</span><span>
</span><span id="line-1118"></span><span>            </span><span id="local-6989586621682156517"><span class="annot"><a href="#local-6989586621682156517"><span class="hs-identifier hs-var hs-var">argsS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Substitution
forall a. DeBruijn a =&gt; [a] -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#parallelS"><span class="hs-identifier hs-var">parallelS</span></a></span><span> </span><span class="annot"><span class="annottext">([Term] -&gt; Substitution) -&gt; [Term] -&gt; Substitution
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Term]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Term] -&gt; [Term]) -&gt; [Term] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682156511"><span class="hs-identifier hs-var">us0</span></a></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Term] -&gt; [Term]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682156514"><span class="hs-identifier hs-var">us1</span></a></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Term] -&gt; [Term]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Term) -&gt; [Arg Term] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (Arg Term) -&gt; [Item (List1 (Arg Term))]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><span class="hs-identifier hs-var">List1.toList</span></span><span> </span><span class="annot"><span class="annottext">List1 (Arg Term)
</span><a href="#local-6989586621682156486"><span class="hs-identifier hs-var">withArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Term] -&gt; [Term]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682156515"><span class="hs-identifier hs-var">us2</span></a></span><span>
</span><span id="line-1119"></span><span>            </span><span id="local-6989586621682156520"><span class="annot"><a href="#local-6989586621682156520"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- generated by checkWithFunction</span><span>
</span><span id="line-1120"></span><span>        </span><span class="hs-comment">-- Andreas, 2013-02-26 add with-name to signature for printing purposes</span><span>
</span><span id="line-1121"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#addConstant"><span class="hs-identifier hs-type">addConstant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156475"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1122"></span><span>          </span><span id="local-6989586621682156521"><span class="annot"><a href="#local-6989586621682156521"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#getLanguage"><span class="hs-identifier hs-type">getLanguage</span></a></span><span>
</span><span id="line-1123"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#useTerPragma"><span class="hs-identifier hs-type">useTerPragma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span>
</span><span id="line-1124"></span><span>            </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defaultDefn"><span class="hs-identifier hs-type">defaultDefn</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-type">defaultArgInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156475"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#__DUMMY_TYPE__"><span class="hs-identifier hs-type">__DUMMY_TYPE__</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156521"><span class="hs-identifier hs-type">lang</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span>
</span><span id="line-1125"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#emptyFunction"><span class="hs-identifier hs-type">emptyFunction</span></a></span><span>
</span><span id="line-1126"></span><span>
</span><span id="line-1127"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1128"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156524"><span class="annot"><a href="#local-6989586621682156524"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156525"><span class="annot"><a href="#local-6989586621682156525"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Utils.List1.html#unzipWith"><span class="hs-identifier hs-type">List1.unzipWith</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156503"><span class="hs-identifier hs-type">vtys</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1129"></span><span>          </span><span class="hs-comment">-- Andreas, 2025-04-07, escapeContext impossible &#916; leads to crash if e.g. vs has metas defined in &#916;.</span><span>
</span><span id="line-1130"></span><span>          </span><span class="hs-comment">-- Thus, we use unsafeEscapeContext instead.</span><span>
</span><span id="line-1131"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;    with arguments&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#unsafeEscapeContext"><span class="hs-identifier hs-type">unsafeEscapeContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156499"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156524"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1132"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;             types&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#unsafeEscapeContext"><span class="hs-identifier hs-type">unsafeEscapeContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156499"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-type">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156525"><span class="hs-keyword hs-type">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1133"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;           context&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1134"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;             delta&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#escapeContext"><span class="hs-identifier hs-type">escapeContext</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-type">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span>
</span><span id="line-1135"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;            delta1&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#escapeContext"><span class="hs-identifier hs-type">escapeContext</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-type">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156499"><span class="hs-identifier hs-type">delta1</span></a></span><span>
</span><span id="line-1136"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;            delta2&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#escapeContext"><span class="hs-identifier hs-type">escapeContext</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-type">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156499"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156500"><span class="hs-identifier hs-type">delta2</span></a></span><span>
</span><span id="line-1137"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span>        </span><span class="hs-comment">-- Only inherit user-written let bindings from parent clauses. Others, like @-patterns,</span><span>
</span><span id="line-1140"></span><span>        </span><span class="hs-comment">-- should not be carried over.</span><span>
</span><span id="line-1141"></span><span>        </span><span id="local-6989586621682156527"><span class="annot"><a href="#local-6989586621682156527"><span class="hs-identifier hs-var">lets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">==</span></span><span> </span><span class="annot"><span class="hs-identifier">UserWritten</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#letOrigin"><span class="hs-identifier hs-var">letOrigin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Open.html#getOpen"><span class="hs-identifier hs-type">getOpen</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#viewTC"><span class="hs-identifier hs-type">viewTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#eLetBindings"><span class="hs-identifier hs-type">eLetBindings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156520"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunction"><span class="hs-identifier hs-type">WithFunction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156474"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156475"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156476"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156478"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156499"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156500"><span class="hs-identifier hs-type">delta2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156503"><span class="hs-identifier hs-type">vtys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156502"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156479"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156477"><span class="hs-identifier hs-type">npars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156501"><span class="hs-identifier hs-type">perm'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156488"><span class="hs-identifier hs-type">perm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156505"><span class="hs-identifier hs-type">finalPerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156484"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156517"><span class="hs-identifier hs-type">argsS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156527"><span class="hs-identifier hs-type">lets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1144"></span><span>
</span><span id="line-1145"></span><span class="annot"><span class="hs-comment">-- | Invoked in empty context.</span></span><span>
</span><span id="line-1146"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkWithFunction"><span class="hs-identifier hs-type">checkWithFunction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunctionProblem"><span class="hs-identifier hs-type">WithFunctionProblem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span id="checkWithFunction"><span class="annot"><span class="annottext">checkWithFunction :: [Name] -&gt; WithFunctionProblem -&gt; TCMT IO (Maybe Term)
</span><a href="Agda.TypeChecking.Rules.Def.html#checkWithFunction"><span class="hs-identifier hs-var hs-var">checkWithFunction</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">WithFunctionProblem
</span><a href="Agda.TypeChecking.Rules.Def.html#NoWithFunction"><span class="hs-identifier hs-var">NoWithFunction</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; TCMT IO (Maybe Term)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe Term
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1148"></span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkWithFunction"><span class="hs-identifier hs-var">checkWithFunction</span></a></span><span> </span><span id="local-6989586621682156534"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682156534"><span class="hs-identifier hs-var">cxtNames</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#WithFunction"><span class="hs-identifier hs-type">WithFunction</span></a></span><span> </span><span id="local-6989586621682156535"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156535"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682156536"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156536"><span class="hs-identifier hs-var">aux</span></a></span></span><span> </span><span id="local-6989586621682156537"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156537"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682156538"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156538"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span id="local-6989586621682156539"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156539"><span class="hs-identifier hs-var">delta1</span></a></span></span><span> </span><span id="local-6989586621682156540"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156540"><span class="hs-identifier hs-var">delta2</span></a></span></span><span> </span><span id="local-6989586621682156541"><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682156541"><span class="hs-identifier hs-var">vtys</span></a></span></span><span> </span><span id="local-6989586621682156542"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156542"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682156543"><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156543"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621682156544"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156544"><span class="hs-identifier hs-var">npars</span></a></span></span><span> </span><span id="local-6989586621682156545"><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156545"><span class="hs-identifier hs-var">perm'</span></a></span></span><span> </span><span id="local-6989586621682156546"><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156546"><span class="hs-identifier hs-var">perm</span></a></span></span><span> </span><span id="local-6989586621682156547"><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156547"><span class="hs-identifier hs-var">finalPerm</span></a></span></span><span> </span><span id="local-6989586621682156548"><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682156548"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621682156549"><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682156549"><span class="hs-identifier hs-var">argsS</span></a></span></span><span> </span><span id="local-6989586621682156550"><span class="annot"><span class="annottext">Map Name LetBinding
</span><a href="#local-6989586621682156550"><span class="hs-identifier hs-var">lets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1149"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- &#916;&#8321; ws &#916;&#8322; &#8866; withSub : &#916;&#8242;    (where &#916;&#8242; is the context of the parent lhs)</span><span>
</span><span id="line-1150"></span><span>      </span><span class="annot"><a href="#local-6989586621682156551"><span class="hs-identifier hs-type">withSub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span>
</span><span id="line-1151"></span><span>      </span><span id="local-6989586621682156551"><span class="annot"><span class="annottext">withSub :: Substitution
</span><a href="#local-6989586621682156551"><span class="hs-identifier hs-var hs-var hs-var">withSub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156552"><span class="annot"><span class="annottext">as :: List1 EqualityView
</span><a href="#local-6989586621682156552"><span class="hs-keyword hs-var hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg (Term, EqualityView) -&gt; EqualityView)
-&gt; List1 (Arg (Term, EqualityView)) -&gt; List1 EqualityView
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term, EqualityView) -&gt; EqualityView
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Term, EqualityView) -&gt; EqualityView)
-&gt; (Arg (Term, EqualityView) -&gt; (Term, EqualityView))
-&gt; Arg (Term, EqualityView)
-&gt; EqualityView
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg (Term, EqualityView) -&gt; (Term, EqualityView)
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682156541"><span class="hs-identifier hs-var">vtys</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1152"></span><span>                </span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#liftS"><span class="hs-identifier hs-var">liftS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156540"><span class="hs-identifier hs-var">delta2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Substitution -&gt; Substitution
forall a. Int -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#wkS"><span class="hs-identifier hs-var">wkS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 EqualityView -&gt; Int
forall (f :: * -&gt; *).
(Functor f, Foldable f) =&gt;
f EqualityView -&gt; Int
</span><a href="Agda.TypeChecking.With.html#countWithArgs"><span class="hs-identifier hs-var">countWithArgs</span></a></span><span> </span><span class="annot"><span class="annottext">List1 EqualityView
</span><a href="#local-6989586621682156552"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution
forall a. Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#idS"><span class="hs-identifier hs-var">idS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>                </span><span class="annot"><span class="annottext">Substitution -&gt; Substitution -&gt; Substitution
forall a.
EndoSubst a =&gt;
Substitution' a -&gt; Substitution' a -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.Class.html#composeS"><span class="hs-operator hs-var">`composeS`</span></a></span><span> </span><span class="annot"><span class="annottext">Impossible -&gt; Permutation -&gt; Substitution
forall a.
DeBruijn a =&gt;
Impossible -&gt; Permutation -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.html#renaming"><span class="hs-identifier hs-var">renaming</span></a></span><span> </span><span class="annot"><span class="annottext">Impossible
HasCallStack =&gt; Impossible
</span><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-var">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Permutation -&gt; Permutation
</span><a href="Agda.Utils.Permutation.html#reverseP"><span class="hs-identifier hs-var">reverseP</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156545"><span class="hs-identifier hs-var">perm'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1156"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checkWithFunction&quot;</span></span><span>
</span><span id="line-1157"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1158"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156558"><span class="annot"><span class="annottext">List1 Term
</span><a href="#local-6989586621682156558"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156559"><span class="annot"><span class="annottext">List1 EqualityView
</span><a href="#local-6989586621682156559"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg (Term, EqualityView) -&gt; (Term, EqualityView))
-&gt; List1 (Arg (Term, EqualityView))
-&gt; (List1 Term, List1 EqualityView)
forall a b c. (a -&gt; (b, c)) -&gt; List1 a -&gt; (List1 b, List1 c)
</span><a href="Agda.Utils.List1.html#unzipWith"><span class="hs-identifier hs-var">List1.unzipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Arg (Term, EqualityView) -&gt; (Term, EqualityView)
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Arg (Term, EqualityView))
</span><a href="#local-6989586621682156541"><span class="hs-identifier hs-var">vtys</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1159"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;delta1 =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Tele (Dom Type) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156539"><span class="hs-identifier hs-var">delta1</span></a></span><span>
</span><span id="line-1160"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;delta2 =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156539"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Tele (Dom Type) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156540"><span class="hs-identifier hs-var">delta2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;t      =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156537"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1162"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;as     =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156539"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 EqualityView -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; List1 EqualityView -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">List1 EqualityView
</span><a href="#local-6989586621682156559"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;vs     =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156539"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">List1 Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; List1 Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">List1 Term
</span><a href="#local-6989586621682156558"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1164"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;b      =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156539"><span class="hs-identifier hs-var">delta1</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156540"><span class="hs-identifier hs-var">delta2</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156542"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1165"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;qs     =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall b (m :: * -&gt; *) a.
(AddContext b, MonadAddContext m) =&gt;
b -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a.
MonadAddContext m =&gt;
Tele (Dom Type) -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-var">addContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156538"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; TCMT IO Doc
forall (m :: * -&gt; *).
MonadPretty m =&gt;
[NamedArg DeBruijnPattern] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCMPatternList"><span class="hs-identifier hs-var">prettyTCMPatternList</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156543"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-1166"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;perm'  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Permutation -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156545"><span class="hs-identifier hs-var">perm'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1167"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;perm   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Permutation -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156546"><span class="hs-identifier hs-var">perm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1168"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;fperm  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Permutation -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156547"><span class="hs-identifier hs-var">finalPerm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;withSub=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Substitution
</span><a href="#local-6989586621682156551"><span class="hs-identifier hs-var">withSub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1171"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1172"></span><span>
</span><span id="line-1173"></span><span>  </span><span class="hs-comment">-- Add the type of the auxiliary function to the signature</span><span>
</span><span id="line-1174"></span><span>
</span><span id="line-1175"></span><span>  </span><span class="hs-comment">-- Jesper, 2020-04-05: Currently variable generalization inserts</span><span>
</span><span id="line-1176"></span><span>  </span><span class="hs-comment">-- dummy terms, we have to reduce projections to get rid of them.</span><span>
</span><span id="line-1177"></span><span>  </span><span class="hs-comment">-- (see also #1332).</span><span>
</span><span id="line-1178"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156563"><span class="annot"><span class="annottext">reds :: SmallSet AllowedReduction
</span><a href="#local-6989586621682156563"><span class="hs-identifier hs-var hs-var hs-var">reds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AllowedReduction] -&gt; SmallSet AllowedReduction
forall a. SmallSetElement a =&gt; [a] -&gt; SmallSet a
</span><a href="Agda.Utils.SmallSet.html#fromList"><span class="hs-identifier hs-var">SmallSet.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AllowedReduction
</span><a href="Agda.TypeChecking.Monad.Base.html#ProjectionReductions"><span class="hs-identifier hs-var">ProjectionReductions</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1179"></span><span>  </span><span id="local-6989586621682156566"><span class="annot"><a href="#local-6989586621682156566"><span class="hs-identifier hs-var">delta1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SmallSet AllowedReduction -&gt; SmallSet AllowedReduction)
-&gt; TCMT IO (Tele (Dom Type)) -&gt; TCMT IO (Tele (Dom Type))
forall (m :: * -&gt; *) a.
MonadTCEnv m =&gt;
(SmallSet AllowedReduction -&gt; SmallSet AllowedReduction)
-&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#modifyAllowedReductions"><span class="hs-identifier hs-var">modifyAllowedReductions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SmallSet AllowedReduction
-&gt; SmallSet AllowedReduction -&gt; SmallSet AllowedReduction
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">SmallSet AllowedReduction
</span><a href="#local-6989586621682156563"><span class="hs-identifier hs-var">reds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCMT IO (Tele (Dom Type)) -&gt; TCMT IO (Tele (Dom Type)))
-&gt; TCMT IO (Tele (Dom Type)) -&gt; TCMT IO (Tele (Dom Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO (Tele (Dom Type))
forall a (m :: * -&gt; *). (Normalise a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#normalise"><span class="hs-identifier hs-var">normalise</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156539"><span class="hs-identifier hs-var">delta1</span></a></span><span>
</span><span id="line-1180"></span><span>
</span><span id="line-1181"></span><span>  </span><span class="hs-comment">-- Amy, 2025-05-14: (InstanceHack) we have to flush instances that may</span><span>
</span><span id="line-1182"></span><span>  </span><span class="hs-comment">-- come from previous clauses, see #7882.</span><span>
</span><span id="line-1183"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.InstanceArguments.html#flushInstanceConstraints"><span class="hs-identifier hs-type">flushInstanceConstraints</span></a></span><span>
</span><span id="line-1184"></span><span>
</span><span id="line-1185"></span><span>  </span><span class="hs-comment">-- Generate the type of the with function</span><span>
</span><span id="line-1186"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682156569"><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-var">withFunType</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682156570"><span class="annot"><a href="#local-6989586621682156570"><span class="hs-identifier hs-var">nwithargs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682156571"><span class="annot"><a href="#local-6989586621682156571"><span class="hs-identifier hs-var">nwithpats</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1187"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156572"><span class="annot"><a href="#local-6989586621682156572"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Impossible -&gt; Permutation -&gt; Substitution' DeBruijnPattern
forall a.
DeBruijn a =&gt;
Impossible -&gt; Permutation -&gt; Substitution' a
</span><a href="Agda.TypeChecking.Substitute.html#renaming"><span class="hs-identifier hs-var">renaming</span></a></span><span> </span><span class="annot"><span class="annottext">Impossible
HasCallStack =&gt; Impossible
</span><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-var">impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Permutation -&gt; Permutation
</span><a href="Agda.Utils.Permutation.html#reverseP"><span class="hs-identifier hs-var">reverseP</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682156545"><span class="hs-identifier hs-var">perm'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Substitution' (SubstArg [NamedArg DeBruijnPattern])
-&gt; [NamedArg DeBruijnPattern] -&gt; [NamedArg DeBruijnPattern]
forall a. Subst a =&gt; Substitution' (SubstArg a) -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-operator hs-var">`applySubst`</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156543"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-1188"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.bndry&quot;</span></span><span> </span><span class="annot"><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156566"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156540"><span class="hs-identifier hs-type">delta2</span></a></span><span>
</span><span id="line-1189"></span><span>                                  </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ps =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156572"><span class="hs-identifier hs-type">ps</span></a></span><span>
</span><span id="line-1190"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156573"><span class="annot"><a href="#local-6989586621682156573"><span class="hs-identifier hs-var hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; [Int]
forall p. IApplyVars p =&gt; p -&gt; [Int]
</span><a href="Agda.TypeChecking.Telescope.Path.html#iApplyVars"><span class="hs-identifier hs-var">iApplyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156572"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1191"></span><span>    </span><span id="local-6989586621682156575"><span class="annot"><a href="#local-6989586621682156575"><span class="hs-identifier hs-var">bndry</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156573"><span class="hs-identifier hs-type">vs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="Agda.Utils.Null.html#empty"><span class="hs-identifier hs-type">empty</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1192"></span><span>      </span><span id="local-6989586621682156576"><span class="annot"><a href="#local-6989586621682156576"><span class="hs-identifier hs-var">iz</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primIZero"><span class="hs-identifier hs-type">primIZero</span></a></span><span>
</span><span id="line-1193"></span><span>      </span><span id="local-6989586621682156577"><span class="annot"><a href="#local-6989586621682156577"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Builtin.html#primIOne"><span class="hs-identifier hs-type">primIOne</span></a></span><span>
</span><span id="line-1194"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156578"><span class="annot"><a href="#local-6989586621682156578"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156535"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern] -&gt; Elims
</span><a href="Agda.Syntax.Internal.Pattern.html#patternsToElims"><span class="hs-identifier hs-var">patternsToElims</span></a></span><span> </span><span class="annot"><span class="annottext">[NamedArg DeBruijnPattern]
</span><a href="#local-6989586621682156572"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#Boundary"><span class="hs-identifier hs-type">Boundary</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156581"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#inplaceS"><span class="hs-identifier hs-type">inplaceS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156581"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156576"><span class="hs-identifier hs-type">iz</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-operator hs-type">`applySubst`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156578"><span class="hs-identifier hs-type">tm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#inplaceS"><span class="hs-identifier hs-type">inplaceS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156581"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156577"><span class="hs-identifier hs-type">io</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-operator hs-type">`applySubst`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156578"><span class="hs-identifier hs-type">tm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682156581"><span class="annot"><a href="#local-6989586621682156581"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682156573"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1196"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.bndry&quot;</span></span><span> </span><span class="annot"><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156566"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156540"><span class="hs-identifier hs-type">delta2</span></a></span><span>
</span><span id="line-1197"></span><span>                                  </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bndry =&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156575"><span class="hs-identifier hs-type">bndry</span></a></span><span>
</span><span id="line-1198"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.With.html#withFunctionType"><span class="hs-identifier hs-type">withFunctionType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156566"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156541"><span class="hs-identifier hs-type">vtys</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156540"><span class="hs-identifier hs-type">delta2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156542"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156575"><span class="hs-identifier hs-type">bndry</span></a></span><span>
</span><span id="line-1199"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.type&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;with-function type:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-type">withFunType</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1200"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.type&quot;</span></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;with-function type:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-type">withFunType</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span>  </span><span id="local-6989586621682156584"><span class="annot"><a href="#local-6989586621682156584"><span class="hs-identifier hs-var">call_in_parent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1203"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682156585"><span class="annot"><a href="#local-6989586621682156585"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682156586"><span class="annot"><a href="#local-6989586621682156586"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#telViewUpToPathBoundary%27"><span class="hs-identifier hs-type">telViewUpToPathBoundary'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156570"><span class="hs-identifier hs-type">nwithargs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156538"><span class="hs-identifier hs-type">delta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-type">withFunType</span></a></span><span>
</span><span id="line-1204"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682156549"><span class="hs-identifier hs-type">argsS</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#applySubst"><span class="hs-operator hs-type">`applySubst`</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156536"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Telescope.html#teleElims"><span class="hs-identifier hs-type">teleElims</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156585"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156586"><span class="hs-identifier hs-type">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1205"></span><span>
</span><span id="line-1206"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156538"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;with function call&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156584"><span class="hs-identifier hs-type">call_in_parent</span></a></span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span>  </span><span class="hs-comment">-- Andreas, 2013-10-21</span><span>
</span><span id="line-1209"></span><span>  </span><span class="hs-comment">-- Check generated type directly in internal syntax.</span><span>
</span><span id="line-1210"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-type">setCurrentRange</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156548"><span class="hs-identifier hs-type">cs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1211"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-type">traceCall</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NoHighlighting"><span class="hs-identifier hs-type">NoHighlighting</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>   </span><span class="hs-comment">-- To avoid flicker.</span><span>
</span><span id="line-1212"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-type">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#CheckWithFunctionType"><span class="hs-identifier hs-type">CheckWithFunctionType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-type">withFunType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1213"></span><span>    </span><span class="hs-comment">-- Jesper, 2024-07-10, issue #6841:</span><span>
</span><span id="line-1214"></span><span>    </span><span class="hs-comment">-- Having an ill-typed type can lead to problems in the</span><span>
</span><span id="line-1215"></span><span>    </span><span class="hs-comment">-- coverage checker, so we ensure there are no constraints here.</span><span>
</span><span id="line-1216"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#noConstraints"><span class="hs-identifier hs-type">noConstraints</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.CheckInternal.html#checkType"><span class="hs-identifier hs-type">checkType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-type">withFunType</span></a></span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-string">&quot;creating with display form...&quot;</span></span><span>
</span><span id="line-1219"></span><span>
</span><span id="line-1220"></span><span>  </span><span class="hs-comment">-- With display forms are closed</span><span>
</span><span id="line-1221"></span><span>  </span><span id="local-6989586621682156591"><span class="annot"><a href="#local-6989586621682156591"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-type">inTopContext</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Open.html#makeOpen"><span class="hs-identifier hs-type">makeOpen</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.With.html#withDisplayForm"><span class="hs-identifier hs-type">withDisplayForm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156535"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156536"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156566"><span class="hs-identifier hs-type">delta1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156540"><span class="hs-identifier hs-type">delta2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156570"><span class="hs-identifier hs-type">nwithargs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156543"><span class="hs-identifier hs-type">qs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156545"><span class="hs-identifier hs-type">perm'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156546"><span class="hs-identifier hs-type">perm</span></a></span><span>
</span><span id="line-1222"></span><span>
</span><span id="line-1223"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-string">&quot;created with display form&quot;</span></span><span>
</span><span id="line-1224"></span><span>
</span><span id="line-1225"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Utils.Functor.html#dget"><span class="hs-identifier hs-type">dget</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156591"><span class="hs-identifier hs-type">df</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1226"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Display"><span class="hs-identifier hs-type">Display</span></a></span><span> </span><span id="local-6989586621682156595"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156595"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682156596"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682156596"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621682156597"><span class="annot"><span class="annottext">DisplayTerm
</span><a href="#local-6989586621682156597"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1227"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Display&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span>
</span><span id="line-1228"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156595"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1229"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="annot"><span class="annottext">([TCMT IO Doc] -&gt; TCMT IO Doc) -&gt; [TCMT IO Doc] -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Elim -&gt; TCMT IO Doc) -&gt; Elims -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Elim -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Elim -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682156596"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1230"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DisplayTerm -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; DisplayTerm -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">DisplayTerm
</span><a href="#local-6989586621682156597"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-1231"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1232"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#addConstant"><span class="hs-identifier hs-type">addConstant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156536"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1233"></span><span>    </span><span id="local-6989586621682156598"><span class="annot"><a href="#local-6989586621682156598"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Options.html#getLanguage"><span class="hs-identifier hs-type">getLanguage</span></a></span><span>
</span><span id="line-1234"></span><span>    </span><span id="local-6989586621682156599"><span class="annot"><a href="#local-6989586621682156599"><span class="hs-identifier hs-var">fun</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#emptyFunction"><span class="hs-identifier hs-type">emptyFunction</span></a></span><span>
</span><span id="line-1235"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#useTerPragma"><span class="hs-identifier hs-type">useTerPragma</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-1236"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defaultDefn"><span class="hs-identifier hs-type">defaultDefn</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#defaultArgInfo"><span class="hs-identifier hs-type">defaultArgInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156536"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-type">withFunType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156598"><span class="hs-identifier hs-type">lang</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156599"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1237"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defDisplay"><span class="hs-identifier hs-var">defDisplay</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682156591"><span class="hs-identifier hs-type">df</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1238"></span><span>  </span><span class="hs-comment">-- solveSizeConstraints -- Andreas, 2012-10-16 does not seem necessary</span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span>
</span><span id="line-1241"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;added with function&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156536"><span class="hs-identifier hs-type">aux</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;of type&quot;</span></span><span>
</span><span id="line-1242"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-type">withFunType</span></a></span><span>
</span><span id="line-1243"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;-|&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextTelescope"><span class="hs-identifier hs-type">getContextTelescope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1244"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1245"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.with.top&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-1246"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;raw with func. type = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-type">withFunType</span></a></span><span>
</span><span id="line-1247"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1248"></span><span>
</span><span id="line-1249"></span><span>
</span><span id="line-1250"></span><span>  </span><span class="hs-comment">-- Construct the body for the with function</span><span>
</span><span id="line-1251"></span><span>  </span><span id="local-6989586621682156601"><span class="annot"><a href="#local-6989586621682156601"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Pattern.html#lhsToSpine"><span class="hs-identifier hs-type">A.lhsToSpine</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156548"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-1252"></span><span>  </span><span id="local-6989586621682156602"><span class="annot"><a href="#local-6989586621682156602"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.With.html#buildWithFunction"><span class="hs-identifier hs-type">buildWithFunction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156534"><span class="hs-identifier hs-type">cxtNames</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156535"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156536"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156537"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156538"><span class="hs-identifier hs-type">delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156543"><span class="hs-identifier hs-type">qs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156544"><span class="hs-identifier hs-type">npars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156551"><span class="hs-identifier hs-type">withSub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156547"><span class="hs-identifier hs-type">finalPerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156566"><span class="hs-identifier hs-type">delta1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156571"><span class="hs-identifier hs-type">nwithpats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156601"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-1253"></span><span>  </span><span id="local-6989586621682156604"><span class="annot"><a href="#local-6989586621682156604"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.Pattern.html#spineToLhs"><span class="hs-identifier hs-type">A.spineToLhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156602"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-1254"></span><span>
</span><span id="line-1255"></span><span>  </span><span class="hs-comment">-- #4833: inherit abstract mode from parent</span><span>
</span><span id="line-1256"></span><span>  </span><span id="local-6989586621682156606"><span class="annot"><a href="#local-6989586621682156606"><span class="hs-identifier hs-var">abstr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defAbstract"><span class="hs-identifier hs-type">defAbstract</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#ignoreAbstractMode"><span class="hs-identifier hs-type">ignoreAbstractMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156535"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>
</span><span id="line-1258"></span><span>  </span><span class="hs-comment">-- Check the with function</span><span>
</span><span id="line-1259"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682156609"><span class="annot"><a href="#local-6989586621682156609"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Fixity' -&gt; Access -&gt; IsAbstract -&gt; Range -&gt; DefInfo
forall t.
Name -&gt; Fixity' -&gt; Access -&gt; IsAbstract -&gt; Range -&gt; DefInfo' t
</span><a href="Agda.Syntax.Info.html#mkDefInfo"><span class="hs-identifier hs-var">Info.mkDefInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#nameConcrete"><span class="hs-identifier hs-var">nameConcrete</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Name -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Name
</span><a href="Agda.Syntax.Abstract.Name.html#qnameName"><span class="hs-identifier hs-var">qnameName</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156536"><span class="hs-identifier hs-var">aux</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fixity'
</span><a href="Agda.Syntax.Common.html#noFixity%27"><span class="hs-identifier hs-var">noFixity'</span></a></span><span> </span><span class="annot"><span class="annottext">Access
</span><a href="Agda.Syntax.Common.html#PublicAccess"><span class="hs-identifier hs-var">PublicAccess</span></a></span><span> </span><span class="annot"><span class="annottext">IsAbstract
</span><a href="#local-6989586621682156606"><span class="hs-identifier hs-var">abstr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">List1 (Clause' LHS) -&gt; Range
forall a. HasRange a =&gt; a -&gt; Range
</span><a href="Agda.Syntax.Position.html#getRange"><span class="hs-identifier hs-var">getRange</span></a></span><span> </span><span class="annot"><span class="annottext">List1 (Clause' LHS)
</span><a href="#local-6989586621682156604"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>  </span><span id="local-6989586621682156615"><span class="annot"><a href="#local-6989586621682156615"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defArgInfo"><span class="hs-identifier hs-var">defArgInfo</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-type">getConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156535"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-1261"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkFunDefS"><span class="hs-identifier hs-type">checkFunDefS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156569"><span class="hs-identifier hs-type">withFunType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156615"><span class="hs-identifier hs-type">ai</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621682156535"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156609"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156536"><span class="hs-identifier hs-type">aux</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156551"><span class="hs-identifier hs-type">withSub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682156550"><span class="hs-identifier hs-type">lets</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">List1.toList</span></span><span> </span><span class="annot"><a href="#local-6989586621682156604"><span class="hs-identifier hs-type">cs</span></a></span><span>
</span><span id="line-1262"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682156584"><span class="hs-identifier hs-type">call_in_parent</span></a></span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span class="annot"><span class="hs-comment">-- | Type check a where clause.</span></span><span>
</span><span id="line-1265"></span><span id="local-6989586621682153736"><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#checkWhere"><span class="hs-identifier hs-type">checkWhere</span></a></span><span>
</span><span id="line-1266"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#WhereDeclarations"><span class="hs-identifier hs-type">A.WhereDeclarations</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Where-declarations to check.</span></span><span>
</span><span id="line-1267"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153736"><span class="hs-identifier hs-type">a</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Continuation.</span></span><span>
</span><span id="line-1268"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153736"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1269"></span><span id="checkWhere"><span class="annot"><span class="annottext">checkWhere :: forall a. WhereDeclarations -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Def.html#checkWhere"><span class="hs-identifier hs-var hs-var">checkWhere</span></a></span></span><span> </span><span id="local-6989586621682156648"><span class="annot"><span class="annottext">wh :: WhereDeclarations
</span><a href="#local-6989586621682156648"><span class="hs-identifier hs-var">wh</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#WhereDecls"><span class="hs-identifier hs-type">A.WhereDecls</span></a></span><span> </span><span id="local-6989586621682156650"><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621682156650"><span class="hs-identifier hs-var">whmod</span></a></span></span><span> </span><span id="local-6989586621682156651"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682156651"><span class="hs-identifier hs-var">whNamed</span></a></span></span><span> </span><span id="local-6989586621682156652"><span class="annot"><span class="annottext">Maybe Declaration
</span><a href="#local-6989586621682156652"><span class="hs-identifier hs-var">mds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156653"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682156653"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1270"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682156651"><span class="hs-identifier hs-var">whNamed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName -&gt; TCM ()
forall {m :: * -&gt; *}.
(MonadTrace m, HasOptions m, MonadDebug m, MonadError TCErr m) =&gt;
Maybe ModuleName -&gt; m ()
</span><a href="#local-6989586621682156654"><span class="hs-identifier hs-var">ensureNoNamedWhereInRefinedContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621682156650"><span class="hs-identifier hs-var">whmod</span></a></span><span>
</span><span id="line-1271"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Declaration
</span><a href="#local-6989586621682156652"><span class="hs-identifier hs-var">mds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1272"></span><span>      </span><span class="annot"><span class="annottext">Maybe Declaration
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682156653"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-1273"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#Section"><span class="hs-identifier hs-type">A.Section</span></a></span><span> </span><span class="annot"><span class="annottext">Range
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156656"><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682156656"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682156657"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156657"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682156658"><span class="annot"><span class="annottext">GeneralizeTelescope
</span><a href="#local-6989586621682156658"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682156659"><span class="annot"><span class="annottext">[Declaration]
</span><a href="#local-6989586621682156659"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1274"></span><span>
</span><span id="line-1275"></span><span>        </span><span class="hs-comment">-- Andreas, 2025-06-14, issue #7943.</span><span>
</span><span id="line-1276"></span><span>        </span><span class="hs-comment">-- If we are in erased context, mark the module as erased.</span><span>
</span><span id="line-1277"></span><span>        </span><span id="local-6989586621682156660"><span class="annot"><a href="#local-6989586621682156660"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682156656"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1278"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Common.html#NotErased"><span class="hs-identifier hs-type">NotErased</span></a></span><span> </span><span id="local-6989586621682156662"><span class="annot"><span class="annottext">Q&#969;Origin
</span><a href="#local-6989586621682156662"><span class="hs-identifier hs-var">oo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1279"></span><span>            </span><span class="annot"><span class="annottext">(TCEnv -&gt; Quantity) -&gt; TCMT IO Quantity
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Quantity
</span><a href="Agda.TypeChecking.Monad.Base.html#envQuantity"><span class="hs-identifier hs-var">envQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Quantity -&gt; (Quantity -&gt; TCMT IO Erased) -&gt; TCMT IO Erased
forall a b. TCMT IO a -&gt; (a -&gt; TCMT IO b) -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1280"></span><span>              </span><span class="annot"><a href="Agda.Syntax.Common.html#Quantity0"><span class="hs-identifier hs-type">Quantity0</span></a></span><span> </span><span id="local-6989586621682156666"><span class="annot"><span class="annottext">Q0Origin
</span><a href="#local-6989586621682156666"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1281"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; TCM () -&gt; TCM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Q&#969;Origin
</span><a href="#local-6989586621682156662"><span class="hs-identifier hs-var">oo</span></a></span><span> </span><span class="annot"><span class="annottext">Q&#969;Origin -&gt; Q&#969;Origin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Q&#969;Origin
</span><a href="Agda.Syntax.Common.html#Q%3C9Inferred"><span class="hs-identifier hs-var">Q&#969;Inferred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1282"></span><span>                  </span><span class="annot"><span class="annottext">Q&#969;Origin -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) x a.
(MonadTrace m, HasRange x) =&gt;
x -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#setCurrentRange"><span class="hs-identifier hs-var">setCurrentRange</span></a></span><span> </span><span class="annot"><span class="annottext">Q&#969;Origin
</span><a href="#local-6989586621682156662"><span class="hs-identifier hs-var">oo</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Warning -&gt; TCM ()
forall (m :: * -&gt; *).
(HasCallStack, MonadWarning m) =&gt;
Warning -&gt; m ()
</span><a href="Agda.TypeChecking.Warnings.html#warning"><span class="hs-identifier hs-var">warning</span></a></span><span> </span><span class="annot"><span class="annottext">(Warning -&gt; TCM ()) -&gt; Warning -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q&#969;Origin -&gt; Warning
</span><a href="Agda.TypeChecking.Monad.Base.html#PlentyInHardCompileTimeMode"><span class="hs-identifier hs-var">PlentyInHardCompileTimeMode</span></a></span><span> </span><span class="annot"><span class="annottext">Q&#969;Origin
</span><a href="#local-6989586621682156662"><span class="hs-identifier hs-var">oo</span></a></span><span>
</span><span id="line-1283"></span><span>                </span><span class="annot"><span class="annottext">Erased -&gt; TCMT IO Erased
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Erased -&gt; TCMT IO Erased) -&gt; Erased -&gt; TCMT IO Erased
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Q0Origin -&gt; Erased
</span><a href="Agda.Syntax.Common.html#Erased"><span class="hs-identifier hs-var">Erased</span></a></span><span> </span><span class="annot"><span class="annottext">Q0Origin
</span><a href="#local-6989586621682156666"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-1284"></span><span>              </span><span class="annot"><a href="Agda.Syntax.Common.html#Quantity%3C9"><span class="hs-identifier hs-type">Quantity&#969;</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Erased -&gt; TCMT IO Erased
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682156656"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1285"></span><span>              </span><span class="annot"><a href="Agda.Syntax.Common.html#Quantity1"><span class="hs-identifier hs-type">Quantity1</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCMT IO Erased
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1286"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Common.html#Erased"><span class="hs-identifier hs-type">Erased</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Erased -&gt; TCMT IO Erased
forall a. a -&gt; TCMT IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682156656"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1287"></span><span>
</span><span id="line-1288"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-type">localTC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156673"><span class="hs-identifier hs-type">whereEnv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#newSection"><span class="hs-identifier hs-type">newSection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156660"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156657"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156658"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Rules.Decl.html#checkDecls"><span class="hs-identifier hs-type">checkDecls</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156659"><span class="hs-identifier hs-type">ds</span></a></span><span>
</span><span id="line-1289"></span><span>        </span><span class="hs-comment">-- Andreas, 2025-06-14, issue #7944</span><span>
</span><span id="line-1290"></span><span>        </span><span class="hs-comment">-- We need to check the body in its original erasure status.</span><span>
</span><span id="line-1291"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#withCurrentModule"><span class="hs-identifier hs-type">withCurrentModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156657"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156653"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-1292"></span><span>      </span><span class="annot"><span class="annottext">Maybe Declaration
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCM a
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1293"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1294"></span><span>    </span><span id="local-6989586621682156673"><span class="annot"><span class="annottext">whereEnv :: TCEnv -&gt; TCEnv
</span><a href="#local-6989586621682156673"><span class="hs-identifier hs-var hs-var">whereEnv</span></a></span></span><span> </span><span id="local-6989586621682156676"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682156676"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682156676"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1295"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envCheckingWhere"><span class="hs-identifier hs-var">envCheckingWhere</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682156651"><span class="hs-identifier hs-type">whNamed</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#SomeWhere_"><span class="hs-identifier hs-type">C.SomeWhere_</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Agda.Syntax.Concrete.html#AnyWhere_"><span class="hs-identifier hs-type">C.AnyWhere_</span></a></span><span>
</span><span id="line-1296"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-1297"></span><span>    </span><span class="hs-comment">-- #2897: We can't handle named where-modules in refined contexts.</span><span>
</span><span id="line-1298"></span><span>    </span><span id="local-6989586621682156654"><span class="annot"><span class="annottext">ensureNoNamedWhereInRefinedContext :: Maybe ModuleName -&gt; m ()
</span><a href="#local-6989586621682156654"><span class="hs-identifier hs-var hs-var">ensureNoNamedWhereInRefinedContext</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1299"></span><span>    </span><span class="annot"><a href="#local-6989586621682156654"><span class="hs-identifier hs-var">ensureNoNamedWhereInRefinedContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682156750"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156750"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Call -&gt; m () -&gt; m ()
forall a. Call -&gt; m a -&gt; m a
forall (m :: * -&gt; *) a. MonadTrace m =&gt; Call -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Trace.html#traceCall"><span class="hs-identifier hs-var">traceCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; Call
</span><a href="Agda.TypeChecking.Monad.Base.html#CheckNamedWhere"><span class="hs-identifier hs-var">CheckNamedWhere</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156750"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1300"></span><span>      </span><span id="local-6989586621682156752"><span class="annot"><a href="#local-6989586621682156752"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Term) -&gt; [Arg Term] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">([Arg Term] -&gt; [Term]) -&gt; m [Arg Term] -&gt; m [Term]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; m [Arg Term]
forall (m :: * -&gt; *).
(Functor m, Applicative m, HasOptions m, MonadTCEnv m,
 ReadTCState m, MonadDebug m) =&gt;
ModuleName -&gt; m [Arg Term]
</span><a href="Agda.TypeChecking.Monad.Signature.html#moduleParamsToApply"><span class="hs-identifier hs-var">moduleParamsToApply</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; m [Arg Term]) -&gt; m ModuleName -&gt; m [Arg Term]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">m ModuleName
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m ModuleName
</span><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-var">currentModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1301"></span><span>      </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682156754"><span class="hs-identifier hs-type">isWeakening</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156752"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- weakened contexts are fine</span><span>
</span><span id="line-1302"></span><span>        </span><span id="local-6989586621682156755"><span class="annot"><a href="#local-6989586621682156755"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#argNameToString"><span class="hs-identifier hs-type">argNameToString</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-type">telToList</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span>
</span><span id="line-1303"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#lookupSection"><span class="hs-identifier hs-type">lookupSection</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#currentModule"><span class="hs-identifier hs-type">currentModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1304"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-type">typeError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#NamedWhereModuleInRefinedContext"><span class="hs-identifier hs-type">NamedWhereModuleInRefinedContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156752"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156755"><span class="hs-identifier hs-type">names</span></a></span><span>
</span><span id="line-1305"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1306"></span><span>        </span><span id="local-6989586621682156754"><span class="annot"><span class="annottext">isWeakening :: [Term] -&gt; Bool
</span><a href="#local-6989586621682156754"><span class="hs-identifier hs-var hs-var">isWeakening</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1307"></span><span>        </span><span class="annot"><a href="#local-6989586621682156754"><span class="hs-identifier hs-var">isWeakening</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682156761"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156761"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682156762"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682156762"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Term] -&gt; Bool
</span><a href="#local-6989586621682156763"><span class="hs-identifier hs-var">isWk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156761"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682156762"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1308"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1309"></span><span>            </span><span id="local-6989586621682156763"><span class="annot"><span class="annottext">isWk :: Int -&gt; [Term] -&gt; Bool
</span><a href="#local-6989586621682156763"><span class="hs-identifier hs-var hs-var">isWk</span></a></span></span><span> </span><span id="local-6989586621682156768"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156768"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1310"></span><span>            </span><span class="annot"><a href="#local-6989586621682156763"><span class="hs-identifier hs-var">isWk</span></a></span><span> </span><span id="local-6989586621682156769"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156769"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682156770"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156770"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682156771"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682156771"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156769"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156770"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Term] -&gt; Bool
</span><a href="#local-6989586621682156763"><span class="hs-identifier hs-var">isWk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156769"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621682156771"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1311"></span><span>            </span><span class="annot"><a href="#local-6989586621682156763"><span class="hs-identifier hs-var">isWk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1312"></span><span>        </span><span class="annot"><a href="#local-6989586621682156754"><span class="hs-identifier hs-var">isWeakening</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1313"></span><span>
</span><span id="line-1314"></span><span>
</span><span id="line-1315"></span><span class="annot"><span class="hs-comment">-- | Enter a new section during type-checking.</span></span><span>
</span><span id="line-1316"></span><span>
</span><span id="line-1317"></span><span id="local-6989586621682153878"><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#newSection"><span class="hs-identifier hs-type">newSection</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1318"></span><span>  </span><span class="annot"><a href="Agda.Syntax.Common.html#Erased"><span class="hs-identifier hs-type">Erased</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#GeneralizeTelescope"><span class="hs-identifier hs-type">A.GeneralizeTelescope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153878"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153878"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1319"></span><span id="newSection"><span class="annot"><span class="annottext">newSection :: forall a.
Erased -&gt; ModuleName -&gt; GeneralizeTelescope -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Def.html#newSection"><span class="hs-identifier hs-var hs-var">newSection</span></a></span></span><span> </span><span id="local-6989586621682156817"><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682156817"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621682156818"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156818"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682156819"><span class="annot"><span class="annottext">gtel :: GeneralizeTelescope
</span><a href="#local-6989586621682156819"><span class="hs-identifier hs-var">gtel</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Abstract.html#GeneralizeTel"><span class="hs-identifier hs-type">A.GeneralizeTel</span></a></span><span> </span><span class="annot"><span class="annottext">Map QName Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156821"><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682156821"><span class="hs-identifier hs-var">tel</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682156822"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682156822"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1320"></span><span>  </span><span class="hs-comment">-- If the section is erased, then hard compile-time mode is entered.</span><span>
</span><span id="line-1321"></span><span>  </span><span class="annot"><span class="annottext">Erased -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#warnForPlentyInHardCompileTimeMode"><span class="hs-identifier hs-var">warnForPlentyInHardCompileTimeMode</span></a></span><span> </span><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682156817"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1322"></span><span>  </span><span class="annot"><span class="annottext">Erased -&gt; TCM a -&gt; TCM a
forall a. Erased -&gt; TCM a -&gt; TCM a
</span><a href="Agda.TypeChecking.Monad.Signature.html#setHardCompileTimeModeIfErased"><span class="hs-identifier hs-var">setHardCompileTimeModeIfErased</span></a></span><span> </span><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682156817"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; TCM a) -&gt; TCM a -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1323"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.section&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1324"></span><span>    </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;checking section&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Erased -&gt; Doc -&gt; Doc
</span><a href="Agda.Syntax.Common.html#prettyErased"><span class="hs-identifier hs-var">prettyErased</span></a></span><span> </span><span class="annot"><span class="annottext">Erased
</span><a href="#local-6989586621682156817"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc -&gt; Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; ModuleName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156818"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1325"></span><span>    </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypedBinding -&gt; TCMT IO Doc) -&gt; Telescope -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TypedBinding -&gt; TCMT IO Doc
forall a (m :: * -&gt; *).
(ToConcrete a, Pretty (ConOfAbs a), MonadAbsToCon m) =&gt;
a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyA"><span class="hs-identifier hs-var">prettyA</span></a></span><span> </span><span class="annot"><span class="annottext">Telescope
</span><a href="#local-6989586621682156821"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1326"></span><span>
</span><span id="line-1327"></span><span>  </span><span class="annot"><span class="annottext">Maybe ModuleName
-&gt; GeneralizeTelescope
-&gt; ([Maybe Name] -&gt; Tele (Dom Type) -&gt; TCM a)
-&gt; TCM a
forall a.
Maybe ModuleName
-&gt; GeneralizeTelescope
-&gt; ([Maybe Name] -&gt; Tele (Dom Type) -&gt; TCM a)
-&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Term.html#checkGeneralizeTelescope"><span class="hs-identifier hs-var">checkGeneralizeTelescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; Maybe ModuleName
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156818"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GeneralizeTelescope
</span><a href="#local-6989586621682156819"><span class="hs-identifier hs-var">gtel</span></a></span><span> </span><span class="annot"><span class="annottext">(([Maybe Name] -&gt; Tele (Dom Type) -&gt; TCM a) -&gt; TCM a)
-&gt; ([Maybe Name] -&gt; Tele (Dom Type) -&gt; TCM a) -&gt; TCM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682156827"><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156827"><span class="hs-identifier hs-var">tel'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1328"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.section&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1329"></span><span>      </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;adding section:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; ModuleName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156818"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; [Char] -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; Int
forall a. Sized a =&gt; a -&gt; Int
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682156827"><span class="hs-identifier hs-var">tel'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1330"></span><span>
</span><span id="line-1331"></span><span>    </span><span class="annot"><span class="annottext">ModuleName -&gt; TCM ()
</span><a href="Agda.TypeChecking.Monad.Signature.html#addSection"><span class="hs-identifier hs-var">addSection</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156818"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1332"></span><span>
</span><span id="line-1333"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.section&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc
forall (tcm :: * -&gt; *) a.
(MonadTCEnv tcm, ReadTCState tcm) =&gt;
tcm a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Context.html#inTopContext"><span class="hs-identifier hs-var">inTopContext</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1334"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Int -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;actual tele:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Tele (Dom Type) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(Tele (Dom Type) -&gt; TCMT IO Doc)
-&gt; TCMT IO (Tele (Dom Type)) -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; TCMT IO (Tele (Dom Type))
forall (m :: * -&gt; *).
(Functor m, ReadTCState m) =&gt;
ModuleName -&gt; m (Tele (Dom Type))
</span><a href="Agda.TypeChecking.Monad.Signature.html#lookupSection"><span class="hs-identifier hs-var">lookupSection</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156818"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1335"></span><span>
</span><span id="line-1336"></span><span>    </span><span class="annot"><span class="annottext">ModuleName -&gt; TCM a -&gt; TCM a
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; ModuleName -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#withCurrentModule"><span class="hs-identifier hs-var">withCurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682156818"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682156822"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-1337"></span><span>
</span><span id="line-1338"></span><span class="annot"><span class="hs-comment">-- | Set the current clause number.</span></span><span>
</span><span id="line-1339"></span><span>
</span><span id="line-1340"></span><span id="local-6989586621682153502"><span class="annot"><a href="Agda.TypeChecking.Rules.Def.html#atClause"><span class="hs-identifier hs-type">atClause</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#SpineClause"><span class="hs-identifier hs-type">A.SpineClause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153502"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682153502"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1341"></span><span id="atClause"><span class="annot"><span class="annottext">atClause :: forall a.
QName
-&gt; Int
-&gt; Type
-&gt; Maybe Substitution
-&gt; SpineClause
-&gt; TCM a
-&gt; TCM a
</span><a href="Agda.TypeChecking.Rules.Def.html#atClause"><span class="hs-identifier hs-var hs-var">atClause</span></a></span></span><span> </span><span id="local-6989586621682156833"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682156833"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621682156834"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682156834"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682156835"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682156835"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682156836"><span class="annot"><span class="annottext">Maybe Substitution
</span><a href="#local-6989586621682156836"><span class="hs-identifier hs-var">sub</span></a></span></span><span> </span><span id="local-6989586621682156837"><span class="annot"><span class="annottext">SpineClause
</span><a href="#local-6989586621682156837"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621682156838"><span class="annot"><span class="annottext">TCM a
</span><a href="#local-6989586621682156838"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1342"></span><span>  </span><span id="local-6989586621682156839"><span class="annot"><a href="#local-6989586621682156839"><span class="hs-identifier hs-var">clo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCMT IO (Closure ())
forall (m :: * -&gt; *) a.
(MonadTCEnv m, ReadTCState m) =&gt;
a -&gt; m (Closure a)
</span><a href="Agda.TypeChecking.Monad.Base.html#buildClosure"><span class="hs-identifier hs-var">buildClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1343"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#localTC"><span class="hs-identifier hs-type">localTC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682156841"><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682156841"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCEnv
</span><a href="#local-6989586621682156841"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envClause"><span class="hs-identifier hs-var">envClause</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IPClause"><span class="hs-identifier hs-type">IPClause</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156833"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156834"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156835"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156836"><span class="hs-identifier hs-type">sub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156837"><span class="hs-identifier hs-type">cl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682156839"><span class="hs-identifier hs-type">clo</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682156838"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-1344"></span></pre></body></html>