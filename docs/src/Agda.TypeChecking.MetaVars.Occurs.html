<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wunused-imports #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation  #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="annot"><span class="hs-comment">{- | The occurs check for unification.  Does pruning on the fly.

  When hitting a meta variable:

  - Compute flex/rigid for its arguments.
  - Compare to allowed variables.
  - Mark arguments with rigid occurrences of disallowed variables for deletion.
  - Attempt to delete marked arguments.
  - We don't need to check for success, we can just continue occurs checking.
-}</span></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html"><span class="hs-identifier">Agda.TypeChecking.MetaVars.Occurs</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zip</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWith</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catchError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwError</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runReaderT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">asks</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">local</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">traverse_</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntMap</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html"><span class="hs-identifier">Agda.Benchmarking</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html"><span class="hs-identifier">Agda.Syntax.Common</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.MetaVars.html"><span class="hs-identifier">Agda.Syntax.Internal.MetaVars</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html"><span class="hs-identifier">Agda.TypeChecking.Constraints</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html"><span class="hs-identifier">Agda.TypeChecking.Pretty</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.html"><span class="hs-identifier">Agda.TypeChecking.Free</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html"><span class="hs-identifier">Agda.TypeChecking.Free.Lazy</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Free.Reduce</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.ProjectionLike.html"><span class="hs-identifier">Agda.TypeChecking.ProjectionLike</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html"><span class="hs-identifier">Agda.TypeChecking.Substitute</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html"><span class="hs-identifier">Agda.TypeChecking.Datatypes</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html"><span class="hs-identifier">Agda.TypeChecking.Records</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html"><span class="hs-identifier">Agda.TypeChecking.MetaVars</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Interaction.Options.html"><span class="hs-identifier">Agda.Interaction.Options</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optFirstOrder"><span class="hs-identifier">optFirstOrder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Either.html"><span class="hs-identifier">Agda.Utils.Either</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Function.html"><span class="hs-identifier">Agda.Utils.Function</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.List.html"><span class="hs-identifier">Agda.Utils.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier">downFrom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.ListInf.html"><span class="hs-identifier">Agda.Utils.ListInf</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ListInf</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Maybe.html"><span class="hs-identifier">Agda.Utils.Maybe</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html"><span class="hs-identifier">Agda.Utils.Monad</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Null.html"><span class="hs-identifier">Agda.Utils.Null</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Permutation.html"><span class="hs-identifier">Agda.Utils.Permutation</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html"><span class="hs-identifier">Agda.Syntax.Common.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier">prettyShow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Size.html"><span class="hs-identifier">Agda.Utils.Size</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html"><span class="hs-identifier">Agda.Utils.VarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier">VarSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html"><span class="hs-identifier">Agda.Utils.VarSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VarSet</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Zip.html"><span class="hs-identifier">Agda.Utils.Zip</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html"><span class="hs-identifier">Agda.Utils.Impossible</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-69"></span><span class="annot"><span class="hs-comment">-- * MetaOccursCheck: going into definitions to exclude cyclic solutions</span></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">{- To address issue 585 (meta var occurrences in mutual defs)

data B : Set where
  inn : A -&gt; B

out : B -&gt; A
out (inn a) = a

postulate
  P : (y : A) (z : Unit -&gt; B) &#8594; Set
  p : (x : Unit -&gt; B) &#8594; P (out (x unit)) x

mutual
  d : Unit -&gt; B
  d unit = inn _           -- Y

  g : P (out (d unit)) d
  g = p _             -- X

-- Agda solves  d unit = inn (out (d unit))
--
-- out (X unit) = out (d unit) = out (inn Y) = Y
-- X = d

When doing the occurs check on d, we need to look at the definition of
d to discover that it mentions X.

To this end, we extend the state by names of definitions that have to
be checked when they occur.  At the beginning, this is initialized
with the names in the current mutual block.  Each time we encounter a
name in the list during occurs check, we delete it (if check is
successful).  This way, we do not duplicate work.

-}</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#modifyOccursCheckDefs"><span class="hs-identifier hs-type">modifyOccursCheckDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span id="modifyOccursCheckDefs"><span class="annot"><span class="annottext">modifyOccursCheckDefs :: (Set QName -&gt; Set QName) -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#modifyOccursCheckDefs"><span class="hs-identifier hs-var hs-var">modifyOccursCheckDefs</span></a></span></span><span> </span><span id="local-6989586621682056782"><span class="annot"><span class="annottext">Set QName -&gt; Set QName
</span><a href="#local-6989586621682056782"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; f (Set QName)) -&gt; TCState -&gt; f TCState
Lens' TCState (Set QName)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOccursCheckDefs"><span class="hs-identifier hs-var">stOccursCheckDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Set QName) -&gt; (Set QName -&gt; Set QName) -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCState m =&gt;
Lens' TCState a -&gt; (a -&gt; a) -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Base.html#modifyTCLens"><span class="hs-operator hs-var">`modifyTCLens`</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Set QName
</span><a href="#local-6989586621682056782"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | Set the names of definitions to be looked at</span><span>
</span><span id="line-110"></span><span class="hs-comment">--   to the defs in the current mutual block.</span><span>
</span><span id="line-111"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#initOccursCheck"><span class="hs-identifier hs-type">initOccursCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MetaVariable"><span class="hs-identifier hs-type">MetaVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span id="initOccursCheck"><span class="annot"><span class="annottext">initOccursCheck :: MetaVariable -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#initOccursCheck"><span class="hs-identifier hs-var hs-var">initOccursCheck</span></a></span></span><span> </span><span id="local-6989586621682056788"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682056788"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; Set QName) -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#modifyOccursCheckDefs"><span class="hs-identifier hs-var">modifyOccursCheckDefs</span></a></span><span> </span><span class="annot"><span class="annottext">((Set QName -&gt; Set QName) -&gt; TCM ())
-&gt; (Set QName -&gt; Set QName -&gt; Set QName) -&gt; Set QName -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; TCM ()) -&gt; TCMT IO (Set QName) -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaInfo -&gt; RunMetaOccursCheck
</span><a href="Agda.TypeChecking.Monad.Base.html#miMetaOccursCheck"><span class="hs-identifier hs-var">miMetaOccursCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaVariable -&gt; MetaInfo
</span><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var">mvInfo</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682056788"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMetaOccursCheck -&gt; RunMetaOccursCheck -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RunMetaOccursCheck
</span><a href="Agda.TypeChecking.Monad.Base.html#DontRunMetaOccursCheck"><span class="hs-identifier hs-var">DontRunMetaOccursCheck</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>   </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>     </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; String -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCM ()) -&gt; String -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-116"></span><span>       </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initOccursCheck: we do not look into definitions&quot;</span></span><span>
</span><span id="line-117"></span><span>     </span><span class="annot"><span class="annottext">Set QName -&gt; TCMT IO (Set QName)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Set QName
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-118"></span><span>   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>     </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; String -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCM ()) -&gt; String -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-120"></span><span>       </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initOccursCheck: we look into the following definitions:&quot;</span></span><span>
</span><span id="line-121"></span><span>     </span><span id="local-6989586621682056797"><span class="annot"><a href="#local-6989586621682056797"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCEnv -&gt; Maybe MutualId) -&gt; TCMT IO (Maybe MutualId)
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; (TCEnv -&gt; a) -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-var">asksTC</span></a></span><span> </span><span class="annot"><span class="annottext">TCEnv -&gt; Maybe MutualId
</span><a href="Agda.TypeChecking.Monad.Base.html#envMutualBlock"><span class="hs-identifier hs-var">envMutualBlock</span></a></span><span>
</span><span id="line-122"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682056797"><span class="hs-identifier hs-type">mb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-123"></span><span>       </span><span class="annot"><span class="annottext">Maybe MutualId
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; String -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCM ()) -&gt; String -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(none)&quot;</span></span><span>
</span><span id="line-125"></span><span>         </span><span class="annot"><span class="annottext">Set QName -&gt; TCMT IO (Set QName)
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Set QName
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-126"></span><span>       </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682056800"><span class="annot"><span class="annottext">MutualId
</span><a href="#local-6989586621682056800"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>         </span><span id="local-6989586621682056801"><span class="annot"><a href="#local-6989586621682056801"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutualBlock -&gt; Set QName
</span><a href="Agda.TypeChecking.Monad.Base.html#mutualNames"><span class="hs-identifier hs-var">mutualNames</span></a></span><span> </span><span class="annot"><span class="annottext">(MutualBlock -&gt; Set QName)
-&gt; TCMT IO MutualBlock -&gt; TCMT IO (Set QName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MutualId -&gt; TCMT IO MutualBlock
forall (tcm :: * -&gt; *).
ReadTCState tcm =&gt;
MutualId -&gt; tcm MutualBlock
</span><a href="Agda.TypeChecking.Monad.Mutual.html#lookupMutualBlock"><span class="hs-identifier hs-var">lookupMutualBlock</span></a></span><span> </span><span class="annot"><span class="annottext">MutualId
</span><a href="#local-6989586621682056800"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-128"></span><span>         </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#sep"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.toList</span></span><span> </span><span class="annot"><a href="#local-6989586621682056801"><span class="hs-identifier hs-type">ds</span></a></span><span>
</span><span id="line-129"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682056801"><span class="hs-identifier hs-type">ds</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><span class="hs-comment">-- | Is a def in the list of stuff to be checked?</span></span><span>
</span><span id="line-133"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#defNeedsChecking"><span class="hs-identifier hs-type">defNeedsChecking</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-134"></span><span id="defNeedsChecking"><span class="annot"><span class="annottext">defNeedsChecking :: QName -&gt; TCM Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#defNeedsChecking"><span class="hs-identifier hs-var hs-var">defNeedsChecking</span></a></span></span><span> </span><span id="local-6989586621682056810"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682056810"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682056810"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; Bool) -&gt; TCMT IO (Set QName) -&gt; TCM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Lens' TCState (Set QName) -&gt; TCMT IO (Set QName)
forall (m :: * -&gt; *) a. ReadTCState m =&gt; Lens' TCState a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#useTC"><span class="hs-identifier hs-var">useTC</span></a></span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; f (Set QName)) -&gt; TCState -&gt; f TCState
Lens' TCState (Set QName)
</span><a href="Agda.TypeChecking.Monad.Base.html#stOccursCheckDefs"><span class="hs-identifier hs-var">stOccursCheckDefs</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><span class="hs-comment">-- | Remove a def from the list of defs to be looked at.</span></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#tallyDef"><span class="hs-identifier hs-type">tallyDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span id="tallyDef"><span class="annot"><span class="annottext">tallyDef :: QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#tallyDef"><span class="hs-identifier hs-var hs-var">tallyDef</span></a></span></span><span> </span><span id="local-6989586621682056816"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682056816"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set QName -&gt; Set QName) -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#modifyOccursCheckDefs"><span class="hs-identifier hs-var">modifyOccursCheckDefs</span></a></span><span> </span><span class="annot"><span class="annottext">((Set QName -&gt; Set QName) -&gt; TCM ())
-&gt; (Set QName -&gt; Set QName) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682056816"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-141"></span><span class="annot"><span class="hs-comment">-- * OccursM monad and its services</span></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><span class="hs-comment">-- | Extra environment for the occurs check.  (Complements 'FreeEnv'.)</span></span><span>
</span><span id="line-144"></span><span class="hs-keyword">data</span><span> </span><span id="OccursExtra"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursExtra"><span class="hs-identifier hs-var">OccursExtra</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OccursExtra"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursExtra"><span class="hs-identifier hs-var">OccursExtra</span></a></span></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="occUnfold"><span class="annot"><span class="annottext">OccursExtra -&gt; UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occUnfold"><span class="hs-identifier hs-var hs-var">occUnfold</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#UnfoldStrategy"><span class="hs-identifier hs-type">UnfoldStrategy</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="occMeta"><span class="annot"><span class="annottext">OccursExtra -&gt; MetaId
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occMeta"><span class="hs-identifier hs-var hs-var">occMeta</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ The meta @m@ we want to solve.</span></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="occVars"><span class="annot"><span class="annottext">OccursExtra -&gt; VarMap
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occVars"><span class="hs-identifier hs-var hs-var">occVars</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#VarMap"><span class="hs-identifier hs-type">VarMap</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ The allowed variables @xs@ with their variance.</span></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="occRHS"><span class="annot"><span class="annottext">OccursExtra -&gt; Term
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occRHS"><span class="hs-identifier hs-var hs-var">occRHS</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ The proposed solution @v@ for the meta (@m xs := v@).</span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="occCxtSize"><span class="annot"><span class="annottext">OccursExtra -&gt; Nat
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occCxtSize"><span class="hs-identifier hs-var hs-var">occCxtSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ The size of the typing context upon invocation.</span></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">type</span><span> </span><span id="OccursCtx"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursCtx"><span class="hs-identifier hs-var">OccursCtx</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#FreeEnv%27"><span class="hs-identifier hs-type">FreeEnv'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursExtra"><span class="hs-identifier hs-type">OccursExtra</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AllowedVar"><span class="hs-identifier hs-type">AllowedVar</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">type</span><span> </span><span id="OccursM"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-var">OccursM</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursCtx"><span class="hs-identifier hs-type">OccursCtx</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><span class="hs-comment">-- ** Modality handling.</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><span class="hs-comment">-- | The passed modality is the one of the current context.</span></span><span>
</span><span id="line-158"></span><span class="hs-keyword">type</span><span> </span><span id="AllowedVar"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AllowedVar"><span class="hs-identifier hs-var">AllowedVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Modality"><span class="hs-identifier hs-type">Modality</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">All</span></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#IsVarSet"><span class="hs-identifier hs-type">IsVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AllowedVar"><span class="hs-identifier hs-type">AllowedVar</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621682056849"><span class="annot"><span class="annottext">withVarOcc :: VarOcc' () -&gt; AllowedVar -&gt; AllowedVar
</span><a href="#local-6989586621682056849"><span class="hs-identifier hs-var hs-var hs-var">withVarOcc</span></a></span></span><span> </span><span id="local-6989586621682056851"><span class="annot"><span class="annottext">VarOcc' ()
</span><a href="#local-6989586621682056851"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682056852"><span class="annot"><span class="annottext">AllowedVar
</span><a href="#local-6989586621682056852"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AllowedVar
</span><a href="#local-6989586621682056852"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">AllowedVar -&gt; (Modality -&gt; Modality) -&gt; AllowedVar
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Modality
</span><a href="Agda.Syntax.Common.html#composeModality"><span class="hs-identifier hs-var">composeModality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarOcc' () -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">VarOcc' ()
</span><a href="#local-6989586621682056851"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | Check whether a free variable is allowed in the context as</span><span>
</span><span id="line-164"></span><span class="hs-comment">--   specified by the modality.</span><span>
</span><span id="line-165"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#variableCheck"><span class="hs-identifier hs-type">variableCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#VarMap"><span class="hs-identifier hs-type">VarMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#Variable"><span class="hs-identifier hs-type">Variable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AllowedVar"><span class="hs-identifier hs-type">AllowedVar</span></a></span><span>
</span><span id="line-166"></span><span id="variableCheck"><span class="annot"><span class="annottext">variableCheck :: VarMap -&gt; Maybe Nat -&gt; AllowedVar
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#variableCheck"><span class="hs-identifier hs-var hs-var">variableCheck</span></a></span></span><span> </span><span id="local-6989586621682056857"><span class="annot"><span class="annottext">VarMap
</span><a href="#local-6989586621682056857"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682056858"><span class="annot"><span class="annottext">Maybe Nat
</span><a href="#local-6989586621682056858"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span id="local-6989586621682056859"><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682056859"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; All
</span><span class="hs-identifier hs-var">All</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; All) -&gt; Bool -&gt; All
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-comment">-- Bound variables are always allowed to occur:</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><span class="annottext">Maybe Nat -&gt; Bool -&gt; (Nat -&gt; Bool) -&gt; Bool
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Nat
</span><a href="#local-6989586621682056858"><span class="hs-identifier hs-var">mi</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">((Nat -&gt; Bool) -&gt; Bool) -&gt; (Nat -&gt; Bool) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682056862"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682056862"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-comment">-- Free variables not listed in @xs@ are forbidden:</span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="annottext">Maybe (VarOcc' MetaSet)
-&gt; Bool -&gt; (VarOcc' MetaSet -&gt; Bool) -&gt; Bool
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; VarMap -&gt; Maybe (VarOcc' MetaSet)
forall a. Nat -&gt; VarMap' a -&gt; Maybe (VarOcc' a)
</span><a href="Agda.TypeChecking.Free.Lazy.html#lookupVarMap"><span class="hs-identifier hs-var">lookupVarMap</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682056862"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">VarMap
</span><a href="#local-6989586621682056857"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">((VarOcc' MetaSet -&gt; Bool) -&gt; Bool)
-&gt; (VarOcc' MetaSet -&gt; Bool) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682056864"><span class="annot"><span class="annottext">VarOcc' MetaSet
</span><a href="#local-6989586621682056864"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-comment">-- For listed variables it holds:</span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-comment">-- The ascribed modality @o@ must be submodality of the</span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-comment">-- modality @q@ of the current context.</span><span>
</span><span id="line-174"></span><span>      </span><span class="hs-comment">-- E.g. irrelevant variables (ascribed, lhs) can only</span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-comment">-- be used in irrelevant position (rhs).</span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><span class="annottext">VarOcc' MetaSet -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">VarOcc' MetaSet
</span><a href="#local-6989586621682056864"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Modality -&gt; Bool
</span><a href="Agda.Syntax.Common.html#moreUsableModality"><span class="hs-operator hs-var">`moreUsableModality`</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682056859"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Occurs check fails if a defined name is not available</span><span>
</span><span id="line-179"></span><span class="hs-comment">--   since it was declared in irrelevant or erased context.</span><span>
</span><span id="line-180"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#definitionCheck"><span class="hs-identifier hs-type">definitionCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span id="definitionCheck"><span class="annot"><span class="annottext">definitionCheck :: QName -&gt; OccursM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#definitionCheck"><span class="hs-identifier hs-var hs-var">definitionCheck</span></a></span></span><span> </span><span id="local-6989586621682056867"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682056867"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621682056868"><span class="annot"><a href="#local-6989586621682056868"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) OccursCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682056869"><span class="annot"><a href="#local-6989586621682056869"><span class="hs-identifier hs-var hs-var">irr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-var">isIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682056868"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span id="local-6989586621682056871"><span class="annot"><a href="#local-6989586621682056871"><span class="hs-identifier hs-var hs-var">er</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; Bool
forall a. LensQuantity a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#hasQuantity0"><span class="hs-identifier hs-var">hasQuantity0</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682056868"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-185"></span><span>      </span><span id="local-6989586621682056873"><span class="annot"><a href="#local-6989586621682056873"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursExtra -&gt; MetaId
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occMeta"><span class="hs-identifier hs-var">occMeta</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; MetaId) -&gt; OccursExtra -&gt; MetaId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682056868"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-comment">-- Anything goes if we are both irrelevant and erased.</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-comment">-- Otherwise, have to check the modality of the defined name.</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056869"><span class="hs-identifier hs-type">irr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621682056871"><span class="hs-identifier hs-type">er</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo%27"><span class="hs-identifier hs-type">getConstInfo'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056867"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-189"></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">SigError
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-comment">-- Andreas, 2021-07-29.</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-comment">-- The definition is not in scope.</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-comment">-- This shouldn't happen, but does so in issue #5492.</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-comment">-- Let's bail out...</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="annottext">Blocker -&gt; Nat -&gt; String -&gt; OccursM ()
forall (m :: * -&gt; *) a.
MonadTCM m =&gt;
Blocker -&gt; Nat -&gt; String -&gt; m a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#patternViolation%27"><span class="hs-identifier hs-var">patternViolation'</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#alwaysUnblock"><span class="hs-identifier hs-var">alwaysUnblock</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">35</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; OccursM ()) -&gt; String -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;occursCheck: definition&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682056867"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not in scope&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621682056881"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682056881"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682056882"><span class="annot"><span class="annottext">dmod :: Modality
</span><a href="#local-6989586621682056882"><span class="hs-identifier hs-var hs-var hs-var">dmod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621682056881"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; OccursM () -&gt; OccursM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682056869"><span class="hs-identifier hs-var">irr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#usableRelevance"><span class="hs-identifier hs-var">usableRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682056882"><span class="hs-identifier hs-var">dmod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OccursM () -&gt; OccursM ()) -&gt; OccursM () -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; OccursM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">35</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; OccursM ()) -&gt; TCMT IO Doc -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;occursCheck: definition&quot;</span></span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682056867"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;has relevance&quot;</span></span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc)
-&gt; (Relevance -&gt; String) -&gt; Relevance -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Relevance -&gt; TCMT IO Doc) -&gt; Relevance -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682056882"><span class="hs-identifier hs-var">dmod</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><span class="annottext">Blocker -&gt; TypeError -&gt; OccursM ()
forall a. Blocker -&gt; TypeError -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#abort"><span class="hs-identifier hs-var">abort</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; OccursM ()) -&gt; TypeError -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#MetaIrrelevantSolution"><span class="hs-identifier hs-var">MetaIrrelevantSolution</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682056873"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TypeError) -&gt; Term -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursExtra -&gt; Term
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occRHS"><span class="hs-identifier hs-var">occRHS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; Term) -&gt; OccursExtra -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682056868"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; OccursM () -&gt; OccursM ()
forall b (m :: * -&gt; *). (IsBool b, Monad m) =&gt; b -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682056871"><span class="hs-identifier hs-var">er</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Bool
forall a. LensQuantity a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#usableQuantity"><span class="hs-identifier hs-var">usableQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682056882"><span class="hs-identifier hs-var">dmod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OccursM () -&gt; OccursM ()) -&gt; OccursM () -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; OccursM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">35</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; OccursM ()) -&gt; TCMT IO Doc -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;occursCheck: definition&quot;</span></span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682056867"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;has quantity&quot;</span></span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc)
-&gt; (Quantity -&gt; String) -&gt; Quantity -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Quantity -&gt; TCMT IO Doc) -&gt; Quantity -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Modality -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682056882"><span class="hs-identifier hs-var">dmod</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">Blocker -&gt; TypeError -&gt; OccursM ()
forall a. Blocker -&gt; TypeError -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#abort"><span class="hs-identifier hs-var">abort</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; OccursM ()) -&gt; TypeError -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#MetaErasedSolution"><span class="hs-identifier hs-var">MetaErasedSolution</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682056873"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TypeError) -&gt; Term -&gt; TypeError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursExtra -&gt; Term
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occRHS"><span class="hs-identifier hs-var">occRHS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; Term) -&gt; OccursExtra -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682056868"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaCheck"><span class="hs-identifier hs-type">metaCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span>
</span><span id="line-216"></span><span id="metaCheck"><span class="annot"><span class="annottext">metaCheck :: MetaId -&gt; OccursM MetaId
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaCheck"><span class="hs-identifier hs-var hs-var">metaCheck</span></a></span></span><span> </span><span id="local-6989586621682056896"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682056896"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>  </span><span id="local-6989586621682056897"><span class="annot"><a href="#local-6989586621682056897"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) OccursCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682056898"><span class="annot"><a href="#local-6989586621682056898"><span class="hs-identifier hs-var hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; Relevance
forall a. LensRelevance a =&gt; a -&gt; Relevance
</span><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-var">getRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682056897"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-219"></span><span>      </span><span id="local-6989586621682056899"><span class="annot"><a href="#local-6989586621682056899"><span class="hs-identifier hs-var hs-var">qnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; Quantity
forall a. LensQuantity a =&gt; a -&gt; Quantity
</span><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-var">getQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682056897"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-220"></span><span>      </span><span id="local-6989586621682056900"><span class="annot"><a href="#local-6989586621682056900"><span class="hs-identifier hs-var hs-var">m0</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursExtra -&gt; MetaId
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occMeta"><span class="hs-identifier hs-var">occMeta</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; MetaId) -&gt; OccursExtra -&gt; MetaId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682056897"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-comment">-- Check for loop</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-comment">--   don't fail hard on this, since we might still be on the top-level</span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-comment">--   after some killing (Issue 442)</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-comment">-- Andreas, 2013-02-18  Issue 795 demonstrates that a recursive</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-comment">-- occurrence of a meta could be solved by the identity.</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-comment">--   ? (Q A) = Q (? A)</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-comment">-- So, do not throw an error.</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-comment">-- I guess the error was there from times when occurrence check</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-comment">-- was done after the &quot;lhs=linear variables&quot; check, but now</span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-comment">-- occurrence check comes first.</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-comment">-- WAS:</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-comment">-- when (m == m') $ if ctx == Top then patternViolation else</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-comment">--   abort ctx $ MetaOccursInItself m'</span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-comment">-- Andreas, 2024-09-28: removed error MetaOccursInItself from code base.</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="#local-6989586621682056900"><span class="hs-identifier hs-type">m0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#patternViolation%27"><span class="hs-identifier hs-type">patternViolation'</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-type">neverUnblock</span></a></span><span> </span><span class="annot"><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;occursCheck failed: Found &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621682056902"><span class="annot"><a href="#local-6989586621682056902"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta"><span class="hs-identifier hs-type">lookupLocalMeta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682056904"><span class="annot"><a href="#local-6989586621682056904"><span class="hs-identifier hs-var hs-var">mmod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682056902"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-241"></span><span>      </span><span id="local-6989586621682056905"><span class="annot"><a href="#local-6989586621682056905"><span class="hs-identifier hs-var hs-var">mmod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; Modality -&gt; Modality
forall a. LensRelevance a =&gt; Relevance -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setRelevance"><span class="hs-identifier hs-var">setRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="#local-6989586621682056898"><span class="hs-identifier hs-var">rel</span></a></span><span> </span><span class="annot"><span class="annottext">(Modality -&gt; Modality) -&gt; Modality -&gt; Modality
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Modality -&gt; Modality
forall a. LensQuantity a =&gt; Quantity -&gt; a -&gt; a
</span><a href="Agda.Syntax.Common.html#setQuantity"><span class="hs-identifier hs-var">setQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621682056899"><span class="hs-identifier hs-var">qnt</span></a></span><span> </span><span class="annot"><span class="annottext">(Modality -&gt; Modality) -&gt; Modality -&gt; Modality
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682056904"><span class="hs-identifier hs-var">mmod</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056904"><span class="hs-identifier hs-type">mmod</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#moreUsableModality"><span class="hs-operator hs-type">`moreUsableModality`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056905"><span class="hs-identifier hs-type">mmod'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">35</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#hsep"><span class="hs-identifier hs-type">hsep</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;occursCheck: meta variable&quot;</span></span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-246"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;has relevance&quot;</span></span><span>
</span><span id="line-247"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#getRelevance"><span class="hs-identifier hs-type">getRelevance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056904"><span class="hs-identifier hs-type">mmod</span></a></span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;and quantity&quot;</span></span><span>
</span><span id="line-249"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#getQuantity"><span class="hs-identifier hs-type">getQuantity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056904"><span class="hs-identifier hs-type">mmod</span></a></span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621682056908"><span class="annot"><a href="#local-6989586621682056908"><span class="hs-identifier hs-var">allowAssign</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envAssignMetas"><span class="hs-identifier hs-var">envAssignMetas</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-comment">-- Jesper, 2020-11-10: if we encounter a metavariable that is</span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-comment">-- unusable because of its modality (e.g. irrelevant or erased) we</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-comment">-- try to *promote* the meta to the required modality, by creating</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">-- a new meta with that modality and solving the old one with</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-comment">-- it. Don't do this if the meta occurs in a flexible or unguarded</span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">-- position:</span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-comment">-- - If it is in a flexible position, it could disappear when</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-comment">--   another meta is solved, so promotion is maybe not necessary.</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-comment">-- - If it is in a top-level position, we can instead solve the</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-comment">--   equation by instantiating the other way around, so promotion</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-comment">--   is not necessary.</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-comment">-- Actually, this is not the case anymore, no new meta is created and</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-comment">-- instead the metavar itself gets modified with the new modality.</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682056910"><span class="annot"><a href="#local-6989586621682056910"><span class="hs-identifier hs-var hs-var">fail</span></a></span></span><span> </span><span id="local-6989586621682056911"><span class="annot"><span class="annottext">TCMT IO Doc
</span><a href="#local-6989586621682056911"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; OccursM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; OccursM ()) -&gt; TCMT IO Doc -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Meta occurs check found bad relevance&quot;</span></span><span>
</span><span id="line-268"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; OccursM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; OccursM ()) -&gt; TCMT IO Doc -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;aborting because&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><a href="#local-6989586621682056911"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-269"></span><span>          </span><span class="annot"><span class="annottext">Blocker -&gt; OccursM ()
forall a. Blocker -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. MonadBlock m =&gt; Blocker -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#patternViolation"><span class="hs-identifier hs-var">patternViolation</span></a></span><span> </span><span class="annot"><span class="annottext">(Blocker -&gt; OccursM ()) -&gt; Blocker -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#unblockOnMeta"><span class="hs-identifier hs-var">unblockOnMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682056896"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#mvFrozen"><span class="hs-identifier hs-var">mvFrozen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056902"><span class="hs-identifier hs-type">mv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Frozen"><span class="hs-identifier hs-type">Frozen</span></a></span><span class="hs-special">)</span><span>             </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682056910"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;meta is frozen&quot;</span></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#unless"><span class="hs-identifier hs-type">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#isOpenMeta"><span class="hs-identifier hs-type">isOpenMeta</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#mvInstantiation"><span class="hs-identifier hs-var">mvInstantiation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056902"><span class="hs-identifier hs-type">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682056910"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;meta is already solved&quot;</span></span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#unlessM"><span class="hs-identifier hs-type">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envAssignMetas"><span class="hs-identifier hs-var">envAssignMetas</span></a></span><span class="hs-special">)</span><span>          </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682056910"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;assigning metas is not allowed here&quot;</span></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-comment">-- Jesper, 2023-09-03, issue #6759: When --lossy-unification is enabled,</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-comment">-- we already lose the guarantee that we only throw an error when a</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-comment">-- problem is really unsolvable in favor of taking the &quot;obvious&quot; solution.</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-comment">-- In this case the &quot;obvious&quot; solution is to promote the meta even if</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-comment">-- it is in a flexible position, so that is what we do.</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-type">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#isFlexible"><span class="hs-identifier hs-type">isFlexible</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056897"><span class="hs-identifier hs-type">cxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Utils.Monad.html#and2M"><span class="hs-operator hs-type">`and2M`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.Base.html#optFirstOrder"><span class="hs-identifier hs-type">optFirstOrder</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.Interaction.Options.HasOptions.html#pragmaOptions"><span class="hs-identifier hs-type">pragmaOptions</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>                                             </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682056910"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;occurrence is flexible&quot;</span></span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#isUnguarded"><span class="hs-identifier hs-type">isUnguarded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056897"><span class="hs-identifier hs-type">cxt</span></a></span><span class="hs-special">)</span><span>                   </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621682056910"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;occurrence is unguarded&quot;</span></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Promoting meta&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;to modality&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056905"><span class="hs-identifier hs-type">mmod'</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-comment">-- The meta gets updated here</span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#updateMetaVar"><span class="hs-identifier hs-type">updateMetaVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682056927"><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682056927"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682056927"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var">mvInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#setModality"><span class="hs-identifier hs-type">setModality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056905"><span class="hs-identifier hs-type">mmod'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var">mvInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056927"><span class="hs-identifier hs-type">mv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#etaExpandListeners"><span class="hs-identifier hs-type">etaExpandListeners</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Constraints.html#wakeupConstraints"><span class="hs-identifier hs-type">wakeupConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682056896"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-comment">-- | Construct a test whether a de Bruijn index is allowed</span><span>
</span><span id="line-290"></span><span class="hs-comment">--   or needs to be pruned.</span><span>
</span><span id="line-291"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#allowedVars"><span class="hs-identifier hs-type">allowedVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span id="allowedVars"><span class="annot"><span class="annottext">allowedVars :: OccursM (Nat -&gt; Bool)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#allowedVars"><span class="hs-identifier hs-var hs-var">allowedVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-comment">-- @n@ is the number of binders we have stepped under.</span><span>
</span><span id="line-294"></span><span>  </span><span id="local-6989586621682056932"><span class="annot"><a href="#local-6989586621682056932"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; Nat -&gt; Nat)
-&gt; ReaderT OccursCtx (TCMT IO) Nat
-&gt; ReaderT OccursCtx (TCMT IO) Nat
-&gt; ReaderT OccursCtx (TCMT IO) Nat
forall (m :: * -&gt; *) a1 a2 r.
Monad m =&gt;
(a1 -&gt; a2 -&gt; r) -&gt; m a1 -&gt; m a2 -&gt; m r
</span><span class="hs-identifier hs-var">liftM2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) Nat
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Nat
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextSize"><span class="hs-identifier hs-var">getContextSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OccursCtx -&gt; Nat) -&gt; ReaderT OccursCtx (TCMT IO) Nat
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccursExtra -&gt; Nat
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occCxtSize"><span class="hs-identifier hs-var">occCxtSize</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; Nat)
-&gt; (OccursCtx -&gt; OccursExtra) -&gt; OccursCtx -&gt; Nat
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>  </span><span id="local-6989586621682056935"><span class="annot"><a href="#local-6989586621682056935"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#theVarMap"><span class="hs-identifier hs-var">theVarMap</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occVars"><span class="hs-identifier hs-var">occVars</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-comment">-- Bound variables are allowed, and those mentioned in occVars.</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682056937"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682056937"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682056937"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682056932"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682056937"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682056932"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; TheVarMap' MetaSet -&gt; Bool
forall a. Nat -&gt; IntMap a -&gt; Bool
</span><span class="hs-operator hs-var">`IntMap.member`</span></span><span> </span><span class="annot"><span class="annottext">TheVarMap' MetaSet
</span><a href="#local-6989586621682056935"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><span class="hs-comment">-- ** Unfolding during occurs check.</span></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- | Unfold definitions during occurs check?</span><span>
</span><span id="line-302"></span><span class="hs-comment">--   This effectively runs the occurs check on the normal form.</span><span>
</span><span id="line-303"></span><span class="hs-keyword">data</span><span> </span><span id="UnfoldStrategy"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#UnfoldStrategy"><span class="hs-identifier hs-var">UnfoldStrategy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="YesUnfold"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#YesUnfold"><span class="hs-identifier hs-var">YesUnfold</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="NoUnfold"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#NoUnfold"><span class="hs-identifier hs-var">NoUnfold</span></a></span></span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682056943"><span id="local-6989586621682056948"><span class="annot"><span class="annottext">UnfoldStrategy -&gt; UnfoldStrategy -&gt; Bool
(UnfoldStrategy -&gt; UnfoldStrategy -&gt; Bool)
-&gt; (UnfoldStrategy -&gt; UnfoldStrategy -&gt; Bool) -&gt; Eq UnfoldStrategy
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: UnfoldStrategy -&gt; UnfoldStrategy -&gt; Bool
== :: UnfoldStrategy -&gt; UnfoldStrategy -&gt; Bool
$c/= :: UnfoldStrategy -&gt; UnfoldStrategy -&gt; Bool
/= :: UnfoldStrategy -&gt; UnfoldStrategy -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056953"><span id="local-6989586621682056955"><span id="local-6989586621682056959"><span class="annot"><span class="annottext">Nat -&gt; UnfoldStrategy -&gt; String -&gt; String
[UnfoldStrategy] -&gt; String -&gt; String
UnfoldStrategy -&gt; String
(Nat -&gt; UnfoldStrategy -&gt; String -&gt; String)
-&gt; (UnfoldStrategy -&gt; String)
-&gt; ([UnfoldStrategy] -&gt; String -&gt; String)
-&gt; Show UnfoldStrategy
forall a.
(Nat -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Nat -&gt; UnfoldStrategy -&gt; String -&gt; String
showsPrec :: Nat -&gt; UnfoldStrategy -&gt; String -&gt; String
$cshow :: UnfoldStrategy -&gt; String
show :: UnfoldStrategy -&gt; String
$cshowList :: [UnfoldStrategy] -&gt; String -&gt; String
showList :: [UnfoldStrategy] -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span id="local-6989586621682056070"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#defArgs"><span class="hs-identifier hs-type">defArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056070"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056070"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-307"></span><span id="defArgs"><span class="annot"><span class="annottext">defArgs :: forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#defArgs"><span class="hs-identifier hs-var hs-var">defArgs</span></a></span></span><span> </span><span id="local-6989586621682056966"><span class="annot"><span class="annottext">OccursM a
</span><a href="#local-6989586621682056966"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccursCtx -&gt; UnfoldStrategy)
-&gt; ReaderT OccursCtx (TCMT IO) UnfoldStrategy
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccursExtra -&gt; UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occUnfold"><span class="hs-identifier hs-var">occUnfold</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; UnfoldStrategy)
-&gt; (OccursCtx -&gt; OccursExtra) -&gt; OccursCtx -&gt; UnfoldStrategy
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) UnfoldStrategy
-&gt; (UnfoldStrategy -&gt; OccursM a) -&gt; OccursM a
forall a b.
ReaderT OccursCtx (TCMT IO) a
-&gt; (a -&gt; ReaderT OccursCtx (TCMT IO) b)
-&gt; ReaderT OccursCtx (TCMT IO) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#NoUnfold"><span class="hs-identifier hs-var">NoUnfold</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccursM a -&gt; OccursM a
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-var">flexibly</span></a></span><span> </span><span class="annot"><span class="annottext">OccursM a
</span><a href="#local-6989586621682056966"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#YesUnfold"><span class="hs-identifier hs-var">YesUnfold</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccursM a -&gt; OccursM a
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#weakly"><span class="hs-identifier hs-var">weakly</span></a></span><span> </span><span class="annot"><span class="annottext">OccursM a
</span><a href="#local-6989586621682056966"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="hs-comment">-- | For a path constructor `c : ... -&gt; Path D a b`, we have that e.g. `c es i0` reduces to `a`.</span><span>
</span><span id="line-312"></span><span class="hs-comment">--   So we have to consider its arguments as flexible when we do not actually unfold.</span><span>
</span><span id="line-313"></span><span id="local-6989586621682056073"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#conArgs"><span class="hs-identifier hs-type">conArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056073"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056073"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-314"></span><span id="conArgs"><span class="annot"><span class="annottext">conArgs :: forall a. Elims -&gt; OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#conArgs"><span class="hs-identifier hs-var hs-var">conArgs</span></a></span></span><span> </span><span id="local-6989586621682056974"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682056974"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span id="local-6989586621682056975"><span class="annot"><span class="annottext">OccursM a
</span><a href="#local-6989586621682056975"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccursCtx -&gt; UnfoldStrategy)
-&gt; ReaderT OccursCtx (TCMT IO) UnfoldStrategy
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccursExtra -&gt; UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occUnfold"><span class="hs-identifier hs-var">occUnfold</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; UnfoldStrategy)
-&gt; (OccursCtx -&gt; OccursExtra) -&gt; OccursCtx -&gt; UnfoldStrategy
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) UnfoldStrategy
-&gt; (UnfoldStrategy -&gt; OccursM a) -&gt; OccursM a
forall a b.
ReaderT OccursCtx (TCMT IO) a
-&gt; (a -&gt; ReaderT OccursCtx (TCMT IO) b)
-&gt; ReaderT OccursCtx (TCMT IO) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-315"></span><span>  </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#YesUnfold"><span class="hs-identifier hs-var">YesUnfold</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccursM a
</span><a href="#local-6989586621682056975"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#NoUnfold"><span class="hs-identifier hs-var">NoUnfold</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[()] -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682056974"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-317"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccursM a
</span><a href="#local-6989586621682056975"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-318"></span><span>  </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#NoUnfold"><span class="hs-identifier hs-var">NoUnfold</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccursM a -&gt; OccursM a
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-var">flexibly</span></a></span><span> </span><span class="annot"><span class="annottext">OccursM a
</span><a href="#local-6989586621682056975"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span id="local-6989586621682056078"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#unfoldB"><span class="hs-identifier hs-type">unfoldB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#Instantiate"><span class="hs-identifier hs-type">Instantiate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056078"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#Reduce"><span class="hs-identifier hs-type">Reduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056078"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056078"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056078"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-321"></span><span id="unfoldB"><span class="annot"><span class="annottext">unfoldB :: forall t. (Instantiate t, Reduce t) =&gt; t -&gt; OccursM (Blocked t)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#unfoldB"><span class="hs-identifier hs-var hs-var">unfoldB</span></a></span></span><span> </span><span id="local-6989586621682056994"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056994"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>  </span><span id="local-6989586621682056995"><span class="annot"><a href="#local-6989586621682056995"><span class="hs-identifier hs-var">unfold</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(OccursCtx -&gt; UnfoldStrategy)
-&gt; ReaderT OccursCtx (TCMT IO) UnfoldStrategy
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">((OccursCtx -&gt; UnfoldStrategy)
 -&gt; ReaderT OccursCtx (TCMT IO) UnfoldStrategy)
-&gt; (OccursCtx -&gt; UnfoldStrategy)
-&gt; ReaderT OccursCtx (TCMT IO) UnfoldStrategy
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursExtra -&gt; UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occUnfold"><span class="hs-identifier hs-var">occUnfold</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; UnfoldStrategy)
-&gt; (OccursCtx -&gt; OccursExtra) -&gt; OccursCtx -&gt; UnfoldStrategy
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span>
</span><span id="line-323"></span><span>  </span><span id="local-6989586621682056996"><span class="annot"><a href="#local-6989586621682056996"><span class="hs-identifier hs-var">rel</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">asks</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#feModality"><span class="hs-identifier hs-var">feModality</span></a></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682056995"><span class="hs-identifier hs-type">unfold</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#YesUnfold"><span class="hs-identifier hs-var">YesUnfold</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-var">isIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="#local-6989586621682056996"><span class="hs-identifier hs-var">rel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; ReaderT OccursCtx (TCMT IO) (Blocked t)
forall a (m :: * -&gt; *).
(Reduce a, MonadReduce m) =&gt;
a -&gt; m (Blocked a)
</span><a href="Agda.TypeChecking.Reduce.html#reduceB"><span class="hs-identifier hs-var">reduceB</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056994"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><span class="hs-identifier">_</span></span><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; Blocked t
forall a t. a -&gt; Blocked' t a
</span><a href="Agda.Syntax.Internal.Blockers.html#notBlocked"><span class="hs-identifier hs-var">notBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">(t -&gt; Blocked t)
-&gt; ReaderT OccursCtx (TCMT IO) t
-&gt; ReaderT OccursCtx (TCMT IO) (Blocked t)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; ReaderT OccursCtx (TCMT IO) t
forall a (m :: * -&gt; *). (Instantiate a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiate"><span class="hs-identifier hs-var">instantiate</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056994"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span id="local-6989586621682056097"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#unfold"><span class="hs-identifier hs-type">unfold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#Instantiate"><span class="hs-identifier hs-type">Instantiate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056097"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#Reduce"><span class="hs-identifier hs-type">Reduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056097"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056097"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056097"><span class="hs-identifier hs-type">t</span></a></span></span><span>
</span><span id="line-329"></span><span id="unfold"><span class="annot"><span class="annottext">unfold :: forall t. (Instantiate t, Reduce t) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#unfold"><span class="hs-identifier hs-var hs-var">unfold</span></a></span></span><span> </span><span id="local-6989586621682057011"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682057011"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccursCtx -&gt; UnfoldStrategy)
-&gt; ReaderT OccursCtx (TCMT IO) UnfoldStrategy
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccursExtra -&gt; UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occUnfold"><span class="hs-identifier hs-var">occUnfold</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; UnfoldStrategy)
-&gt; (OccursCtx -&gt; OccursExtra) -&gt; OccursCtx -&gt; UnfoldStrategy
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) UnfoldStrategy
-&gt; (UnfoldStrategy -&gt; ReaderT OccursCtx (TCMT IO) t)
-&gt; ReaderT OccursCtx (TCMT IO) t
forall a b.
ReaderT OccursCtx (TCMT IO) a
-&gt; (a -&gt; ReaderT OccursCtx (TCMT IO) b)
-&gt; ReaderT OccursCtx (TCMT IO) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-330"></span><span>  </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#NoUnfold"><span class="hs-identifier hs-var">NoUnfold</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; ReaderT OccursCtx (TCMT IO) t
forall a (m :: * -&gt; *). (Instantiate a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiate"><span class="hs-identifier hs-var">instantiate</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682057011"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#YesUnfold"><span class="hs-identifier hs-var">YesUnfold</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; ReaderT OccursCtx (TCMT IO) t
forall a (m :: * -&gt; *). (Reduce a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682057011"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="annot"><span class="hs-comment">-- ** Managing rigidiy during occurs check.</span></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="annot"><span class="hs-comment">-- | Leave the strongly rigid position.</span></span><span>
</span><span id="line-336"></span><span id="local-6989586621682057013"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#weakly"><span class="hs-identifier hs-type">weakly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057013"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057013"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-337"></span><span id="weakly"><span class="annot"><span class="annottext">weakly :: forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#weakly"><span class="hs-identifier hs-var hs-var">weakly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccursCtx -&gt; OccursCtx)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall a.
(OccursCtx -&gt; OccursCtx)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((OccursCtx -&gt; OccursCtx)
 -&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a)
-&gt; (OccursCtx -&gt; OccursCtx)
-&gt; ReaderT OccursCtx (TCMT IO) a
-&gt; ReaderT OccursCtx (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' OccursCtx (FlexRig' ()) -&gt; LensMap OccursCtx (FlexRig' ())
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">(FlexRig' () -&gt; f (FlexRig' ())) -&gt; OccursCtx -&gt; f OccursCtx
forall o a. LensFlexRig o a =&gt; Lens' o (FlexRig' a)
Lens' OccursCtx (FlexRig' ())
</span><a href="Agda.TypeChecking.Free.Lazy.html#lensFlexRig"><span class="hs-identifier hs-var">lensFlexRig</span></a></span><span> </span><span class="annot"><span class="annottext">LensMap OccursCtx (FlexRig' ()) -&gt; LensMap OccursCtx (FlexRig' ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FlexRig' () -&gt; FlexRig' () -&gt; FlexRig' ()
forall a. Semigroup a =&gt; FlexRig' a -&gt; FlexRig' a -&gt; FlexRig' a
</span><a href="Agda.TypeChecking.Free.Lazy.html#composeFlexRig"><span class="hs-identifier hs-var">composeFlexRig</span></a></span><span> </span><span class="annot"><span class="annottext">FlexRig' ()
forall a. FlexRig' a
</span><a href="Agda.TypeChecking.Free.Lazy.html#WeaklyRigid"><span class="hs-identifier hs-var">WeaklyRigid</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span id="local-6989586621682057023"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#strongly"><span class="hs-identifier hs-type">strongly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057023"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057023"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-340"></span><span id="strongly"><span class="annot"><span class="annottext">strongly :: forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#strongly"><span class="hs-identifier hs-var hs-var">strongly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccursCtx -&gt; OccursCtx)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall a.
(OccursCtx -&gt; OccursCtx)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((OccursCtx -&gt; OccursCtx)
 -&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a)
-&gt; (OccursCtx -&gt; OccursCtx)
-&gt; ReaderT OccursCtx (TCMT IO) a
-&gt; ReaderT OccursCtx (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' OccursCtx (FlexRig' ()) -&gt; LensMap OccursCtx (FlexRig' ())
forall o i. Lens' o i -&gt; LensMap o i
</span><a href="Agda.Utils.Lens.html#over"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">(FlexRig' () -&gt; f (FlexRig' ())) -&gt; OccursCtx -&gt; f OccursCtx
forall o a. LensFlexRig o a =&gt; Lens' o (FlexRig' a)
Lens' OccursCtx (FlexRig' ())
</span><a href="Agda.TypeChecking.Free.Lazy.html#lensFlexRig"><span class="hs-identifier hs-var">lensFlexRig</span></a></span><span> </span><span class="annot"><span class="annottext">LensMap OccursCtx (FlexRig' ()) -&gt; LensMap OccursCtx (FlexRig' ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="annottext">FlexRig' ()
</span><a href="Agda.TypeChecking.Free.Lazy.html#WeaklyRigid"><span class="hs-identifier hs-var">WeaklyRigid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlexRig' ()
forall a. FlexRig' a
</span><a href="Agda.TypeChecking.Free.Lazy.html#StronglyRigid"><span class="hs-identifier hs-var">StronglyRigid</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><span class="annottext">FlexRig' ()
</span><a href="Agda.TypeChecking.Free.Lazy.html#Unguarded"><span class="hs-identifier hs-var">Unguarded</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlexRig' ()
forall a. FlexRig' a
</span><a href="Agda.TypeChecking.Free.Lazy.html#StronglyRigid"><span class="hs-identifier hs-var">StronglyRigid</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span id="local-6989586621682057031"><span class="annot"><span class="annottext">FlexRig' ()
</span><a href="#local-6989586621682057031"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FlexRig' ()
</span><a href="#local-6989586621682057031"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span id="local-6989586621682057032"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-type">flexibly</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057032"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057032"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-346"></span><span id="flexibly"><span class="annot"><span class="annottext">flexibly :: forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-var hs-var">flexibly</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OccursCtx -&gt; OccursCtx)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall a.
(OccursCtx -&gt; OccursCtx)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((OccursCtx -&gt; OccursCtx)
 -&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a)
-&gt; (OccursCtx -&gt; OccursCtx)
-&gt; ReaderT OccursCtx (TCMT IO) a
-&gt; ReaderT OccursCtx (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lens' OccursCtx (FlexRig' ()) -&gt; LensSet OccursCtx (FlexRig' ())
forall o i. Lens' o i -&gt; LensSet o i
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">(FlexRig' () -&gt; f (FlexRig' ())) -&gt; OccursCtx -&gt; f OccursCtx
forall o a. LensFlexRig o a =&gt; Lens' o (FlexRig' a)
Lens' OccursCtx (FlexRig' ())
</span><a href="Agda.TypeChecking.Free.Lazy.html#lensFlexRig"><span class="hs-identifier hs-var">lensFlexRig</span></a></span><span> </span><span class="annot"><span class="annottext">LensSet OccursCtx (FlexRig' ()) -&gt; LensSet OccursCtx (FlexRig' ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; FlexRig' ()
forall a. a -&gt; FlexRig' a
</span><a href="Agda.TypeChecking.Free.Lazy.html#Flexible"><span class="hs-identifier hs-var">Flexible</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="annot"><span class="hs-comment">-- ** Error throwing during occurs check.</span></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span id="local-6989586621682056029"><span id="local-6989586621682056030"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#patternViolation%27"><span class="hs-identifier hs-type">patternViolation'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadTCM"><span class="hs-identifier hs-type">MonadTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056029"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056029"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056030"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-351"></span><span id="patternViolation%27"><span class="annot"><span class="annottext">patternViolation' :: forall (m :: * -&gt; *) a.
MonadTCM m =&gt;
Blocker -&gt; Nat -&gt; String -&gt; m a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#patternViolation%27"><span class="hs-identifier hs-var hs-var">patternViolation'</span></a></span></span><span> </span><span id="local-6989586621682057044"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682057044"><span class="hs-identifier hs-var">unblock</span></a></span></span><span> </span><span id="local-6989586621682057045"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682057045"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682057046"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682057046"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM a -&gt; m a
forall a. TCM a -&gt; m a
forall (tcm :: * -&gt; *) a. MonadTCM tcm =&gt; TCM a -&gt; tcm a
</span><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-var">liftTCM</span></a></span><span> </span><span class="annot"><span class="annottext">(TCM a -&gt; m a) -&gt; TCM a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; String -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682057045"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682057046"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="annottext">Blocker -&gt; TCM a
forall a. Blocker -&gt; TCMT IO a
forall (m :: * -&gt; *) a. MonadBlock m =&gt; Blocker -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#patternViolation"><span class="hs-identifier hs-var">patternViolation</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682057044"><span class="hs-identifier hs-var">unblock</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span id="local-6989586621682056036"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#abort"><span class="hs-identifier hs-type">abort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TypeError"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056036"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-356"></span><span id="abort"><span class="annot"><span class="annottext">abort :: forall a. Blocker -&gt; TypeError -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#abort"><span class="hs-identifier hs-var hs-var">abort</span></a></span></span><span> </span><span id="local-6989586621682057060"><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682057060"><span class="hs-identifier hs-var">unblock</span></a></span></span><span> </span><span id="local-6989586621682057061"><span class="annot"><span class="annottext">TypeError
</span><a href="#local-6989586621682057061"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>  </span><span id="local-6989586621682057062"><span class="annot"><a href="#local-6989586621682057062"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) OccursCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-type">isIrrelevant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057062"><span class="hs-identifier hs-type">ctx</span></a></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682057064"><span class="hs-identifier hs-type">soft</span></a></span><span>
</span><span id="line-360"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#StronglyRigid"><span class="hs-identifier hs-type">StronglyRigid</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682057062"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#lensFlexRig"><span class="hs-identifier hs-type">lensFlexRig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682057069"><span class="hs-identifier hs-type">hard</span></a></span><span>
</span><span id="line-361"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682057064"><span class="hs-identifier hs-type">soft</span></a></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-363"></span><span>  </span><span id="local-6989586621682057069"><span class="annot"><span class="annottext">hard :: TCM a
</span><a href="#local-6989586621682057069"><span class="hs-identifier hs-var hs-var">hard</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeError -&gt; TCM a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadTCError m) =&gt;
TypeError -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Base.html#typeError"><span class="hs-identifier hs-var">typeError</span></a></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="#local-6989586621682057061"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-comment">-- here, throw an uncatchable error (unsolvable constraint)</span><span>
</span><span id="line-364"></span><span>  </span><span id="local-6989586621682057064"><span class="annot"><span class="annottext">soft :: TCM a
</span><a href="#local-6989586621682057064"><span class="hs-identifier hs-var hs-var">soft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Nat -&gt; String -&gt; TCM a
forall (m :: * -&gt; *) a.
MonadTCM m =&gt;
Blocker -&gt; Nat -&gt; String -&gt; m a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#patternViolation%27"><span class="hs-identifier hs-var">patternViolation'</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682057060"><span class="hs-identifier hs-var">unblock</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">70</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TypeError
</span><a href="#local-6989586621682057061"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- throws a PatternErr, which leads to delayed constraint</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-367"></span><span class="annot"><span class="hs-comment">-- * Implementation of the occurs check.</span></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="annot"><span class="hs-comment">-- | Extended occurs check.</span></span><span>
</span><span id="line-370"></span><span class="hs-keyword">class</span><span> </span><span id="Occurs"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-var">Occurs</span></a></span></span><span> </span><span id="local-6989586621682056137"><span class="annot"><a href="#local-6989586621682056137"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-371"></span><span>  </span><span id="occurs"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682056137"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056137"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-372"></span><span>  </span><span id="metaOccurs"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-type">metaOccurs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056137"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- raise exception if meta occurs in t</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-keyword">default</span><span> </span><span id="metaOccurs"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-type">metaOccurs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621682056135"><span id="local-6989586621682056136"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621682056135"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056136"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682056135"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056136"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="#local-6989586621682056137"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056137"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-375"></span><span>  </span><span id="local-6989586621682057074"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var">metaOccurs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; TCM ()) -&gt; t -&gt; TCM ()
(a -&gt; TCM ()) -&gt; f a -&gt; TCM ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">((a -&gt; TCM ()) -&gt; t -&gt; TCM ())
-&gt; (MetaId -&gt; a -&gt; TCM ()) -&gt; MetaId -&gt; t -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; a -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span id="local-6989586621682056144"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-type">occurs_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056144"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#TypeOf"><span class="hs-identifier hs-type">TypeOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056144"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056144"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056144"><span class="hs-identifier hs-type">t</span></a></span></span><span>
</span><span id="line-378"></span><span id="occurs_"><span class="annot"><span class="annottext">occurs_ :: forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var hs-var">occurs_</span></a></span></span><span> </span><span id="local-6989586621682057087"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682057087"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; OccursM t
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682057087"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span id="local-6989586621682056147"><span id="local-6989586621682056148"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs2"><span class="hs-identifier hs-type">metaOccurs2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056147"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056148"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056147"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056148"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-381"></span><span id="metaOccurs2"><span class="annot"><span class="annottext">metaOccurs2 :: forall a b. (Occurs a, Occurs b) =&gt; MetaId -&gt; a -&gt; b -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs2"><span class="hs-identifier hs-var hs-var">metaOccurs2</span></a></span></span><span> </span><span id="local-6989586621682057094"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057094"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682057095"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057095"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682057096"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682057096"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; a -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057094"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057095"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM () -&gt; TCM ()
forall a b. TCMT IO a -&gt; TCMT IO b -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; b -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057094"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682057096"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span id="local-6989586621682056153"><span id="local-6989586621682056154"><span id="local-6989586621682056155"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs3"><span class="hs-identifier hs-type">metaOccurs3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056153"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056154"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056155"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056153"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056154"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056155"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-384"></span><span id="metaOccurs3"><span class="annot"><span class="annottext">metaOccurs3 :: forall a b c.
(Occurs a, Occurs b, Occurs c) =&gt;
MetaId -&gt; a -&gt; b -&gt; c -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs3"><span class="hs-identifier hs-var hs-var">metaOccurs3</span></a></span></span><span> </span><span id="local-6989586621682057106"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057106"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682057107"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057107"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682057108"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682057108"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621682057109"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682057109"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; a -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057106"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057107"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM () -&gt; TCM ()
forall a b. TCMT IO a -&gt; TCMT IO b -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; b -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057106"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682057108"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">TCM () -&gt; TCM () -&gt; TCM ()
forall a b. TCMT IO a -&gt; TCMT IO b -&gt; TCMT IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; c -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057106"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682057109"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">-- | When assigning @m xs := v@, check that @m@ does not occur in @v@</span><span>
</span><span id="line-387"></span><span class="hs-comment">--   and that the free variables of @v@ are contained in @xs@.</span><span>
</span><span id="line-388"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occursCheck"><span class="hs-identifier hs-type">occursCheck</span></a></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#VarMap"><span class="hs-identifier hs-type">VarMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-390"></span><span id="occursCheck"><span class="annot"><span class="annottext">occursCheck :: MetaId -&gt; VarMap -&gt; Term -&gt; TCM Term
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occursCheck"><span class="hs-identifier hs-var hs-var">occursCheck</span></a></span></span><span> </span><span id="local-6989586621682057111"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057111"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682057112"><span class="annot"><span class="annottext">VarMap
</span><a href="#local-6989586621682057112"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682057113"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057113"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO)) -&gt; TCM Term -&gt; TCM Term
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#Typing"><span class="hs-identifier hs-var">Bench.Typing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#OccursCheck"><span class="hs-identifier hs-var">Bench.OccursCheck</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM Term -&gt; TCM Term) -&gt; TCM Term -&gt; TCM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>  </span><span id="local-6989586621682057117"><span class="annot"><a href="#local-6989586621682057117"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO MetaVariable
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta"><span class="hs-identifier hs-var">lookupLocalMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057111"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621682057118"><span class="annot"><a href="#local-6989586621682057118"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#getContextSize"><span class="hs-identifier hs-type">getContextSize</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">65</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;occursCheck&quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057111"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682057112"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057120"><span class="annot"><a href="#local-6989586621682057120"><span class="hs-identifier hs-var hs-var">initEnv</span></a></span></span><span> </span><span id="local-6989586621682057121"><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="#local-6989586621682057121"><span class="hs-identifier hs-var">unf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#FreeEnv"><span class="hs-identifier hs-type">FreeEnv</span></a></span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">feExtra :: OccursExtra
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursExtra"><span class="hs-identifier hs-type">OccursExtra</span></a></span><span>
</span><span id="line-396"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">occUnfold :: UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occUnfold"><span class="hs-identifier hs-var">occUnfold</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="#local-6989586621682057121"><span class="hs-identifier hs-var">unf</span></a></span><span>
</span><span id="line-397"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">occMeta :: MetaId
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occMeta"><span class="hs-identifier hs-var">occMeta</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057111"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-398"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">occVars :: VarMap
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occVars"><span class="hs-identifier hs-var">occVars</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarMap
</span><a href="#local-6989586621682057112"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-399"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">occRHS :: Term
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occRHS"><span class="hs-identifier hs-var">occRHS</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057113"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-400"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">occCxtSize :: Nat
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occCxtSize"><span class="hs-identifier hs-var">occCxtSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682057118"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-401"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-402"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feFlexRig :: FlexRig' ()
</span><a href="Agda.TypeChecking.Free.Lazy.html#feFlexRig"><span class="hs-identifier hs-var">feFlexRig</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FlexRig' ()
forall a. FlexRig' a
</span><a href="Agda.TypeChecking.Free.Lazy.html#StronglyRigid"><span class="hs-identifier hs-var">StronglyRigid</span></a></span><span> </span><span class="hs-comment">-- ? Unguarded</span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feModality :: Modality
</span><a href="Agda.TypeChecking.Free.Lazy.html#feModality"><span class="hs-identifier hs-var">feModality</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682057117"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-404"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feSingleton :: Maybe Nat -&gt; AllowedVar
</span><a href="Agda.TypeChecking.Free.Lazy.html#feSingleton"><span class="hs-identifier hs-var">feSingleton</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarMap -&gt; Maybe Nat -&gt; AllowedVar
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#variableCheck"><span class="hs-identifier hs-var">variableCheck</span></a></span><span> </span><span class="annot"><span class="annottext">VarMap
</span><a href="#local-6989586621682057112"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#initOccursCheck"><span class="hs-identifier hs-type">initOccursCheck</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057117"><span class="hs-identifier hs-type">mv</span></a></span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-comment">-- First try without normalising the term</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057113"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">`runReaderT`</span></span><span> </span><span class="annot"><a href="#local-6989586621682057120"><span class="hs-identifier hs-type">initEnv</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#NoUnfold"><span class="hs-identifier hs-type">NoUnfold</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682057124"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682057124"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>      </span><span class="hs-comment">-- If first run is inconclusive, try again with normalization</span><span>
</span><span id="line-411"></span><span>      </span><span class="hs-comment">-- (unless metavariable is irrelevant, in which case the</span><span>
</span><span id="line-412"></span><span>      </span><span class="hs-comment">-- constraint will anyway be dropped)</span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682057124"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-414"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PatternErr"><span class="hs-identifier hs-type">PatternErr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Modality -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-var">isIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">(Modality -&gt; Bool) -&gt; Modality -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Modality
forall a. LensModality a =&gt; a -&gt; Modality
</span><a href="Agda.Syntax.Common.html#getModality"><span class="hs-identifier hs-var">getModality</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682057117"><span class="hs-identifier hs-var">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>          </span><span class="annot"><span class="annottext">MetaVariable -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#initOccursCheck"><span class="hs-identifier hs-var">initOccursCheck</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682057117"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-416"></span><span>          </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057113"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">OccursM Term -&gt; OccursCtx -&gt; TCM Term
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-operator hs-var">`runReaderT`</span></span><span> </span><span class="annot"><span class="annottext">UnfoldStrategy -&gt; OccursCtx
</span><a href="#local-6989586621682057120"><span class="hs-identifier hs-var">initEnv</span></a></span><span> </span><span class="annot"><span class="annottext">UnfoldStrategy
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#YesUnfold"><span class="hs-identifier hs-var">YesUnfold</span></a></span><span>
</span><span id="line-417"></span><span>        </span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; TCM Term
forall a. TCErr -&gt; TCMT IO a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682057124"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-420"></span><span>  </span><span id="local-6989586621682057287"><span class="annot"><span class="annottext">occurs :: Term -&gt; OccursM Term
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span id="local-6989586621682057288"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057288"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-421"></span><span>    </span><span id="local-6989586621682057289"><span class="annot"><a href="#local-6989586621682057289"><span class="hs-identifier hs-var">vb</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM (Blocked Term)
forall t. (Instantiate t, Reduce t) =&gt; t -&gt; OccursM (Blocked t)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#unfoldB"><span class="hs-identifier hs-var">unfoldB</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057288"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057290"><span class="annot"><a href="#local-6989586621682057290"><span class="hs-identifier hs-var hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Blocker
forall t a. Blocked' t a -&gt; Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#getBlocker"><span class="hs-identifier hs-var">getBlocker</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682057289"><span class="hs-identifier hs-var">vb</span></a></span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-comment">-- On a failure, we should retry when any meta that is blocking</span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-comment">-- the term is solved.</span><span>
</span><span id="line-425"></span><span>        </span><span id="local-6989586621682057292"><span class="annot"><a href="#local-6989586621682057292"><span class="hs-identifier hs-var hs-var">flexIfBlocked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span>
</span><span id="line-426"></span><span>          </span><span class="hs-comment">-- In the metavariable case we should not yet become flexible</span><span>
</span><span id="line-427"></span><span>          </span><span class="hs-comment">-- because otherwise pruning won't fire.</span><span>
</span><span id="line-428"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Term
forall t a. Blocked' t a -&gt; a
</span><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682057289"><span class="hs-identifier hs-var">vb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; OccursM Term -&gt; OccursM Term
forall (m :: * -&gt; *) a.
(PureTCM m, MonadBlock m) =&gt;
Blocker -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#addOrUnblocker"><span class="hs-identifier hs-var">addOrUnblocker</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682057290"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-429"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682057290"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Blocker -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccursM Term -&gt; OccursM Term
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-var">flexibly</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursM Term -&gt; OccursM Term)
-&gt; (OccursM Term -&gt; OccursM Term) -&gt; OccursM Term -&gt; OccursM Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; OccursM Term -&gt; OccursM Term
forall (m :: * -&gt; *) a.
(PureTCM m, MonadBlock m) =&gt;
Blocker -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#addOrUnblocker"><span class="hs-identifier hs-var">addOrUnblocker</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="#local-6989586621682057290"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-430"></span><span>          </span><span class="hs-comment">-- Re #3594, do not fail hard when Underapplied:</span><span>
</span><span id="line-431"></span><span>          </span><span class="hs-comment">-- the occurrence could be computed away after eta expansion.</span><span>
</span><span id="line-432"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">blockingStatus :: forall t a. Blocked' t a -&gt; NotBlocked' t
</span><a href="Agda.Syntax.Internal.Blockers.html#blockingStatus"><span class="hs-identifier hs-var">blockingStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><a href="Agda.Syntax.Internal.Blockers.html#Underapplied"><span class="hs-identifier hs-var">Underapplied</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682057289"><span class="hs-identifier hs-var">vb</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccursM Term -&gt; OccursM Term
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-var">flexibly</span></a></span><span>
</span><span id="line-433"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccursM Term -&gt; OccursM Term
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621682057301"><span class="annot"><a href="#local-6989586621682057301"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.ProjectionLike.html#reduceProjectionLike"><span class="hs-identifier hs-type">reduceProjectionLike</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057289"><span class="hs-identifier hs-type">vb</span></a></span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><a href="#local-6989586621682057292"><span class="hs-identifier hs-type">flexIfBlocked</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-436"></span><span>        </span><span id="local-6989586621682057303"><span class="annot"><a href="#local-6989586621682057303"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ask</span></span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057304"><span class="annot"><a href="#local-6989586621682057304"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursExtra -&gt; MetaId
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occMeta"><span class="hs-identifier hs-var">occMeta</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; MetaId)
-&gt; (OccursCtx -&gt; OccursExtra) -&gt; OccursCtx -&gt; MetaId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursCtx -&gt; MetaId) -&gt; OccursCtx -&gt; MetaId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682057303"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-438"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">45</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-439"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;occursCheck &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-type">prettyShow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057304"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot; (&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#feFlexRig"><span class="hs-identifier hs-var">feFlexRig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057303"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;) of &quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057301"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-440"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-441"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057301"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682057301"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-443"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682057307"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682057307"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682057308"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057308"><span class="hs-identifier hs-var">es</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-444"></span><span>            </span><span id="local-6989586621682057309"><span class="annot"><a href="#local-6989586621682057309"><span class="hs-identifier hs-var">allowed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">All -&gt; Bool
</span><span class="hs-identifier hs-var">getAll</span></span><span> </span><span class="annot"><span class="annottext">(All -&gt; Bool) -&gt; (AllowedVar -&gt; All) -&gt; AllowedVar -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AllowedVar -&gt; AllowedVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Modality
</span><a href="Agda.Syntax.Common.html#unitModality"><span class="hs-identifier hs-var">unitModality</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AllowedVar -&gt; Bool)
-&gt; ReaderT OccursCtx (TCMT IO) AllowedVar
-&gt; ReaderT OccursCtx (TCMT IO) Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; ReaderT OccursCtx (TCMT IO) AllowedVar
forall (m :: * -&gt; *) a c b.
(Monad m, IsVarSet a c) =&gt;
Nat -&gt; FreeT a b m c
</span><a href="Agda.TypeChecking.Free.Lazy.html#variable"><span class="hs-identifier hs-var">variable</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682057307"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-445"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621682057309"><span class="hs-identifier hs-type">allowed</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057307"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#weakly"><span class="hs-identifier hs-type">weakly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057308"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-446"></span><span>              </span><span class="hs-comment">-- if the offending variable is of singleton type,</span><span>
</span><span id="line-447"></span><span>              </span><span class="hs-comment">-- eta-expand it away</span><span>
</span><span id="line-448"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">35</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;offending variable: &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057307"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>              </span><span id="local-6989586621682057314"><span class="annot"><a href="#local-6989586621682057314"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#typeOfBV"><span class="hs-identifier hs-type">typeOfBV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057307"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-450"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">35</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;of type &quot;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-type">prettyTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057314"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-451"></span><span>              </span><span id="local-6989586621682057316"><span class="annot"><a href="#local-6989586621682057316"><span class="hs-identifier hs-var">isST</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Env.html#typeLevelReductions"><span class="hs-identifier hs-type">typeLevelReductions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Records.html#isSingletonType"><span class="hs-identifier hs-type">isSingletonType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057314"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-452"></span><span>              </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="hs-number">35</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-type">nest</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;(after singleton test)&quot;</span></span><span>
</span><span id="line-453"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682057316"><span class="hs-identifier hs-type">isST</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-454"></span><span>                </span><span class="hs-comment">-- not a singleton type</span><span>
</span><span id="line-455"></span><span>                </span><span class="annot"><span class="annottext">Maybe Term
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-456"></span><span>                  </span><span class="hs-comment">-- #4480: Only hard fail if the variable is not in scope. Wrong modality/relevance</span><span>
</span><span id="line-457"></span><span>                  </span><span class="hs-comment">-- could potentially be salvaged by eta expansion.</span><span>
</span><span id="line-458"></span><span>                  </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) Bool
-&gt; OccursM Term -&gt; OccursM Term -&gt; OccursM Term
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Nat -&gt; Bool) -&gt; Nat -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682057307"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Nat -&gt; Bool) -&gt; Bool)
-&gt; OccursM (Nat -&gt; Bool) -&gt; ReaderT OccursCtx (TCMT IO) Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">OccursM (Nat -&gt; Bool)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#allowedVars"><span class="hs-identifier hs-var">allowedVars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- vv TODO: neverUnblock is not correct! What could trigger this eta expansion though?</span><span>
</span><span id="line-459"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker -&gt; Nat -&gt; String -&gt; OccursM Term
forall (m :: * -&gt; *) a.
MonadTCM m =&gt;
Blocker -&gt; Nat -&gt; String -&gt; m a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#patternViolation%27"><span class="hs-identifier hs-var">patternViolation'</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; OccursM Term) -&gt; String -&gt; OccursM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Disallowed var &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682057307"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; due to modality/relevance&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccursM Term -&gt; OccursM Term
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#strongly"><span class="hs-identifier hs-var">strongly</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursM Term -&gt; OccursM Term) -&gt; OccursM Term -&gt; OccursM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TypeError -&gt; OccursM Term
forall a. Blocker -&gt; TypeError -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#abort"><span class="hs-identifier hs-var">abort</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeError -&gt; OccursM Term) -&gt; TypeError -&gt; OccursM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; Nat -&gt; TypeError
</span><a href="Agda.TypeChecking.Monad.Base.html#MetaCannotDependOn"><span class="hs-identifier hs-var">MetaCannotDependOn</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057304"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccursExtra -&gt; Term
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occRHS"><span class="hs-identifier hs-var">occRHS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; Term) -&gt; OccursExtra -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682057303"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682057307"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>                </span><span class="hs-comment">-- is a singleton type with unique inhabitant sv</span><span>
</span><span id="line-462"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682057321"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057321"><span class="hs-identifier hs-var">sv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; OccursM Term) -&gt; Term -&gt; OccursM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057321"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Elims -&gt; Term
forall t. Apply t =&gt; t -&gt; Elims -&gt; t
</span><a href="Agda.TypeChecking.Substitute.Class.html#applyE"><span class="hs-operator hs-var">`applyE`</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057308"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-463"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682057324"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057324"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682057325"><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682057325"><span class="hs-identifier hs-var">f</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-464"></span><span>            </span><span class="annot"><span class="annottext">ArgInfo -&gt; Abs Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057324"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">(Abs Term -&gt; Term)
-&gt; ReaderT OccursCtx (TCMT IO) (Abs Term) -&gt; OccursM Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Abs Term -&gt; ReaderT OccursCtx (TCMT IO) (Abs Term)
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682057325"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-465"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span id="local-6989586621682057327"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682057327"><span class="hs-identifier hs-var">l</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Level -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-var">Level</span></a></span><span> </span><span class="annot"><span class="annottext">(Level -&gt; Term)
-&gt; ReaderT OccursCtx (TCMT IO) Level -&gt; OccursM Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Level -&gt; ReaderT OccursCtx (TCMT IO) Level
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682057327"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-466"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682057329"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682057329"><span class="hs-identifier hs-var">l</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057301"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-467"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057301"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-468"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span> </span><span id="local-6989586621682057332"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057332"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Term
</span><a href="Agda.Syntax.Internal.html#dontCare"><span class="hs-identifier hs-var">dontCare</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Term) -&gt; OccursM Term -&gt; OccursM Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-469"></span><span>            </span><span class="annot"><span class="annottext">OccursM Term -&gt; OccursM Term
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#onlyReduceTypes"><span class="hs-identifier hs-var">onlyReduceTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursM Term -&gt; OccursM Term) -&gt; OccursM Term -&gt; OccursM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Relevance -&gt; OccursM Term -&gt; OccursM Term
forall r (m :: * -&gt; *) o z.
(MonadReader r m, LensRelevance r, LensRelevance o) =&gt;
o -&gt; m z -&gt; m z
</span><a href="Agda.TypeChecking.Free.Lazy.html#underRelevance"><span class="hs-identifier hs-var">underRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="Agda.Syntax.Common.html#irrelevant"><span class="hs-identifier hs-var">irrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursM Term -&gt; OccursM Term) -&gt; OccursM Term -&gt; OccursM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057332"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-470"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682057338"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057338"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682057339"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057339"><span class="hs-identifier hs-var">es</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-471"></span><span>            </span><span class="annot"><span class="annottext">QName -&gt; OccursM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#definitionCheck"><span class="hs-identifier hs-var">definitionCheck</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057338"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-472"></span><span>            </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057338"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term)
-&gt; ReaderT OccursCtx (TCMT IO) Elims -&gt; OccursM Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; ReaderT OccursCtx (TCMT IO) Elims
forall {b}. Occurs b =&gt; QName -&gt; b -&gt; ReaderT OccursCtx (TCMT IO) b
</span><a href="#local-6989586621682057340"><span class="hs-identifier hs-var">occDef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057338"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057339"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-473"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682057342"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682057342"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682057343"><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682057343"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621682057344"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057344"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-474"></span><span>            </span><span class="annot"><span class="annottext">QName -&gt; OccursM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#definitionCheck"><span class="hs-identifier hs-var">definitionCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682057342"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>            </span><span class="annot"><span class="annottext">ConHead -&gt; ConInfo -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-var">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682057342"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><a href="#local-6989586621682057343"><span class="hs-identifier hs-var">ci</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term)
-&gt; ReaderT OccursCtx (TCMT IO) Elims -&gt; OccursM Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Elims
-&gt; ReaderT OccursCtx (TCMT IO) Elims
-&gt; ReaderT OccursCtx (TCMT IO) Elims
forall a. Elims -&gt; OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#conArgs"><span class="hs-identifier hs-var">conArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057344"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; ReaderT OccursCtx (TCMT IO) Elims
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057344"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- if strongly rigid, remain so, except with unreduced IApply arguments.</span><span>
</span><span id="line-476"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621682057347"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682057347"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682057348"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682057348"><span class="hs-identifier hs-var">b</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; Abs Type -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-var">Pi</span></a></span><span> </span><span class="annot"><span class="annottext">(Dom Type -&gt; Abs Type -&gt; Term)
-&gt; ReaderT OccursCtx (TCMT IO) (Dom Type)
-&gt; ReaderT OccursCtx (TCMT IO) (Abs Type -&gt; Term)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Dom Type -&gt; ReaderT OccursCtx (TCMT IO) (Dom Type)
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682057347"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) (Abs Type -&gt; Term)
-&gt; ReaderT OccursCtx (TCMT IO) (Abs Type) -&gt; OccursM Term
forall a b.
ReaderT OccursCtx (TCMT IO) (a -&gt; b)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Abs Type -&gt; ReaderT OccursCtx (TCMT IO) (Abs Type)
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682057348"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-477"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span id="local-6989586621682057350"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057350"><span class="hs-identifier hs-var">s</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-var">Sort</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort -&gt; Term) -&gt; ReaderT OccursCtx (TCMT IO) Sort -&gt; OccursM Term
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Relevance
-&gt; ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall r (m :: * -&gt; *) o z.
(MonadReader r m, LensRelevance r, LensRelevance o) =&gt;
o -&gt; m z -&gt; m z
</span><a href="Agda.TypeChecking.Free.Lazy.html#underRelevance"><span class="hs-identifier hs-var">underRelevance</span></a></span><span> </span><span class="annot"><span class="annottext">Relevance
</span><a href="Agda.Syntax.Common.html#shapeIrrelevant"><span class="hs-identifier hs-var">shapeIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT OccursCtx (TCMT IO) Sort
 -&gt; ReaderT OccursCtx (TCMT IO) Sort)
-&gt; ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057350"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-478"></span><span>          </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span id="local-6989586621682057352"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057352"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span id="local-6989586621682057353"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057353"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>            </span><span id="local-6989586621682057354"><span class="annot"><a href="#local-6989586621682057354"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; OccursM MetaId
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaCheck"><span class="hs-identifier hs-var">metaCheck</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057352"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-480"></span><span>            </span><span class="hs-comment">-- The arguments of a meta are in a flexible position</span><span>
</span><span id="line-481"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057354"><span class="hs-identifier hs-type">m'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-type">flexibly</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057353"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">`catchError`</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682057355"><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682057355"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>                </span><span id="local-6989586621682057356"><span class="annot"><a href="#local-6989586621682057356"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) OccursCtx
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-483"></span><span>                </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.kill&quot;</span></span><span> </span><span class="annot"><span class="hs-number">25</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-type">vcat</span></a></span><span>
</span><span id="line-484"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;error during flexible occurs check, we are &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682057356"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#lensFlexRig"><span class="hs-identifier hs-type">lensFlexRig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-type">text</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682057355"><span class="hs-identifier hs-type">err</span></a></span><span>
</span><span id="line-486"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-487"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682057355"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-488"></span><span>                  </span><span class="hs-comment">-- On pattern violations try to remove offending</span><span>
</span><span id="line-489"></span><span>                  </span><span class="hs-comment">-- flexible occurrences (if not already in a flexible context)</span><span>
</span><span id="line-490"></span><span>                  </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PatternErr"><span class="hs-identifier hs-type">PatternErr</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccursCtx -&gt; Bool
forall o a. LensFlexRig o a =&gt; o -&gt; Bool
</span><a href="Agda.TypeChecking.Free.Lazy.html#isFlexible"><span class="hs-identifier hs-var">isFlexible</span></a></span><span> </span><span class="annot"><span class="annottext">OccursCtx
</span><a href="#local-6989586621682057356"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-491"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; String -&gt; OccursM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; String -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.kill&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; OccursM ()) -&gt; String -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-492"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;oops, pattern violation for &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057354"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-493"></span><span>                    </span><span class="hs-comment">-- Andreas, 2014-03-02, see issue 1070:</span><span>
</span><span id="line-494"></span><span>                    </span><span class="hs-comment">-- Do not prune when meta is projected!</span><span>
</span><span id="line-495"></span><span>                    </span><span class="annot"><span class="annottext">Maybe [Arg Term]
-&gt; OccursM Term -&gt; ([Arg Term] -&gt; OccursM Term) -&gt; OccursM Term
forall a b. Maybe a -&gt; b -&gt; (a -&gt; b) -&gt; b
</span><a href="Agda.Utils.Maybe.html#caseMaybe"><span class="hs-identifier hs-var">caseMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Elims -&gt; Maybe [Arg Term]
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057353"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCErr -&gt; OccursM Term
forall a. TCErr -&gt; ReaderT OccursCtx (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682057355"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Arg Term] -&gt; OccursM Term) -&gt; OccursM Term)
-&gt; ([Arg Term] -&gt; OccursM Term) -&gt; OccursM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682057362"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682057362"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-496"></span><span>                      </span><span id="local-6989586621682057363"><span class="annot"><a href="#local-6989586621682057363"><span class="hs-identifier hs-var">killResult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCM PruneResult -&gt; ReaderT OccursCtx (TCMT IO) PruneResult
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT OccursCtx m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TCM PruneResult -&gt; ReaderT OccursCtx (TCMT IO) PruneResult)
-&gt; ((Nat -&gt; Bool) -&gt; TCM PruneResult)
-&gt; (Nat -&gt; Bool)
-&gt; ReaderT OccursCtx (TCMT IO) PruneResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; [Arg Term] -&gt; (Nat -&gt; Bool) -&gt; TCM PruneResult
forall (m :: * -&gt; *).
(PureTCM m, MonadMetaSolver m) =&gt;
MetaId -&gt; [Arg Term] -&gt; (Nat -&gt; Bool) -&gt; m PruneResult
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#prune"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057354"><span class="hs-identifier hs-var">m'</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682057362"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">((Nat -&gt; Bool) -&gt; ReaderT OccursCtx (TCMT IO) PruneResult)
-&gt; OccursM (Nat -&gt; Bool) -&gt; ReaderT OccursCtx (TCMT IO) PruneResult
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">OccursM (Nat -&gt; Bool)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#allowedVars"><span class="hs-identifier hs-var">allowedVars</span></a></span><span>
</span><span id="line-497"></span><span>                      </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682057363"><span class="hs-identifier hs-type">killResult</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PrunedEverything"><span class="hs-identifier hs-type">PrunedEverything</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>                        </span><span class="hs-comment">-- after successful pruning, restart occurs check</span><span>
</span><span id="line-499"></span><span>                        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-type">reportSDoc</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.prune&quot;</span></span><span> </span><span class="annot"><span class="hs-number">40</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Pruned everything&quot;</span></span><span>
</span><span id="line-500"></span><span>                        </span><span id="local-6989586621682057366"><span class="annot"><a href="#local-6989586621682057366"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiate"><span class="hs-identifier hs-type">instantiate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057354"><span class="hs-identifier hs-type">m'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057353"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>                        </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057366"><span class="hs-identifier hs-type">v'</span></a></span><span>
</span><span id="line-502"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">throwError</span></span><span> </span><span class="annot"><a href="#local-6989586621682057355"><span class="hs-identifier hs-type">err</span></a></span><span>
</span><span id="line-503"></span><span>                  </span><span class="annot"><span class="annottext">TCErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCErr -&gt; OccursM Term
forall a. TCErr -&gt; ReaderT OccursCtx (TCMT IO) a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">TCErr
</span><a href="#local-6989586621682057355"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-504"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-505"></span><span>            </span><span class="hs-comment">-- a data or record type constructor propagates strong occurrences</span><span>
</span><span id="line-506"></span><span>            </span><span class="hs-comment">-- since e.g. x = List x is unsolvable</span><span>
</span><span id="line-507"></span><span>            </span><span id="local-6989586621682057340"><span class="annot"><span class="annottext">occDef :: QName -&gt; b -&gt; ReaderT OccursCtx (TCMT IO) b
</span><a href="#local-6989586621682057340"><span class="hs-identifier hs-var hs-var">occDef</span></a></span></span><span> </span><span id="local-6989586621682057385"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057385"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682057386"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682057386"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>              </span><span id="local-6989586621682057387"><span class="annot"><a href="#local-6989586621682057387"><span class="hs-identifier hs-var">m</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(OccursCtx -&gt; MetaId) -&gt; OccursM MetaId
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccursExtra -&gt; MetaId
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occMeta"><span class="hs-identifier hs-var">occMeta</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursExtra -&gt; MetaId)
-&gt; (OccursCtx -&gt; OccursExtra) -&gt; OccursCtx -&gt; MetaId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OccursCtx -&gt; OccursExtra
forall a b c. FreeEnv' a b c -&gt; b
</span><a href="Agda.TypeChecking.Free.Lazy.html#feExtra"><span class="hs-identifier hs-var">feExtra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-type">metaOccurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057387"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057385"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-510"></span><span>              </span><span class="annot"><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-type">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#liftTCM"><span class="hs-identifier hs-type">liftTCM</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">isJust</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Datatypes.html#isDataOrRecordType"><span class="hs-identifier hs-type">isDataOrRecordType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057385"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>                </span><span class="hs-comment">{-then-}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057386"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>                </span><span class="hs-comment">{-else-}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#defArgs"><span class="hs-identifier hs-type">defArgs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057386"><span class="hs-identifier hs-type">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>  </span><span id="local-6989586621682057412"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Term -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057413"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682057414"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057414"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-515"></span><span>    </span><span id="local-6989586621682057415"><span class="annot"><a href="#local-6989586621682057415"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCM Term
forall a (m :: * -&gt; *). (Instantiate a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiate"><span class="hs-identifier hs-var">instantiate</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057414"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682057415"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-517"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682057416"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682057416"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682057417"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057417"><span class="hs-identifier hs-var">vs</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057417"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-518"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621682057418"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057418"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621682057419"><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682057419"><span class="hs-identifier hs-var">f</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Abs Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682057419"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-519"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span id="local-6989586621682057420"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682057420"><span class="hs-identifier hs-var">l</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Level -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682057420"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-520"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621682057421"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621682057421"><span class="hs-identifier hs-var">l</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span> </span><span id="local-6989586621682057422"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057422"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057422"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-523"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682057423"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057423"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682057424"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057424"><span class="hs-identifier hs-var">vs</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; QName -&gt; Elims -&gt; TCM ()
forall a b. (Occurs a, Occurs b) =&gt; MetaId -&gt; a -&gt; b -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs2"><span class="hs-identifier hs-var">metaOccurs2</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057423"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057424"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-524"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682057425"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682057425"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057426"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057426"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057426"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-525"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621682057427"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682057427"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682057428"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682057428"><span class="hs-identifier hs-var">b</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Dom Type -&gt; Abs Type -&gt; TCM ()
forall a b. (Occurs a, Occurs b) =&gt; MetaId -&gt; a -&gt; b -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs2"><span class="hs-identifier hs-var">metaOccurs2</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682057427"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682057428"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span id="local-6989586621682057429"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057429"><span class="hs-identifier hs-var">s</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Sort -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057429"><span class="hs-identifier hs-var">s</span></a></span><span>              </span><span class="hs-comment">-- vv m is already an unblocker</span><span>
</span><span id="line-527"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span id="local-6989586621682057430"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057430"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span id="local-6989586621682057431"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057431"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; MetaId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057430"><span class="hs-identifier hs-var">m'</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; Nat -&gt; String -&gt; TCM ()
forall (m :: * -&gt; *) a.
MonadTCM m =&gt;
Blocker -&gt; Nat -&gt; String -&gt; m a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#patternViolation%27"><span class="hs-identifier hs-var">patternViolation'</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#neverUnblock"><span class="hs-identifier hs-var">neverUnblock</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCM ()) -&gt; String -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Found occurrence of &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; String
forall a. Pretty a =&gt; a -&gt; String
</span><a href="Agda.Syntax.Common.Pretty.html#prettyShow"><span class="hs-identifier hs-var">prettyShow</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-528"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Blocker -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a.
(PureTCM m, MonadBlock m) =&gt;
Blocker -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#addOrUnblocker"><span class="hs-identifier hs-var">addOrUnblocker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Blocker
</span><a href="Agda.Syntax.Internal.Blockers.html#unblockOnMeta"><span class="hs-identifier hs-var">unblockOnMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057430"><span class="hs-identifier hs-var">m'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057413"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057431"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-531"></span><span>  </span><span id="local-6989586621682057436"><span class="annot"><span class="annottext">occurs :: QName -&gt; OccursM QName
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span id="local-6989586621682057437"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057437"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursM QName
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span>  </span><span id="local-6989586621682057447"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057448"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057448"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682057449"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057449"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM Bool -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Agda.Utils.Monad.html#whenM"><span class="hs-identifier hs-var">whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; TCM Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#defNeedsChecking"><span class="hs-identifier hs-var">defNeedsChecking</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057449"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-534"></span><span>    </span><span class="annot"><span class="annottext">QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#tallyDef"><span class="hs-identifier hs-var">tallyDef</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057449"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; TCM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">30</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCM ()) -&gt; TCMT IO Doc -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;Checking for occurrences in &quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; QName -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057449"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-536"></span><span>    </span><span class="annot"><span class="annottext">MetaId -&gt; QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccursQName"><span class="hs-identifier hs-var">metaOccursQName</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057448"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057449"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccursQName"><span class="hs-identifier hs-type">metaOccursQName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span id="metaOccursQName"><span class="annot"><span class="annottext">metaOccursQName :: MetaId -&gt; QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccursQName"><span class="hs-identifier hs-var hs-var">metaOccursQName</span></a></span></span><span> </span><span id="local-6989586621682057451"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057451"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682057452"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057452"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Defn -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057451"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Defn -&gt; TCM ()) -&gt; (Definition -&gt; Defn) -&gt; Definition -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Defn
</span><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCM ()) -&gt; TCMT IO Definition -&gt; TCM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-540"></span><span>  </span><span class="annot"><span class="annottext">TCMT IO Definition -&gt; TCMT IO Definition
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Signature.html#ignoreAbstractMode"><span class="hs-identifier hs-var">ignoreAbstractMode</span></a></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Definition -&gt; TCMT IO Definition)
-&gt; TCMT IO Definition -&gt; TCMT IO Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; TCMT IO Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057452"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-541"></span><span>  </span><span class="hs-comment">-- Andreas, 2019-05-03, issue #3742:</span><span>
</span><span id="line-542"></span><span>  </span><span class="hs-comment">-- ignoreAbstractMode necessary, as abstract</span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-comment">-- constructors are also called up.</span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Defn"><span class="hs-identifier hs-type">Defn</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-546"></span><span>  </span><span id="local-6989586621682057460"><span class="annot"><span class="annottext">occurs :: Defn -&gt; OccursM Defn
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span id="local-6989586621682057461"><span class="annot"><span class="annottext">Defn
</span><a href="#local-6989586621682057461"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursM Defn
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span>  </span><span id="local-6989586621682057478"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Defn -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057479"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057479"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057481"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057481"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DataOrRecSig"><span class="hs-identifier hs-type">DataOrRecSig</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057483"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057483"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">funClauses :: Defn -&gt; [Clause]
</span><a href="Agda.TypeChecking.Monad.Base.html#funClauses"><span class="hs-identifier hs-var">funClauses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057486"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682057486"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Clause -&gt; TCM ()) -&gt; [Clause] -&gt; TCM ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Clause -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057483"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621682057486"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-551"></span><span>  </span><span class="hs-comment">-- since a datatype is isomorphic to the sum of its constructor types</span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-comment">-- we check the constructor types</span><span>
</span><span id="line-553"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057487"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057487"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dataCons :: Defn -&gt; [QName]
</span><a href="Agda.TypeChecking.Monad.Base.html#dataCons"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057490"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682057490"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCM ()) -&gt; [QName] -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccursQName"><span class="hs-identifier hs-var">metaOccursQName</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057487"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621682057490"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057492"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057492"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recConHead :: Defn -&gt; ConHead
</span><a href="Agda.TypeChecking.Monad.Base.html#recConHead"><span class="hs-identifier hs-var">recConHead</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057495"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682057495"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; QName -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccursQName"><span class="hs-identifier hs-var">metaOccursQName</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057492"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; TCM ()) -&gt; QName -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682057495"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-555"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057496"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057496"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057498"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057498"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Primitive"><span class="hs-identifier hs-type">Primitive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057500"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057500"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#PrimitiveSort"><span class="hs-identifier hs-type">PrimitiveSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057502"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057502"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-559"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057504"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057504"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizableVar"><span class="hs-identifier hs-type">GeneralizableVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCM ()
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-562"></span><span>  </span><span id="local-6989586621682057510"><span class="annot"><span class="annottext">occurs :: Clause -&gt; OccursM Clause
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span id="local-6989586621682057511"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682057511"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccursM Clause
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>  </span><span id="local-6989586621682057514"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Clause -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057515"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057515"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682057516"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682057516"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Term -&gt; (Term -&gt; TCM ()) -&gt; TCM ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="Agda.Utils.Maybe.html#whenJust"><span class="hs-identifier hs-var">whenJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; Maybe Term
</span><a href="Agda.Syntax.Internal.html#clauseBody"><span class="hs-identifier hs-var">clauseBody</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621682057516"><span class="hs-identifier hs-var">cl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Term -&gt; TCM ()) -&gt; TCM ()) -&gt; (Term -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057515"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-567"></span><span>  </span><span id="local-6989586621682057529"><span class="annot"><span class="annottext">occurs :: Level -&gt; ReaderT OccursCtx (TCMT IO) Level
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Max"><span class="hs-identifier hs-type">Max</span></a></span><span> </span><span id="local-6989586621682057531"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682057531"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682057532"><span class="annot"><span class="annottext">[PlusLevel' Term]
</span><a href="#local-6989586621682057532"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; [PlusLevel' Term] -&gt; Level
forall t. Integer -&gt; [PlusLevel' t] -&gt; Level' t
</span><a href="Agda.Syntax.Internal.html#Max"><span class="hs-identifier hs-var">Max</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682057531"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">([PlusLevel' Term] -&gt; Level)
-&gt; ReaderT OccursCtx (TCMT IO) [PlusLevel' Term]
-&gt; ReaderT OccursCtx (TCMT IO) Level
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PlusLevel' Term -&gt; ReaderT OccursCtx (TCMT IO) (PlusLevel' Term))
-&gt; [PlusLevel' Term]
-&gt; ReaderT OccursCtx (TCMT IO) [PlusLevel' Term]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">PlusLevel' Term -&gt; ReaderT OccursCtx (TCMT IO) (PlusLevel' Term)
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">[PlusLevel' Term]
</span><a href="#local-6989586621682057532"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>  </span><span id="local-6989586621682057543"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Level -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057544"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057544"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Max"><span class="hs-identifier hs-type">Max</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057545"><span class="annot"><span class="annottext">[PlusLevel' Term]
</span><a href="#local-6989586621682057545"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-570"></span><span>    </span><span class="annot"><span class="annottext">Blocker -&gt; TCM () -&gt; TCM ()
forall (m :: * -&gt; *) a.
(PureTCM m, MonadBlock m) =&gt;
Blocker -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Constraints.html#addOrUnblocker"><span class="hs-identifier hs-var">addOrUnblocker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PlusLevel' Term] -&gt; Blocker
forall t. AllMetas t =&gt; t -&gt; Blocker
</span><a href="Agda.Syntax.Internal.MetaVars.html#unblockOnAnyMetaIn"><span class="hs-identifier hs-var">unblockOnAnyMetaIn</span></a></span><span> </span><span class="annot"><span class="annottext">[PlusLevel' Term]
</span><a href="#local-6989586621682057545"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TCM () -&gt; TCM ()) -&gt; TCM () -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PlusLevel' Term -&gt; TCM ()) -&gt; [PlusLevel' Term] -&gt; TCM ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; PlusLevel' Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057544"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PlusLevel' Term]
</span><a href="#local-6989586621682057545"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-comment">-- TODO: Should only be blocking metas in as. But any meta that can</span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-comment">--       let the Max make progress needs to be included. For instance,</span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-comment">--       _1 &#8852; _2 = _1 should unblock on _2, even though _1 is the meta</span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-comment">--       failing occurs check.</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#PlusLevel"><span class="hs-identifier hs-type">PlusLevel</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-577"></span><span>  </span><span id="local-6989586621682057552"><span class="annot"><span class="annottext">occurs :: PlusLevel' Term -&gt; ReaderT OccursCtx (TCMT IO) (PlusLevel' Term)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Plus"><span class="hs-identifier hs-type">Plus</span></a></span><span> </span><span id="local-6989586621682057554"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682057554"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682057555"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057555"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><span class="annottext">Integer -&gt; Term -&gt; PlusLevel' Term
forall t. Integer -&gt; t -&gt; PlusLevel' t
</span><a href="Agda.Syntax.Internal.html#Plus"><span class="hs-identifier hs-var">Plus</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682057554"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; PlusLevel' Term)
-&gt; OccursM Term -&gt; ReaderT OccursCtx (TCMT IO) (PlusLevel' Term)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057555"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>  </span><span id="local-6989586621682057557"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; PlusLevel' Term -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057558"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057558"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Plus"><span class="hs-identifier hs-type">Plus</span></a></span><span> </span><span id="local-6989586621682057559"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682057559"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682057560"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057560"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057558"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057560"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-583"></span><span>  </span><span id="local-6989586621682057569"><span class="annot"><span class="annottext">occurs :: Type -&gt; ReaderT OccursCtx (TCMT IO) Type
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span id="local-6989586621682057571"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057571"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682057572"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057572"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; Term -&gt; Type
forall t a. Sort' t -&gt; a -&gt; Type'' t a
</span><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-var">El</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort -&gt; Term -&gt; Type)
-&gt; ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) (Term -&gt; Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057571"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) (Term -&gt; Type)
-&gt; OccursM Term -&gt; ReaderT OccursCtx (TCMT IO) Type
forall a b.
ReaderT OccursCtx (TCMT IO) (a -&gt; b)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057572"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>  </span><span id="local-6989586621682057575"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057576"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057576"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span id="local-6989586621682057577"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057577"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682057578"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057578"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Sort -&gt; Term -&gt; TCM ()
forall a b. (Occurs a, Occurs b) =&gt; MetaId -&gt; a -&gt; b -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs2"><span class="hs-identifier hs-var">metaOccurs2</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057576"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057577"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057578"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-588"></span><span>  </span><span id="local-6989586621682057645"><span class="annot"><span class="annottext">occurs :: Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span id="local-6989586621682057646"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057646"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall t. (Instantiate t, Reduce t) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#unfold"><span class="hs-identifier hs-var">unfold</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057646"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) Sort
-&gt; (Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort)
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a b.
ReaderT OccursCtx (TCMT IO) a
-&gt; (a -&gt; ReaderT OccursCtx (TCMT IO) b)
-&gt; ReaderT OccursCtx (TCMT IO) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-590"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#PiSort"><span class="hs-identifier hs-type">PiSort</span></a></span><span> </span><span id="local-6989586621682057648"><span class="annot"><span class="annottext">Dom' Term Term
</span><a href="#local-6989586621682057648"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682057649"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057649"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682057650"><span class="annot"><span class="annottext">Abs Sort
</span><a href="#local-6989586621682057650"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-591"></span><span>        </span><span id="local-6989586621682057651"><span class="annot"><a href="#local-6989586621682057651"><span class="hs-identifier hs-var">s1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-var">flexibly</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT OccursCtx (TCMT IO) Sort
 -&gt; ReaderT OccursCtx (TCMT IO) Sort)
-&gt; ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057649"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-592"></span><span>        </span><span id="local-6989586621682057652"><span class="annot"><a href="#local-6989586621682057652"><span class="hs-identifier hs-var">a'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">a</span></span><span> </span><span class="annot"><span class="hs-operator">$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-type">flexibly</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057648"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>        </span><span id="local-6989586621682057655"><span class="annot"><a href="#local-6989586621682057655"><span class="hs-identifier hs-var">s2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#mapAbstraction"><span class="hs-identifier hs-type">mapAbstraction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057651"><span class="hs-identifier hs-type">s1'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621682057652"><span class="hs-identifier hs-type">a'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-type">flexibly</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Free.Lazy.html#underBinder"><span class="hs-identifier hs-type">underBinder</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-type">occurs_</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682057650"><span class="hs-identifier hs-type">s2</span></a></span><span>
</span><span id="line-594"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#PiSort"><span class="hs-identifier hs-type">PiSort</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057652"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057651"><span class="hs-identifier hs-type">s1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057655"><span class="hs-identifier hs-type">s2'</span></a></span><span>
</span><span id="line-595"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#FunSort"><span class="hs-identifier hs-type">FunSort</span></a></span><span> </span><span id="local-6989586621682057659"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057659"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682057660"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057660"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; Sort -&gt; Sort
forall t. Sort' t -&gt; Sort' t -&gt; Sort' t
</span><a href="Agda.Syntax.Internal.html#FunSort"><span class="hs-identifier hs-var">FunSort</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort -&gt; Sort -&gt; Sort)
-&gt; ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) (Sort -&gt; Sort)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-var">flexibly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057659"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) (Sort -&gt; Sort)
-&gt; ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a b.
ReaderT OccursCtx (TCMT IO) (a -&gt; b)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-var">flexibly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057660"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Univ"><span class="hs-identifier hs-type">Univ</span></a></span><span> </span><span id="local-6989586621682057662"><span class="annot"><span class="annottext">Univ
</span><a href="#local-6989586621682057662"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621682057663"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682057663"><span class="hs-identifier hs-var">a</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Univ -&gt; Level -&gt; Sort
forall t. Univ -&gt; Level' t -&gt; Sort' t
</span><a href="Agda.Syntax.Internal.html#Univ"><span class="hs-identifier hs-var">Univ</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><a href="#local-6989586621682057662"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">(Level -&gt; Sort)
-&gt; ReaderT OccursCtx (TCMT IO) Level
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Level -&gt; ReaderT OccursCtx (TCMT IO) Level
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682057663"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-597"></span><span>      </span><span id="local-6989586621682057664"><span class="annot"><span class="annottext">s :: Sort
</span><a href="#local-6989586621682057664"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Agda.Syntax.Internal.html#Inf"><span class="hs-identifier hs-type">Inf</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057664"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-598"></span><span>      </span><span id="local-6989586621682057666"><span class="annot"><span class="annottext">s :: Sort
</span><a href="#local-6989586621682057666"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#SizeUniv"><span class="hs-identifier hs-var">SizeUniv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057666"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-599"></span><span>      </span><span id="local-6989586621682057668"><span class="annot"><span class="annottext">s :: Sort
</span><a href="#local-6989586621682057668"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#LockUniv"><span class="hs-identifier hs-var">LockUniv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057668"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-600"></span><span>      </span><span id="local-6989586621682057670"><span class="annot"><span class="annottext">s :: Sort
</span><a href="#local-6989586621682057670"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#LevelUniv"><span class="hs-identifier hs-var">LevelUniv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057670"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-601"></span><span>      </span><span id="local-6989586621682057672"><span class="annot"><span class="annottext">s :: Sort
</span><a href="#local-6989586621682057672"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#IntervalUniv"><span class="hs-identifier hs-var">IntervalUniv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057672"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-602"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#UnivSort"><span class="hs-identifier hs-type">UnivSort</span></a></span><span> </span><span id="local-6989586621682057675"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057675"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; Sort
forall t. Sort' t -&gt; Sort' t
</span><a href="Agda.Syntax.Internal.html#UnivSort"><span class="hs-identifier hs-var">UnivSort</span></a></span><span> </span><span class="annot"><span class="annottext">(Sort -&gt; Sort)
-&gt; ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. OccursM a -&gt; OccursM a
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#flexibly"><span class="hs-identifier hs-var">flexibly</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT OccursCtx (TCMT IO) Sort
 -&gt; ReaderT OccursCtx (TCMT IO) Sort)
-&gt; ReaderT OccursCtx (TCMT IO) Sort
-&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057675"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-603"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaS"><span class="hs-identifier hs-type">MetaS</span></a></span><span> </span><span id="local-6989586621682057677"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057677"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682057678"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057678"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-604"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span> </span><span id="local-6989586621682057679"><span class="annot"><a href="#local-6989586621682057679"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682057680"><span class="annot"><a href="#local-6989586621682057680"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-var">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057677"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057678"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaS"><span class="hs-identifier hs-type">MetaS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057679"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057680"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-606"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefS"><span class="hs-identifier hs-type">DefS</span></a></span><span> </span><span id="local-6989586621682057682"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057682"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682057683"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057683"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-607"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682057684"><span class="annot"><a href="#local-6989586621682057684"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682057685"><span class="annot"><a href="#local-6989586621682057685"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057682"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057683"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefS"><span class="hs-identifier hs-type">DefS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057684"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057685"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-609"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DummyS"><span class="hs-identifier hs-type">DummyS</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; ReaderT OccursCtx (TCMT IO) Sort
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057646"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>  </span><span id="local-6989586621682057710"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Sort -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057711"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682057712"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057712"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>    </span><span id="local-6989586621682057713"><span class="annot"><a href="#local-6989586621682057713"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Sort -&gt; TCMT IO Sort
forall a (m :: * -&gt; *). (Instantiate a, MonadReduce m) =&gt; a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiate"><span class="hs-identifier hs-var">instantiate</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057712"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682057713"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-614"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#PiSort"><span class="hs-identifier hs-type">PiSort</span></a></span><span> </span><span id="local-6989586621682057714"><span class="annot"><span class="annottext">Dom' Term Term
</span><a href="#local-6989586621682057714"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682057715"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057715"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682057716"><span class="annot"><span class="annottext">Abs Sort
</span><a href="#local-6989586621682057716"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-615"></span><span>        </span><span class="annot"><span class="annottext">MetaId -&gt; Dom' Term Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Dom' Term Term
</span><a href="#local-6989586621682057714"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-616"></span><span>        </span><span class="annot"><span class="annottext">MetaId -&gt; Sort -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057715"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-617"></span><span>        </span><span class="annot"><span class="annottext">MetaId -&gt; Sort -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Abs Sort -&gt; Sort
forall a. Subst a =&gt; Abs a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#absBody"><span class="hs-identifier hs-var">absBody</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Sort
</span><a href="#local-6989586621682057716"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#FunSort"><span class="hs-identifier hs-type">FunSort</span></a></span><span> </span><span id="local-6989586621682057718"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057718"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682057719"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057719"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Sort -&gt; Sort -&gt; TCM ()
forall a b. (Occurs a, Occurs b) =&gt; MetaId -&gt; a -&gt; b -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs2"><span class="hs-identifier hs-var">metaOccurs2</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057718"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057719"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-619"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Univ"><span class="hs-identifier hs-type">Univ</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057720"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682057720"><span class="hs-identifier hs-var">a</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Level -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682057720"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-620"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Inf"><span class="hs-identifier hs-type">Inf</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>      </span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#SizeUniv"><span class="hs-identifier hs-var">SizeUniv</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>      </span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#LockUniv"><span class="hs-identifier hs-var">LockUniv</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>      </span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#LevelUniv"><span class="hs-identifier hs-var">LevelUniv</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>      </span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#IntervalUniv"><span class="hs-identifier hs-var">IntervalUniv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#UnivSort"><span class="hs-identifier hs-type">UnivSort</span></a></span><span> </span><span id="local-6989586621682057721"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057721"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Sort -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682057721"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-626"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaS"><span class="hs-identifier hs-type">MetaS</span></a></span><span> </span><span id="local-6989586621682057722"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057722"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682057723"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057723"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TCM ()) -&gt; Term -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-var">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057722"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057723"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-627"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefS"><span class="hs-identifier hs-type">DefS</span></a></span><span> </span><span id="local-6989586621682057724"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057724"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682057725"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057725"><span class="hs-identifier hs-var">es</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; TCM ()) -&gt; Term -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057724"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057725"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-628"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DummyS"><span class="hs-identifier hs-type">DummyS</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-631"></span><span>  </span><span id="local-6989586621682057760"><span class="annot"><span class="annottext">occurs :: Elims -&gt; ReaderT OccursCtx (TCMT IO) Elims
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; ReaderT OccursCtx (TCMT IO) Elims
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-632"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057761"><span class="annot"><span class="annottext">Elim' Term
</span><a href="#local-6989586621682057761"><span class="hs-identifier hs-var">e</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682057762"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057762"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; OccursM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs.elim&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">45</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; OccursM ()) -&gt; TCMT IO Doc -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Elim' Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Elim' Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Elim' Term
</span><a href="#local-6989586621682057761"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-634"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; OccursM ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.occurs.elim&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">70</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; OccursM ()) -&gt; TCMT IO Doc -&gt; OccursM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;occurs&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Elim' Term -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Elim' Term
</span><a href="#local-6989586621682057761"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-635"></span><span>    </span><span id="local-6989586621682057763"><span class="annot"><a href="#local-6989586621682057763"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Elim' Term
</span><a href="#local-6989586621682057761"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-636"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span> </span><span id="local-6989586621682057765"><span class="annot"><span class="annottext">ProjOrigin
</span><a href="#local-6989586621682057765"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621682057766"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057766"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-637"></span><span>        </span><span class="annot"><span class="annottext">QName -&gt; OccursM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#definitionCheck"><span class="hs-identifier hs-var">definitionCheck</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682057766"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-638"></span><span>        </span><span class="annot"><span class="annottext">Elim' Term -&gt; ReaderT OccursCtx (TCMT IO) (Elim' Term)
forall a. a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Elim' Term
</span><a href="#local-6989586621682057761"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-639"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682057768"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682057768"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-640"></span><span>        </span><span id="local-6989586621682057769"><span class="annot"><a href="#local-6989586621682057769"><span class="hs-identifier hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; OccursM (Arg Term)
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682057768"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-641"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057769"><span class="hs-identifier hs-type">u'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span id="local-6989586621682057770"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057770"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682057771"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057771"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621682057772"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057772"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-643"></span><span>        </span><span id="local-6989586621682057773"><span class="annot"><a href="#local-6989586621682057773"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057770"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-644"></span><span>        </span><span id="local-6989586621682057774"><span class="annot"><a href="#local-6989586621682057774"><span class="hs-identifier hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057771"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-645"></span><span>        </span><span id="local-6989586621682057775"><span class="annot"><a href="#local-6989586621682057775"><span class="hs-identifier hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057772"><span class="hs-identifier hs-type">u</span></a></span><span>
</span><span id="line-646"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057773"><span class="hs-identifier hs-type">x'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057774"><span class="hs-identifier hs-type">y'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057775"><span class="hs-identifier hs-type">u'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">e'</span></span><span class="annot"><span class="hs-glyph">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682057762"><span class="hs-identifier hs-type">es</span></a></span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>  </span><span id="local-6989586621682057783"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Elims -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057784"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057784"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682057785"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057785"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; (Elim' Term -&gt; TCM ()) -&gt; TCM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682057785"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">((Elim' Term -&gt; TCM ()) -&gt; TCM ())
-&gt; (Elim' Term -&gt; TCM ()) -&gt; TCM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-650"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TCM ()
forall a. a -&gt; TCMT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682057787"><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682057787"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Arg Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057784"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Arg Term
</span><a href="#local-6989586621682057787"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-652"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span id="local-6989586621682057788"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057788"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682057789"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057789"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621682057790"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057790"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; Term -&gt; Term -&gt; TCM ()
forall a b c.
(Occurs a, Occurs b, Occurs c) =&gt;
MetaId -&gt; a -&gt; b -&gt; c -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs3"><span class="hs-identifier hs-var">metaOccurs3</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057784"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057788"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057789"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057790"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-655"></span><span>  </span><span id="local-6989586621682057801"><span class="annot"><span class="annottext">occurs :: Abs Term -&gt; ReaderT OccursCtx (TCMT IO) (Abs Term)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-type">NoAbs</span></a></span><span> </span><span id="local-6989586621682057803"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682057803"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682057804"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057804"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Term -&gt; Abs Term
forall a. String -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-var">NoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682057803"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Abs Term)
-&gt; OccursM Term -&gt; ReaderT OccursCtx (TCMT IO) (Abs Term)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057804"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-656"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span id="local-6989586621682057805"><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682057805"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; OccursM Term)
-&gt; Abs Term -&gt; ReaderT OccursCtx (TCMT IO) (Abs Term)
forall a b (m :: * -&gt; *).
(Subst a, Subst b, MonadAddContext m) =&gt;
(a -&gt; m b) -&gt; Abs a -&gt; m (Abs b)
</span><a href="Agda.TypeChecking.Monad.Context.html#mapAbstraction_"><span class="hs-identifier hs-var">mapAbstraction_</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682057807"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057807"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccursM Term -&gt; OccursM Term
forall a b c (m :: * -&gt; *) z.
MonadReader (FreeEnv' a b c) m =&gt;
m z -&gt; m z
</span><a href="Agda.TypeChecking.Free.Lazy.html#underBinder"><span class="hs-identifier hs-var">underBinder</span></a></span><span> </span><span class="annot"><span class="annottext">(OccursM Term -&gt; OccursM Term) -&gt; OccursM Term -&gt; OccursM Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; OccursM Term
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057807"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682057805"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>  </span><span id="local-6989586621682057810"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Abs Term -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057811"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057811"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span>   </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057813"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057813"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057811"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057813"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-659"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057814"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057814"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-type">NoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057815"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057815"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Term -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057814"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682057815"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-662"></span><span>  </span><span id="local-6989586621682057836"><span class="annot"><span class="annottext">occurs :: Abs Type -&gt; ReaderT OccursCtx (TCMT IO) (Abs Type)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-type">NoAbs</span></a></span><span> </span><span id="local-6989586621682057837"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682057837"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682057838"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057838"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Type -&gt; Abs Type
forall a. String -&gt; a -&gt; Abs a
</span><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-var">NoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682057837"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Abs Type)
-&gt; ReaderT OccursCtx (TCMT IO) Type
-&gt; ReaderT OccursCtx (TCMT IO) (Abs Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ReaderT OccursCtx (TCMT IO) Type
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057838"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-663"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span id="local-6989586621682057839"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682057839"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ReaderT OccursCtx (TCMT IO) Type)
-&gt; Abs Type -&gt; ReaderT OccursCtx (TCMT IO) (Abs Type)
forall a b (m :: * -&gt; *).
(Subst a, Subst b, MonadAddContext m) =&gt;
(a -&gt; m b) -&gt; Abs a -&gt; m (Abs b)
</span><a href="Agda.TypeChecking.Monad.Context.html#mapAbstraction_"><span class="hs-identifier hs-var">mapAbstraction_</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682057840"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057840"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) Type
-&gt; ReaderT OccursCtx (TCMT IO) Type
forall a b c (m :: * -&gt; *) z.
MonadReader (FreeEnv' a b c) m =&gt;
m z -&gt; m z
</span><a href="Agda.TypeChecking.Free.Lazy.html#underBinder"><span class="hs-identifier hs-var">underBinder</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT OccursCtx (TCMT IO) Type
 -&gt; ReaderT OccursCtx (TCMT IO) Type)
-&gt; ReaderT OccursCtx (TCMT IO) Type
-&gt; ReaderT OccursCtx (TCMT IO) Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ReaderT OccursCtx (TCMT IO) Type
forall t. (Occurs t, TypeOf t ~ ()) =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs_"><span class="hs-identifier hs-var">occurs_</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057840"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682057839"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span>  </span><span id="local-6989586621682057843"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Abs Type -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057844"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057844"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span>   </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057845"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057845"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Type -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057844"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057845"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-666"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span id="local-6989586621682057846"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057846"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#NoAbs"><span class="hs-identifier hs-type">NoAbs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057847"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057847"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Type -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057846"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057847"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682056281"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056281"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056281"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-669"></span><span>  </span><span id="local-6989586621682057862"><span class="annot"><span class="annottext">occurs :: Arg a -&gt; OccursM (Arg a)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682057864"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057864"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682057865"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057865"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; a -&gt; Arg a
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057864"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Arg a) -&gt; ReaderT OccursCtx (TCMT IO) a -&gt; OccursM (Arg a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-670"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; (ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a)
-&gt; ReaderT OccursCtx (TCMT IO) a
-&gt; ReaderT OccursCtx (TCMT IO) a
forall b a. IsBool b =&gt; b -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Agda.Utils.Function.html#applyWhen"><span class="hs-identifier hs-var">applyWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-var">isIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057864"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall (m :: * -&gt; *) a. MonadTCEnv m =&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Monad.Env.html#onlyReduceTypes"><span class="hs-identifier hs-var">onlyReduceTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-671"></span><span>      </span><span class="annot"><span class="annottext">ArgInfo
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall r (m :: * -&gt; *) o z.
(MonadReader r m, LensModality r, LensModality o) =&gt;
o -&gt; m z -&gt; m z
</span><a href="Agda.TypeChecking.Free.Lazy.html#underModality"><span class="hs-identifier hs-var">underModality</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057864"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a)
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ReaderT OccursCtx (TCMT IO) a
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057865"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-672"></span><span>  </span><span id="local-6989586621682057869"><span class="annot"><span class="annottext">metaOccurs :: MetaId -&gt; Arg a -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var hs-var hs-var">metaOccurs</span></a></span></span><span> </span><span id="local-6989586621682057870"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057870"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; a -&gt; TCM ()
forall t. Occurs t =&gt; MetaId -&gt; t -&gt; TCM ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#metaOccurs"><span class="hs-identifier hs-var">metaOccurs</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057870"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; TCM ()) -&gt; (Arg a -&gt; a) -&gt; Arg a -&gt; TCM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; a
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682056186"><span id="local-6989586621682057875"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056186"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056186"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-type">occurs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056186"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056186"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#OccursM"><span class="hs-identifier hs-type">OccursM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056186"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>  </span><span id="local-6989586621682057889"><span class="annot"><span class="annottext">occurs :: Occurs a =&gt; Dom a -&gt; OccursM (Dom a)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var hs-var hs-var">occurs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span id="local-6989586621682057891"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057891"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621682057892"><span class="annot"><span class="annottext">Maybe NamedName
</span><a href="#local-6989586621682057892"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682057893"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682057893"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682057894"><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682057894"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621682057895"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057895"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-677"></span><span>    </span><span class="annot"><span class="annottext">ArgInfo -&gt; Maybe NamedName -&gt; Bool -&gt; Maybe Term -&gt; a -&gt; Dom a
forall t e.
ArgInfo -&gt; Maybe NamedName -&gt; Bool -&gt; Maybe t -&gt; e -&gt; Dom' t e
</span><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-var">Dom</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057891"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NamedName
</span><a href="#local-6989586621682057892"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682057893"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Term
</span><a href="#local-6989586621682057894"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Dom a) -&gt; ReaderT OccursCtx (TCMT IO) a -&gt; OccursM (Dom a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ArgInfo
-&gt; ReaderT OccursCtx (TCMT IO) a -&gt; ReaderT OccursCtx (TCMT IO) a
forall r (m :: * -&gt; *) o a.
(MonadReader r m, LensQuantity r, LensQuantity o) =&gt;
o -&gt; m a -&gt; m a
</span><a href="Agda.TypeChecking.Free.Lazy.html#underQuantity"><span class="hs-identifier hs-var">underQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682057891"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ReaderT OccursCtx (TCMT IO) a
forall t. Occurs t =&gt; t -&gt; OccursM t
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#occurs"><span class="hs-identifier hs-var">occurs</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057895"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="hs-comment">---------------------------------------------------------------------------</span><span>
</span><span id="line-680"></span><span class="annot"><span class="hs-comment">-- * Pruning: getting rid of flexible occurrences.</span></span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="hs-comment">-- | @prune m' vs xs@ attempts to remove all arguments from @vs@ whose</span><span>
</span><span id="line-683"></span><span class="hs-comment">--   free variables are not contained in @xs@.</span><span>
</span><span id="line-684"></span><span class="hs-comment">--   If successful, @m'@ is solved by the new, pruned meta variable and we</span><span>
</span><span id="line-685"></span><span class="hs-comment">--   return @True@ else @False@.</span><span>
</span><span id="line-686"></span><span class="hs-comment">--</span><span>
</span><span id="line-687"></span><span class="hs-comment">--   Issue 1147:</span><span>
</span><span id="line-688"></span><span class="hs-comment">--   If any of the meta args @vs@ is matchable, e.g., is a constructor term,</span><span>
</span><span id="line-689"></span><span class="hs-comment">--   we cannot prune, because the offending variables could be removed by</span><span>
</span><span id="line-690"></span><span class="hs-comment">--   reduction for a suitable instantiation of the meta variable.</span><span>
</span><span id="line-691"></span><span id="local-6989586621682056228"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#prune"><span class="hs-identifier hs-type">prune</span></a></span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056228"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#MonadMetaSolver"><span class="hs-identifier hs-type">MonadMetaSolver</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056228"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Meta to prune.</span></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Arguments to meta variable.</span></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Test for allowed variable (de Bruijn index).</span></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056228"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PruneResult"><span class="hs-identifier hs-type">PruneResult</span></a></span></span><span>
</span><span id="line-697"></span><span id="prune"><span class="annot"><span class="annottext">prune :: forall (m :: * -&gt; *).
(PureTCM m, MonadMetaSolver m) =&gt;
MetaId -&gt; [Arg Term] -&gt; (Nat -&gt; Bool) -&gt; m PruneResult
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#prune"><span class="hs-identifier hs-var hs-var">prune</span></a></span></span><span> </span><span id="local-6989586621682057939"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057939"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span id="local-6989586621682057940"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682057940"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621682057941"><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682057941"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-698"></span><span>  </span><span class="annot"><span class="annottext">m (Either () [Bool])
-&gt; (() -&gt; m PruneResult)
-&gt; ([Bool] -&gt; m PruneResult)
-&gt; m PruneResult
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
m (Either a b) -&gt; (a -&gt; m c) -&gt; (b -&gt; m c) -&gt; m c
</span><a href="Agda.Utils.Either.html#caseEitherM"><span class="hs-identifier hs-var">caseEitherM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT () m [Bool] -&gt; m (Either () [Bool])
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT () m [Bool] -&gt; m (Either () [Bool]))
-&gt; ExceptT () m [Bool] -&gt; m (Either () [Bool])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; ExceptT () m Bool)
-&gt; [Arg Term] -&gt; ExceptT () m [Bool]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Nat -&gt; Bool) -&gt; Term -&gt; ExceptT () m Bool
forall (m :: * -&gt; *).
PureTCM m =&gt;
(Nat -&gt; Bool) -&gt; Term -&gt; ExceptT () m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#hasBadRigid"><span class="hs-identifier hs-var">hasBadRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682057941"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term -&gt; ExceptT () m Bool)
-&gt; (Arg Term -&gt; Term) -&gt; Arg Term -&gt; ExceptT () m Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682057940"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m PruneResult -&gt; () -&gt; m PruneResult
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(m PruneResult -&gt; () -&gt; m PruneResult)
-&gt; m PruneResult -&gt; () -&gt; m PruneResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PruneResult -&gt; m PruneResult
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PruneResult
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#PrunedNothing"><span class="hs-identifier hs-var">PrunedNothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Bool] -&gt; m PruneResult) -&gt; m PruneResult)
-&gt; ([Bool] -&gt; m PruneResult) -&gt; m PruneResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682057946"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682057946"><span class="hs-identifier hs-var">kills</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-700"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.kill&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-701"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;attempting kills&quot;</span></span><span>
</span><span id="line-702"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Nat -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-703"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;m'    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057939"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-704"></span><span>        </span><span class="hs-comment">-- , &quot;xs    =&quot; &lt;+&gt; prettyList (map (prettyTCM . var) xs)  -- no longer printable</span><span>
</span><span id="line-705"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;vs    =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Term -&gt; TCMT IO Doc) -&gt; [Arg Term] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Arg Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682057940"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;kills =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682057946"><span class="hs-identifier hs-var">kills</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-708"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-709"></span><span>    </span><span class="annot"><span class="annottext">[Bool] -&gt; MetaId -&gt; m PruneResult
forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
[Bool] -&gt; MetaId -&gt; m PruneResult
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#killArgs"><span class="hs-identifier hs-var">killArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682057946"><span class="hs-identifier hs-var">kills</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682057939"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span class="hs-comment">-- | @hasBadRigid xs v = Just True@ iff one of the rigid variables in @v@ is not in @xs@.</span><span>
</span><span id="line-712"></span><span class="hs-comment">--   Actually we can only prune if a bad variable is in the head. See issue 458.</span><span>
</span><span id="line-713"></span><span class="hs-comment">--   Or in a non-eliminateable position (see succeed/PruningNonMillerPattern).</span><span>
</span><span id="line-714"></span><span class="hs-comment">--</span><span>
</span><span id="line-715"></span><span class="hs-comment">--   @hasBadRigid xs v = Nothing@ means that</span><span>
</span><span id="line-716"></span><span class="hs-comment">--   we cannot prune at all as one of the meta args is matchable.</span><span>
</span><span id="line-717"></span><span class="hs-comment">--   (See issue 1147.)</span><span>
</span><span id="line-718"></span><span id="local-6989586621682056334"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#hasBadRigid"><span class="hs-identifier hs-type">hasBadRigid</span></a></span><span>
</span><span id="line-719"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056334"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-720"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ Test for allowed variable (de Bruijn index).</span></span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Argument of meta variable.</span></span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682056334"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Exception if argument is matchable.</span></span><span>
</span><span id="line-723"></span><span id="hasBadRigid"><span class="annot"><span class="annottext">hasBadRigid :: forall (m :: * -&gt; *).
PureTCM m =&gt;
(Nat -&gt; Bool) -&gt; Term -&gt; ExceptT () m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#hasBadRigid"><span class="hs-identifier hs-var hs-var">hasBadRigid</span></a></span></span><span> </span><span id="local-6989586621682058013"><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058013"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682058014"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058014"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-comment">-- We fail if we encounter a matchable argument.</span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058021"><span class="annot"><span class="annottext">failure :: ExceptT () m a
</span><a href="#local-6989586621682058021"><span class="hs-identifier hs-var hs-var hs-var">failure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT () m a
forall a. () -&gt; ExceptT () m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span>  </span><span id="local-6989586621682058022"><span class="annot"><a href="#local-6989586621682058022"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; ExceptT () m (Blocked Term)
forall a (m :: * -&gt; *).
(Reduce a, MonadReduce m) =&gt;
a -&gt; m (Blocked a)
</span><a href="Agda.TypeChecking.Reduce.html#reduceB"><span class="hs-identifier hs-var">reduceB</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058014"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058023"><span class="annot"><a href="#local-6989586621682058023"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocked Term -&gt; Term
forall t a. Blocked' t a -&gt; a
</span><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682058022"><span class="hs-identifier hs-var">tb</span></a></span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621682058023"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-729"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682058024"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058024"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT () m Bool
forall a. a -&gt; ExceptT () m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; ExceptT () m Bool) -&gt; Bool -&gt; ExceptT () m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058013"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058024"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-comment">-- Issue 1153: A lambda has to be considered matchable.</span><span>
</span><span id="line-731"></span><span>    </span><span class="hs-comment">-- Lam _ v    -&gt; hasBadRigid (0 : map (+1) xs) (absBody v)</span><span>
</span><span id="line-732"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058025"><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682058025"><span class="hs-identifier hs-var">v</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT () m Bool
forall {a}. ExceptT () m a
</span><a href="#local-6989586621682058021"><span class="hs-identifier hs-var">failure</span></a></span><span>
</span><span id="line-733"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span> </span><span id="local-6989586621682058026"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058026"><span class="hs-identifier hs-var">v</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; Bool) -&gt; Term -&gt; ExceptT () m Bool
forall (m :: * -&gt; *).
PureTCM m =&gt;
(Nat -&gt; Bool) -&gt; Term -&gt; ExceptT () m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#hasBadRigid"><span class="hs-identifier hs-var">hasBadRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058013"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058026"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-734"></span><span>    </span><span class="hs-comment">-- The following types of arguments cannot be eliminated by a pattern</span><span>
</span><span id="line-735"></span><span>    </span><span class="hs-comment">-- match: data, record, Pi, levels, sorts</span><span>
</span><span id="line-736"></span><span>    </span><span class="hs-comment">-- Thus, their offending rigid variables are bad.</span><span>
</span><span id="line-737"></span><span>    </span><span id="local-6989586621682058027"><span class="annot"><span class="annottext">v :: Term
</span><a href="#local-6989586621682058027"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621682058028"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682058028"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682058029"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058029"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT () m Bool
-&gt; ExceptT () m Bool -&gt; ExceptT () m Bool -&gt; ExceptT () m Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifNotM"><span class="hs-identifier hs-var">ifNotM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocked Term -&gt; QName -&gt; Elims -&gt; ExceptT () m Bool
forall (m :: * -&gt; *) t.
HasConstInfo m =&gt;
Blocked t -&gt; QName -&gt; Elims -&gt; m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#isNeutral"><span class="hs-identifier hs-var">isNeutral</span></a></span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682058022"><span class="hs-identifier hs-var">tb</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682058028"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058029"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExceptT () m Bool
forall {a}. ExceptT () m a
</span><a href="#local-6989586621682058021"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT () m Bool -&gt; ExceptT () m Bool)
-&gt; ExceptT () m Bool -&gt; ExceptT () m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-comment">{- else -}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-738"></span><span>      </span><span class="annot"><span class="annottext">m Bool -&gt; ExceptT () m Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Bool -&gt; ExceptT () m Bool) -&gt; m Bool -&gt; ExceptT () m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058029"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Elims -&gt; (Nat -&gt; Bool) -&gt; m Bool
forall (m :: * -&gt; *) a.
(PureTCM m, AnyRigid a) =&gt;
a -&gt; (Nat -&gt; Bool) -&gt; m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#rigidVarsNotContainedIn"><span class="hs-operator hs-var">`rigidVarsNotContainedIn`</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058013"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-739"></span><span>    </span><span class="hs-comment">-- Andreas, 2012-05-03: There is room for further improvement.</span><span>
</span><span id="line-740"></span><span>    </span><span class="hs-comment">-- We could also consider a defined f which is not blocked by a meta.</span><span>
</span><span id="line-741"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621682058033"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682058033"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682058034"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682058034"><span class="hs-identifier hs-var">b</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; ExceptT () m Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Bool -&gt; ExceptT () m Bool) -&gt; m Bool -&gt; ExceptT () m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682058033"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682058034"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Dom Type, Abs Type) -&gt; (Nat -&gt; Bool) -&gt; m Bool
forall (m :: * -&gt; *) a.
(PureTCM m, AnyRigid a) =&gt;
a -&gt; (Nat -&gt; Bool) -&gt; m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#rigidVarsNotContainedIn"><span class="hs-operator hs-var">`rigidVarsNotContainedIn`</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058013"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-742"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span id="local-6989586621682058035"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682058035"><span class="hs-identifier hs-var">v</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; ExceptT () m Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Bool -&gt; ExceptT () m Bool) -&gt; m Bool -&gt; ExceptT () m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682058035"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Level -&gt; (Nat -&gt; Bool) -&gt; m Bool
forall (m :: * -&gt; *) a.
(PureTCM m, AnyRigid a) =&gt;
a -&gt; (Nat -&gt; Bool) -&gt; m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#rigidVarsNotContainedIn"><span class="hs-operator hs-var">`rigidVarsNotContainedIn`</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058013"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-743"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span id="local-6989586621682058036"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058036"><span class="hs-identifier hs-var">s</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; ExceptT () m Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ExceptT () m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Bool -&gt; ExceptT () m Bool) -&gt; m Bool -&gt; ExceptT () m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058036"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Sort -&gt; (Nat -&gt; Bool) -&gt; m Bool
forall (m :: * -&gt; *) a.
(PureTCM m, AnyRigid a) =&gt;
a -&gt; (Nat -&gt; Bool) -&gt; m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#rigidVarsNotContainedIn"><span class="hs-operator hs-var">`rigidVarsNotContainedIn`</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058013"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-744"></span><span>    </span><span class="hs-comment">-- Since constructors can be eliminated by pattern-matching,</span><span>
</span><span id="line-745"></span><span>    </span><span class="hs-comment">-- offending variables under a constructor could be removed by</span><span>
</span><span id="line-746"></span><span>    </span><span class="hs-comment">-- the right instantiation of the meta variable.</span><span>
</span><span id="line-747"></span><span>    </span><span class="hs-comment">-- Thus, they are not rigid.</span><span>
</span><span id="line-748"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682058037"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682058037"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058038"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058038"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621682058039"><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682058039"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Elims -&gt; Maybe [Arg Term]
forall a. [Elim' a] -&gt; Maybe [Arg a]
</span><a href="Agda.Syntax.Internal.Elim.html#allApplyElims"><span class="hs-identifier hs-var">allApplyElims</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058038"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-749"></span><span>      </span><span class="annot"><span class="annottext">ExceptT () m Bool
-&gt; ExceptT () m Bool -&gt; ExceptT () m Bool -&gt; ExceptT () m Bool
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="Agda.Utils.Monad.html#ifM"><span class="hs-identifier hs-var">ifM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; ExceptT () m Bool
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Bool
</span><a href="Agda.TypeChecking.Records.html#isEtaCon"><span class="hs-identifier hs-var">isEtaCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConHead -&gt; QName
</span><a href="Agda.Syntax.Internal.html#conName"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682058037"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-750"></span><span>        </span><span class="hs-comment">-- in case of a record con, we can in principle prune</span><span>
</span><span id="line-751"></span><span>        </span><span class="hs-comment">-- (but not this argument; the meta could become a projection!)</span><span>
</span><span id="line-752"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool) -&gt; ExceptT () m [Bool] -&gt; ExceptT () m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; ExceptT () m Bool)
-&gt; [Arg Term] -&gt; ExceptT () m [Bool]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Nat -&gt; Bool) -&gt; Term -&gt; ExceptT () m Bool
forall (m :: * -&gt; *).
PureTCM m =&gt;
(Nat -&gt; Bool) -&gt; Term -&gt; ExceptT () m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#hasBadRigid"><span class="hs-identifier hs-var">hasBadRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058013"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; ExceptT () m Bool)
-&gt; (Arg Term -&gt; Term) -&gt; Arg Term -&gt; ExceptT () m Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Term
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682058039"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- not andM, we need to force the exceptions!</span><span>
</span><span id="line-753"></span><span>        </span><span class="annot"><span class="annottext">ExceptT () m Bool
forall {a}. ExceptT () m a
</span><a href="#local-6989586621682058021"><span class="hs-identifier hs-var">failure</span></a></span><span>
</span><span id="line-754"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span id="local-6989586621682058042"><span class="annot"><span class="annottext">ConHead
</span><a href="#local-6989586621682058042"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058043"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058043"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT () m Bool
forall {a}. ExceptT () m a
</span><a href="#local-6989586621682058021"><span class="hs-identifier hs-var">failure</span></a></span><span>
</span><span id="line-755"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT () m Bool
forall {a}. ExceptT () m a
</span><a href="#local-6989586621682058021"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="hs-comment">-- matchable</span><span>
</span><span id="line-756"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT () m Bool
forall {a}. ExceptT () m a
</span><a href="#local-6989586621682058021"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="hs-comment">-- potentially matchable</span><span>
</span><span id="line-757"></span><span>    </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT () m Bool
forall a. a -&gt; ExceptT () m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="hs-comment">-- | Check whether a term @Def f es@ is finally stuck.</span><span>
</span><span id="line-760"></span><span class="hs-comment">--   Currently, we give only a crude approximation.</span><span>
</span><span id="line-761"></span><span id="local-6989586621682056356"><span id="local-6989586621682056357"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#isNeutral"><span class="hs-identifier hs-type">isNeutral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Signature.html#HasConstInfo"><span class="hs-identifier hs-type">HasConstInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056356"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056357"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Elims"><span class="hs-identifier hs-type">Elims</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056356"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-762"></span><span id="isNeutral"><span class="annot"><span class="annottext">isNeutral :: forall (m :: * -&gt; *) t.
HasConstInfo m =&gt;
Blocked t -&gt; QName -&gt; Elims -&gt; m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#isNeutral"><span class="hs-identifier hs-var hs-var">isNeutral</span></a></span></span><span> </span><span id="local-6989586621682058059"><span class="annot"><span class="annottext">Blocked t
</span><a href="#local-6989586621682058059"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682058060"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682058060"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682058061"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058061"><span class="hs-identifier hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058065"><span class="annot"><span class="annottext">yes :: m Bool
</span><a href="#local-6989586621682058065"><span class="hs-identifier hs-var hs-var hs-var">yes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-764"></span><span>      </span><span id="local-6989586621682058069"><span class="annot"><span class="annottext">no :: m Bool
</span><a href="#local-6989586621682058069"><span class="hs-identifier hs-var hs-var hs-var">no</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-765"></span><span>  </span><span id="local-6989586621682058070"><span class="annot"><a href="#local-6989586621682058070"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QName -&gt; m Definition
forall (m :: * -&gt; *). HasConstInfo m =&gt; QName -&gt; m Definition
</span><a href="Agda.TypeChecking.Monad.Signature.html#getConstInfo"><span class="hs-identifier hs-var">getConstInfo</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621682058060"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#defMatchable"><span class="hs-identifier hs-var">defMatchable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058070"><span class="hs-identifier hs-type">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621682058069"><span class="hs-identifier hs-type">no</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#theDef"><span class="hs-identifier hs-var">theDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058070"><span class="hs-identifier hs-type">def</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-768"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#AbstractDefn"><span class="hs-identifier hs-type">AbstractDefn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621682058065"><span class="hs-identifier hs-var">yes</span></a></span><span>
</span><span id="line-769"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Axiom"><span class="hs-identifier hs-type">Axiom</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621682058065"><span class="hs-identifier hs-var">yes</span></a></span><span>
</span><span id="line-770"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621682058065"><span class="hs-identifier hs-var">yes</span></a></span><span>
</span><span id="line-771"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621682058065"><span class="hs-identifier hs-var">yes</span></a></span><span>
</span><span id="line-772"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Blocked t
</span><a href="#local-6989586621682058059"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-773"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#StuckOn"><span class="hs-identifier hs-type">StuckOn</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621682058065"><span class="hs-identifier hs-var">yes</span></a></span><span>
</span><span id="line-774"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="annot"><span class="annottext">NotBlocked' Term
</span><a href="Agda.Syntax.Internal.Blockers.html#AbsurdMatch"><span class="hs-identifier hs-var">AbsurdMatch</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621682058065"><span class="hs-identifier hs-var">yes</span></a></span><span>
</span><span id="line-775"></span><span>      </span><span class="annot"><span class="annottext">Blocked t
</span><span class="hs-identifier">_</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621682058069"><span class="hs-identifier hs-var">no</span></a></span><span>
</span><span id="line-776"></span><span>    </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#GeneralizableVar"><span class="hs-identifier hs-type">GeneralizableVar</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-777"></span><span>    </span><span class="annot"><span class="annottext">Defn
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m Bool
</span><a href="#local-6989586621682058069"><span class="hs-identifier hs-var">no</span></a></span><span>
</span><span id="line-778"></span><span>
</span><span id="line-779"></span><span class="hs-comment">-- | Check whether any of the variables (given as de Bruijn indices)</span><span>
</span><span id="line-780"></span><span class="hs-comment">--   occurs *definitely* in the term in a rigid position.</span><span>
</span><span id="line-781"></span><span class="hs-comment">--   Reduces the term successively to remove variables in dead subterms.</span><span>
</span><span id="line-782"></span><span class="hs-comment">--   This fixes issue 1386.</span><span>
</span><span id="line-783"></span><span id="local-6989586621682056358"><span id="local-6989586621682056359"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#rigidVarsNotContainedIn"><span class="hs-identifier hs-type">rigidVarsNotContainedIn</span></a></span><span>
</span><span id="line-784"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056358"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056359"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056359"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Test for allowed variable (de Bruijn index).</span></span><span>
</span><span id="line-787"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056358"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-788"></span><span id="rigidVarsNotContainedIn"><span class="annot"><span class="annottext">rigidVarsNotContainedIn :: forall (m :: * -&gt; *) a.
(PureTCM m, AnyRigid a) =&gt;
a -&gt; (Nat -&gt; Bool) -&gt; m Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#rigidVarsNotContainedIn"><span class="hs-identifier hs-var hs-var">rigidVarsNotContainedIn</span></a></span></span><span> </span><span id="local-6989586621682058100"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058100"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621682058101"><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058101"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-789"></span><span>  </span><span id="local-6989586621682058102"><span class="annot"><a href="#local-6989586621682058102"><span class="hs-identifier hs-var">n0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Nat
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Nat
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextSize"><span class="hs-identifier hs-var">getContextSize</span></a></span><span>
</span><span id="line-790"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- allowed variables as de Bruijn levels</span><span>
</span><span id="line-791"></span><span>      </span><span id="local-6989586621682058103"><span class="annot"><a href="#local-6989586621682058103"><span class="hs-identifier hs-var hs-var">levels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058101"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; Bool) -&gt; (Nat -&gt; Nat) -&gt; Nat -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058102"><span class="hs-identifier hs-var">n0</span></a></span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="hs-special">)</span><span>
</span><span id="line-792"></span><span>      </span><span class="hs-comment">-- test if index is forbidden by converting it to level</span><span>
</span><span id="line-793"></span><span>      </span><span id="local-6989586621682058104"><span class="annot"><a href="#local-6989586621682058104"><span class="hs-identifier hs-var hs-var">test</span></a></span></span><span> </span><span id="local-6989586621682058105"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058105"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-794"></span><span>        </span><span id="local-6989586621682058106"><span class="annot"><a href="#local-6989586621682058106"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Nat
forall (m :: * -&gt; *). MonadTCEnv m =&gt; m Nat
</span><a href="Agda.TypeChecking.Monad.Context.html#getContextSize"><span class="hs-identifier hs-var">getContextSize</span></a></span><span>
</span><span id="line-795"></span><span>        </span><span class="hs-comment">-- get de Bruijn level for i</span><span>
</span><span id="line-796"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058107"><span class="annot"><a href="#local-6989586621682058107"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058106"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058105"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-797"></span><span>            </span><span class="hs-comment">-- If l &gt;= n0 then it is a bound variable and can be</span><span>
</span><span id="line-798"></span><span>            </span><span class="hs-comment">-- ignored.  Otherwise, it has to be in the allowed levels.</span><span>
</span><span id="line-799"></span><span>            </span><span id="local-6989586621682058108"><span class="annot"><a href="#local-6989586621682058108"><span class="hs-identifier hs-var hs-var">forbidden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058107"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058102"><span class="hs-identifier hs-var">n0</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; Bool
</span><a href="#local-6989586621682058103"><span class="hs-identifier hs-var">levels</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058107"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>        </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058108"><span class="hs-identifier hs-type">forbidden</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-801"></span><span>          </span><span class="annot"><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-type">reportSLn</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tc.meta.kill&quot;</span></span><span> </span><span class="annot"><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-802"></span><span>            </span><span class="annot"><span class="hs-string">&quot;found forbidden de Bruijn level &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621682058107"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-803"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621682058108"><span class="hs-identifier hs-type">forbidden</span></a></span><span>
</span><span id="line-804"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-type">anyRigid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058104"><span class="hs-identifier hs-type">test</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058100"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span class="hs-comment">-- | Collect the *definitely* rigid variables in a monoid.</span><span>
</span><span id="line-807"></span><span class="hs-comment">--   We need to successively reduce the expression to do this.</span><span>
</span><span id="line-808"></span><span>
</span><span id="line-809"></span><span class="hs-keyword">class</span><span> </span><span id="AnyRigid"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-var">AnyRigid</span></a></span></span><span> </span><span id="local-6989586621682056367"><span class="annot"><a href="#local-6989586621682056367"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-810"></span><span>  </span><span id="anyRigid"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-type">anyRigid</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621682056368"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Pure.html#PureTCM"><span class="hs-identifier hs-type">PureTCM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056368"><span class="hs-identifier hs-type">tcm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Nat"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056368"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056367"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056368"><span class="hs-identifier hs-type">tcm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-814"></span><span>  </span><span id="local-6989586621682058150"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Term -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058151"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058151"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682058152"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058152"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-815"></span><span>    </span><span id="local-6989586621682058153"><span class="annot"><a href="#local-6989586621682058153"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term -&gt; tcm (Blocked Term)
forall a (m :: * -&gt; *).
(Reduce a, MonadReduce m) =&gt;
a -&gt; m (Blocked a)
</span><a href="Agda.TypeChecking.Reduce.html#reduceB"><span class="hs-identifier hs-var">reduceB</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058152"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-816"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#ignoreBlocking"><span class="hs-identifier hs-var">ignoreBlocking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058153"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-817"></span><span>      </span><span class="hs-comment">-- Upon entry, we are in rigid position, thus,</span><span>
</span><span id="line-818"></span><span>      </span><span class="hs-comment">-- bound variables are rigid ones.</span><span>
</span><span id="line-819"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682058154"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058154"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621682058155"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058155"><span class="hs-identifier hs-var">es</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058151"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058154"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">tcm Bool -&gt; tcm Bool -&gt; tcm Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#or2M"><span class="hs-operator hs-var">`or2M`</span></a></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Elims -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Elims -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058151"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058155"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-820"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058157"><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682058157"><span class="hs-identifier hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Abs Term -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Abs Term -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058151"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Abs Term
</span><a href="#local-6989586621682058157"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-821"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-822"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058158"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058158"><span class="hs-identifier hs-var">es</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Blocked Term
</span><a href="#local-6989586621682058153"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-823"></span><span>        </span><span class="hs-comment">-- If the definition is blocked by a meta, its arguments</span><span>
</span><span id="line-824"></span><span>        </span><span class="hs-comment">-- may be in flexible positions.</span><span>
</span><span id="line-825"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#Blocked"><span class="hs-identifier hs-type">Blocked</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-826"></span><span>        </span><span class="hs-comment">-- If the definition is incomplete, arguments might disappear</span><span>
</span><span id="line-827"></span><span>        </span><span class="hs-comment">-- by reductions that come with more clauses, thus, these</span><span>
</span><span id="line-828"></span><span>        </span><span class="hs-comment">-- arguments are not rigid.</span><span>
</span><span id="line-829"></span><span>        </span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#NotBlocked"><span class="hs-identifier hs-type">NotBlocked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Blockers.html#MissingClauses"><span class="hs-identifier hs-type">MissingClauses</span></a></span><span> </span><span class="annot"><span class="annottext">QName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-830"></span><span>        </span><span class="hs-comment">-- _        -&gt; mempty -- breaks: ImproveInertRHS, Issue442, PruneRecord, PruningNonMillerPattern</span><span>
</span><span id="line-831"></span><span>        </span><span class="annot"><span class="annottext">Blocked Term
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Elims -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Elims -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058151"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058158"><span class="hs-identifier hs-var">es</span></a></span><span>
</span><span id="line-832"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Con"><span class="hs-identifier hs-type">Con</span></a></span><span> </span><span class="annot"><span class="annottext">ConHead
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058161"><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058161"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Elims -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Elims -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058151"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Elims
</span><a href="#local-6989586621682058161"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-833"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span id="local-6989586621682058162"><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682058162"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682058163"><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682058163"><span class="hs-identifier hs-var">b</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; (Dom Type, Abs Type) -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; (Dom Type, Abs Type) -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058151"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom Type
</span><a href="#local-6989586621682058162"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Abs Type
</span><a href="#local-6989586621682058163"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span id="local-6989586621682058164"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058164"><span class="hs-identifier hs-var">s</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Sort -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Sort -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058151"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058164"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-835"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span id="local-6989586621682058165"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682058165"><span class="hs-identifier hs-var">l</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Level -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Level -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058151"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682058165"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-836"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-type">MetaV</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-837"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DontCare"><span class="hs-identifier hs-type">DontCare</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-838"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Dummy"><span class="hs-identifier hs-type">Dummy</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-841"></span><span>  </span><span id="local-6989586621682058172"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Type -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058173"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058173"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#El"><span class="hs-identifier hs-type">El</span></a></span><span> </span><span id="local-6989586621682058174"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058174"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621682058175"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058175"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; (Sort, Term) -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; (Sort, Term) -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058173"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058174"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058175"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Sort"><span class="hs-identifier hs-type">Sort</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-844"></span><span>  </span><span id="local-6989586621682058194"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Sort -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058195"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058195"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682058196"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058196"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-845"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058196"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-846"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Univ"><span class="hs-identifier hs-type">Univ</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058197"><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682058197"><span class="hs-identifier hs-var">l</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Level -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Level -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058195"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Level
</span><a href="#local-6989586621682058197"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-847"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#Inf"><span class="hs-identifier hs-type">Inf</span></a></span><span> </span><span class="annot"><span class="annottext">Univ
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-848"></span><span>      </span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#SizeUniv"><span class="hs-identifier hs-var">SizeUniv</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-849"></span><span>      </span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#LockUniv"><span class="hs-identifier hs-var">LockUniv</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-850"></span><span>      </span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#LevelUniv"><span class="hs-identifier hs-var">LevelUniv</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-851"></span><span>      </span><span class="annot"><span class="annottext">Sort
</span><a href="Agda.Syntax.Internal.html#IntervalUniv"><span class="hs-identifier hs-var">IntervalUniv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-852"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#PiSort"><span class="hs-identifier hs-type">PiSort</span></a></span><span> </span><span id="local-6989586621682058198"><span class="annot"><span class="annottext">Dom' Term Term
</span><a href="#local-6989586621682058198"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682058199"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058199"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682058200"><span class="annot"><span class="annottext">Abs Sort
</span><a href="#local-6989586621682058200"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-853"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#FunSort"><span class="hs-identifier hs-type">FunSort</span></a></span><span> </span><span id="local-6989586621682058201"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058201"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682058202"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058202"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-854"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#UnivSort"><span class="hs-identifier hs-type">UnivSort</span></a></span><span> </span><span id="local-6989586621682058203"><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058203"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Sort -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Sort -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058195"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Sort
</span><a href="#local-6989586621682058203"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-855"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#MetaS"><span class="hs-identifier hs-type">MetaS</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-856"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DefS"><span class="hs-identifier hs-type">DefS</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-857"></span><span>      </span><span class="annot"><a href="Agda.Syntax.Internal.html#DummyS"><span class="hs-identifier hs-type">DummyS</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Level"><span class="hs-identifier hs-type">Level</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-860"></span><span>  </span><span id="local-6989586621682058210"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Level -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058211"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058211"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Max"><span class="hs-identifier hs-type">Max</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058212"><span class="annot"><span class="annottext">[PlusLevel' Term]
</span><a href="#local-6989586621682058212"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; [PlusLevel' Term] -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; [PlusLevel' Term] -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058211"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[PlusLevel' Term]
</span><a href="#local-6989586621682058212"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-861"></span><span>
</span><span id="line-862"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#PlusLevel"><span class="hs-identifier hs-type">PlusLevel</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-863"></span><span>  </span><span id="local-6989586621682058217"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; PlusLevel' Term -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058218"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058218"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Plus"><span class="hs-identifier hs-type">Plus</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058219"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058219"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Term -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Term -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058218"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058219"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682056350"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Substitute.Class.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056350"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056350"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Abs"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056350"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-866"></span><span>  </span><span id="local-6989586621682058230"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Abs a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058231"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058231"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682058232"><span class="annot"><span class="annottext">Abs a
</span><a href="#local-6989586621682058232"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Abs a -&gt; (a -&gt; tcm Bool) -&gt; tcm Bool
forall a (m :: * -&gt; *) b.
(Subst a, MonadAddContext m) =&gt;
Abs a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Agda.TypeChecking.Monad.Context.html#underAbstraction_"><span class="hs-identifier hs-var">underAbstraction_</span></a></span><span> </span><span class="annot"><span class="annottext">Abs a
</span><a href="#local-6989586621682058232"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">((a -&gt; tcm Bool) -&gt; tcm Bool) -&gt; (a -&gt; tcm Bool) -&gt; tcm Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058231"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-867"></span><span>
</span><span id="line-868"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682056380"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056380"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056380"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-869"></span><span>  </span><span id="local-6989586621682058245"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Arg a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058246"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058246"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682058247"><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682058247"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-870"></span><span>      </span><span class="hs-comment">-- Irrelevant arguments are definitionally equal to</span><span>
</span><span id="line-871"></span><span>      </span><span class="hs-comment">-- values, so the variables there are not considered</span><span>
</span><span id="line-872"></span><span>      </span><span class="hs-comment">-- &quot;definitely rigid&quot;.</span><span>
</span><span id="line-873"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; Bool
forall a. LensRelevance a =&gt; a -&gt; Bool
</span><a href="Agda.Syntax.Common.html#isIrrelevant"><span class="hs-identifier hs-var">isIrrelevant</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682058247"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-874"></span><span>      </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058246"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Arg a -&gt; a
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682058247"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682056349"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056349"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056349"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-877"></span><span>  </span><span id="local-6989586621682058253"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Dom a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058254"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058254"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058254"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; tcm Bool) -&gt; (Dom a -&gt; a) -&gt; Dom a -&gt; tcm Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dom a -&gt; a
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682056348"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056348"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Elim%27"><span class="hs-identifier hs-type">Elim'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056348"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-880"></span><span>  </span><span id="local-6989586621682058266"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Elim' a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058267"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058267"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621682058268"><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682058268"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; Arg a -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; Arg a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058267"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Arg a
</span><a href="#local-6989586621682058268"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-881"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span id="local-6989586621682058269"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058269"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#IApply"><span class="hs-identifier hs-type">IApply</span></a></span><span> </span><span id="local-6989586621682058270"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058270"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682058271"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058271"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621682058272"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058272"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; (a, (a, a)) -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; (a, (a, a)) -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058269"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058270"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058271"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058272"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span id="local-6989586621682058273"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058273"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Elim.html#Proj"><span class="hs-identifier hs-type">Proj</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; tcm Bool
forall a. a -&gt; tcm a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682056347"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056347"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682056347"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-885"></span><span>  </span><span id="local-6989586621682058283"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; [a] -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; tcm Bool) -&gt; [a] -&gt; tcm Bool
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable f, Monad m) =&gt;
(a -&gt; m Bool) -&gt; f a -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#anyM"><span class="hs-identifier hs-var">anyM</span></a></span><span> </span><span class="annot"><span class="annottext">((a -&gt; tcm Bool) -&gt; [a] -&gt; tcm Bool)
-&gt; ((Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool)
-&gt; (Nat -&gt; tcm Bool)
-&gt; [a]
-&gt; tcm Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682056345"><span id="local-6989586621682056346"><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056345"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056346"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#AnyRigid"><span class="hs-identifier hs-type">AnyRigid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056345"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682056346"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-888"></span><span>  </span><span id="local-6989586621682058296"><span class="annot"><span class="annottext">anyRigid :: forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; (a, b) -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var hs-var hs-var">anyRigid</span></a></span></span><span> </span><span id="local-6989586621682058297"><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058297"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058298"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058298"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682058299"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682058299"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058297"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058298"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">tcm Bool -&gt; tcm Bool -&gt; tcm Bool
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="Agda.Utils.Monad.html#or2M"><span class="hs-operator hs-var">`or2M`</span></a></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; tcm Bool) -&gt; b -&gt; tcm Bool
forall a (tcm :: * -&gt; *).
(AnyRigid a, PureTCM tcm) =&gt;
(Nat -&gt; tcm Bool) -&gt; a -&gt; tcm Bool
forall (tcm :: * -&gt; *).
PureTCM tcm =&gt;
(Nat -&gt; tcm Bool) -&gt; b -&gt; tcm Bool
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#anyRigid"><span class="hs-identifier hs-var">anyRigid</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; tcm Bool
</span><a href="#local-6989586621682058297"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682058299"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span>
</span><span id="line-891"></span><span class="hs-keyword">data</span><span> </span><span id="PruneResult"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PruneResult"><span class="hs-identifier hs-var">PruneResult</span></a></span></span><span>
</span><span id="line-892"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NothingToPrune"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#NothingToPrune"><span class="hs-identifier hs-var">NothingToPrune</span></a></span></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ the kill list is empty or only @False@s</span></span><span>
</span><span id="line-893"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PrunedNothing"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PrunedNothing"><span class="hs-identifier hs-var">PrunedNothing</span></a></span></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ there is no possible kill (because of type dep.)</span></span><span>
</span><span id="line-894"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PrunedSomething"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PrunedSomething"><span class="hs-identifier hs-var">PrunedSomething</span></a></span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ managed to kill some args in the list</span></span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PrunedEverything"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PrunedEverything"><span class="hs-identifier hs-var">PrunedEverything</span></a></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ all prescribed kills where performed</span></span><span>
</span><span id="line-896"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058303"><span id="local-6989586621682058307"><span class="annot"><span class="annottext">PruneResult -&gt; PruneResult -&gt; Bool
(PruneResult -&gt; PruneResult -&gt; Bool)
-&gt; (PruneResult -&gt; PruneResult -&gt; Bool) -&gt; Eq PruneResult
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PruneResult -&gt; PruneResult -&gt; Bool
== :: PruneResult -&gt; PruneResult -&gt; Bool
$c/= :: PruneResult -&gt; PruneResult -&gt; Bool
/= :: PruneResult -&gt; PruneResult -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058310"><span id="local-6989586621682058312"><span id="local-6989586621682058316"><span class="annot"><span class="annottext">Nat -&gt; PruneResult -&gt; String -&gt; String
[PruneResult] -&gt; String -&gt; String
PruneResult -&gt; String
(Nat -&gt; PruneResult -&gt; String -&gt; String)
-&gt; (PruneResult -&gt; String)
-&gt; ([PruneResult] -&gt; String -&gt; String)
-&gt; Show PruneResult
forall a.
(Nat -&gt; a -&gt; String -&gt; String)
-&gt; (a -&gt; String) -&gt; ([a] -&gt; String -&gt; String) -&gt; Show a
$cshowsPrec :: Nat -&gt; PruneResult -&gt; String -&gt; String
showsPrec :: Nat -&gt; PruneResult -&gt; String -&gt; String
$cshow :: PruneResult -&gt; String
show :: PruneResult -&gt; String
$cshowList :: [PruneResult] -&gt; String -&gt; String
showList :: [PruneResult] -&gt; String -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span class="hs-comment">-- | @killArgs [k1,...,kn] X@ prunes argument @i@ from metavar @X@ if @ki==True@.</span><span>
</span><span id="line-899"></span><span class="hs-comment">--   Pruning is carried out whenever &gt; 0 arguments can be pruned.</span><span>
</span><span id="line-900"></span><span id="local-6989586621682056335"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#killArgs"><span class="hs-identifier hs-type">killArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#MonadMetaSolver"><span class="hs-identifier hs-type">MonadMetaSolver</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056335"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056335"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PruneResult"><span class="hs-identifier hs-type">PruneResult</span></a></span></span><span>
</span><span id="line-901"></span><span id="killArgs"><span class="annot"><span class="annottext">killArgs :: forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
[Bool] -&gt; MetaId -&gt; m PruneResult
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#killArgs"><span class="hs-identifier hs-var hs-var">killArgs</span></a></span></span><span> </span><span id="local-6989586621682058399"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682058399"><span class="hs-identifier hs-var">kills</span></a></span></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-902"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682058399"><span class="hs-identifier hs-var">kills</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PruneResult -&gt; m PruneResult
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">PruneResult
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#NothingToPrune"><span class="hs-identifier hs-var">NothingToPrune</span></a></span><span>  </span><span class="hs-comment">-- nothing to kill</span><span>
</span><span id="line-903"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#killArgs"><span class="hs-identifier hs-var">killArgs</span></a></span><span> </span><span id="local-6989586621682058401"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682058401"><span class="hs-identifier hs-var">kills</span></a></span></span><span> </span><span id="local-6989586621682058402"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682058402"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-904"></span><span>  </span><span id="local-6989586621682058403"><span class="annot"><a href="#local-6989586621682058403"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; m MetaVariable
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta"><span class="hs-identifier hs-var">lookupLocalMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682058402"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-905"></span><span>  </span><span id="local-6989586621682058404"><span class="annot"><a href="#local-6989586621682058404"><span class="hs-identifier hs-var">allowAssign</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#asksTC"><span class="hs-identifier hs-type">asksTC</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#envAssignMetas"><span class="hs-identifier hs-var">envAssignMetas</span></a></span><span>
</span><span id="line-906"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#mvFrozen"><span class="hs-identifier hs-var">mvFrozen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058403"><span class="hs-identifier hs-type">mv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Frozen"><span class="hs-identifier hs-type">Frozen</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">||</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621682058404"><span class="hs-identifier hs-type">allowAssign</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PrunedNothing"><span class="hs-identifier hs-type">PrunedNothing</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-907"></span><span>      </span><span class="hs-comment">-- Andreas 2011-04-26, we allow pruning in MetaV and MetaS</span><span>
</span><span id="line-908"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058405"><span class="annot"><a href="#local-6989586621682058405"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Judgement MetaId -&gt; Type
forall a. Judgement a -&gt; Type
</span><a href="Agda.TypeChecking.Monad.Base.html#jMetaType"><span class="hs-identifier hs-var">jMetaType</span></a></span><span> </span><span class="annot"><span class="annottext">(Judgement MetaId -&gt; Type) -&gt; Judgement MetaId -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682058403"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-909"></span><span>      </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#TelV"><span class="hs-identifier hs-type">TelV</span></a></span><span> </span><span id="local-6989586621682058409"><span class="annot"><a href="#local-6989586621682058409"><span class="hs-identifier hs-var">tel</span></a></span></span><span> </span><span id="local-6989586621682058410"><span class="annot"><a href="#local-6989586621682058410"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#telView%27"><span class="hs-identifier hs-type">telView'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-type">instantiateFull</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058405"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-910"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058413"><span class="annot"><a href="#local-6989586621682058413"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Dom (String, Type)]
-&gt; Infinite Bool -&gt; [(Dom (String, Type), Bool)]
forall a b. [a] -&gt; Infinite b -&gt; [(a, b)]
forall (f :: * -&gt; *) (g :: * -&gt; *) (h :: * -&gt; *) a b.
Zip f g h =&gt;
f a -&gt; g b -&gt; h (a, b)
</span><a href="Agda.Utils.Zip.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tele (Dom Type) -&gt; [Dom (String, Type)]
forall t. Tele (Dom t) -&gt; [Dom (String, t)]
</span><a href="Agda.Syntax.Internal.html#telToList"><span class="hs-identifier hs-var">telToList</span></a></span><span> </span><span class="annot"><span class="annottext">Tele (Dom Type)
</span><a href="#local-6989586621682058409"><span class="hs-identifier hs-var">tel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Bool -&gt; Infinite Bool
forall a. [a] -&gt; a -&gt; ListInf a
</span><a href="Agda.Utils.ListInf.html#pad"><span class="hs-identifier hs-var">ListInf.pad</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682058401"><span class="hs-identifier hs-var">kills</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682058417"><span class="annot"><a href="#local-6989586621682058417"><span class="hs-identifier hs-var">kills'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058418"><span class="annot"><a href="#local-6989586621682058418"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#killedType"><span class="hs-identifier hs-type">killedType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058413"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058410"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-912"></span><span>      </span><span class="annot"><a href="#local-6989586621682058420"><span class="hs-identifier hs-type">dbg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058417"><span class="hs-identifier hs-type">kills'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058405"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058418"><span class="hs-identifier hs-type">a'</span></a></span><span>
</span><span id="line-913"></span><span>      </span><span class="hs-comment">-- If there is any prunable argument, perform the pruning</span><span>
</span><span id="line-914"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">any</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058417"><span class="hs-identifier hs-type">kills'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PrunedNothing"><span class="hs-identifier hs-type">PrunedNothing</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-915"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Context.html#addContext"><span class="hs-identifier hs-type">addContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058409"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#performKill"><span class="hs-identifier hs-type">performKill</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058417"><span class="hs-identifier hs-type">kills'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058402"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058418"><span class="hs-identifier hs-type">a'</span></a></span><span>
</span><span id="line-916"></span><span>        </span><span class="hs-comment">-- Only successful if all occurrences were killed</span><span>
</span><span id="line-917"></span><span>        </span><span class="hs-comment">-- Andreas, 2011-05-09 more precisely, check that at least</span><span>
</span><span id="line-918"></span><span>        </span><span class="hs-comment">-- the in 'kills' prescribed kills were carried out</span><span>
</span><span id="line-919"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">and</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.Zip.html#zipWith"><span class="hs-identifier hs-type">zipWith</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058425"><span class="hs-identifier hs-type">implies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058401"><span class="hs-identifier hs-type">kills</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058417"><span class="hs-identifier hs-type">kills'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PrunedEverything"><span class="hs-identifier hs-type">PrunedEverything</span></a></span><span>
</span><span id="line-921"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#PrunedSomething"><span class="hs-identifier hs-type">PrunedSomething</span></a></span><span>
</span><span id="line-922"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-923"></span><span>    </span><span class="annot"><a href="#local-6989586621682058425"><span class="hs-identifier hs-type">implies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-924"></span><span>    </span><span id="local-6989586621682058425"><span class="annot"><span class="annottext">implies :: Bool -&gt; Bool -&gt; Bool
</span><a href="#local-6989586621682058425"><span class="hs-identifier hs-var hs-var">implies</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-925"></span><span>    </span><span class="annot"><a href="#local-6989586621682058425"><span class="hs-identifier hs-var">implies</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span id="local-6989586621682058426"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682058426"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682058426"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-926"></span><span>    </span><span id="local-6989586621682058420"><span class="annot"><span class="annottext">dbg :: [Arg Bool] -&gt; Type -&gt; Type -&gt; m ()
</span><a href="#local-6989586621682058420"><span class="hs-identifier hs-var hs-var">dbg</span></a></span></span><span> </span><span id="local-6989586621682058427"><span class="annot"><span class="annottext">[Arg Bool]
</span><a href="#local-6989586621682058427"><span class="hs-identifier hs-var">kills'</span></a></span></span><span> </span><span id="local-6989586621682058428"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058428"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682058429"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058429"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-927"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.kill&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-928"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;after kill analysis&quot;</span></span><span>
</span><span id="line-929"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Nat -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-930"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;metavar =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; MetaId -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682058402"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-931"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;kills   =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682058401"><span class="hs-identifier hs-var">kills</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-932"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;kills'  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList"><span class="hs-identifier hs-var">prettyList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Bool -&gt; TCMT IO Doc) -&gt; [Arg Bool] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Bool -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Arg Bool -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Bool]
</span><a href="#local-6989586621682058427"><span class="hs-identifier hs-var">kills'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;oldType =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058428"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-934"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;newType =&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Type -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058429"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-935"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-936"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="hs-comment">-- | @killedType [((x1,a1),k1)..((xn,an),kn)] b = ([k'1..k'n],t')@</span><span>
</span><span id="line-939"></span><span class="hs-comment">--   (ignoring @Dom@).  Let @t' = (xs:as) -&gt; b@.</span><span>
</span><span id="line-940"></span><span class="hs-comment">--   Invariant: @k'i == True@ iff @ki == True@ and pruning the @i@th argument from</span><span>
</span><span id="line-941"></span><span class="hs-comment">--   type @b@ is possible without creating unbound variables.</span><span>
</span><span id="line-942"></span><span class="hs-comment">--   @t'@ is type @t@ after pruning all @k'i==True@.</span><span>
</span><span id="line-943"></span><span id="local-6989586621682056417"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#killedType"><span class="hs-identifier hs-type">killedType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056417"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ArgName"><span class="hs-identifier hs-type">ArgName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056417"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-944"></span><span id="killedType"><span class="annot"><span class="annottext">killedType :: forall (m :: * -&gt; *).
MonadReduce m =&gt;
[(Dom (String, Type), Bool)] -&gt; Type -&gt; m ([Arg Bool], Type)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#killedType"><span class="hs-identifier hs-var hs-var">killedType</span></a></span></span><span> </span><span id="local-6989586621682058446"><span class="annot"><span class="annottext">[(Dom (String, Type), Bool)]
</span><a href="#local-6989586621682058446"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621682058447"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058447"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058448"><span class="annot"><span class="annottext">n :: Nat
</span><a href="#local-6989586621682058448"><span class="hs-identifier hs-var hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Dom (String, Type), Bool)] -&gt; Nat
forall a. [a] -&gt; Nat
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Nat
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Dom (String, Type), Bool)]
</span><a href="#local-6989586621682058446"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-947"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058450"><span class="annot"><span class="annottext">iargs :: [(Nat, (Dom (String, Type), Bool))]
</span><a href="#local-6989586621682058450"><span class="hs-identifier hs-var hs-var hs-var">iargs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Nat]
-&gt; [(Dom (String, Type), Bool)]
-&gt; [(Nat, (Dom (String, Type), Bool))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
forall (f :: * -&gt; *) (g :: * -&gt; *) (h :: * -&gt; *) a b.
Zip f g h =&gt;
f a -&gt; g b -&gt; h (a, b)
</span><a href="Agda.Utils.Zip.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; [Nat]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058448"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Dom (String, Type), Bool)]
</span><a href="#local-6989586621682058446"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>  </span><span class="hs-comment">-- Turn list of bools into an VarSet containing the variables we want to kill</span><span>
</span><span id="line-950"></span><span>  </span><span class="hs-comment">-- (indices relative to b).</span><span>
</span><span id="line-951"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058451"><span class="annot"><span class="annottext">tokill :: VarSet
</span><a href="#local-6989586621682058451"><span class="hs-identifier hs-var hs-var hs-var">tokill</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Nat] -&gt; VarSet
</span><a href="Agda.Utils.VarSet.html#fromList"><span class="hs-identifier hs-var">VarSet.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058453"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058453"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058453"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom (String, Type)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Nat, (Dom (String, Type), Bool))]
</span><a href="#local-6989586621682058450"><span class="hs-identifier hs-var">iargs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-952"></span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-comment">-- First, check the free variables of b to see if they prevent any kills.</span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682058454"><span class="annot"><a href="#local-6989586621682058454"><span class="hs-identifier hs-var">tokill</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058455"><span class="annot"><a href="#local-6989586621682058455"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Type -&gt; m (VarSet, Type)
forall (m :: * -&gt; *).
MonadReduce m =&gt;
VarSet -&gt; Type -&gt; m (VarSet, Type)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#reallyNotFreeIn"><span class="hs-identifier hs-var">reallyNotFreeIn</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058451"><span class="hs-identifier hs-var">tokill</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058447"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span>  </span><span class="hs-comment">-- Then recurse over the telescope (right-to-left), building up the final type.</span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682058457"><span class="annot"><a href="#local-6989586621682058457"><span class="hs-identifier hs-var">killed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058458"><span class="annot"><a href="#local-6989586621682058458"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682058459"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">reverse</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621682058446"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682058454"><span class="hs-identifier hs-type">tokill</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058455"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-comment">-- Turn the VarSet of killed variables into the list of Arg Bool's to return.</span><span>
</span><span id="line-960"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058462"><span class="annot"><a href="#local-6989586621682058462"><span class="hs-identifier hs-var hs-var">kills</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Bool -&gt; Arg Bool
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dom (String, Type) -&gt; ArgInfo
forall a. LensArgInfo a =&gt; a -&gt; ArgInfo
</span><a href="Agda.Syntax.Common.html#getArgInfo"><span class="hs-identifier hs-var">getArgInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Dom (String, Type)
</span><a href="#local-6989586621682058464"><span class="hs-identifier hs-var">dom</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; VarSet -&gt; Bool
</span><a href="Agda.Utils.VarSet.html#member"><span class="hs-identifier hs-var">VarSet.member</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058466"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058457"><span class="hs-identifier hs-var">killed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-961"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058466"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058466"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058464"><span class="annot"><span class="annottext">Dom (String, Type)
</span><a href="#local-6989586621682058464"><span class="hs-identifier hs-var">dom</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Nat, (Dom (String, Type), Bool))]
</span><a href="#local-6989586621682058450"><span class="hs-identifier hs-var">iargs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-962"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682058462"><span class="hs-identifier hs-type">kills</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682058458"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-964"></span><span>    </span><span class="hs-comment">-- go &#916; xs B</span><span>
</span><span id="line-965"></span><span>    </span><span class="hs-comment">-- Invariants:</span><span>
</span><span id="line-966"></span><span>    </span><span class="hs-comment">--   - &#916; &#8866; B</span><span>
</span><span id="line-967"></span><span>    </span><span class="hs-comment">--   - &#916; is represented as a list in right-to-left order</span><span>
</span><span id="line-968"></span><span>    </span><span class="hs-comment">--   - xs are deBruijn indices into &#916;</span><span>
</span><span id="line-969"></span><span>    </span><span class="hs-comment">--   - xs &#8745; FV(B) = &#216;</span><span>
</span><span id="line-970"></span><span>    </span><span class="hs-comment">-- Result: (ys, &#916;' &#8594; B')</span><span>
</span><span id="line-971"></span><span>    </span><span class="hs-comment">--    where &#916;' &#8838; &#916;  (possibly reduced to remove dependencies, see #3177)</span><span>
</span><span id="line-972"></span><span>    </span><span class="hs-comment">--          ys &#8838; xs are the variables that were dropped from &#916;</span><span>
</span><span id="line-973"></span><span>    </span><span class="hs-comment">--          B' = strengthen ys B</span><span>
</span><span id="line-974"></span><span>    </span><span id="local-6989586621682056437"><span class="annot"><a href="#local-6989586621682058459"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056437"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Internal.html#Dom"><span class="hs-identifier hs-type">Dom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Syntax.Common.html#ArgName"><span class="hs-identifier hs-type">ArgName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056437"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-975"></span><span>    </span><span id="local-6989586621682058459"><span class="annot"><span class="annottext">go :: forall (m :: * -&gt; *).
MonadReduce m =&gt;
[Dom (String, Type)] -&gt; VarSet -&gt; Type -&gt; m (VarSet, Type)
</span><a href="#local-6989586621682058459"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682058492"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058492"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682058493"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058493"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058492"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarSet, Type) -&gt; m (VarSet, Type)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058492"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058493"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-976"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (VarSet, Type)
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-977"></span><span>    </span><span class="annot"><a href="#local-6989586621682058459"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058494"><span class="annot"><span class="annottext">Dom (String, Type)
</span><a href="#local-6989586621682058494"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682058495"><span class="annot"><span class="annottext">[Dom (String, Type)]
</span><a href="#local-6989586621682058495"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682058496"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058496"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682058497"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058497"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-comment">-- go (&#916; (x : A)) xs B, (x = deBruijn index 0)</span><span>
</span><span id="line-978"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; VarSet -&gt; Bool
</span><a href="Agda.Utils.VarSet.html#member"><span class="hs-identifier hs-var">VarSet.member</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058496"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-979"></span><span>          </span><span class="hs-comment">-- Case x &#8712; xs. We know x &#8713; FV(B), so we can safely drop x from the</span><span>
</span><span id="line-980"></span><span>          </span><span class="hs-comment">-- telescope. Drop x from xs (and shift indices) and recurse with</span><span>
</span><span id="line-981"></span><span>          </span><span class="hs-comment">-- `strengthen x B`.</span><span>
</span><span id="line-982"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058498"><span class="annot"><span class="annottext">ys :: VarSet
</span><a href="#local-6989586621682058498"><span class="hs-identifier hs-var hs-var hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; VarSet -&gt; VarSet
</span><a href="Agda.Utils.VarSet.html#strengthen"><span class="hs-identifier hs-var">VarSet.strengthen</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058496"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-983"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682058500"><span class="annot"><a href="#local-6989586621682058500"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058501"><span class="annot"><a href="#local-6989586621682058501"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Dom (String, Type)] -&gt; VarSet -&gt; Type -&gt; m (VarSet, Type)
forall (m :: * -&gt; *).
MonadReduce m =&gt;
[Dom (String, Type)] -&gt; VarSet -&gt; Type -&gt; m (VarSet, Type)
</span><a href="#local-6989586621682058459"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Dom (String, Type)]
</span><a href="#local-6989586621682058495"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058498"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; m (VarSet, Type)) -&gt; Type -&gt; m (VarSet, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Impossible -&gt; Type -&gt; Type
forall a. Subst a =&gt; Impossible -&gt; a -&gt; a
</span><a href="Agda.TypeChecking.Substitute.Class.html#strengthen"><span class="hs-identifier hs-var">strengthen</span></a></span><span> </span><span class="annot"><span class="annottext">Impossible
HasCallStack =&gt; Impossible
</span><a href="Agda.Utils.Impossible.html#impossible"><span class="hs-identifier hs-var">impossible</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058497"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-984"></span><span>          </span><span class="hs-comment">-- We need to return a set of killed variables relative to &#916; (x : A), so</span><span>
</span><span id="line-985"></span><span>          </span><span class="hs-comment">-- shift ys and add x back in.</span><span>
</span><span id="line-986"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.VarSet.html#insert"><span class="hs-identifier hs-type">VarSet.insert</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#weaken"><span class="hs-identifier hs-type">VarSet.weaken</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="#local-6989586621682058500"><span class="hs-identifier hs-type">ys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682058501"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-987"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-988"></span><span>          </span><span class="hs-comment">-- Case x &#8713; xs. We either can't or don't want to get rid of x. In</span><span>
</span><span id="line-989"></span><span>          </span><span class="hs-comment">-- this case we have to check A for potential dependencies preventing</span><span>
</span><span id="line-990"></span><span>          </span><span class="hs-comment">-- us from killing variables in xs.</span><span>
</span><span id="line-991"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058506"><span class="annot"><span class="annottext">xs' :: VarSet
</span><a href="#local-6989586621682058506"><span class="hs-identifier hs-var hs-var hs-var">xs'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; VarSet -&gt; VarSet
</span><a href="Agda.Utils.VarSet.html#strengthen"><span class="hs-identifier hs-var">VarSet.strengthen</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058496"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-comment">-- Shift to make relative to &#916; &#8866; A</span><span>
</span><span id="line-992"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682058507"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682058507"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058508"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058508"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dom (String, Type) -&gt; (String, Type)
forall t e. Dom' t e -&gt; e
</span><a href="Agda.Syntax.Internal.html#unDom"><span class="hs-identifier hs-var">unDom</span></a></span><span> </span><span class="annot"><span class="annottext">Dom (String, Type)
</span><a href="#local-6989586621682058494"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-993"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682058509"><span class="annot"><a href="#local-6989586621682058509"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058510"><span class="annot"><a href="#local-6989586621682058510"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Type -&gt; m (VarSet, Type)
forall (m :: * -&gt; *).
MonadReduce m =&gt;
VarSet -&gt; Type -&gt; m (VarSet, Type)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#reallyNotFreeIn"><span class="hs-identifier hs-var">reallyNotFreeIn</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058506"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058508"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-994"></span><span>          </span><span class="hs-comment">-- Recurse on &#916;, ys, and (x : A') &#8594; B, where A reduces to A' and ys &#8838; xs'</span><span>
</span><span id="line-995"></span><span>          </span><span class="hs-comment">-- not free in A'. We already know ys not free in B.</span><span>
</span><span id="line-996"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682058511"><span class="annot"><a href="#local-6989586621682058511"><span class="hs-identifier hs-var">zs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058512"><span class="annot"><a href="#local-6989586621682058512"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621682058459"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058495"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058509"><span class="hs-identifier hs-type">ys</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Substitute.html#mkPi"><span class="hs-identifier hs-type">mkPi</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682058507"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682058510"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$</span></span><span> </span><span class="annot"><a href="#local-6989586621682058494"><span class="hs-identifier hs-type">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682058497"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-997"></span><span>          </span><span class="hs-comment">-- Shift back up to make it relative to &#916; (x : A) again.</span><span>
</span><span id="line-998"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.VarSet.html#weaken"><span class="hs-identifier hs-type">VarSet.weaken</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="#local-6989586621682058511"><span class="hs-identifier hs-type">zs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682058512"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span id="local-6989586621682056436"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#reallyNotFreeIn"><span class="hs-identifier hs-type">reallyNotFreeIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#MonadReduce"><span class="hs-identifier hs-type">MonadReduce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056436"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056436"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1001"></span><span id="reallyNotFreeIn"><span class="annot"><span class="annottext">reallyNotFreeIn :: forall (m :: * -&gt; *).
MonadReduce m =&gt;
VarSet -&gt; Type -&gt; m (VarSet, Type)
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#reallyNotFreeIn"><span class="hs-identifier hs-var hs-var">reallyNotFreeIn</span></a></span></span><span> </span><span id="local-6989586621682058542"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058542"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682058543"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058543"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Bool
forall a. Null a =&gt; a -&gt; Bool
</span><a href="Agda.Utils.Null.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058542"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarSet, Type) -&gt; m (VarSet, Type)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058542"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058543"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Shortcut</span><span>
</span><span id="line-1002"></span><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#reallyNotFreeIn"><span class="hs-identifier hs-var">reallyNotFreeIn</span></a></span><span> </span><span id="local-6989586621682058544"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058544"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621682058545"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058545"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058546"><span class="annot"><span class="annottext">fvs :: VarMap
</span><a href="#local-6989586621682058546"><span class="hs-identifier hs-var hs-var">fvs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarMap
forall a c t. (IsVarSet a c, Singleton Nat c, Free t) =&gt; t -&gt; c
</span><a href="Agda.TypeChecking.Free.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058545"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1004"></span><span>      </span><span id="local-6989586621682058548"><span class="annot"><span class="annottext">anywhere :: VarSet
</span><a href="#local-6989586621682058548"><span class="hs-identifier hs-var hs-var">anywhere</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarMap -&gt; VarSet
</span><a href="Agda.TypeChecking.Free.html#allVars"><span class="hs-identifier hs-var">allVars</span></a></span><span> </span><span class="annot"><span class="annottext">VarMap
</span><a href="#local-6989586621682058546"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-1005"></span><span>      </span><span id="local-6989586621682058550"><span class="annot"><span class="annottext">rigid :: VarSet
</span><a href="#local-6989586621682058550"><span class="hs-identifier hs-var hs-var">rigid</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="Agda.Utils.VarSet.html#union"><span class="hs-identifier hs-var">VarSet.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarMap -&gt; VarSet
</span><a href="Agda.TypeChecking.Free.html#stronglyRigidVars"><span class="hs-identifier hs-var">stronglyRigidVars</span></a></span><span> </span><span class="annot"><span class="annottext">VarMap
</span><a href="#local-6989586621682058546"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarMap -&gt; VarSet
</span><a href="Agda.TypeChecking.Free.html#unguardedVars"><span class="hs-identifier hs-var">unguardedVars</span></a></span><span> </span><span class="annot"><span class="annottext">VarMap
</span><a href="#local-6989586621682058546"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span>      </span><span id="local-6989586621682058554"><span class="annot"><span class="annottext">nonrigid :: VarSet
</span><a href="#local-6989586621682058554"><span class="hs-identifier hs-var hs-var">nonrigid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="Agda.Utils.VarSet.html#difference"><span class="hs-identifier hs-var">VarSet.difference</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058548"><span class="hs-identifier hs-var">anywhere</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058550"><span class="hs-identifier hs-var">rigid</span></a></span><span>
</span><span id="line-1007"></span><span>      </span><span id="local-6989586621682058556"><span class="annot"><span class="annottext">hasNo :: VarSet -&gt; Bool
</span><a href="#local-6989586621682058556"><span class="hs-identifier hs-var hs-var">hasNo</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; Bool
</span><a href="Agda.Utils.VarSet.html#disjoint"><span class="hs-identifier hs-var">VarSet.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058544"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Bool
</span><a href="#local-6989586621682058556"><span class="hs-identifier hs-var">hasNo</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058554"><span class="hs-identifier hs-var">nonrigid</span></a></span><span>
</span><span id="line-1009"></span><span>    </span><span class="hs-keyword">then</span><span>
</span><span id="line-1010"></span><span>       </span><span class="hs-comment">-- No non-rigid occurrences. We can't do anything about the rigid</span><span>
</span><span id="line-1011"></span><span>       </span><span class="hs-comment">-- occurrences so drop those and leave `a` untouched.</span><span>
</span><span id="line-1012"></span><span>       </span><span class="annot"><span class="annottext">(VarSet, Type) -&gt; m (VarSet, Type)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="Agda.Utils.VarSet.html#difference"><span class="hs-identifier hs-var">VarSet.difference</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058544"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058550"><span class="hs-identifier hs-var">rigid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058545"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1014"></span><span>      </span><span class="hs-comment">-- If there are non-rigid occurrences we need to reduce a to see if</span><span>
</span><span id="line-1015"></span><span>      </span><span class="hs-comment">-- we can get rid of them (#3177).</span><span>
</span><span id="line-1016"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682058558"><span class="annot"><a href="#local-6989586621682058558"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058559"><span class="annot"><a href="#local-6989586621682058559"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Type -&gt; m (IntMap IsFree, Type)
forall a (m :: * -&gt; *).
(ForceNotFree a, Reduce a, MonadReduce m) =&gt;
VarSet -&gt; a -&gt; m (IntMap IsFree, a)
</span><a href="Agda.TypeChecking.Free.Reduce.html#forceNotFree"><span class="hs-identifier hs-var">forceNotFree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="Agda.Utils.VarSet.html#difference"><span class="hs-identifier hs-var">VarSet.difference</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058544"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058550"><span class="hs-identifier hs-var">rigid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058545"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1017"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058561"><span class="annot"><a href="#local-6989586621682058561"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap IsFree -&gt; VarSet
</span><a href="Agda.TypeChecking.Free.Reduce.html#nonFreeVars"><span class="hs-identifier hs-var">nonFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap IsFree
</span><a href="#local-6989586621682058558"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-1018"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682058561"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682058559"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span class="hs-comment">-- | Instantiate a meta variable with a new one that only takes</span><span>
</span><span id="line-1021"></span><span class="hs-comment">--   the arguments which are not pruneable.</span><span>
</span><span id="line-1022"></span><span id="local-6989586621682056423"><span class="annot"><a href="Agda.TypeChecking.MetaVars.Occurs.html#performKill"><span class="hs-identifier hs-type">performKill</span></a></span><span>
</span><span id="line-1023"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#MonadMetaSolver"><span class="hs-identifier hs-type">MonadMetaSolver</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056423"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1024"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ Arguments to old meta var in left to right order</span><span>
</span><span id="line-1025"></span><span>                   </span><span class="hs-comment">--   with @Bool@ indicating whether they can be pruned.</span><span>
</span><span id="line-1026"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#MetaId"><span class="hs-identifier hs-type">MetaId</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ The old meta var to receive pruning.</span></span><span>
</span><span id="line-1027"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ The pruned type of the new meta var.</span></span><span>
</span><span id="line-1028"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1029"></span><span id="performKill"><span class="annot"><span class="annottext">performKill :: forall (m :: * -&gt; *).
MonadMetaSolver m =&gt;
[Arg Bool] -&gt; MetaId -&gt; Type -&gt; m ()
</span><a href="Agda.TypeChecking.MetaVars.Occurs.html#performKill"><span class="hs-identifier hs-var hs-var">performKill</span></a></span></span><span> </span><span id="local-6989586621682058632"><span class="annot"><span class="annottext">[Arg Bool]
</span><a href="#local-6989586621682058632"><span class="hs-identifier hs-var">kills</span></a></span></span><span> </span><span id="local-6989586621682058633"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682058633"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682058634"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058634"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1030"></span><span>  </span><span id="local-6989586621682058635"><span class="annot"><a href="#local-6989586621682058635"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; m MetaVariable
forall (m :: * -&gt; *).
(HasCallStack, MonadDebug m, ReadTCState m) =&gt;
MetaId -&gt; m MetaVariable
</span><a href="Agda.TypeChecking.Monad.MetaVars.html#lookupLocalMeta"><span class="hs-identifier hs-var">lookupLocalMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682058633"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1031"></span><span>  </span><span class="annot"><a href="Agda.Utils.Monad.html#when"><span class="hs-identifier hs-type">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#mvFrozen"><span class="hs-identifier hs-var">mvFrozen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058635"><span class="hs-identifier hs-type">mv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Frozen"><span class="hs-identifier hs-type">Frozen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-type">__IMPOSSIBLE__</span></a></span><span>
</span><span id="line-1032"></span><span>  </span><span class="hs-comment">-- Arity of the old meta.</span><span>
</span><span id="line-1033"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058636"><span class="annot"><a href="#local-6989586621682058636"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Arg Bool] -&gt; Nat
forall a. Sized a =&gt; a -&gt; Nat
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Bool]
</span><a href="#local-6989586621682058632"><span class="hs-identifier hs-var">kills</span></a></span><span>
</span><span id="line-1034"></span><span>  </span><span class="hs-comment">-- The permutation of the new meta picks the arguments</span><span>
</span><span id="line-1035"></span><span>  </span><span class="hs-comment">-- which are not pruned in left to right order</span><span>
</span><span id="line-1036"></span><span>  </span><span class="hs-comment">-- (de Bruijn level order).</span><span>
</span><span id="line-1037"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682058638"><span class="annot"><a href="#local-6989586621682058638"><span class="hs-identifier hs-var hs-var">perm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; [Nat] -&gt; Permutation
</span><a href="Agda.Utils.Permutation.html#Perm"><span class="hs-identifier hs-var">Perm</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058636"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1038"></span><span>             </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058640"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058640"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058640"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Infinite Nat -&gt; [Arg Bool] -&gt; [(Nat, Arg Bool)]
forall a b. Infinite a -&gt; [b] -&gt; [(a, b)]
forall (f :: * -&gt; *) (g :: * -&gt; *) (h :: * -&gt; *) a b.
Zip f g h =&gt;
f a -&gt; g b -&gt; h (a, b)
</span><a href="Agda.Utils.Zip.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; Infinite Nat
forall n. Enum n =&gt; n -&gt; ListInf n
</span><a href="Agda.Utils.ListInf.html#upFrom"><span class="hs-identifier hs-var">ListInf.upFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg Bool]
</span><a href="#local-6989586621682058632"><span class="hs-identifier hs-var">kills</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1039"></span><span>      </span><span class="hs-comment">-- The permutation for the old meta might range over a prefix of the arguments</span><span>
</span><span id="line-1040"></span><span>      </span><span id="local-6989586621682058642"><span class="annot"><a href="#local-6989586621682058642"><span class="hs-identifier hs-var hs-var">oldPerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Permutation -&gt; Permutation
</span><a href="Agda.Utils.Permutation.html#liftP"><span class="hs-identifier hs-var">liftP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Nat -&gt; Nat) -&gt; Nat -&gt; Nat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058636"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nat -&gt; Nat -&gt; Nat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058645"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682058646"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1041"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682058646"><span class="annot"><span class="annottext">p :: Permutation
</span><a href="#local-6989586621682058646"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Permutation
</span><a href="Agda.TypeChecking.Monad.Base.html#mvPermutation"><span class="hs-identifier hs-var">mvPermutation</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682058635"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-1042"></span><span>              </span><span id="local-6989586621682058645"><span class="annot"><span class="annottext">m :: Nat
</span><a href="#local-6989586621682058645"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Permutation -&gt; Nat
forall a. Sized a =&gt; a -&gt; Nat
</span><a href="Agda.Utils.Size.html#size"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation
</span><a href="#local-6989586621682058646"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1043"></span><span>      </span><span id="local-6989586621682058648"><span class="annot"><a href="#local-6989586621682058648"><span class="hs-identifier hs-var hs-var">judg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaVariable -&gt; Judgement MetaId
</span><a href="Agda.TypeChecking.Monad.Base.html#mvJudgement"><span class="hs-identifier hs-var">mvJudgement</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVariable
</span><a href="#local-6989586621682058635"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1044"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#HasType"><span class="hs-identifier hs-type">HasType</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">jComparison :: forall a. Judgement a -&gt; Comparison
</span><a href="Agda.TypeChecking.Monad.Base.html#jComparison"><span class="hs-identifier hs-var">jComparison</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682058651"><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682058651"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ZonkAny 0 -&gt; Comparison -&gt; Type -&gt; Judgement (ZonkAny 0)
forall a. a -&gt; Comparison -&gt; Type -&gt; Judgement a
</span><a href="Agda.TypeChecking.Monad.Base.html#HasType"><span class="hs-identifier hs-var">HasType</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkAny 0
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Comparison
</span><a href="#local-6989586621682058651"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058634"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1045"></span><span>        </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#IsSort"><span class="hs-identifier hs-type">IsSort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ZonkAny 0 -&gt; Type -&gt; Judgement (ZonkAny 0)
forall a. a -&gt; Type -&gt; Judgement a
</span><a href="Agda.TypeChecking.Monad.Base.html#IsSort"><span class="hs-identifier hs-var">IsSort</span></a></span><span>  </span><span class="annot"><span class="annottext">ZonkAny 0
forall a. HasCallStack =&gt; a
</span><a href="Agda.Utils.Impossible.html#__IMPOSSIBLE__"><span class="hs-identifier hs-var">__IMPOSSIBLE__</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058634"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1046"></span><span>  </span><span id="local-6989586621682058653"><span class="annot"><a href="#local-6989586621682058653"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#newMeta"><span class="hs-identifier hs-type">newMeta</span></a></span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Instantiable"><span class="hs-identifier hs-type">Instantiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#mvInfo"><span class="hs-identifier hs-var">mvInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058635"><span class="hs-identifier hs-type">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#mvPriority"><span class="hs-identifier hs-var">mvPriority</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058635"><span class="hs-identifier hs-type">mv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.Utils.Permutation.html#composeP"><span class="hs-identifier hs-type">composeP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058638"><span class="hs-identifier hs-type">perm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058642"><span class="hs-identifier hs-type">oldPerm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682058648"><span class="hs-identifier hs-type">judg</span></a></span><span>
</span><span id="line-1047"></span><span>  </span><span class="hs-comment">-- Andreas, 2010-10-15 eta expand new meta variable if necessary</span><span>
</span><span id="line-1048"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.Monad.MetaVars.html#etaExpandMetaSafe"><span class="hs-identifier hs-type">etaExpandMetaSafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058653"><span class="hs-identifier hs-type">m'</span></a></span><span>
</span><span id="line-1049"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Arguments to new meta (de Bruijn indices)</span><span>
</span><span id="line-1050"></span><span>      </span><span class="hs-comment">-- in left to right order.</span><span>
</span><span id="line-1051"></span><span>      </span><span id="local-6989586621682058659"><span class="annot"><a href="#local-6989586621682058659"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ArgInfo -&gt; Term -&gt; Arg Term
forall e. ArgInfo -&gt; e -&gt; Arg e
</span><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span><span> </span><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682058660"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; Term
</span><a href="Agda.Syntax.Internal.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058661"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1052"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058661"><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058661"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.Syntax.Common.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span id="local-6989586621682058660"><span class="annot"><span class="annottext">ArgInfo
</span><a href="#local-6989586621682058660"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Nat] -&gt; [Arg Bool] -&gt; [(Nat, Arg Bool)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
forall (f :: * -&gt; *) (g :: * -&gt; *) (h :: * -&gt; *) a b.
Zip f g h =&gt;
f a -&gt; g b -&gt; h (a, b)
</span><a href="Agda.Utils.Zip.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nat -&gt; [Nat]
forall a. Integral a =&gt; a -&gt; [a]
</span><a href="Agda.Utils.List.html#downFrom"><span class="hs-identifier hs-var">downFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><a href="#local-6989586621682058636"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg Bool]
</span><a href="#local-6989586621682058632"><span class="hs-identifier hs-var">kills</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1053"></span><span>      </span><span id="local-6989586621682058662"><span class="annot"><a href="#local-6989586621682058662"><span class="hs-identifier hs-var hs-var">u</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; Elims -&gt; Term
</span><a href="Agda.Syntax.Internal.html#MetaV"><span class="hs-identifier hs-var">MetaV</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682058653"><span class="hs-identifier hs-var">m'</span></a></span><span> </span><span class="annot"><span class="annottext">(Elims -&gt; Term) -&gt; Elims -&gt; Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Arg Term -&gt; Elim' Term) -&gt; [Arg Term] -&gt; Elims
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Arg Term -&gt; Elim' Term
forall a. Arg a -&gt; Elim' a
</span><a href="Agda.Syntax.Internal.Elim.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg Term]
</span><a href="#local-6989586621682058659"><span class="hs-identifier hs-var">vars</span></a></span><span>
</span><span id="line-1054"></span><span>      </span><span class="hs-comment">-- Arguments to the old meta (just arg infos and name hints)</span><span>
</span><span id="line-1055"></span><span>      </span><span class="hs-comment">-- in left to right order.</span><span>
</span><span id="line-1056"></span><span>      </span><span id="local-6989586621682058663"><span class="annot"><a href="#local-6989586621682058663"><span class="hs-identifier hs-var hs-var">tel</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Arg Bool -&gt; Arg String) -&gt; [Arg Bool] -&gt; [Arg String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;v&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Arg Bool -&gt; Arg String
forall a b. a -&gt; Arg b -&gt; Arg a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg Bool]
</span><a href="#local-6989586621682058632"><span class="hs-identifier hs-var">kills</span></a></span><span>
</span><span id="line-1057"></span><span>  </span><span class="annot"><a href="#local-6989586621682058664"><span class="hs-identifier hs-type">dbg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058653"><span class="hs-identifier hs-type">m'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058662"><span class="hs-identifier hs-type">u</span></a></span><span>
</span><span id="line-1058"></span><span>  </span><span class="annot"><a href="Agda.TypeChecking.MetaVars.html#assignTerm"><span class="hs-identifier hs-type">assignTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058633"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058663"><span class="hs-identifier hs-type">tel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058662"><span class="hs-identifier hs-type">u</span></a></span><span>  </span><span class="hs-comment">-- m tel := u</span><span>
</span><span id="line-1059"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1060"></span><span>    </span><span id="local-6989586621682058664"><span class="annot"><span class="annottext">dbg :: MetaId -&gt; Term -&gt; m ()
</span><a href="#local-6989586621682058664"><span class="hs-identifier hs-var hs-var">dbg</span></a></span></span><span> </span><span id="local-6989586621682058666"><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682058666"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span id="local-6989586621682058667"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058667"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
String -&gt; Nat -&gt; TCMT IO Doc -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSDoc"><span class="hs-identifier hs-var">reportSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc.meta.kill&quot;</span></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; m ()) -&gt; TCMT IO Doc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1061"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;actual killing&quot;</span></span><span>
</span><span id="line-1062"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Nat -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Functor m =&gt; Nat -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Nat
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(TCMT IO Doc -&gt; TCMT IO Doc) -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1063"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;new meta:&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682058666"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-1064"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;kills   :&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TCMT IO Doc] -&gt; TCMT IO Doc
forall (m :: * -&gt; *) (t :: * -&gt; *).
(Applicative m, Semigroup (m Doc), Foldable t) =&gt;
t (m Doc) -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyList_"><span class="hs-identifier hs-var">prettyList_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Arg Bool -&gt; TCMT IO Doc) -&gt; [Arg Bool] -&gt; [TCMT IO Doc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; String -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TCMT IO Doc)
-&gt; (Arg Bool -&gt; String) -&gt; Arg Bool -&gt; TCMT IO Doc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; String) -&gt; (Arg Bool -&gt; Bool) -&gt; Arg Bool -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Arg Bool -&gt; Bool
forall e. Arg e -&gt; e
</span><a href="Agda.Syntax.Common.html#unArg"><span class="hs-identifier hs-var">unArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg Bool]
</span><a href="#local-6989586621682058632"><span class="hs-identifier hs-var">kills</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1065"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;inst    :&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId -&gt; TCMT IO Doc
forall (m :: * -&gt; *) a. (Applicative m, Pretty a) =&gt; a -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">MetaId
</span><a href="#local-6989586621682058633"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc
</span><span class="hs-string">&quot;:=&quot;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO Doc -&gt; TCMT IO Doc -&gt; TCMT IO Doc
forall (m :: * -&gt; *). Applicative m =&gt; m Doc -&gt; m Doc -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; TCMT IO Doc
forall a (m :: * -&gt; *). (PrettyTCM a, MonadPretty m) =&gt; a -&gt; m Doc
forall (m :: * -&gt; *). MonadPretty m =&gt; Term -&gt; m Doc
</span><a href="Agda.TypeChecking.Pretty.html#prettyTCM"><span class="hs-identifier hs-var">prettyTCM</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621682058667"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-1066"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1067"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1068"></span></pre></body></html>