<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Agda.TypeChecking.SizedTypes.Solve</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">Agda</span><ul class="links" id="page-menu"><li><a href="src/Agda.TypeChecking.SizedTypes.Solve.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Agda.TypeChecking.SizedTypes.Solve</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#section.orphans">Orphan instances</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Solving size constraints under hypotheses.</p><p>The size solver proceeds as follows:</p><ol><li value="1">Get size constraints, cluster into connected components.</li></ol><p>All size constraints that mention the same metas go into the same
    cluster.  Each cluster can be solved by itself.</p><p>Constraints that do not fit our format are ignored.
    We check whether our computed solution fulfills them as well
    in the last step.</p><ol><li value="2">Find a joint context for each cluster.</li></ol><p>Each constraint comes with its own typing context, which
    contains size hypotheses <code class="inline-code">j : Size&lt; i</code>.  We need to find a
    common super context in which all constraints of a cluster live,
    and raise all constraints to this context.</p><p>There might not be a common super context.  Then we are screwed,
    since our solver is not ready to deal with such a situation.  We
    will blatantly refuse to solve this cluster and blame it on the
    user.</p><ol><li value="3">Convert the joint context into a hypothesis graph.</li></ol><p>This is straightforward.  Each de Bruijn index becomes a
    rigid variable, each typing assumption <code class="inline-code">j : Size&lt; i</code> becomes an
    arc.</p><ol><li value="4">Convert the constraints into a constraint graph.</li></ol><p>Here we need to convert <code class="inline-code">MetaV</code>s into flexible variables.</p><ol><li value="5">Run the solver</li><li value="6">Convert the solution into meta instantiations.</li><li value="7">Double-check whether the constraints are solved.</li></ol></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:DefaultToInfty">DefaultToInfty</a><ul class="subs"><li>= <a href="#v:DefaultToInfty">DefaultToInfty</a></li><li>| <a href="#v:DontDefaultToInfty">DontDefaultToInfty</a></li></ul></li><li class="src short"><a href="#v:solveSizeConstraints">solveSizeConstraints</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> ()</li><li class="src short"><a href="#v:castConstraintToCurrentContext-39-">castConstraintToCurrentContext'</a> :: <a href="Agda-TypeChecking-Monad-Base.html#t:Closure" title="Agda.TypeChecking.Monad.Base">Closure</a> <a href="Agda-TypeChecking-Monad-Base.html#t:Constraint" title="Agda.TypeChecking.Monad.Base">Constraint</a> -&gt; <a href="https://hackage.haskell.org/package/transformers-0.6.1.2/docs/Control-Monad-Trans-Maybe.html#t:MaybeT" title="Control.Monad.Trans.Maybe">MaybeT</a> <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> <a href="Agda-TypeChecking-Monad-Base.html#t:Constraint" title="Agda.TypeChecking.Monad.Base">Constraint</a></li><li class="src short"><a href="#v:castConstraintToCurrentContext">castConstraintToCurrentContext</a> :: <a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a> -&gt; <a href="https://hackage.haskell.org/package/transformers-0.6.1.2/docs/Control-Monad-Trans-Maybe.html#t:MaybeT" title="Control.Monad.Trans.Maybe">MaybeT</a> <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> <a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a></li><li class="src short"><a href="#v:solveSizeConstraints_">solveSizeConstraints_</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; [<a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a>] -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="https://hackage.haskell.org/package/containers-0.7/docs/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="Agda-Syntax-Common.html#t:MetaId" title="Agda.Syntax.Common">MetaId</a>)</li><li class="src short"><a href="#v:solveCluster">solveCluster</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a>, <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:HypSizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">HypSizeConstraint</a>) -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> ()</li><li class="src short"><a href="#v:getSizeHypotheses">getSizeHypotheses</a> :: <a href="Agda-TypeChecking-Monad-Base-Types.html#t:Context" title="Agda.TypeChecking.Monad.Base.Types">Context</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> [(<a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a>, <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a>)]</li><li class="src short"><a href="#v:canonicalizeSizeConstraint">canonicalizeSizeConstraint</a> :: <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a></li><li class="src short"><a href="#v:computeSizeConstraint">computeSizeConstraint</a> :: <a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:HypSizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">HypSizeConstraint</a>)</li><li class="src short"><a href="#v:sizeExpr">sizeExpr</a> :: <a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:DBSizeExpr" title="Agda.TypeChecking.SizedTypes.Syntax">DBSizeExpr</a>)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:DefaultToInfty" class="def">DefaultToInfty</a> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#DefaultToInfty" class="link">Source</a> <a href="#t:DefaultToInfty" class="selflink">#</a></p><div class="doc"><p>Flag to control the behavior of size solver.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:DefaultToInfty" class="def">DefaultToInfty</a></td><td class="doc"><p>Instantiate all unconstrained size variables to &#8734;.</p></td></tr><tr><td class="src"><a id="v:DontDefaultToInfty" class="def">DontDefaultToInfty</a></td><td class="doc"><p>Leave unconstrained size variables unsolved.</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:DefaultToInfty">Instances</h4><details id="i:DefaultToInfty" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DefaultToInfty:Show:1"></span> <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Prelude.html#t:Show" title="Prelude">Show</a> <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a></span> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#line-109" class="link">Source</a> <a href="#t:DefaultToInfty" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DefaultToInfty:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Agda-TypeChecking-SizedTypes-Solve.html">Agda.TypeChecking.SizedTypes.Solve</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Prelude.html#t:ShowS" title="Prelude">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a>] -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Prelude.html#t:ShowS" title="Prelude">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DefaultToInfty:Eq:2"></span> <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a></span> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#line-109" class="link">Source</a> <a href="#t:DefaultToInfty" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DefaultToInfty:Eq:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Agda-TypeChecking-SizedTypes-Solve.html">Agda.TypeChecking.SizedTypes.Solve</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:DefaultToInfty:Ord:3"></span> <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a></span> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#line-109" class="link">Source</a> <a href="#t:DefaultToInfty" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:DefaultToInfty:Ord:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Agda-TypeChecking-SizedTypes-Solve.html">Agda.TypeChecking.SizedTypes.Solve</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:compare">compare</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a> <a href="#v:compare" class="selflink">#</a></p><p class="src"><a href="#v:-60-">(&lt;)</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-60-" class="selflink">#</a></p><p class="src"><a href="#v:-60--61-">(&lt;=)</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-60--61-" class="selflink">#</a></p><p class="src"><a href="#v:-62-">(&gt;)</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-62-" class="selflink">#</a></p><p class="src"><a href="#v:-62--61-">(&gt;=)</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-62--61-" class="selflink">#</a></p><p class="src"><a href="#v:max">max</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> <a href="#v:max" class="selflink">#</a></p><p class="src"><a href="#v:min">min</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> <a href="#v:min" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:solveSizeConstraints" class="def">solveSizeConstraints</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> () <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#solveSizeConstraints" class="link">Source</a> <a href="#v:solveSizeConstraints" class="selflink">#</a></p><div class="doc"><p>Solve size constraints involving hypotheses.</p></div></div><div class="top"><p class="src"><a id="v:castConstraintToCurrentContext-39-" class="def">castConstraintToCurrentContext'</a> :: <a href="Agda-TypeChecking-Monad-Base.html#t:Closure" title="Agda.TypeChecking.Monad.Base">Closure</a> <a href="Agda-TypeChecking-Monad-Base.html#t:Constraint" title="Agda.TypeChecking.Monad.Base">Constraint</a> -&gt; <a href="https://hackage.haskell.org/package/transformers-0.6.1.2/docs/Control-Monad-Trans-Maybe.html#t:MaybeT" title="Control.Monad.Trans.Maybe">MaybeT</a> <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> <a href="Agda-TypeChecking-Monad-Base.html#t:Constraint" title="Agda.TypeChecking.Monad.Base">Constraint</a> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#castConstraintToCurrentContext%27" class="link">Source</a> <a href="#v:castConstraintToCurrentContext-39-" class="selflink">#</a></p><div class="doc"><p>TODO: this does not actually work!</p><p>We would like to use a constraint <code class="inline-code">c</code> created in context <code class="inline-code">&#916;</code> from module <code class="inline-code">N</code>
   in the current context <code class="inline-code">&#915;</code> and current module <code class="inline-code">M</code>.</p><p><code class="inline-code">&#916;</code> is module tel <code class="inline-code">&#916;&#8321;</code> of <code class="inline-code">N</code> extended by some local bindings <code class="inline-code">&#916;&#8322;</code>.
   <code class="inline-code">&#915;</code> is the current context.
   The module parameter substitution from current <code class="inline-code">M</code> to <code class="inline-code">N</code> be
   <code class="inline-code">&#915; &#8866; &#963; : &#916;&#8321;</code>.</p><p>If <code class="inline-code">M == N</code>, we do not need the parameter substitution.  We try raising.</p><p>We first strengthen <code class="inline-code">&#916; &#8866; c</code> to live in <code class="inline-code">&#916;&#8321;</code> and obtain <code class="inline-code">c&#8321; = strengthen &#916;&#8322; c</code>.
   We then transport <code class="inline-code">c&#8321;</code> to <code class="inline-code">&#915;</code> and obtain <code class="inline-code">c&#8322; = applySubst &#963; c&#8321;</code>.</p><p>This works for different modules, but if <code class="inline-code">M == N</code> we should not strengthen
   and then weaken, because strengthening is a partial operation.
   We should rather lift the substitution <code class="inline-code">&#963;</code> by <code class="inline-code">&#916;&#8322;</code> and then
   raise by <code class="inline-code">&#915;&#8322; - &#916;&#8322;</code>.
   This &quot;raising&quot; might be a strengthening if <code class="inline-code">&#915;&#8322;</code> is shorter than <code class="inline-code">&#916;&#8322;</code>.</p><p>(TODO: If the module substitution does not exist, because <code class="inline-code">N</code> is not
   a parent of <code class="inline-code">M</code>, we cannot use the constraint, as it has been created
   in an unrelated context.)</p></div></div><div class="top"><p class="src"><a id="v:castConstraintToCurrentContext" class="def">castConstraintToCurrentContext</a> :: <a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a> -&gt; <a href="https://hackage.haskell.org/package/transformers-0.6.1.2/docs/Control-Monad-Trans-Maybe.html#t:MaybeT" title="Control.Monad.Trans.Maybe">MaybeT</a> <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> <a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#castConstraintToCurrentContext" class="link">Source</a> <a href="#v:castConstraintToCurrentContext" class="selflink">#</a></p><div class="doc"><p>A hazardous hack, may the Gods have mercy on us.</p><p>To cast to the current context, we match the context of the
   given constraint by <code class="inline-code">CtxId</code>, and as fallback, by variable name (douh!).</p><p>This hack lets issue 2046 go through.</p></div></div><div class="top"><p class="src"><a id="v:solveSizeConstraints_" class="def">solveSizeConstraints_</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; [<a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a>] -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="https://hackage.haskell.org/package/containers-0.7/docs/Data-Set.html#t:Set" title="Data.Set">Set</a> <a href="Agda-Syntax-Common.html#t:MetaId" title="Agda.Syntax.Common">MetaId</a>) <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#solveSizeConstraints_" class="link">Source</a> <a href="#v:solveSizeConstraints_" class="selflink">#</a></p><div class="doc"><p>Return the size metas occurring in the simplified constraints.
   A constraint like <code class="inline-code">&#8593; _j =&lt; &#8734; : Size</code> simplifies to nothing,
   so <code class="inline-code">_j</code> would not be in this set.</p></div></div><div class="top"><p class="src"><a id="v:solveCluster" class="def">solveCluster</a> :: <a href="Agda-TypeChecking-SizedTypes-Solve.html#t:DefaultToInfty" title="Agda.TypeChecking.SizedTypes.Solve">DefaultToInfty</a> -&gt; <a href="Agda-Utils-List1.html#t:List1" title="Agda.Utils.List1">List1</a> (<a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a>, <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:HypSizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">HypSizeConstraint</a>) -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> () <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#solveCluster" class="link">Source</a> <a href="#v:solveCluster" class="selflink">#</a></p><div class="doc"><p>Solve a cluster of constraints sharing some metas.</p></div></div><div class="top"><p class="src"><a id="v:getSizeHypotheses" class="def">getSizeHypotheses</a> :: <a href="Agda-TypeChecking-Monad-Base-Types.html#t:Context" title="Agda.TypeChecking.Monad.Base.Types">Context</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> [(<a href="Agda-Syntax-Common.html#t:Nat" title="Agda.Syntax.Common">Nat</a>, <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a>)] <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#getSizeHypotheses" class="link">Source</a> <a href="#v:getSizeHypotheses" class="selflink">#</a></p><div class="doc"><p>Collect constraints from a typing context, looking for SIZELT hypotheses.</p></div></div><div class="top"><p class="src"><a id="v:canonicalizeSizeConstraint" class="def">canonicalizeSizeConstraint</a> :: <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#canonicalizeSizeConstraint" class="link">Source</a> <a href="#v:canonicalizeSizeConstraint" class="selflink">#</a></p><div class="doc"><p>Convert size constraint into form where each meta is applied
   to indices <code class="inline-code">n-1,...,1,0</code> where <code class="inline-code">n</code> is the arity of that meta.</p><p><code class="inline-code">X[&#963;] &lt;= t</code> becomes <code class="inline-code">X[id] &lt;= t[&#963;^-1]</code></p><p><code class="inline-code">X[&#963;] &#8804; Y[&#964;]</code> becomes <code class="inline-code">X[id] &#8804; Y[&#964;[&#963;^-1]]</code> or <code class="inline-code">X[&#963;[&#964;^1]] &#8804; Y[id]</code>
   whichever is defined.  If none is defined, we give up.</p><p>Cf. <code class="inline-code">SizedTypes.oldCanonicalizeSizeConstraint</code>.</p><p>Fixes (the rather artificial) issue 300.
   But it is unsound when pruned metas occur and triggers issue 1914.
   Thus we deactivate it.
   This needs to be properly implemented, possibly using the
   metaPermuatation of each meta variable.</p></div></div><div class="top"><p class="src"><a id="v:computeSizeConstraint" class="def">computeSizeConstraint</a> :: <a href="Agda-TypeChecking-Monad-Base.html#t:ProblemConstraint" title="Agda.TypeChecking.Monad.Base">ProblemConstraint</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:HypSizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">HypSizeConstraint</a>) <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#computeSizeConstraint" class="link">Source</a> <a href="#v:computeSizeConstraint" class="selflink">#</a></p><div class="doc"><p>Turn a constraint over de Bruijn indices into a size constraint.</p></div></div><div class="top"><p class="src"><a id="v:sizeExpr" class="def">sizeExpr</a> :: <a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a> -&gt; <a href="Agda-TypeChecking-Monad-Base.html#t:TCM" title="Agda.TypeChecking.Monad.Base">TCM</a> (<a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:DBSizeExpr" title="Agda.TypeChecking.SizedTypes.Syntax">DBSizeExpr</a>) <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#sizeExpr" class="link">Source</a> <a href="#v:sizeExpr" class="selflink">#</a></p><div class="doc"><p>Turn a term into a size expression.</p><p>Returns <code><a href="https://hackage.haskell.org/package/base-4.21.0.0/docs/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> if the term isn't a proper size expression.</p></div></div><h1>Orphan instances</h1><div id="section.orphans"><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:ic:Subst:Subst:1"></span> <a href="Agda-TypeChecking-Substitute-Class.html#t:Subst" title="Agda.TypeChecking.Substitute.Class">Subst</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a></span> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#line-672" class="link">Source</a> <a href="#v:-36-fSubstConstraint-39-" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:o:ic:Subst:Subst:1"><summary class="hide-when-js-enabled">Instance details</summary><p></p> <div class="subs associated-types"><p class="caption">Associated Types</p><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:if:D:R:SubstArgConstraint-39-:SubstArg:1"></span> <span class="keyword">type</span> <a href="Agda-TypeChecking-Substitute-Class.html#t:SubstArg" title="Agda.TypeChecking.Substitute.Class">SubstArg</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a></span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:o:if:D:R:SubstArgConstraint-39-:SubstArg:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Agda-TypeChecking-SizedTypes-Solve.html">Agda.TypeChecking.SizedTypes.Solve</a></p> <div class="src"><span class="keyword">type</span> <a href="Agda-TypeChecking-Substitute-Class.html#t:SubstArg" title="Agda.TypeChecking.Substitute.Class">SubstArg</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a> = <a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a></div></details></td></tr></table></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:applySubst">applySubst</a> :: <a href="Agda-Syntax-Internal.html#t:Substitution-39-" title="Agda.Syntax.Internal">Substitution'</a> (<a href="Agda-TypeChecking-Substitute-Class.html#t:SubstArg" title="Agda.TypeChecking.Substitute.Class">SubstArg</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a>) -&gt; <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeConstraint" title="Agda.TypeChecking.SizedTypes.Syntax">SizeConstraint</a> <a href="src/Agda.TypeChecking.Substitute.Class.html#applySubst" class="link">Source</a> <a href="#v:applySubst" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:ic:Subst:Subst:2"></span> <a href="Agda-TypeChecking-Substitute-Class.html#t:Subst" title="Agda.TypeChecking.Substitute.Class">Subst</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a></span> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#line-650" class="link">Source</a> <a href="#v:-36-fSubstSizeMeta" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:o:ic:Subst:Subst:2"><summary class="hide-when-js-enabled">Instance details</summary><p></p> <div class="subs associated-types"><p class="caption">Associated Types</p><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:if:D:R:SubstArgSizeMeta:SubstArg:1"></span> <span class="keyword">type</span> <a href="Agda-TypeChecking-Substitute-Class.html#t:SubstArg" title="Agda.TypeChecking.Substitute.Class">SubstArg</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a></span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:o:if:D:R:SubstArgSizeMeta:SubstArg:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Agda-TypeChecking-SizedTypes-Solve.html">Agda.TypeChecking.SizedTypes.Solve</a></p> <div class="src"><span class="keyword">type</span> <a href="Agda-TypeChecking-Substitute-Class.html#t:SubstArg" title="Agda.TypeChecking.Substitute.Class">SubstArg</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a> = <a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a></div></details></td></tr></table></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:applySubst">applySubst</a> :: <a href="Agda-Syntax-Internal.html#t:Substitution-39-" title="Agda.Syntax.Internal">Substitution'</a> (<a href="Agda-TypeChecking-Substitute-Class.html#t:SubstArg" title="Agda.TypeChecking.Substitute.Class">SubstArg</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a>) -&gt; <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a> <a href="src/Agda.TypeChecking.Substitute.Class.html#applySubst" class="link">Source</a> <a href="#v:applySubst" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:ic:Subst:Subst:3"></span> <a href="Agda-TypeChecking-Substitute-Class.html#t:Subst" title="Agda.TypeChecking.Substitute.Class">Subst</a> (<a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeExpr-39-" title="Agda.TypeChecking.SizedTypes.Syntax">SizeExpr'</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:NamedRigid" title="Agda.TypeChecking.SizedTypes.Syntax">NamedRigid</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a>)</span> <a href="src/Agda.TypeChecking.SizedTypes.Solve.html#line-660" class="link">Source</a> <a href="#v:-36-fSubstSizeExpr-39-" class="selflink">#</a></td><td class="doc"><p>Only for <code><a href="Agda-TypeChecking-Substitute-Class.html#v:raise" title="Agda.TypeChecking.Substitute.Class">raise</a></code>.</p></td></tr><tr><td colspan="2"><details id="i:o:ic:Subst:Subst:3"><summary class="hide-when-js-enabled">Instance details</summary><p></p> <div class="subs associated-types"><p class="caption">Associated Types</p><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:o:if:D:R:SubstArgSizeExpr-39-:SubstArg:1"></span> <span class="keyword">type</span> <a href="Agda-TypeChecking-Substitute-Class.html#t:SubstArg" title="Agda.TypeChecking.Substitute.Class">SubstArg</a> (<a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeExpr-39-" title="Agda.TypeChecking.SizedTypes.Syntax">SizeExpr'</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:NamedRigid" title="Agda.TypeChecking.SizedTypes.Syntax">NamedRigid</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a>)</span></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:o:if:D:R:SubstArgSizeExpr-39-:SubstArg:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Agda-TypeChecking-SizedTypes-Solve.html">Agda.TypeChecking.SizedTypes.Solve</a></p> <div class="src"><span class="keyword">type</span> <a href="Agda-TypeChecking-Substitute-Class.html#t:SubstArg" title="Agda.TypeChecking.Substitute.Class">SubstArg</a> (<a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeExpr-39-" title="Agda.TypeChecking.SizedTypes.Syntax">SizeExpr'</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:NamedRigid" title="Agda.TypeChecking.SizedTypes.Syntax">NamedRigid</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a>) = <a href="Agda-Syntax-Internal.html#t:Term" title="Agda.Syntax.Internal">Term</a></div></details></td></tr></table></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:applySubst">applySubst</a> :: <a href="Agda-Syntax-Internal.html#t:Substitution-39-" title="Agda.Syntax.Internal">Substitution'</a> (<a href="Agda-TypeChecking-Substitute-Class.html#t:SubstArg" title="Agda.TypeChecking.Substitute.Class">SubstArg</a> (<a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeExpr-39-" title="Agda.TypeChecking.SizedTypes.Syntax">SizeExpr'</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:NamedRigid" title="Agda.TypeChecking.SizedTypes.Syntax">NamedRigid</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a>)) -&gt; <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeExpr-39-" title="Agda.TypeChecking.SizedTypes.Syntax">SizeExpr'</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:NamedRigid" title="Agda.TypeChecking.SizedTypes.Syntax">NamedRigid</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a> -&gt; <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeExpr-39-" title="Agda.TypeChecking.SizedTypes.Syntax">SizeExpr'</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:NamedRigid" title="Agda.TypeChecking.SizedTypes.Syntax">NamedRigid</a> <a href="Agda-TypeChecking-SizedTypes-Syntax.html#t:SizeMeta" title="Agda.TypeChecking.SizedTypes.Syntax">SizeMeta</a> <a href="src/Agda.TypeChecking.Substitute.Class.html#applySubst" class="link">Source</a> <a href="#v:applySubst" class="selflink">#</a></p></div></details></td></tr></table></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.30.0</p></div></body></html>